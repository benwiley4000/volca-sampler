(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{102:function(U,re,g){},103:function(U,re,g){},134:function(U,re,g){"use strict";g.r(re);var u=g(0),r=g.n(u),ct=g(10),aa=g.n(ct),Nn=g(102),xn=g(103),He=g(146),ge=g(149),se=g(148),Ee=g(141),na=g(20),ce=g.n(na);function ra({onMenuOpen:e,onHeaderClick:t}){return r.a.createElement("div",{className:ce.a.titleBar},r.a.createElement("span",{className:ce.a.menuIcon,onClick:e},"\u2630"),r.a.createElement(Ee.a,{fluid:"sm",className:ce.a.titleContainer},r.a.createElement("h1",{className:ce.a.title,onClick:t},r.a.createElement("span",{className:ce.a.titleText,"data-text":"Volca Sample"},"Volca Sample",r.a.createElement("span",{className:ce.a.titleR},"r"),r.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:ce.a.titleStarburst},Array(24).fill().map((a,n,{length:o})=>r.a.createElement("polygon",{key:n,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${n*360/o}deg`}})))),r.a.createElement("img",{className:ce.a.titleGraphic,src:"volca_sample.png",alt:""}))),r.a.createElement("svg",{width:0,height:0},r.a.createElement("filter",{id:"outline"},r.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),r.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),r.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),r.a.createElement("feMerge",null,r.a.createElement("feMergeNode",{in:"OUTLINE"}),r.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var oa=ra,it=g(53),la=g(54),st=g.n(la),ca=g(45),we=g.n(ca),ut=g(150),dt=g(79);const Se=31250;var ia=Object.defineProperty,sa=Object.defineProperties,ua=Object.getOwnPropertyDescriptors,Oe=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,ze=(e,t,a)=>t in e?ia(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Q=(e,t)=>{for(var a in t||(t={}))ft.call(t,a)&&ze(e,a,t[a]);if(Oe)for(var a of Oe(t))mt.call(t,a)&&ze(e,a,t[a]);return e},oe=(e,t)=>sa(e,ua(t)),Ce=(e,t)=>{var a={};for(var n in e)ft.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&Oe)for(var n of Oe(e))t.indexOf(n)<0&&mt.call(e,n)&&(a[n]=e[n]);return a},De=(e,t,a)=>(ze(e,typeof t!="symbol"?t+"":t,a),a),q=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const ke=we.a.createInstance({name:"audio_file_data",driver:we.a.INDEXEDDB}),Pe=we.a.createInstance({name:"sample_metadata",driver:we.a.INDEXEDDB});function da(e){return q(this,null,function*(){const t=Object(ut.a)();return yield ke.setItem(t,e),t})}const Ve="0.5.0",fa={"0.1.0":e=>{const t=e,{clip:a}=t,n=Ce(t,["clip"]);return oe(Q({},n),{trimFrames:a.map(i=>Math.round(i*Se)),metadataVersion:"0.2.0"})},"0.2.0":e=>q(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=Ce(t,["trimFrames"]),o=yield Re(n.sourceFileId,!1),i=yield Dt(o,a),c={frames:a,waveformPeaks:i};return oe(Q({},n),{trim:c,metadataVersion:"0.3.0"})}),"0.3.0":e=>{const t=e,{dateSampled:a,dateModified:n}=t,o=Ce(t,["dateSampled","dateModified"]);return oe(Q({},o),{dateSampled:new Date(a).toISOString(),dateModified:new Date(n).toISOString(),metadataVersion:"0.4.0"})},"0.4.0":e=>q(void 0,null,function*(){const t=e,{scaleCoefficient:a,trim:{frames:n,waveformPeaks:o}}=t,i=Ce(t,["scaleCoefficient","trim"]),c=yield Re(i.sourceFileId,!1),s=je(c,n),l=me(s);return oe(Q({},i),{normalize:a!==1,trim:{frames:n,waveformPeaks:oe(Q({},o),{normalizationCoefficient:1/l})},metadataVersion:"0.5.0"})})};function ma(e){return q(this,null,function*(){let t=e;for(;t.metadataVersion!==Ve;){const a=fa[t.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:Ve};break}t=yield a(t)}return t})}const fe=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(ut.a)(),userFileInfo:o=null,slotNumber:i=0,dateSampled:c=new Date().toISOString(),dateModified:s=c,useCompression:l=!0,qualityBitDepth:d=16,normalize:b=!0}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:o,slotNumber:i,dateSampled:c,dateModified:s,useCompression:l,qualityBitDepth:d,normalize:b,metadataVersion:Ve}}duplicate(){const e=new fe.Mutable(oe(Q({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:new Date().toISOString()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return q(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),o=new Uint8Array(n);return this.cacheSourceFileData(e,o),o}const t=yield ke.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return q(this,null,function*(){const e=new Map,t=[];return yield Pe.iterate((a,n)=>{a&&t.push(ma(a).then(o=>{e.set(n,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${n}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return q(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield pt(),a=(yield ke.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,i])=>{const{sourceFileId:c}=i;return a.includes(c)?new fe.Mutable(Q({id:o},i)):(console.warn(`Found metadata "${i.name||o}" with missing data "${c}; ignoring.`),null)}).filter(Boolean).sort(({metadata:{dateModified:o}},{metadata:{dateModified:i}})=>o>i?-1:i>o?1:0)})}};let $=fe;De($,"Mutable",class extends fe{constructor(e){super(e);setTimeout(()=>q(this,null,function*(){(yield Pe.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return q(this,null,function*(){yield Pe.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,n=typeof e=="function"?e(a):e;if(Object.keys(n).every(c=>n[c]===a[c]))return this;const o=oe(Q(Q({},a),n),{dateModified:new Date().toISOString()}),i=new fe.Mutable(Q({id:t},o));return i.persist(),i}remove(){return q(this,null,function*(){if(yield Pe.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield fe.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield ke.removeItem(this.metadata.sourceFileId)})}}),De($,"sourceFileData",new Map),De($,"recentlyCachedSourceFileIds",[]),De($,"MAX_CACHED",10);let Ue;function pt(){return Ue||(Ue=fetch("factory-samples.json").then(e=>e.json())),Ue}function pa(){return q(this,null,function*(){const e=yield pt();return new Map(e.map(t=>[t.id,new $(oe(Q({},t),{normalize:!1,trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:oe(Q({},t.trim.waveformPeaks),{positive:new Float32Array(Object(dt.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(dt.a)(t.trim.waveformPeaks.negative))})}}))]))})}var vt=Math.pow,$e=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function Ae(e,t){const a=4,n=t[0]*a,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,o)}function je(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),o=Array(e.numberOfChannels).fill().map((i,c)=>Ae(e.getChannelData(c),t));for(let i=0;i<a;i++){let c=0;for(let s=0;s<o.length;s++)c+=o[s][i];c/=o.length,n[i]=c}return n}function me(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function va(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function ha(e){const t=me(e);va(e,1/t)}function ya(e,t){const a=vt(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function ht(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function ba(e){const t=e.length,a=e[0].length,n=new Float32Array(t*a);for(let o=0;o<n.length;o++){const i=t*o;for(let c=0;c<t;c++)n[i+c]=e[c][o]}return n}function yt(e){const t=new Int16Array(e.length),a=vt(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function bt(){return window.AudioContext||window.webkitAudioContext}let gt;function Et(){const e=bt();return gt=gt||new e({sampleRate:Se})}function pe(e){return $e(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,o)=>{Et().decodeAudioData(t.buffer,n,o)})})}function Re(e,t){return $e(this,null,function*(){const a=yield $.getSourceFileData(e),n=yield pe(a);if(t)for(let o=0;o<n.numberOfChannels;o++)ht(n.getChannelData(o));return n})}function Xe(e){return $e(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,normalize:o,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const c=yield Re(a,Boolean(n)),s=c.numberOfChannels===1?Ae(c.getChannelData(0),i):je(c,i);o&&ha(s),t<16&&ya(s,t);const l=yt(s),d=l.length*2,b=st()({channels:1,sampleRate:c.sampleRate,bitDepth:16,dataLength:d}),f=new Uint8Array(b.length+d);return f.set(b),f.set(new Uint8Array(l.buffer),b.length),{data:f,sampleRate:16}})}const ga={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},wt=Object(u.createContext)(ga);function Ea({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((o,{onTimeUpdate:i=()=>null,onEnded:c=()=>null}={})=>{t.current();const s=Et(),l=s.createBufferSource();l.buffer=o,l.connect(s.destination),l.start();const d=s.currentTime;i(0);let b=requestAnimationFrame(f);function f(){i(s.currentTime-d),b=requestAnimationFrame(f)}let v=!1;l.addEventListener("ended",()=>{v||(i(o.duration),c()),cancelAnimationFrame(b)});function h(){v||(l.stop(),cancelAnimationFrame(b),c(),v=!0)}return t.current=h,h},[]),n=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(wt.Provider,{value:n},e)}function Be(){return Object(u.useContext)(wt)}var St=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const ve=6,Ot=ve*44;function Ct(e,t){const a=Math.floor(ve*e.length/t),n=new Float32Array(Math.floor(e.length/a)),o=new Float32Array(Math.floor(e.length/a));for(let l=0;l<n.length;l++){const d=new Float32Array(e.buffer,l*a*4,a);let b=0,f=0;for(const v of d)v>b&&(b=v),v<f&&(f=v);n[l]=Math.min(1,b),o[l]=Math.max(-1,f)}const i=e.length%a,c=new Float32Array(n.length+o.length+i);c.set(n,0),c.set(o,n.length),c.set(new Float32Array(e.buffer,(e.length-i)*4,i),n.length+o.length);const s=me(c);return{positive:n,negative:o,normalizationCoefficient:1/s}}function Dt(e,t){return St(this,null,function*(){const a=je(e,t);return Ct(a,Ot)})}function kt(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let o=!1;return(()=>St(this,null,function*(){if(o)return;const i=yield Re(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));o||a([e.metadata.sourceFileId,i])}))(),()=>{o=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const n=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(n.current=e),{sample:n.current,sourceAudioBuffer:t&&t[1]}}function Pt(e){const t=Object(u.useMemo)(()=>e?je(e,[0,0]):new Float32Array,[e]),[a,n]=Object(u.useState)(null),[o,i]=Object(u.useState)({width:0,height:0}),c=Object(u.useMemo)(()=>a&&(o.width||a.offsetWidth),[a,o]),s=Object(u.useMemo)(()=>!c||!t.length?{positive:new Float32Array,negative:new Float32Array,normalizationCoefficient:1/0}:Ct(t,c),[c,t]);return{monoSamples:t,waveformRef:n,pixelWidth:c,peaks:s,onResize:i}}var wa=g(89),Sa=Object.defineProperty,At=Object.getOwnPropertySymbols,Oa=Object.prototype.hasOwnProperty,Ca=Object.prototype.propertyIsEnumerable,jt=(e,t,a)=>t in e?Sa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Rt=(e,t)=>{for(var a in t||(t={}))Oa.call(t,a)&&jt(e,a,t[a]);if(At)for(var a of At(t))Ca.call(t,a)&&jt(e,a,t[a]);return e};const Da=it.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function ka(e,t){function a(o,i){e.width=o,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new wa.a(([o])=>{const{width:i,height:c}=o.contentRect;a(i,c),t({width:i,height:c})});return n.observe(e),()=>n.disconnect()}function Pa(e,t,a){const n=getComputedStyle(document.documentElement),o=n.getPropertyValue("--bs-primary"),i=n.getPropertyValue("--bs-primary-darkened"),c=e.getContext("2d");c.imageSmoothingEnabled=!1;const{width:s,height:l}=e;c.clearRect(0,0,s,l);const d=Math.floor(l*(2/3))+1;c.fillStyle=o,t.positive.forEach((f,v)=>{const h=d*f,E=Math.max(Math.round(a*h),1);c.fillRect(v*ve,d-E,ve-1,E)});const b=l-d;c.fillStyle=i,t.negative.forEach((f,v)=>{const h=b*f*-1,E=Math.round(a*h);c.fillRect(v*ve,d,ve-1,E)})}function Aa({peaks:e,scaleCoefficient:t,waveformRef:a,onResize:n}){const o=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>o.current);const[i,c]=Object(u.useState)(Symbol()),s=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!o.current)throw new Error("Canvas should be defined");return s.current.width=o.current.offsetWidth,s.current.height=o.current.offsetHeight,n&&n(Rt({},s.current)),ka(o.current,({width:l,height:d})=>{(l!==s.current.width||d!==s.current.height)&&(c(Symbol()),s.current.width=l,s.current.height=d,n&&n(Rt({},s.current)))})},[n]),Object(u.useLayoutEffect)(()=>{const l=o.current;if(!l)throw new Error("Canvas should be defined");let d=requestAnimationFrame(()=>{d=requestAnimationFrame(()=>{Pa(l,e,t===void 0?e.normalizationCoefficient:t)})});return()=>cancelAnimationFrame(d)},[e,t,i]),r.a.createElement(Da,{ref:o})}var Ge=Aa;const ja=it.a.div({width:`${Ot}px`,height:"40px"}),Bt=typeof IntersectionObserver!="undefined",Ra=r.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(u.useRef)(null),[o,i]=Object(u.useState)(!Bt);return Object(u.useLayoutEffect)(()=>{if(!Bt)return;const c=n.current;if(!c)throw new Error("Waveform container should be defined");const s=c.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){i(!0);return}const l=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),l.unobserve(c))});return l.observe(c),()=>l.disconnect()},[]),r.a.createElement(ge.a.Item,{active:t,onClick:()=>a(e.id)},r.a.createElement("div",null,e.metadata.name),r.a.createElement(ja,{ref:n},o&&r.a.createElement(Ge,{peaks:e.metadata.trim.waveformPeaks})))});function Ba({samples:e,selectedSampleId:t,onSampleSelect:a}){return r.a.createElement(ge.a,{variant:"flush"},[...e].map(([n,o])=>r.a.createElement(Ra,{key:n,sample:o,selected:n===t,onSampleSelect:a})))}var Mt=Ba,Ma=g(143),Me=g(96),Ke=g(147),Ye=g(142),X=g(145),G=g(92),Ia=g(90),La=g(91),Na=g(7),W=g.n(Na);function Ie(e,t){return`0:${e.toFixed(t).padStart(3+t,"0")}`}function xa({sample:e,previewWav:t,onSetTrimFrames:a}){const{sample:{metadata:{trim:{frames:n},normalize:o}},sourceAudioBuffer:i}=kt(e),{monoSamples:c,waveformRef:s,pixelWidth:l,peaks:d,onResize:b}=Pt(i),f=Object(u.useMemo)(()=>{if(!i)return 0;const A=Ae(c,n);return me(A)},[i,c,n]),v=1/f,[h,E]=Object(u.useState)(n);Object(u.useEffect)(()=>{E(n)},[n]);const m=Object(u.useMemo)(()=>{if(!c.length||!l)return[0,0];const A=l/c.length;return h.map(R=>R*A)},[l,c.length,h]),w=Object(u.useRef)(null),C=Object(u.useRef)(null),S=Object(u.useRef)(null);{const A=Object(u.useRef)(null),R=Object(u.useRef)(null),_=Object(u.useRef)(null),T=Object(u.useRef)(!1),z=Object(u.useRef)(null);Object(u.useLayoutEffect)(()=>{z.current&&(clearTimeout(z.current),z.current=null)},[h]);const ae=Object(u.useMemo)(()=>{if(!l||!c.length)return null;const V=Math.max(2e3,Math.ceil(10*c.length/l));return{pixelWidth:l,monoSamplesLength:c.length,minFrameWidth:V}},[l,c.length]),J=Object(u.useRef)(h);J.current=h,Object(u.useEffect)(()=>{if(!ae||!w.current||!C.current||!S.current)return;const{pixelWidth:ee,monoSamplesLength:V,minFrameWidth:ie}=ae,{left:Qt}=S.current.getBoundingClientRect();function Fe(y){y instanceof TouchEvent&&y.preventDefault(),document.body.style.userSelect="none";const{pageX:B}=y instanceof MouseEvent?y:y.touches[0];A.current=B}function Te(y){y instanceof TouchEvent&&y.preventDefault(),document.body.style.userSelect="none";const{pageX:B}=y instanceof MouseEvent?y:y.touches[0];R.current=B}function We(y){if(y instanceof TouchEvent&&y.preventDefault(),y.detail===2){a(()=>[0,0]);return}document.body.style.userSelect="none";const{clientX:B}=y instanceof MouseEvent?y:y.touches[0],ne=(B-Qt)/ee,x=Math.round(V*ne),ue=x+ie,de=ue<V?ue:x-ie;de<0||(E([Math.min(x,de),V-1-Math.max(x,de)]),_.current=x)}function tt(y){const B=y/ee,Z=Math.round(V*B);E(ne=>{let x=ne[0]+Z;return x=Math.min(x,V-ne[1]-ie),x=Math.max(x,0),[x,ne[1]]})}function at(y){if(A.current===null)return;y instanceof TouchEvent&&y.preventDefault();const{pageX:B}=y instanceof MouseEvent?y:y.touches[0],Z=B-A.current;Z&&(tt(Z),A.current=B)}function nt(y){const B=y/ee,Z=Math.round(V*B);E(ne=>{let x=ne[1]+Z;return x=Math.min(x,V-ne[0]-ie),x=Math.max(x,0),[ne[0],x]})}function rt(y){if(R.current===null)return;y instanceof TouchEvent&&y.preventDefault();const{pageX:B}=y instanceof MouseEvent?y:y.touches[0],Z=R.current-B;Z&&(nt(Z),R.current=B)}let _e=!1;function Zt(y){if(A.current!==null)return;let B=!0;switch(y.key){case"ArrowLeft":tt(-1);break;case"ArrowRight":tt(1);break;default:B=!1;break}B&&(y.stopPropagation(),y.preventDefault(),_e=!0)}function qt(y){if(R.current!==null)return;let B=!0;switch(y.key){case"ArrowLeft":nt(1);break;case"ArrowRight":nt(-1);break;default:B=!1;break}B&&(y.stopPropagation(),y.preventDefault(),_e=!0)}function ot(y){if(_.current===null)return;y instanceof TouchEvent&&y.preventDefault();const B=_.current,{clientX:Z}=y instanceof MouseEvent?y:y.touches[0],x=(Z-Qt)/ee,ue=Math.max(0,Math.min(V-1,Math.round(V*x)));if(ue!==_.current){T.current=!0;const de=B+ie,lt=B-ie,ta=ue>B?de<V?Math.max(ue,de):lt:lt>=0?Math.min(ue,lt):de;E([Math.min(B,ta),V-1-Math.max(B,ta)])}}function ea(y){at(y),rt(y),ot(y)}function F(y){(A.current!==null||R.current!==null||_.current!==null||_e)&&((y instanceof TouchEvent||y instanceof KeyboardEvent)&&y.preventDefault(),_.current&&!T.current&&y.detail===1?z.current=setTimeout(()=>{z.current=null,a(()=>J.current)},250):a(()=>J.current),A.current=null,R.current=null,_.current=null,T.current=!1,_e=!1),document.body.style.userSelect="unset"}const K=w.current,Y=C.current,te=S.current;function he(y){y.target instanceof Node&&te.contains(y.target)||z.current&&(clearTimeout(z.current),z.current=null,a(()=>J.current))}return K.addEventListener("touchstart",Fe),K.addEventListener("mousedown",Fe),Y.addEventListener("touchstart",Te),Y.addEventListener("mousedown",Te),te.addEventListener("touchstart",We),te.addEventListener("mousedown",We),K.addEventListener("touchmove",at),Y.addEventListener("touchmove",rt),K.addEventListener("keydown",Zt),Y.addEventListener("keydown",qt),te.addEventListener("touchmove",ot),window.addEventListener("mousemove",ea),K.addEventListener("touchend",F),K.addEventListener("touchcancel",F),K.addEventListener("keyup",F),Y.addEventListener("touchend",F),Y.addEventListener("keyup",F),Y.addEventListener("touchcancel",F),te.addEventListener("touchend",F),te.addEventListener("touchcancel",F),window.addEventListener("mouseup",F),window.addEventListener("touchstart",he,{capture:!0}),window.addEventListener("mousedown",he,{capture:!0}),window.addEventListener("keydown",he,{capture:!0}),()=>{K.removeEventListener("touchstart",Fe),K.removeEventListener("mousedown",Fe),Y.removeEventListener("touchstart",Te),Y.removeEventListener("mousedown",Te),te.removeEventListener("touchstart",We),te.removeEventListener("mousedown",We),K.removeEventListener("touchmove",at),Y.removeEventListener("touchmove",rt),K.removeEventListener("keydown",Zt),Y.removeEventListener("keydown",qt),te.removeEventListener("touchmove",ot),window.removeEventListener("mousemove",ea),K.removeEventListener("touchend",F),K.removeEventListener("touchcancel",F),K.removeEventListener("keyup",F),Y.removeEventListener("touchend",F),Y.removeEventListener("keyup",F),Y.removeEventListener("touchcancel",F),te.removeEventListener("touchend",F),te.removeEventListener("touchcancel",F),window.removeEventListener("mouseup",F),window.removeEventListener("touchstart",he,{capture:!0}),window.removeEventListener("mousedown",he,{capture:!0}),window.removeEventListener("keydown",he,{capture:!0})}},[ae,a])}const{playAudioBuffer:M}=Be(),P=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>P.current(),[e,h]);const[j,N]=Object(u.useState)(null);Object(u.useEffect)(()=>{t instanceof AudioBuffer&&j&&(N(null),j.fn())},[t,j]);const[I,H]=Object(u.useState)(0),[O,L]=Object(u.useState)(!1),[D,k]=Object(u.useState)("");Object(u.useEffect)(()=>{t&&k(Ie(O?I*t.duration:t.duration,1))},[t,O,I]);const p=Object(u.useCallback)(A=>{if(O)P.current();else if(t)P.current=M(t,{onTimeUpdate(R){H(R/t.duration)},onEnded(){L(!1)}}),H(0),L(!0);else{const R=A.target;N({fn:()=>R.dispatchEvent(A)})}},[O,M,t]);return Object(u.useEffect)(()=>{function A(R){R.key===" "&&(R.preventDefault(),p(R))}return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[p]),r.a.createElement("div",{className:[W.a.waveformContainer,O?W.a.playbackActive:""].join(" "),style:{"--trim-pixels-left":`${m[0]}px`,"--trim-pixels-right":`${m[1]}px`,"--playback-progress":`${100*I}%`}},r.a.createElement(Ge,{waveformRef:s,peaks:d,scaleCoefficient:o?v:1,onResize:b}),r.a.createElement("div",{className:W.a.playbackOverlay},r.a.createElement("div",{className:W.a.playback})),r.a.createElement("div",{className:W.a.playbackButtonContainer},r.a.createElement(Ke.a,{delay:{show:400,hide:0},overlay:r.a.createElement(Ye.a,null,"Preview how your sample will sound on the Volca Sample")},r.a.createElement(G.a,{variant:"dark",onClick:A=>p(A.nativeEvent)},r.a.createElement("img",{src:O?La.a:Ia.a,alt:"Play preview"}))),D&&r.a.createElement("span",null,D)),r.a.createElement("div",{className:[W.a.trim,W.a.left].join(" ")},r.a.createElement("div",{className:W.a.bar}),r.a.createElement("div",{ref:w,className:W.a.handle,tabIndex:0}),i&&Boolean(c.length)&&r.a.createElement("span",{className:W.a.time},Ie(i.duration*h[0]/c.length,2))),r.a.createElement("div",{className:[W.a.trim,W.a.right].join(" ")},r.a.createElement("div",{className:W.a.bar}),r.a.createElement("div",{ref:C,className:W.a.handle,tabIndex:0}),i&&Boolean(c.length)&&r.a.createElement("span",{className:W.a.time},Ie(i.duration*(c.length-1-h[1])/c.length,2))),r.a.createElement("div",{ref:S,className:W.a.waveformOverlay}))}var Fa=xa,Ta=g(151),Wa=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});let It;function _a(){return Wa(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return It=It||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){a(o);return}t(n)})})}var Ha=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function za(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Ha(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:c,getSampleBufferProgress:s,getSampleBufferTotalSize:l,cancelSampleBufferWork:d,registerUpdateCallback:b,unregisterUpdateCallback:f,heap8Buffer:v}=yield _a();if(a)return new Uint8Array;const{data:h}=yield Xe(e);if(a)return new Uint8Array;let E,m=0;const w=b(S=>{if(a)return;const M=l(S);E||(E=new Uint8Array(M));const P=i(S),j=c(S),N=s(S);E.set(new Uint8Array(v(),P,j),N-j),m=N/M}),C=o(h,h.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,w);t(m);try{yield new Promise(S=>{let M;n=()=>{cancelAnimationFrame(M),d(C),S()},P();function P(){if(m&&(t(m),m>=1)){S();return}M=requestAnimationFrame(P)}})}finally{n=()=>{},f(w)}if(a)return new Uint8Array;if(!E)throw new Error("Unexpected condition: sampleBuffer should be defined");return E}))()}}var Va=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function Ua({sample:e}){const[t,a]=Object(u.useState)(0),[n,o]=Object(u.useState)("idle"),[i,c]=Object(u.useState)(null),[s,l]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&s&&(l(null),s.fn())},[i,s]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let f=!1;a(0),o("idle"),c(null),l(null),d.current=()=>{f=!0};try{const{sampleBufferPromise:v,cancelWork:h}=za(e,E=>{f||a(E)});d.current=()=>{h(),f=!0},v.then(E=>Va(this,null,function*(){if(f)return;d.current=()=>{f=!0};const m=yield pe(E);f||c(m)}))}catch(v){console.error(v),c(new Error(String(v)))}return()=>d.current()},[e]);const{playAudioBuffer:b}=Be();return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,{type:"button",variant:"primary",onClick:f=>{if(!(i instanceof AudioBuffer)){if(!i){const{target:v,nativeEvent:h}=f;l({fn:()=>v.dispatchEvent(h)})}return}try{o("transferring");const v=b(i,{onTimeUpdate:h=>a(h/i.duration),onEnded:()=>o("idle")});d.current=()=>{v(),o("idle")}}catch(v){console.error(v),o("error")}},disabled:i instanceof Error||n==="transferring"},"Transfer to volca sample"),r.a.createElement("br",null),i&&n==="idle"?null:n==="error"?"Error transferring":r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),r.a.createElement(Ta.a,{now:100*t}),r.a.createElement("br",null),r.a.createElement(G.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),r.a.createElement("br",null))}var Lt=Ua,Nt=g(74),xt=g.n(Nt),Je=g(75),Qe=g(76),$a=g(93),Xa=g(19),le=g.n(Xa),Ft=Math.pow;Nt.Digit.defaultProps.offOpacity=0;const Tt=(e,t)=>Math.min(199,t+Ft(10,e)),Wt=(e,t)=>Math.max(0,t-Ft(10,e));function Ga({slotNumber:e,onSlotNumberUpdate:t}){const[a,n]=Object(u.useState)(e);Object(u.useEffect)(()=>{n(e)},[e]);const[o,i]=Object(u.useState)(null),c=Object(u.useCallback)(b=>{t(f=>Tt(b,f))},[t]),s=Object(u.useCallback)(b=>{t(f=>Wt(b,f))},[t]),l=Object(u.useRef)(null),d=Object(u.useRef)(null);{const b=Object(u.useRef)(o);b.current=o;const f=Object(u.useRef)(a);f.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function v(O){const L=b.current===null?0:b.current;let D=!0;const k=()=>{i(L)};switch(O.key){case"ArrowDown":k(),n(p=>Wt(L,p));break;case"ArrowUp":k(),n(p=>Tt(L,p));break;case"ArrowLeft":k(),i(p=>p!==null&&p<2?p+1:p);break;case"ArrowRight":k(),i(p=>p&&p-1);break;case"Enter":case"Escape":i(null);break;default:D=!1;break}D&&O.preventDefault()}function h(O){const L=b.current===null?2:b.current;O.stopPropagation(),O.preventDefault();const D=f.current;if(isNaN(Number(O.key)))t(D);else{const k=String(D).padStart(3,"0").split("");k[2-L]=O.key;const p=Math.min(199,Math.max(0,Number(k.join(""))));i(L?L-1:null),t(p)}}const E=l.current;E.addEventListener("keydown",v,!0),E.addEventListener("keyup",h,!0);let m=0,w=!1,C=!1,S=0;function M(O){document.body.style.userSelect="none",m=O instanceof MouseEvent?O.pageY:O.touches[0].pageY,w=!0,C=!1,S=f.current}E.addEventListener("mousedown",M),E.addEventListener("touchstart",O=>{O.preventDefault(),M(O)});function P(O){if(!w)return;const{pageY:L}=O instanceof MouseEvent?O:O.touches[0],D=2,k=Math.round((m-L)/D);k&&(C=!0,n(Math.min(199,Math.max(0,S+k))))}window.addEventListener("mousemove",P),E.addEventListener("touchmove",P);function j(){document.body.style.userSelect="unset",w=!1,C&&t(f.current)}window.addEventListener("mouseup",j),E.addEventListener("touchend",j),E.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function N(O){C||d.current&&d.current.some(L=>L.contains(O.target))||i(2)}E.addEventListener("click",N),d.current.forEach((O,L)=>{const D=L;O.addEventListener("click",()=>{C||i(D)}),O.addEventListener("touchstart",k=>{k.preventDefault()})});function I(){w||i(2)}function H(){i(null)}return E.addEventListener("focus",I),E.addEventListener("blur",H),()=>{window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",j)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((b,f)=>{f===o?b.classList.add(le.a.active):b.classList.remove(le.a.active)})},[o]),r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Label,null,"Destination"),r.a.createElement("br",null),r.a.createElement("div",{className:le.a.slotNumberRow},r.a.createElement("div",{className:le.a.slotNumberContainer},r.a.createElement("div",{className:le.a.arrowControls},r.a.createElement("span",{onClick:()=>c(2)},r.a.createElement("img",{src:Je.a,alt:"Increment 100"})),r.a.createElement("span",{onClick:()=>c(1)},r.a.createElement("img",{src:Je.a,alt:"Increment 10"})),r.a.createElement("span",{onClick:()=>c(0)},r.a.createElement("img",{src:Je.a,alt:"Increment 1"}))),r.a.createElement("div",{className:le.a.slotNumber,title:`Slot ${a}`,ref:l,tabIndex:0},r.a.createElement(xt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),r.a.createElement(xt.a,{ref:b=>{const f=Object(ct.findDOMNode)(b);if(f){f.querySelectorAll("circle").forEach(h=>{f.removeChild(h)});const v=document.createElementNS("http://www.w3.org/2000/svg","circle");v.classList.add(le.a.point),v.setAttribute("cx","10.7"),v.setAttribute("cy","17"),v.setAttribute("r","1"),f.appendChild(v),d.current=[].slice.call(f.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),r.a.createElement("div",{className:le.a.arrowControls},r.a.createElement("span",{onClick:()=>s(2)},r.a.createElement("img",{src:Qe.a,alt:"Decrement 100"})),r.a.createElement("span",{onClick:()=>s(1)},r.a.createElement("img",{src:Qe.a,alt:"Decrement 10"})),r.a.createElement("span",{onClick:()=>s(0)},r.a.createElement("img",{src:Qe.a,alt:"Decrement 1"})))),e>99&&a>99&&r.a.createElement(Ke.a,{placement:"auto-end",overlay:r.a.createElement(Ye.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},r.a.createElement("img",{className:le.a.warning,src:$a.a,alt:"destination-warning"}))))}var _t=Ga,Ka=g(39),Le=g.n(Ka),Ya=Object.defineProperty,Ja=Object.defineProperties,Qa=Object.getOwnPropertyDescriptors,Ht=Object.getOwnPropertySymbols,Za=Object.prototype.hasOwnProperty,qa=Object.prototype.propertyIsEnumerable,zt=(e,t,a)=>t in e?Ya(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Vt=(e,t)=>{for(var a in t||(t={}))Za.call(t,a)&&zt(e,a,t[a]);if(Ht)for(var a of Ht(t))qa.call(t,a)&&zt(e,a,t[a]);return e},Ut=(e,t)=>Ja(e,Qa(t)),en=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function tn(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function an({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const o=e&&e.id,i=Object(u.useCallback)(m=>o&&t(o,w=>Ut(Vt({},w),{trim:Ut(Vt({},w.trim),{frames:m(w.trim.frames)})})),[o,t]),[c,s]=Object(u.useState)(null),[l,d]=Object(u.useState)(null),[b,f]=Object(u.useState)(null);Object(u.useEffect)(()=>{l instanceof AudioBuffer&&b&&(f(null),b.fn())},[l,b]),Object(u.useEffect)(()=>{s(null),f(null);let m=!1;Xe(e).then(({data:w})=>{m||s(w)})},[e]),Object(u.useEffect)(()=>{if(d(null),c){let m=!1;pe(c).then(w=>{m||d(w)})}},[c]);const{playAudioBuffer:v}=Be(),h=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>h.current(),[e]);const E=Object(u.useCallback)(m=>{t(e.id,({slotNumber:w})=>({slotNumber:typeof m=="function"?m(w):m}))},[e.id,t]);return r.a.createElement(Ee.a,{fluid:"sm"},r.a.createElement("h2",null,e.metadata.name,r.a.createElement(Ma.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},r.a.createElement(Me.a.Item,{onClick:()=>{const m=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),w=m&&m.trim();w&&t(e.id,{name:w})}},"Rename"),r.a.createElement(Me.a.Item,{onClick:()=>a(e.id)},"Duplicate"),r.a.createElement(Me.a.Divider,null),r.a.createElement(Me.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),r.a.createElement("br",null),r.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),r.a.createElement("br",null),r.a.createElement("div",null,r.a.createElement(Ke.a,{delay:{show:400,hide:0},overlay:r.a.createElement(Ye.a,null,"Boosts your sample's volume so its peak is at the same level as your other normalized samples")},r.a.createElement("div",{className:Le.a.normalizeControlWrapper},r.a.createElement(X.a.Switch,{label:"Normalize",checked:e.metadata.normalize,onChange:m=>t(e.id,{normalize:m.target.checked})})))),r.a.createElement("br",null),r.a.createElement("div",{className:Le.a.waveformBoundingBox},r.a.createElement(Fa,{onSetTrimFrames:i,sample:e,previewWav:l})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(G.a,{type:"button",variant:"secondary",size:"sm",onClick:m=>{if(l)h.current=v(l);else{const w=m.currentTarget;f({fn:()=>w.click()})}}},"Play audio preview")," ",r.a.createElement(G.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>en(this,null,function*(){const{sourceFileId:m,userFileInfo:w}=e.metadata,C=yield $.getSourceFileData(m),S=new Blob([C],{type:w?w.type:"audio/x-wav"});tn(S,`${e.metadata.name}${w?w.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(X.a.Group,null,r.a.createElement(X.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),r.a.createElement(X.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:m=>{const w=Number(m.target.value);t(e.id,{qualityBitDepth:w})}})),r.a.createElement(_t,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:E}),r.a.createElement("br",null),r.a.createElement(Lt,{sample:e}))}var nn=an,Ne=g(144);function rn({sample:e}){const{sample:{metadata:{normalize:t,trim:{frames:a}}},sourceAudioBuffer:n}=kt(e),{monoSamples:o,waveformRef:i,peaks:c}=Pt(n),s=Object(u.useMemo)(()=>{if(!n)return 0;const d=Ae(o,a);return me(d)},[n,o,a]),l=1/s;return r.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},r.a.createElement(Ge,{waveformRef:i,peaks:c,scaleCoefficient:t?l:1}))}var on=rn,ln=Object.defineProperty,cn=Object.defineProperties,sn=Object.getOwnPropertyDescriptors,$t=Object.getOwnPropertySymbols,un=Object.prototype.hasOwnProperty,dn=Object.prototype.propertyIsEnumerable,Xt=(e,t,a)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,fn=(e,t)=>{for(var a in t||(t={}))un.call(t,a)&&Xt(e,a,t[a]);if($t)for(var a of $t(t))dn.call(t,a)&&Xt(e,a,t[a]);return e},mn=(e,t)=>cn(e,sn(t)),pn=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function vn(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function hn(e){const t=e.metadata.slotNumber,[a,n]=Object(u.useState)(t);return Object(u.useEffect)(()=>{n(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new $(mn(fn({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:n}}function yn({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:n}=hn(e),[o,i]=Object(u.useState)(null),[c,s]=Object(u.useState)(null),[l,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{c instanceof AudioBuffer&&l&&(d(null),l.fn())},[c,l]),Object(u.useEffect)(()=>{i(null),d(null);let v=!1;Xe(a).then(({data:h})=>{v||i(h)})},[a]),Object(u.useEffect)(()=>{if(s(null),o){let v=!1;pe(o).then(h=>{v||s(h)})}},[o]);const{playAudioBuffer:b}=Be(),f=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>f.current(),[a]),r.a.createElement(Ee.a,{fluid:"sm"},r.a.createElement("h2",null,a.metadata.name),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),r.a.createElement(Ne.a,{variant:"secondary"},r.a.createElement(Ne.a.Heading,null,"This is a factory sample."),r.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",r.a.createElement("span",{className:Le.a.buttonLink},r.a.createElement(G.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),r.a.createElement("div",{className:Le.a.waveformContainer},r.a.createElement(on,{sample:a})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(G.a,{type:"button",variant:"secondary",size:"sm",onClick:v=>{if(c)f.current=b(c);else{const h=v.currentTarget;d({fn:()=>h.click()})}}},"Play audio preview")," ",r.a.createElement(G.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>pn(this,null,function*(){const{sourceFileId:v,userFileInfo:h}=a.metadata,E=yield $.getSourceFileData(v),m=new Blob([E],{type:h?h.type:"audio/x-wav"});vn(m,`${a.metadata.name}${h?h.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(X.a.Group,null,r.a.createElement(X.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),r.a.createElement(X.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),r.a.createElement(_t,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:n}),r.a.createElement("br",null),r.a.createElement(Lt,{sample:a}))}var bn=yn,gn=g(97),ye=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});let Gt;function Ze(){const e=bt();return Gt=Gt||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:Se}:{})}function En(){return ye(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of n.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>n.deviceId===s).label;let c=1;{const s=o.getAudioTracks()[0],l=s.getSettings().channelCount;l?c=l:s.getCapabilities&&(c=(s.getCapabilities().channelCount||{}).max||c)}for(const s of o.getTracks())s.stop();a.push({device:{deviceId:n.deviceId,label:i},channelsAvailable:c})}return a})}let qe;function wn(e){return ye(this,arguments,function*({onData:t,onFinish:a}){const n=Ze();qe=qe||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield qe;const o=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=c=>{if(c.data.eventType==="data"){const s=c.data.audioChannels;t(s)}c.data.eventType==="stop"&&a()};const i=o.parameters.get("isRecording");return i.setValueAtTime(1,n.currentTime),{recorderNode:o,stop(){i.setValueAtTime(0,n.currentTime)}}})}function Sn({channelCount:e,onData:t,onFinish:a}){const o=Ze().createScriptProcessor(1024,e,e);let i=!1;return o.onaudioprocess=c=>{const s=Array(e).fill().map((l,d)=>c.inputBuffer.getChannelData(d));t(s),i&&a()},{recorderNode:o,stop(){i=!0}}}function On(e){return ye(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Sn(e):yield wn(e)})}function Cn(e){return ye(this,arguments,function*({deviceId:t,channelCount:a,onStart:n,onUpdate:o}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:Se,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),c=Ze(),s=c.createMediaStreamSource(i),{recorderNode:l,stop:d}=yield On({channelCount:a,onData:E,onFinish:M});s.connect(l),l.connect(c.destination);const b=10;n(c.sampleRate,b);const f=b*c.sampleRate;let v=0;const h=Array(a).fill([]);function E(P){let j=0;const N=[];for(let O=0;O<a;O++){const L=P[O],D=L.length,k=L.slice(0,Math.min(D,f-v));ht(k),j||(j=k.length),N.push(k)}const I=ba(N),H=yt(I);h.push(H),v+=j,v>=f&&d(),o(N)}let m,w;const C=new Promise((P,j)=>{m=P,w=j});let S=!1;function M(){return ye(this,null,function*(){if(S)return;try{const N=yield new Blob(h).arrayBuffer(),I=new Float32Array(N),H=st()({channels:a,sampleRate:c.sampleRate,bitDepth:16,dataLength:I.byteLength}),O=new Uint8Array(H.length+I.byteLength);O.set(H),O.set(new Uint8Array(I.buffer),H.length),m(O)}catch(j){w(j)}const P=i.getTracks();for(const j of P)j.stop();l.disconnect(c.destination),s.disconnect(l),S=!0})}return{stop:d,mediaRecording:C}})}var Dn=g(46),xe=g.n(Dn),be=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const Kt="capture_device_preference";let Yt=null;function kn(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(Kt)||"null")),[n,o]=Object(u.useState)(Yt),[i,c]=Object(u.useState)(n?"ok":"pending"),[s,l]=Object(u.useState)("");Object(u.useEffect)(()=>{Yt=n,c("ok")},[n]);const d=Object(u.useCallback)(()=>{let D=!1;return En().then(k=>{D||k.length&&(o(new Map(k.map(p=>[p.device.deviceId,p]))),l(p=>p?(a.current=null,p):a.current&&k.find(({device:A})=>a.current.deviceId===A.deviceId)?a.current.deviceId:(a.current=null,k[0].device.deviceId)))}).catch(k=>{if(!D){if(k instanceof DOMException){if(k.name==="NotAllowedError"){c("denied");return}if(k.name==="NotFoundError"){c("unavailable");return}}throw k}}),()=>{D=!0}},[]),[b,f]=Object(u.useState)(1);Object(u.useEffect)(()=>{const D=n&&n.get(s);D&&(a.current&&a.current.deviceId===D.device.deviceId&&a.current.channelCount<=D.channelsAvailable?f(a.current.channelCount):f(D.channelsAvailable),a.current=null)},[n,s]),Object(u.useEffect)(()=>{s&&localStorage.setItem(Kt,JSON.stringify({deviceId:s,channelCount:b}))},[s,b]);const[v,h]=Object(u.useState)("ready"),[E,m]=Object(u.useState)(null),[w,C]=Object(u.useState)(!1);Object(u.useEffect)(()=>{v!=="ready"&&C(!1)},[v]);const S=Object(u.useCallback)(()=>{C(!1)},[]),[M,P]=Object(u.useState)({fn(D){}});Object(u.useEffect)(()=>M.fn,[M]);const[j,N]=Object(u.useState)(1/0),[I,H]=Object(u.useState)(0),O=Object(u.useCallback)(()=>be(this,null,function*(){let D=!1;const k=(T,z)=>Cn({deviceId:T,channelCount:z,onStart:(ae,J)=>{const ee=J*ae;N(ae),H(ee),h("capturing")},onUpdate:e}),p=a.current,{mediaRecording:A,stop:R}=yield p?(()=>be(this,null,function*(){try{return k(p.deviceId,p.channelCount)}catch(T){if(T instanceof DOMException&&T.name==="NotFoundError")return k(s,b);throw T}}))():k(s,b);P({fn(T){R(),T&&(D=!0)}});let _;try{_=yield A}catch(T){m(T),h("error");return}if(D)h("ready");else{h("finalizing");const T=yield t(_);D||(h("ready"),T==="silent"&&C(!0))}}),[s,b,e,t]),L=Object(u.useCallback)(D=>{if(D.target.files&&D.target.files.length){const k=D.target.files[0];k.arrayBuffer().then(p=>be(this,null,function*(){const A=new Uint8Array(p);let R;try{R=yield pe(A)}catch(T){alert("Unsupported audio format detected");return}if(R.length>10*R.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}h("finalizing");const _=yield t(A,k);h("ready"),_==="silent"&&C(!0)}))}},[t]);return{captureDevices:n,accessState:i,selectedCaptureDeviceId:s,selectedChannelCount:b,captureState:v,recordingError:E,showSilenceWarning:w,sampleRate:j,maxSamples:I,refreshCaptureDevices:d,setSelectedCaptureDeviceId:l,setSelectedChannelCount:f,beginRecording:O,stopRecording:M.fn,importFile:L,dismissSilenceWarning:S}}const et=3;function Pn({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:n}){const o="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:c,height:s}=e;i.clearRect(0,0,c,s),i.fillStyle=o;for(let l=0;l<a&&l<t.length;l++){const d=t[l],b=s*d,f=Math.max(Math.round(n*b),2);i.fillRect(l*et,s-f,et-1,f)}}function An({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),n=Object(u.useRef)(new Float32Array),o=Object(u.useRef)(0),i=Object(u.useRef)([]),c=Object(u.useRef)(1/0),s=Object(u.useRef)(0),[l,d]=Object(u.useState)(0),b=Object(u.useCallback)(p=>be(this,null,function*(){const A=a.current,R=n.current,_=i.current;if(_.push(p),s.current+=p[0].length,d(Math.floor(s.current/c.current)),_.reduce((z,[{length:ae}])=>z+ae,0)>=A){const z=yield Promise.all(p.map((J,ee)=>_.reduce((V,ie)=>[...V,ie[ee]],[])).map(J=>be(this,null,function*(){const ee=yield new Blob(J).arrayBuffer();return new Float32Array(ee)}))),ae=z.map(J=>me(new Float32Array(J.buffer,0,A)));R[o.current++]=Math.max(...ae),Pn({canvas:t.current,peaks:R,drawUntil:o.current,scaleCoefficient:.3}),i.current=[z.map(J=>J.slice(A))]}}),[]),{captureDevices:f,accessState:v,selectedCaptureDeviceId:h,selectedChannelCount:E,captureState:m,recordingError:w,showSilenceWarning:C,maxSamples:S,sampleRate:M,refreshCaptureDevices:P,setSelectedCaptureDeviceId:j,setSelectedChannelCount:N,beginRecording:I,stopRecording:H,importFile:O,dismissSilenceWarning:L}=kn(b,e);c.current=M,Object(u.useEffect)(()=>{const p=t.current;p&&(p.width=p.offsetWidth,p.height=p.offsetHeight)},[v]),Object(u.useLayoutEffect)(()=>{const p=t.current;!p||(m!=="finalizing"&&p.getContext("2d").clearRect(0,0,p.width,p.height),m==="capturing"&&S&&(a.current=Math.floor(et*S/t.current.width),n.current=new Float32Array(Math.floor(S/a.current)),o.current=0,i.current=[],c.current=1/0,s.current=0,d(0)))},[S,m]);const[D,k]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{D&&P()},[D,P]),r.a.createElement(Ee.a,{fluid:"sm"},v==="denied"?r.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",r.a.createElement(G.a,{type:"button",variant:"secondary",onClick:P},"try again")):v==="unavailable"?r.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",r.a.createElement(G.a,{type:"button",variant:"secondary",onClick:P},"try again")):r.a.createElement("div",null,r.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),C&&r.a.createElement("div",{className:xe.a.alertContainer},r.a.createElement(Ne.a,{dismissible:!0,variant:"warning",onClose:L},r.a.createElement(Ne.a.Heading,null,"Your recording was totally silent."),r.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),r.a.createElement(G.a,{className:xe.a.recordButton,type:"button",variant:m==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:m==="capturing"?()=>H():I,disabled:m==="finalizing"},r.a.createElement("canvas",{ref:t}),r.a.createElement("span",{className:xe.a.mainText},["capturing","finalizing"].includes(m)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(m)&&r.a.createElement("span",{className:xe.a.timeRecorded},"0:",String(l).padStart(2,"0"))),["capturing","finalizing"].includes(m)?r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(G.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>H(!0)},"Cancel")):r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(G.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>k(p=>!p)},"Audio input settings ",D?"\u25B2":"\u25BC"),r.a.createElement(gn.a,{in:D},r.a.createElement("div",null,r.a.createElement(X.a.Group,null,r.a.createElement(X.a.Label,null,"Capture Device"),r.a.createElement(X.a.Select,{style:{width:250},value:h,onChange:p=>j(p.target.value)},f&&v==="ok"?[...f].map(([p,{device:A}])=>r.a.createElement("option",{key:p,value:p},A.label||p)):r.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),r.a.createElement(X.a.Group,null,r.a.createElement(X.a.Label,null,"Input channels"),r.a.createElement(X.a.Select,{style:{width:250},value:E,onChange:p=>N(Number(p.target.value))},[1,2].map(p=>r.a.createElement("option",{key:p,value:p,disabled:!f||!f.has(h)||f.get(h).channelsAvailable<p},p===1?"Mono":"Stereo (summed to mono)")))),r.a.createElement("br",null))))),m==="error"&&w||null,r.a.createElement("br",null),r.a.createElement(G.a,{style:{width:250},type:"button",variant:"secondary",onClick:p=>{const A=p.currentTarget.querySelector("input");A&&p.target!==A&&A.click()}},"Or import an audio file",r.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:O})))}var jn=An,Rn=g(80),Jt=g.n(Rn),Bn=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function Mn(){const[e,t]=Object(u.useState)(new Map),[a,n]=Object(u.useState)(new Map),o=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{pa().then(n).catch(console.error)},[]);const[i,c]=Object(u.useState)(null),[s,l]=Object(u.useState)(!0);Object(u.useEffect)(()=>{$.getAllFromStorage().then(E=>{t(m=>new Map([...m,...E.map(w=>[w.id,w])]))}).finally(()=>{l(!1)})},[]);const d=Object(u.useCallback)((E,m)=>Bn(this,null,function*(){const w=yield pe(E),C=[0,0],S=yield Dt(w,C);if([...S.positive,...S.negative].every(I=>I===0))return"silent";const M=yield da(E);let P="",j="";if(m){const I=m.name.lastIndexOf(".");I>0?(P=m.name.slice(0,I),j=m.name.slice(I)):P=m.name}else P="New sample";const N=new $.Mutable({name:P,sourceFileId:M,trim:{frames:C,waveformPeaks:S},userFileInfo:m&&{type:m.type,ext:j}});return yield N.persist(),t(I=>new Map([[N.id,N],...I])),c(N.id),"saved"}),[]),b=Object(u.useCallback)((E,m)=>{t(w=>{const C=w.get(E);if(C&&C instanceof $.Mutable){const S=C.update(m);if(S!==C)return new Map(w).set(C.id,S)}return w})},[]),[f,v]=Object(u.useState)(!1),h=Object(u.useCallback)(E=>{c(E),v(!1)},[]);return r.a.createElement("div",null,r.a.createElement(oa,{onMenuOpen:()=>v(!0),onHeaderClick:()=>c(null)}),r.a.createElement(He.a,{show:f,onHide:()=>v(!1)},r.a.createElement(He.a.Header,{closeButton:!0}),r.a.createElement(He.a.Body,null,r.a.createElement(ge.a,null,r.a.createElement(ge.a.Item,{as:"button",onClick:()=>h(null)},"New Sample"),s?"Loading...":null,!s&&r.a.createElement(se.a,{defaultActiveKey:e.size?"user":"factory"},r.a.createElement(se.a.Item,{eventKey:"user"},r.a.createElement(se.a.Header,null,"Your Samples"),r.a.createElement(se.a.Body,{style:{padding:0}},r.a.createElement(Mt,{samples:e,selectedSampleId:i,onSampleSelect:h}))),r.a.createElement(se.a.Item,{eventKey:"factory"},r.a.createElement(se.a.Header,null,"Factory Samples"),r.a.createElement(se.a.Body,{style:{padding:0}},r.a.createElement(Mt,{samples:a,selectedSampleId:i,onSampleSelect:h}))))))),r.a.createElement("div",{className:Jt.a.mainLayout},r.a.createElement("div",{className:Jt.a.focusedSampleContainer},i&&(()=>{const E=o.get(i)||null;if(!E)return null;const m=w=>{const C=o.get(w);if(C){const S=C.duplicate();t(M=>new Map([[S.id,S],...M])),c(S.id)}};return E instanceof $.Mutable?r.a.createElement(nn,{sample:E,onSampleUpdate:b,onSampleDuplicate:m,onSampleDelete:w=>{const C=e.get(w);if(C&&C instanceof $.Mutable){C.remove();let S=null,M=!1;for(const[,P]of e){if(M){S=P.id;break}if(P.id===w){if(!S){M=!0;continue}break}S=P.id}c(S),t(P=>{const j=new Map(P);return j.delete(C.id),j})}}}):r.a.createElement(bn,{sample:E,onSampleDuplicate:m})})(),!i&&r.a.createElement(jn,{onRecordFinish:d}))))}var In=Mn,Ln=e=>{e&&e instanceof Function&&g.e(3).then(g.bind(null,152)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:o,getTTFB:i})=>{t(e),a(e),n(e),o(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),aa.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ea,null,r.a.createElement(In,null))),document.getElementById("root")),Ln()},19:function(U,re,g){U.exports={"form-switch":"SlotNumberInput_form-switch__39Wtl","form-check-input":"SlotNumberInput_form-check-input__oNf4Z",slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},20:function(U,re,g){U.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},39:function(U,re,g){U.exports={normalizeControlWrapper:"SampleDetail_normalizeControlWrapper__1yc_t",waveformBoundingBox:"SampleDetail_waveformBoundingBox__2GVCa",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},46:function(U,re,g){U.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},7:function(U,re,g){U.exports={"form-switch":"WaveformEdit_form-switch__2DZid","form-check-input":"WaveformEdit_form-check-input__2TImp",scaleButtonsContainer:"WaveformEdit_scaleButtonsContainer__248kb",scaleButtons:"WaveformEdit_scaleButtons__3u8fE",waveformContainer:"WaveformEdit_waveformContainer__Qq3MI",playbackOverlay:"WaveformEdit_playbackOverlay__1_jAo",playbackActive:"WaveformEdit_playbackActive__hTwgX",playback:"WaveformEdit_playback__2tuIe",trim:"WaveformEdit_trim__1GV76",bar:"WaveformEdit_bar__1KFgt",handle:"WaveformEdit_handle__23NoG",time:"WaveformEdit_time__YX5rg",left:"WaveformEdit_left__3Jfpn",right:"WaveformEdit_right__35CjW",waveformOverlay:"WaveformEdit_waveformOverlay__3oZfw",playbackButtonContainer:"WaveformEdit_playbackButtonContainer__3tLJJ"}},80:function(U,re,g){U.exports={"form-switch":"App_form-switch__3Ht4D","form-check-input":"App_form-check-input__19Z6o",mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}}},[[134,1,2]]]);

//# sourceMappingURL=main.afabfb31.chunk.js.map