(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{43:function(Ne,ie,E){},54:function(Ne,ie,E){"use strict";E.r(ie);var d=E(0),c=E.n(d),Ve=E(8),He=E.n(Ve),sa=E(43),P=E(4);const ze=P.a.h1({display:"flex",alignItems:"center",padding:"2rem 1rem 1rem",marginBottom:"0px",backgroundColor:"#f3f3f3",borderBottom:"1px solid #ccc",position:"sticky",top:0}),Ue=P.a.span({marginRight:"1rem",cursor:"pointer"}),$e=P.a.span({color:"red",whiteSpace:"nowrap"}),Ge=P.a.span({textTransform:"uppercase",textDecoration:"underline"}),Xe=P.a.img({height:"1.6em",paddingLeft:"1rem"});function Ye({onMenuOpen:e}){return c.a.createElement(ze,null,c.a.createElement(Ue,{onClick:e},"\u2630"),c.a.createElement($e,null,"Volca Sample",c.a.createElement(Ge,null,"r")),c.a.createElement(Xe,{src:"volca_sample.png",alt:""}))}var Ke=Ye,W=E(60),Je=E(32),Qe=E.n(Je),Ze=E(19),T=E.n(Ze),ce=E(62),se=E(30);const L=31250;var _e=Object.defineProperty,qe=Object.defineProperties,et=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable,_=(e,t,a)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))ue.call(t,a)&&_(e,a,t[a]);if(N)for(var a of N(t))de.call(t,a)&&_(e,a,t[a]);return e},R=(e,t)=>qe(e,et(t)),fe=(e,t)=>{var a={};for(var n in e)ue.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&N)for(var n of N(e))t.indexOf(n)<0&&de.call(e,n)&&(a[n]=e[n]);return a},V=(e,t,a)=>(_(e,typeof t!="symbol"?t+"":t,a),a),F=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const H=T.a.createInstance({name:"audio_file_data",driver:T.a.INDEXEDDB}),z=T.a.createInstance({name:"sample_metadata",driver:T.a.INDEXEDDB});function tt(e){return F(this,null,function*(){const t=Object(ce.a)();return yield H.setItem(t,e),t})}const q="0.3.0",at={"0.1.0":e=>{const t=e,{clip:a}=t,n=fe(t,["clip"]);return R(B({},n),{trimFrames:a.map(l=>Math.round(l*L)),metadataVersion:"0.2.0"})},"0.2.0":e=>F(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=fe(t,["trimFrames"]),r=yield G(n.sourceFileId,a),l={frames:a,waveformPeaks:r};return R(B({},n),{trim:l,metadataVersion:"0.3.0"})})};function nt(e){return F(this,null,function*(){let t=e;for(;t.metadataVersion!==q;){const a=at[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:q};break}t=yield a(t)}return t})}const k=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(ce.a)(),userFileInfo:r=null,slotNumber:l=0,dateSampled:s=Date.now(),dateModified:i=s,useCompression:o=!0,qualityBitDepth:u=16,scaleCoefficient:y=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:r,slotNumber:l,dateSampled:s,dateModified:i,useCompression:o,qualityBitDepth:u,scaleCoefficient:y,metadataVersion:q}}duplicate(){const e=new k.Mutable(R(B({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return F(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),r=new Uint8Array(n);return this.cacheSourceFileData(e,r),r}const t=yield H.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return F(this,null,function*(){const e=[];return yield z.iterate((a,n)=>{a&&e.push(nt(a).then(r=>[n,r]))}),new Map(yield Promise.all(e))})}static getAllFromStorage(){return F(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield me(),a=(yield H.keys()).concat(t.map(({sourceFileId:r})=>r));return[...e].map(([r,l])=>{const{sourceFileId:s}=l;return a.includes(s)?new k.Mutable(B({id:r},l)):(console.warn(`Found metadata "${l.name||r}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort((r,l)=>l.metadata.dateModified-r.metadata.dateModified)})}};let D=k;V(D,"Mutable",class extends k{constructor(e){super(e);setTimeout(()=>F(this,null,function*(){(yield z.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return F(this,null,function*(){yield z.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this;if(Object.keys(e).every(l=>e[l]===a[l]))return this;const n=R(B(B({},a),e),{dateModified:Date.now()}),r=new k.Mutable(B({id:t},n));return r.persist(),r}remove(){return F(this,null,function*(){if(yield z.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield k.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield H.removeItem(this.metadata.sourceFileId)})}}),V(D,"sourceFileData",new Map),V(D,"recentlyCachedSourceFileIds",[]),V(D,"MAX_CACHED",10);let ee;function me(){return ee||(ee=fetch("factory-samples.json").then(e=>e.json())),ee}function rt(){return F(this,null,function*(){const e=yield me();return new Map(e.map(t=>[t.id,new D(R(B({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(se.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(se.a)(t.trim.waveformPeaks.negative))}}}))]))})}var pe=Math.pow,te=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});function ae(e,t){const a=4,n=t[0]*a,r=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,r)}function ne(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),r=Array(e.numberOfChannels).fill().map((l,s)=>ae(e.getChannelData(s),t));for(let l=0;l<a;l++){let s=0;for(let i=0;i<r.length;i++)s+=r[i][l];s/=r.length,n[l]=s}return n}function ot(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function lt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function it(e,t){const a=pe(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function he(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function ct(e){const t=new Int16Array(e.length),a=pe(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function ve(){return window.AudioContext||window.webkitAudioContext}let ye;function ge(){const e=ve();return ye=ye||new e({sampleRate:L})}function U(e){return te(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,r)=>{ge().decodeAudioData(t.buffer,n,r)})})}function $(e,t){return te(this,null,function*(){const a=yield D.getSourceFileData(e),n=yield U(a);if(t)for(let r=0;r<n.numberOfChannels;r++)he(n.getChannelData(r));return n})}function be(e){return te(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:r,trim:{frames:l}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const s=yield $(a,Boolean(n)),i=s.numberOfChannels===1?ae(s.getChannelData(0),l):ne(s,l);r!==1&&lt(i,r),t<16&&it(i,t);const o=ct(i),u=o.length*2,y=Qe()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:u}),p=new Uint8Array(y.length+u);return p.set(y),p.set(new Uint8Array(o.buffer),y.length),{data:p,sampleRate:16}})}const st={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},Se=Object(d.createContext)(st);function ut({children:e}){const[t,a]=Object(d.useState)(!1),n=Object(d.useCallback)((l,{onTimeUpdate:s=()=>null,onEnded:i=()=>null}={})=>{if(t)throw new Error("Wait until audio playback has finished to start new playback");a(!0);let o,u;try{o=ge(),u=o.createBufferSource(),u.buffer=l,u.connect(o.destination),u.start()}catch(f){throw a(!1),f}const y=o.currentTime;s(0);let p=requestAnimationFrame(C);function C(){s(o.currentTime-y),p=requestAnimationFrame(C)}let O=!1;return u.addEventListener("ended",()=>{O||(s(l.duration),i()),a(!1),cancelAnimationFrame(p)}),function(){u.stop(),O=!0}},[t]),r=Object(d.useMemo)(()=>({playAudioBuffer:n,isAudioBusy:t}),[n,t]);return Object(d.createElement)(Se.Provider,{value:r},e)}function we(){return Object(d.useContext)(Se)}var dt=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const j=6,Ee=j*44;function Ce(e,t){const a=Math.floor(j*e.length/t),n=new Float32Array(Math.floor(e.length/a)),r=new Float32Array(Math.floor(e.length/a));for(let l=0;l<n.length;l++){const s=new Float32Array(e.buffer,l*a*4,a);let i=0,o=0;for(const u of s)u>i&&(i=u),u<o&&(o=u);n[l]=Math.min(1,i),r[l]=Math.max(-1,o)}return{positive:n,negative:r}}function G(e,t){return dt(this,null,function*(){const a=yield $(e,!1),n=ne(a,t);return Ce(n,Ee)})}var ft=E(33);const mt=P.a.canvas({width:"100%",height:"100%",display:"block"});function pt(e,t){function a(r,l){e.width=r,e.height=l}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new ft.a(([r])=>{const{width:l,height:s}=r.contentRect;a(l,s),t({width:l,height:s})});return n.observe(e),()=>n.disconnect()}function ht(e,t,a){const n=e.getContext("2d"),{width:r,height:l}=e;n.clearRect(0,0,r,l);const s=Math.floor(l*(2/3))+1;n.fillStyle="red",t.positive.forEach((o,u)=>{const y=s*o,p=Math.max(Math.round(a*y),1);n.fillRect(u*j,s-p,j-1,p)});const i=l-s;n.fillStyle="darkred",t.negative.forEach((o,u)=>{const y=i*o*-1,p=Math.round(a*y);n.fillRect(u*j,s,j-1,p)})}function vt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(d.useRef)(null);Object(d.useImperativeHandle)(a,()=>n.current);const[r,l]=Object(d.useState)(Symbol()),s=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return s.current.width=n.current.offsetWidth,s.current.height=n.current.offsetHeight,pt(n.current,({width:i,height:o})=>{(i!==s.current.width||o!==s.current.height)&&(l(Symbol()),s.current.width=i,s.current.height=o)})},[]),Object(d.useLayoutEffect)(()=>{const i=n.current;if(!i)throw new Error("Canvas should be defined");let o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{ht(i,e,t)})});return()=>cancelAnimationFrame(o)},[e,t,r]),c.a.createElement(mt,{ref:n})}var Oe=vt;const yt=P.a.div({width:`${Ee}px`,height:"40px"}),Pe=typeof IntersectionObserver!="undefined",gt=c.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(d.useRef)(null),[r,l]=Object(d.useState)(!Pe);return Object(d.useLayoutEffect)(()=>{if(!Pe)return;const s=n.current;if(!s)throw new Error("Waveform container should be defined");const i=s.getBoundingClientRect();if(i.top+i.height>=0&&i.bottom-i.height<=window.innerHeight){l(!0);return}const o=new IntersectionObserver(([u])=>{u.isIntersecting&&(l(!0),o.unobserve(s))});return o.observe(s),()=>o.disconnect()},[]),c.a.createElement(W.a.Item,{active:t,onClick:()=>a(e.id)},c.a.createElement("div",null,e.metadata.name),c.a.createElement(yt,{ref:n},r&&c.a.createElement(Oe,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function bt({samples:e,selectedSampleId:t,onSampleSelect:a}){return c.a.createElement(W.a,{variant:"flush"},[...e].map(([n,r])=>c.a.createElement(gt,{key:n,sample:r,selected:n===t,onSampleSelect:a})))}var Ae=bt,St=Object.defineProperty,wt=Object.defineProperties,Et=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,Be=(e,t,a)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ct=(e,t)=>{for(var a in t||(t={}))De.call(t,a)&&Be(e,a,t[a]);if(X)for(var a of X(t))Fe.call(t,a)&&Be(e,a,t[a]);return e},Ot=(e,t)=>wt(e,Et(t)),Pt=(e,t)=>{var a={};for(var n in e)De.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&X)for(var n of X(e))t.indexOf(n)<0&&Fe.call(e,n)&&(a[n]=e[n]);return a},At=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const Dt=P.a.input({position:"absolute"});function Ft({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:t},scaleCoefficient:a}},onSetTrimFrames:n,onSetScaleCoefficient:r}){const l=Object(d.useMemo)(()=>e?ne(e,[0,0]):new Float32Array,[e]),s=Object(d.useRef)(null),i=Object(d.useMemo)(()=>{const p=s.current&&s.current.offsetWidth;return!p||!l.length?{positive:new Float32Array,negative:new Float32Array}:Ce(l,p)},[l]),o=Object(d.useMemo)(()=>{if(!e)return 0;const p=ae(l,t);return ot(p)},[e,l,t]),u=1/o;Object(d.useLayoutEffect)(()=>{a>u&&r(u)},[a,u,r]);const y=a*o;return c.a.createElement(c.a.Fragment,null,c.a.createElement(Dt,{type:"range",disabled:o===0,value:y,min:.1,max:1,step:.01,onChange:p=>{o!==0&&r(Number(p.target.value)/o)}}),c.a.createElement(Oe,{waveformRef:s,peaks:i,scaleCoefficient:a}),c.a.createElement("button",{type:"button",disabled:a===u,onClick:()=>r(u)},"Normalize"),c.a.createElement("button",{type:"button",disabled:a===1,onClick:()=>r(1)},"Original level"))}function Bt(e){var t=e,{sample:a}=t,n=Pt(t,["sample"]);const[r,l]=Object(d.useState)(null);Object(d.useEffect)(()=>{let i=!1;return(()=>At(this,null,function*(){if(i)return;const o=yield $(a.metadata.sourceFileId,Boolean(a.metadata.userFileInfo));i||l([a.metadata.sourceFileId,o])}))(),()=>{i=!0}},[a.metadata.sourceFileId,a.metadata.userFileInfo]);const s=Object(d.useRef)(a);return r&&a.metadata.sourceFileId===r[0]&&(s.current=a),c.a.createElement(Ft,Ot(Ct({},n),{sample:s.current,sourceAudioBuffer:r&&r[1]}))}var It=Bt,kt=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});let Ie;function jt(){return kt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Ie=Ie||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(r){return e.addFunction(r,"vi")},unregisterUpdateCallback(r){e.removeFunction(r)},heap8Buffer(){return e.HEAP8.buffer}}}catch(r){a(r);return}t(n)})})}var Mt=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});function xt(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Mt(this,null,function*(){const{prepareSampleBufferFromWavData:r,getSampleBufferChunkPointer:l,getSampleBufferChunkSize:s,getSampleBufferProgress:i,getSampleBufferTotalSize:o,cancelSampleBufferWork:u,registerUpdateCallback:y,unregisterUpdateCallback:p,heap8Buffer:C}=yield jt();if(a)return new Uint8Array;const{data:O}=yield be(e);if(a)return new Uint8Array;let f,h=0;const S=y(m=>{if(a)return;const v=o(m);f||(f=new Uint8Array(v));const b=l(m),w=s(m),A=i(m);f.set(new Uint8Array(C(),b,w),A-w),h=A/v}),g=r(O,O.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,S);t(h);try{yield new Promise(m=>{let v;n=()=>{cancelAnimationFrame(v),u(g),m()},b();function b(){if(h&&(t(h),h>=1)){m();return}v=requestAnimationFrame(b)}})}finally{n=()=>{},p(S)}if(a)return new Uint8Array;if(!f)throw new Error("Unexpected condition: sampleBuffer should be defined");return f}))()}}var Rt=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});function Wt({sample:e}){const[t,a]=Object(d.useState)(0),[n,r]=Object(d.useState)("idle"),[l,s]=Object(d.useState)(null),i=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let y=!1;a(0),r("idle"),s(null),i.current=()=>{y=!0};try{const{sampleBufferPromise:p,cancelWork:C}=xt(e,O=>{y||a(O)});i.current=()=>{C(),y=!0},p.then(O=>Rt(this,null,function*(){if(y)return;i.current=()=>{y=!0};const f=yield U(O);y||s(f)}))}catch(p){console.error(p),s(new Error(String(p)))}return()=>i.current()},[e]);const{playAudioBuffer:o,isAudioBusy:u}=we();return c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{type:"button",onClick:()=>{if(l instanceof AudioBuffer)try{r("transferring");const y=o(l,{onTimeUpdate:p=>a(p/l.duration),onEnded:()=>r("idle")});i.current=()=>{y(),r("idle")}}catch(y){console.error(y),r("error")}},disabled:u||!l||n==="transferring"},"transfer to volca sample"),c.a.createElement("br",null),l&&n==="idle"?null:n==="error"?"Error transferring":c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,l?l instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),c.a.createElement("progress",{value:t}),c.a.createElement("br",null),c.a.createElement("button",{onClick:()=>i.current()},"Cancel")),c.a.createElement("br",null))}var Tt=Wt,Lt=Object.defineProperty,ke=Object.getOwnPropertySymbols,Nt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,je=(e,t,a)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Me=(e,t)=>{for(var a in t||(t={}))Nt.call(t,a)&&je(e,a,t[a]);if(ke)for(var a of ke(t))Vt.call(t,a)&&je(e,a,t[a]);return e},Y=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const Ht=P.a.div({paddingLeft:"2rem"}),zt=P.a.div({height:"200px",backgroundColor:"#f3f3f3",maxWidth:"400px"});function xe(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function Ut({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const[r,l]=Object(d.useState)(0),s=e&&e.metadata.sourceFileId;Object(d.useEffect)(()=>{l(0),s&&$(s,!1).then(m=>l(m.length))},[s]);const i=e&&e.id,o=Object(d.useCallback)(m=>i&&t(i,{scaleCoefficient:m}),[i,t]),[u,y]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(y(null),e){let m=!1;be(e).then(({data:v})=>{m||y(v)})}},[e]);const[p,C]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(C(null),u){let m=!1;U(u).then(v=>{m||C(v)})}},[u]);const{playAudioBuffer:O,isAudioBusy:f}=we(),h=Object(d.useRef)(()=>{});if(Object(d.useEffect)(()=>()=>h.current(),[e]),!e)return null;const S=Math.max(0,r-e.metadata.trim.frames[1]),g=Math.max(0,r-e.metadata.trim.frames[0]);return c.a.createElement(Ht,null,c.a.createElement("h3",null,e.metadata.name),c.a.createElement("button",{type:"button",onClick:()=>a(e.id)},"Duplicate"),c.a.createElement("button",{type:"button",onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Remove"),c.a.createElement("h4",null,"Last edited: ",new Date(e.metadata.dateModified).toLocaleString()),c.a.createElement("h4",null,"Sampled: ",new Date(e.metadata.dateSampled).toLocaleString()),c.a.createElement("label",null,c.a.createElement("h4",null,"Trim start"),c.a.createElement("input",{type:"number",value:e.metadata.trim.frames[0],step:1,min:0,max:S,onChange:m=>Y(this,null,function*(){if(r){const v=Number(m.target.value),b=[Math.min(v,S),e.metadata.trim.frames[1]],w=yield G(e.metadata.sourceFileId,b);t(e.id,{trim:{frames:b,waveformPeaks:w}})}else t(e.id,{trim:Me({},e.metadata.trim)})})})),c.a.createElement("label",null,c.a.createElement("h4",null,"Trim end"),c.a.createElement("input",{type:"number",value:e.metadata.trim.frames[1],step:1,min:0,max:g,onChange:m=>Y(this,null,function*(){if(r){const v=Number(m.target.value),b=[e.metadata.trim.frames[0],Math.min(v,g)],w=yield G(e.metadata.sourceFileId,b);t(e.id,{trim:{frames:b,waveformPeaks:w}})}else t(e.id,{trim:Me({},e.metadata.trim)})})})),c.a.createElement(zt,null,c.a.createElement(It,{onSetTrimFrames:()=>null,onSetScaleCoefficient:o,sample:e}),c.a.createElement("button",{type:"button",onClick:()=>{p&&(h.current=O(p))},disabled:f||!p},"play"),c.a.createElement("button",{type:"button",onClick:()=>Y(this,null,function*(){if(u){const m=new Blob([u],{type:"audio/x-wav"});xe(m,`${e.metadata.name}.wav`)}}),disabled:!u},"download"),c.a.createElement("button",{type:"button",onClick:()=>Y(this,null,function*(){const{sourceFileId:m,userFileInfo:v}=e.metadata,b=yield D.getSourceFileData(m),w=new Blob([b],{type:v?v.type:"audio/x-wav"});xe(w,`${e.metadata.name}${v?v.ext:".wav"}`)})},"download (orig)")),c.a.createElement("h4",null,"Quality bit depth: ",e.metadata.qualityBitDepth),c.a.createElement("input",{type:"range",value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:m=>{const v=Number(m.target.value);t(e.id,{qualityBitDepth:v})}}),c.a.createElement("label",null,c.a.createElement("h4",null,"Slot number"),c.a.createElement("input",{type:"number",value:e.metadata.slotNumber,step:1,min:0,max:99,onChange:m=>{const v=Number(m.target.value);t(e.id,{slotNumber:v})}})),c.a.createElement(Tt,{sample:e}))}var $t=Ut,K=E(57),Gt=E(38),M=E(59),Xt=E(37),J=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});let Re;function re(){const e=ve();return Re=Re||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:L}:{})}function Yt(){return J(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const r of n.getTracks())r.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const r=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),l=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:i})=>n.deviceId===i).label,s=r.getAudioTracks().length;for(const i of r.getTracks())i.stop();a.push({device:{deviceId:n.deviceId,label:l},channelsAvailable:s})}return a})}let oe;function Kt(e){return J(this,arguments,function*({onData:t,onFinish:a}){const n=re();oe=oe||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield oe;const r=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});r.port.onmessage=s=>{if(s.data.eventType==="data"){const i=s.data.audioChannels;t(i)}s.data.eventType==="stop"&&a()};const l=r.parameters.get("isRecording");return l.setValueAtTime(1,n.currentTime),{recorderNode:r,stop(){l.setValueAtTime(0,n.currentTime)}}})}function Jt({channelCount:e,onData:t,onFinish:a}){const r=re().createScriptProcessor(1024,e,e);let l=!1;return r.onaudioprocess=s=>{const i=Array(e).fill().map((o,u)=>s.inputBuffer.getChannelData(u));t(i),l&&a()},{recorderNode:r,stop(){l=!0}}}function Qt(e){return J(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Jt(e):yield Kt(e)})}function Zt(e){return J(this,arguments,function*({deviceId:t,channelCount:a,onStart:n}){const r=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:L,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),l=re(),s=l.createMediaStreamSource(r),{recorderNode:i,stop:o}=yield Qt({channelCount:a,onData:O,onFinish:m});s.connect(i),i.connect(l.destination),n();const y=10*l.sampleRate;let p=0;const C=Array(a).fill([]);function O(v){let b=0;for(let w=0;w<a;w++){const A=v[w],Q=A.length,x=A.slice(0,Math.min(Q,y-p));he(x),b||(b=x.length),C[w].push(x)}p+=b,p>=y&&(m(),o())}let f,h;const S=new Promise((v,b)=>{f=v,h=b});let g=!1;function m(){if(g)return;try{const b=C.map(Q=>{const x=new Float32Array(Q.reduce((Z,ca)=>Z+ca.length,0));let Le=0;for(const Z of Q)x.set(Z,Le),Le+=Z.length;return x}),w=new Xt.a;w.fromScratch(b.length,l.sampleRate,"32f",b);const A=w.toBuffer();f(A)}catch(b){h(b)}const v=r.getTracks();for(const b of v)b.stop();i.disconnect(l.destination),s.disconnect(i),g=!0}return{stop:o,mediaRecording:S}})}var We=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const _t=P.a.div({});let Te=null;function qt(e){const[t,a]=Object(d.useState)(Te),[n,r]=Object(d.useState)(t?"ok":"pending"),[l,s]=Object(d.useState)("");Object(d.useEffect)(()=>{Te=t,r("ok")},[t]);const i=Object(d.useCallback)(()=>{let g=!1;return Yt().then(m=>{g||m.length&&(a(new Map(m.map(v=>[v.device.deviceId,v]))),s(v=>v||m[0].device.deviceId))}).catch(m=>{if(!g){if(m instanceof DOMException){if(m.name==="NotAllowedError"){r("denied");return}if(m.name==="NotFoundError"){r("unavailable");return}}throw m}}),()=>{g=!0}},[]);Object(d.useEffect)(i,[i]);const[o,u]=Object(d.useState)(1);Object(d.useEffect)(()=>{const g=t&&t.get(l);g&&u(g.channelsAvailable)},[t,l]);const[y,p]=Object(d.useState)("ready"),[C,O]=Object(d.useState)(null),[f,h]=Object(d.useState)({fn(g){}}),S=Object(d.useCallback)(()=>We(this,null,function*(){let g=!1;const{mediaRecording:m,stop:v}=yield Zt({deviceId:l,channelCount:o,onStart:()=>p("capturing")});h({fn(w){v(),w&&(g=!0)}});let b;try{b=yield m}catch(w){O(w),p("error");return}g?p("ready"):(p("finalizing"),e(b))}),[l,o,e]);return{captureDevices:t,accessState:n,selectedCaptureDeviceId:l,selectedChannelCount:o,captureState:y,recordingError:C,refreshCaptureDevices:i,setSelectedCaptureDeviceId:s,setSelectedChannelCount:u,beginRecording:S,stopRecording:f.fn}}function ea({onRecordFinish:e}){const{captureDevices:t,accessState:a,selectedCaptureDeviceId:n,selectedChannelCount:r,captureState:l,recordingError:s,refreshCaptureDevices:i,setSelectedCaptureDeviceId:o,setSelectedChannelCount:u,beginRecording:y,stopRecording:p}=qt(e),[C,O]=Object(d.useState)(!1);return c.a.createElement(_t,null,a==="denied"?c.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",c.a.createElement("button",{type:"button",onClick:i},"try again")):a==="unavailable"?c.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",c.a.createElement("button",{type:"button",onClick:i},"try again")):c.a.createElement("div",null,c.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),c.a.createElement(K.a,{type:"button",variant:l==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:l==="capturing"?()=>p():y,disabled:l==="finalizing"},["capturing","finalizing"].includes(l)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(l)?c.a.createElement(c.a.Fragment,null,c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(K.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>p(!0)},"Cancel")):c.a.createElement(c.a.Fragment,null,c.a.createElement("br",null),c.a.createElement(K.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>O(f=>!f)},"Audio input settings ",C?"\u25B2":"\u25BC"),c.a.createElement(Gt.a,{in:C},c.a.createElement("div",null,c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Capture Device"),c.a.createElement(M.a.Select,{style:{width:250},value:n,onChange:f=>o(f.target.value)},t&&a==="ok"?[...t].map(([f,{device:h}])=>c.a.createElement("option",{key:f,value:f},h.label||f)):c.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Input channels"),c.a.createElement(M.a.Select,{style:{width:250},value:r,onChange:f=>u(Number(f.target.value))},[1,2].map(f=>c.a.createElement("option",{key:f,value:f,disabled:!t||!t.has(n)||t.get(n).channelsAvailable<f},f===1?"Mono":"Stereo (summed to mono)")))),c.a.createElement("br",null))),c.a.createElement("br",null),c.a.createElement(K.a,{style:{width:250},type:"button",variant:"secondary",onClick:f=>{const h=f.currentTarget.querySelector("input");h&&f.target!==h&&h.click()}},"Or import an audio file",c.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:f=>{if(f.target.files&&f.target.files.length){const h=f.target.files[0];h.arrayBuffer().then(S=>We(this,null,function*(){const g=new Uint8Array(S);let m;try{m=yield U(g)}catch(v){alert("Unsupported audio format detected");return}if(m.length>10*m.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(g,h)}))}}})))),l==="error"&&s||null)}var ta=ea,le=E(58),I=E(61),aa=(e,t,a)=>new Promise((n,r)=>{var l=o=>{try{i(a.next(o))}catch(u){r(u)}},s=o=>{try{i(a.throw(o))}catch(u){r(u)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,s);i((a=a.apply(e,t)).next())});const na=P.a.div({padding:"2rem",display:"flex",height:"100%"}),ra=P.a.div({flexGrow:1});function oa(){const[e,t]=Object(d.useState)(new Map),[a,n]=Object(d.useState)(new Map),r=Object(d.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(d.useEffect)(()=>{rt().then(n).catch(console.error)},[]);const[l,s]=Object(d.useState)(null),[i,o]=Object(d.useState)(!0);Object(d.useEffect)(()=>{D.getAllFromStorage().then(f=>{t(h=>new Map([...h,...f.map(S=>[S.id,S])]))}).finally(()=>{o(!1)})},[]);const u=Object(d.useCallback)((f,h)=>aa(this,null,function*(){const S=yield tt(f);let g="",m="";if(h){const A=h.name.lastIndexOf(".");A>0?(g=h.name.slice(0,A),m=h.name.slice(A)):g=h.name}else g="New one";const v=[0,0],b=yield G(S,v),w=new D.Mutable({name:g,sourceFileId:S,trim:{frames:v,waveformPeaks:b},userFileInfo:h&&{type:h.type,ext:m}});yield w.persist(),t(A=>new Map([[w.id,w],...A])),s(w.id)}),[]),y=Object(d.useCallback)((f,h)=>{t(S=>{const g=S.get(f);if(g&&g instanceof D.Mutable){const m=g.update(h);if(m!==g)return new Map(S).set(g.id,m)}return S})},[]),[p,C]=Object(d.useState)(!1),O=Object(d.useCallback)(f=>{s(f),C(!1)},[]);return c.a.createElement("div",null,c.a.createElement(Ke,{onMenuOpen:()=>C(!0)}),c.a.createElement(na,null,c.a.createElement(le.a,{show:p,onHide:()=>C(!1)},c.a.createElement(le.a.Header,{closeButton:!0}),c.a.createElement(le.a.Body,null,c.a.createElement(W.a,null,c.a.createElement(W.a.Item,{as:"button",onClick:()=>O(null)},"New Sample"),i?"Loading...":null,!i&&c.a.createElement(I.a,{defaultActiveKey:"user"},c.a.createElement(I.a.Item,{eventKey:"user"},c.a.createElement(I.a.Header,null,"Your Samples"),c.a.createElement(I.a.Body,{style:{padding:0}},c.a.createElement(Ae,{samples:e,selectedSampleId:l,onSampleSelect:O}))),c.a.createElement(I.a.Item,{eventKey:"factory"},c.a.createElement(I.a.Header,null,"Factory Samples"),c.a.createElement(I.a.Body,{style:{padding:0}},c.a.createElement(Ae,{samples:a,selectedSampleId:l,onSampleSelect:O}))))))),c.a.createElement(ra,null,l&&c.a.createElement($t,{sample:r.get(l)||null,onSampleUpdate:y,onSampleDuplicate:f=>{const h=r.get(f);if(h){const S=h.duplicate();t(g=>new Map([[S.id,S],...g])),s(S.id)}},onSampleDelete:f=>{const h=r.get(f);h&&h instanceof D.Mutable&&(h.remove(),t(S=>{const g=new Map(S);return g.delete(h.id),g}))}}),!l&&c.a.createElement(ta,{onRecordFinish:u}))))}var la=oa,ia=e=>{e&&e instanceof Function&&E.e(3).then(E.bind(null,63)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:r,getTTFB:l})=>{t(e),a(e),n(e),r(e),l(e)})};He.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(ut,null,c.a.createElement(la,null))),document.getElementById("root")),ia()}},[[54,1,2]]]);

//# sourceMappingURL=main.5acef425.chunk.js.map