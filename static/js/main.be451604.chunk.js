(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{100:function(L,V,g){},131:function(L,V,g){"use strict";g.r(V);var u=g(0),r=g.n(u),je=g(9),gt=g.n(je),Ya=g(99),Ka=g(100),me=g(143),ae=g(146),_=g(145),ne=g(138),St=g(19),U=g.n(St);function Et({onMenuOpen:e,onHeaderClick:t}){return r.a.createElement("div",{className:U.a.titleBar},r.a.createElement("span",{className:U.a.menuIcon,onClick:e},"\u2630"),r.a.createElement(ne.a,{fluid:"sm",className:U.a.titleContainer},r.a.createElement("h1",{className:U.a.title,onClick:t},r.a.createElement("span",{className:U.a.titleText,"data-text":"Volca Sample"},"Volca Sample",r.a.createElement("span",{className:U.a.titleR},"r"),r.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:U.a.titleStarburst},Array(24).fill().map((a,n,{length:o})=>r.a.createElement("polygon",{key:n,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${n*360/o}deg`}})))),r.a.createElement("img",{className:U.a.titleGraphic,src:"volca_sample.png",alt:""}))),r.a.createElement("svg",{width:0,height:0},r.a.createElement("filter",{id:"outline"},r.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),r.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),r.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),r.a.createElement("feMerge",null,r.a.createElement("feMergeNode",{in:"OUTLINE"}),r.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var wt=Et,Be=g(52),Ct=g(53),Me=g.n(Ct),Ot=g(44),re=g.n(Ot),Ie=g(147),Ne=g(78);const oe=31250;var Dt=Object.defineProperty,kt=Object.defineProperties,At=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,pe=(e,t,a)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,z=(e,t)=>{for(var a in t||(t={}))xe.call(t,a)&&pe(e,a,t[a]);if(le)for(var a of le(t))Fe.call(t,a)&&pe(e,a,t[a]);return e},Z=(e,t)=>kt(e,At(t)),Le=(e,t)=>{var a={};for(var n in e)xe.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&le)for(var n of le(e))t.indexOf(n)<0&&Fe.call(e,n)&&(a[n]=e[n]);return a},ce=(e,t,a)=>(pe(e,typeof t!="symbol"?t+"":t,a),a),T=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const ie=re.a.createInstance({name:"audio_file_data",driver:re.a.INDEXEDDB}),se=re.a.createInstance({name:"sample_metadata",driver:re.a.INDEXEDDB});function Rt(e){return T(this,null,function*(){const t=Object(Ie.a)();return yield ie.setItem(t,e),t})}const he="0.3.0",Pt={"0.1.0":e=>{const t=e,{clip:a}=t,n=Le(t,["clip"]);return Z(z({},n),{trimFrames:a.map(i=>Math.round(i*oe)),metadataVersion:"0.2.0"})},"0.2.0":e=>T(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=Le(t,["trimFrames"]),o=yield Se(n.sourceFileId,!1),i=yield Qe(o,a),c={frames:a,waveformPeaks:i};return Z(z({},n),{trim:c,metadataVersion:"0.3.0"})})};function jt(e){return T(this,null,function*(){let t=e;for(;t.metadataVersion!==he;){const a=Pt[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:he};break}t=yield a(t)}return t})}const G=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(Ie.a)(),userFileInfo:o=null,slotNumber:i=0,dateSampled:c=Date.now(),dateModified:s=c,useCompression:l=!0,qualityBitDepth:d=16,scaleCoefficient:w=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:o,slotNumber:i,dateSampled:c,dateModified:s,useCompression:l,qualityBitDepth:d,scaleCoefficient:w,metadataVersion:he}}duplicate(){const e=new G.Mutable(Z(z({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return T(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),o=new Uint8Array(n);return this.cacheSourceFileData(e,o),o}const t=yield ie.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return T(this,null,function*(){const e=new Map,t=[];return yield se.iterate((a,n)=>{a&&t.push(jt(a).then(o=>{e.set(n,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${n}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return T(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield Te(),a=(yield ie.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,i])=>{const{sourceFileId:c}=i;return a.includes(c)?new G.Mutable(z({id:o},i)):(console.warn(`Found metadata "${i.name||o}" with missing data "${c}; ignoring.`),null)}).filter(Boolean).sort((o,i)=>i.metadata.dateModified-o.metadata.dateModified)})}};let x=G;ce(x,"Mutable",class extends G{constructor(e){super(e);setTimeout(()=>T(this,null,function*(){(yield se.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return T(this,null,function*(){yield se.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,n=typeof e=="function"?e(a):e;if(Object.keys(n).every(c=>n[c]===a[c]))return this;const o=Z(z(z({},a),n),{dateModified:Date.now()}),i=new G.Mutable(z({id:t},o));return i.persist(),i}remove(){return T(this,null,function*(){if(yield se.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield G.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield ie.removeItem(this.metadata.sourceFileId)})}}),ce(x,"sourceFileData",new Map),ce(x,"recentlyCachedSourceFileIds",[]),ce(x,"MAX_CACHED",10);let ve;function Te(){return ve||(ve=fetch("factory-samples.json").then(e=>e.json())),ve}function Bt(){return T(this,null,function*(){const e=yield Te();return new Map(e.map(t=>[t.id,new x(Z(z({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(Ne.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(Ne.a)(t.trim.waveformPeaks.negative))}}}))]))})}var We=Math.pow,ye=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function be(e,t){const a=4,n=t[0]*a,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,o)}function ge(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),o=Array(e.numberOfChannels).fill().map((i,c)=>be(e.getChannelData(c),t));for(let i=0;i<a;i++){let c=0;for(let s=0;s<o.length;s++)c+=o[s][i];c/=o.length,n[i]=c}return n}function He(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function Mt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function It(e,t){const a=We(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function Ve(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function Nt(e){const t=e.length,a=e[0].length,n=new Float32Array(t*a);for(let o=0;o<n.length;o++){const i=t*o;for(let c=0;c<t;c++)n[i+c]=e[c][o]}return n}function Ue(e){const t=new Int16Array(e.length),a=We(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function ze(){return window.AudioContext||window.webkitAudioContext}let $e;function _e(){const e=ze();return $e=$e||new e({sampleRate:oe})}function Y(e){return ye(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,o)=>{_e().decodeAudioData(t.buffer,n,o)})})}function Se(e,t){return ye(this,null,function*(){const a=yield x.getSourceFileData(e),n=yield Y(a);if(t)for(let o=0;o<n.numberOfChannels;o++)Ve(n.getChannelData(o));return n})}function Ee(e){return ye(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:o,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const c=yield Se(a,Boolean(n)),s=c.numberOfChannels===1?be(c.getChannelData(0),i):ge(c,i);o!==1&&Mt(s,o),t<16&&It(s,t);const l=Ue(s),d=l.length*2,w=Me()({channels:1,sampleRate:c.sampleRate,bitDepth:16,dataLength:d}),m=new Uint8Array(w.length+d);return m.set(w),m.set(new Uint8Array(l.buffer),w.length),{data:m,sampleRate:16}})}const xt={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},Xe=Object(u.createContext)(xt);function Ft({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((o,{onTimeUpdate:i=()=>null,onEnded:c=()=>null}={})=>{t.current();const s=_e(),l=s.createBufferSource();l.buffer=o,l.connect(s.destination),l.start();const d=s.currentTime;i(0);let w=requestAnimationFrame(m);function m(){i(s.currentTime-d),w=requestAnimationFrame(m)}let p=!1;l.addEventListener("ended",()=>{p||(i(o.duration),c()),cancelAnimationFrame(w)});function S(){l.stop(),cancelAnimationFrame(w),p=!0}return t.current=S,S},[]),n=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(Xe.Provider,{value:n},e)}function we(){return Object(u.useContext)(Xe)}var Ge=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const K=6,Ye=K*44;function Ke(e,t){const a=Math.floor(K*e.length/t),n=new Float32Array(Math.floor(e.length/a)),o=new Float32Array(Math.floor(e.length/a));for(let i=0;i<n.length;i++){const c=new Float32Array(e.buffer,i*a*4,a);let s=0,l=0;for(const d of c)d>s&&(s=d),d<l&&(l=d);n[i]=Math.min(1,s),o[i]=Math.max(-1,l)}return{positive:n,negative:o}}function Qe(e,t){return Ge(this,null,function*(){const a=ge(e,t);return Ke(a,Ye)})}function Je(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let o=!1;return(()=>Ge(this,null,function*(){if(o)return;const i=yield Se(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));o||a([e.metadata.sourceFileId,i])}))(),()=>{o=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const n=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(n.current=e),{sample:n.current,sourceAudioBuffer:t&&t[1]}}function Ze(e){const t=Object(u.useMemo)(()=>e?ge(e,[0,0]):new Float32Array,[e]),[a,n]=Object(u.useState)(null),o=Object(u.useMemo)(()=>a&&a.offsetWidth,[a]),i=Object(u.useMemo)(()=>!o||!t.length?{positive:new Float32Array,negative:new Float32Array}:Ke(t,o),[o,t]);return{monoSamples:t,waveformRef:n,pixelWidth:o,peaks:i}}var Lt=g(88);const Tt=Be.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function Wt(e,t){function a(o,i){e.width=o,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new Lt.a(([o])=>{const{width:i,height:c}=o.contentRect;a(i,c),t({width:i,height:c})});return n.observe(e),()=>n.disconnect()}function Ht(e,t,a){const n=getComputedStyle(document.documentElement),o=n.getPropertyValue("--bs-primary"),i=n.getPropertyValue("--bs-primary-darkened"),c=e.getContext("2d");c.imageSmoothingEnabled=!1;const{width:s,height:l}=e;c.clearRect(0,0,s,l);const d=Math.floor(l*(2/3))+1;c.fillStyle=o,t.positive.forEach((m,p)=>{const S=d*m,C=Math.max(Math.round(a*S),1);c.fillRect(p*K,d-C,K-1,C)});const w=l-d;c.fillStyle=i,t.negative.forEach((m,p)=>{const S=w*m*-1,C=Math.round(a*S);c.fillRect(p*K,d,K-1,C)})}function Vt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>n.current);const[o,i]=Object(u.useState)(Symbol()),c=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return c.current.width=n.current.offsetWidth,c.current.height=n.current.offsetHeight,Wt(n.current,({width:s,height:l})=>{(s!==c.current.width||l!==c.current.height)&&(i(Symbol()),c.current.width=s,c.current.height=l)})},[]),Object(u.useLayoutEffect)(()=>{const s=n.current;if(!s)throw new Error("Canvas should be defined");let l=requestAnimationFrame(()=>{l=requestAnimationFrame(()=>{Ht(s,e,t)})});return()=>cancelAnimationFrame(l)},[e,t,o]),r.a.createElement(Tt,{ref:n})}var Ce=Vt;const Ut=Be.a.div({width:`${Ye}px`,height:"40px"}),qe=typeof IntersectionObserver!="undefined",zt=r.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(u.useRef)(null),[o,i]=Object(u.useState)(!qe);return Object(u.useLayoutEffect)(()=>{if(!qe)return;const c=n.current;if(!c)throw new Error("Waveform container should be defined");const s=c.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){i(!0);return}const l=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),l.unobserve(c))});return l.observe(c),()=>l.disconnect()},[]),r.a.createElement(ae.a.Item,{active:t,onClick:()=>a(e.id)},r.a.createElement("div",null,e.metadata.name),r.a.createElement(Ut,{ref:n},o&&r.a.createElement(Ce,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function $t({samples:e,selectedSampleId:t,onSampleSelect:a}){return r.a.createElement(ae.a,{variant:"flush"},[...e].map(([n,o])=>r.a.createElement(zt,{key:n,sample:o,selected:n===t,onSampleSelect:a})))}var et=$t,_t=g(140),ue=g(93),N=g(89),F=g(142);function Xt({sample:e,onSetTrimFrames:t,onSetScaleCoefficient:a}){const{sample:{metadata:{trim:{frames:n},scaleCoefficient:o}},sourceAudioBuffer:i}=Je(e),{monoSamples:c,waveformRef:s,pixelWidth:l,peaks:d}=Ze(i),w=Object(u.useMemo)(()=>{if(!i)return 0;const f=be(c,n);return He(f)},[i,c,n]),m=1/w;Object(u.useLayoutEffect)(()=>{o>m&&a(m)},[o,m,a]);const[p,S]=Object(u.useState)(n);Object(u.useEffect)(()=>{S(n)},[n]);const C=Object(u.useMemo)(()=>{if(!c.length||!l)return[0,0];const f=l/c.length;return p.map(y=>y*f)},[l,c.length,p]),h=Object(u.useRef)(null),v=Object(u.useRef)(null);{const f=Object(u.useRef)(p);f.current=p,Object(u.useEffect)(()=>{function y(D){if(!l||!c.length)return;const{pageX:k}=D;if(h.current!==null){const A=k-h.current;if(A){const R=A/l,O=Math.round(c.length*R);S(j=>{let b=j[0]+O;return b=Math.min(b,c.length-j[1]-2e3),b=Math.max(b,0),[b,j[1]]}),h.current=k}}if(v.current!==null){const A=v.current-k;if(A){const R=A/l,O=Math.round(c.length*R);S(j=>{let b=j[1]+O;return b=Math.min(b,c.length-j[0]-2e3),b=Math.max(b,0),[j[0],b]}),v.current=k}}}function P(){(h.current!==null||v.current!==null)&&t(()=>f.current),h.current=null,v.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",y),window.addEventListener("mouseup",P),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",P)}},[l,c.length,t])}return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},r.a.createElement(N.a,{type:"button",variant:"light",disabled:o===m,onClick:()=>a(m)},"Normalize")," ",r.a.createElement(N.a,{type:"button",variant:"light",disabled:o===1,onClick:()=>a(1)},"Original level"))),r.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:s,peaks:d,scaleCoefficient:o}),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${C[0]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",h.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",h.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),h.current===null||!l||!c.length)return;const{pageX:y}=f.touches[0],P=y-h.current;if(P){const D=P/l,k=Math.round(c.length*D);t(A=>{let R=A[0]+k;return R=Math.min(R,c.length-A[1]-2e3),R=Math.max(R,0),[R,A[1]]}),h.current=y}},onTouchEnd:()=>{h.current=null},onTouchCancel:()=>{h.current=null}})),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${C[1]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",v.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",v.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),v.current===null||!l||!c.length)return;const{pageX:y}=f.touches[0],P=v.current-y;if(P){const D=P/l,k=Math.round(c.length*D);t(A=>{let R=A[1]+k;return R=Math.min(R,c.length-A[0]-2e3),R=Math.max(R,0),[A[0],R]}),v.current=y}},onTouchEnd:()=>{v.current=null},onTouchCancel:()=>{v.current=null}}))))}var Gt=Xt,Yt=g(148),Kt=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});let tt;function Qt(){return Kt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return tt=tt||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){a(o);return}t(n)})})}var Jt=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function Zt(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Jt(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:c,getSampleBufferProgress:s,getSampleBufferTotalSize:l,cancelSampleBufferWork:d,registerUpdateCallback:w,unregisterUpdateCallback:m,heap8Buffer:p}=yield Qt();if(a)return new Uint8Array;const{data:S}=yield Ee(e);if(a)return new Uint8Array;let C,h=0;const v=w(y=>{if(a)return;const P=l(y);C||(C=new Uint8Array(P));const D=i(y),k=c(y),A=s(y);C.set(new Uint8Array(p(),D,k),A-k),h=A/P}),f=o(S,S.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,v);t(h);try{yield new Promise(y=>{let P;n=()=>{cancelAnimationFrame(P),d(f),y()},D();function D(){if(h&&(t(h),h>=1)){y();return}P=requestAnimationFrame(D)}})}finally{n=()=>{},m(v)}if(a)return new Uint8Array;if(!C)throw new Error("Unexpected condition: sampleBuffer should be defined");return C}))()}}var qt=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function ea({sample:e}){const[t,a]=Object(u.useState)(0),[n,o]=Object(u.useState)("idle"),[i,c]=Object(u.useState)(null),[s,l]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&s&&(l(null),s.fn())},[i,s]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let m=!1;a(0),o("idle"),c(null),l(null),d.current=()=>{m=!0};try{const{sampleBufferPromise:p,cancelWork:S}=Zt(e,C=>{m||a(C)});d.current=()=>{S(),m=!0},p.then(C=>qt(this,null,function*(){if(m)return;d.current=()=>{m=!0};const h=yield Y(C);m||c(h)}))}catch(p){console.error(p),c(new Error(String(p)))}return()=>d.current()},[e]);const{playAudioBuffer:w}=we();return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{type:"button",variant:"primary",onClick:m=>{if(!(i instanceof AudioBuffer)){if(!i){const p=m.currentTarget;l({fn:()=>p.click()})}return}try{o("transferring");const p=w(i,{onTimeUpdate:S=>a(S/i.duration),onEnded:()=>o("idle")});d.current=()=>{p(),o("idle")}}catch(p){console.error(p),o("error")}},disabled:i instanceof Error||n==="transferring"},"Transfer to volca sample"),r.a.createElement("br",null),i&&n==="idle"?null:n==="error"?"Error transferring":r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),r.a.createElement(Yt.a,{now:100*t}),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),r.a.createElement("br",null))}var at=ea,nt=g(73),rt=g.n(nt),ta=g(144),aa=g(139),Oe=g(74),De=g(75),na=g(90),ra=g(18),W=g.n(ra),ot=Math.pow;nt.Digit.defaultProps.offOpacity=0;const lt=(e,t)=>Math.min(199,t+ot(10,e)),ct=(e,t)=>Math.max(0,t-ot(10,e));function oa({slotNumber:e,onSlotNumberUpdate:t}){const[a,n]=Object(u.useState)(e);Object(u.useEffect)(()=>{n(e)},[e]);const[o,i]=Object(u.useState)(null),c=Object(u.useCallback)(w=>{t(m=>lt(w,m))},[t]),s=Object(u.useCallback)(w=>{t(m=>ct(w,m))},[t]),l=Object(u.useRef)(null),d=Object(u.useRef)(null);{const w=Object(u.useRef)(o);w.current=o;const m=Object(u.useRef)(a);m.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function p(O){const j=w.current;if(j!==null)switch(O.stopPropagation(),O.preventDefault(),O.key){case"ArrowDown":n(b=>ct(j,b));break;case"ArrowUp":n(b=>lt(j,b));break;case"ArrowLeft":i(b=>b!==null&&b<2?b+1:b);break;case"ArrowRight":i(b=>b&&b-1);break;case"Enter":case"Escape":i(null);break;default:break}}function S(O){const j=w.current;if(j===null)return;O.stopPropagation(),O.preventDefault();const b=m.current;if(isNaN(Number(O.key)))t(b);else{const B=String(b).padStart(3,"0").split("");B[2-j]=O.key;const E=Math.min(199,Math.max(0,Number(B.join(""))));i(j?j-1:null),t(E)}}function C(O){l.current&&l.current.contains(O.target)||i(null)}document.addEventListener("keydown",p,!0),document.addEventListener("keyup",S,!0),document.addEventListener("click",C);const h=l.current;let v=0,f=!1,y=!1,P=0;function D(O){document.body.style.userSelect="none",v=O instanceof MouseEvent?O.pageY:O.touches[0].pageY,f=!0,y=!1,P=m.current}h.addEventListener("mousedown",D),h.addEventListener("touchstart",O=>{O.preventDefault(),D(O)});function k(O){if(!f)return;const{pageY:j}=O instanceof MouseEvent?O:O.touches[0],b=2,B=Math.round((v-j)/b);B&&(y=!0,n(Math.min(199,Math.max(0,P+B))))}window.addEventListener("mousemove",k),h.addEventListener("touchmove",k);function A(){document.body.style.userSelect="unset",f=!1,y&&t(m.current)}window.addEventListener("mouseup",A),h.addEventListener("touchend",A),h.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function R(O){y||d.current&&d.current.some(j=>j.contains(O.target))||i(2)}return h.addEventListener("click",R),d.current.forEach((O,j)=>{const b=j;O.addEventListener("click",()=>{y||i(b)}),O.addEventListener("touchstart",B=>{B.preventDefault()})}),()=>{document.removeEventListener("keydown",p,!0),document.removeEventListener("keyup",S,!0),document.removeEventListener("click",C),window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",A)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((w,m)=>{m===o?w.classList.add(W.a.active):w.classList.remove(W.a.active)})},[o]),r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a.Label,null,"Destination"),r.a.createElement("br",null),r.a.createElement("div",{className:W.a.slotNumberRow},r.a.createElement("div",{className:W.a.slotNumberContainer},r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>c(2)},r.a.createElement("img",{src:Oe.a,alt:"Increment 100"})),r.a.createElement("span",{onClick:()=>c(1)},r.a.createElement("img",{src:Oe.a,alt:"Increment 10"})),r.a.createElement("span",{onClick:()=>c(0)},r.a.createElement("img",{src:Oe.a,alt:"Increment 1"}))),r.a.createElement("div",{className:W.a.slotNumber,title:`Slot ${a}`,ref:l},r.a.createElement(rt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),r.a.createElement(rt.a,{ref:w=>{const m=Object(je.findDOMNode)(w);if(m){m.querySelectorAll("circle").forEach(S=>{m.removeChild(S)});const p=document.createElementNS("http://www.w3.org/2000/svg","circle");p.classList.add(W.a.point),p.setAttribute("cx","10.7"),p.setAttribute("cy","17"),p.setAttribute("r","1"),m.appendChild(p),d.current=[].slice.call(m.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>s(2)},r.a.createElement("img",{src:De.a,alt:"Decrement 100"})),r.a.createElement("span",{onClick:()=>s(1)},r.a.createElement("img",{src:De.a,alt:"Decrement 10"})),r.a.createElement("span",{onClick:()=>s(0)},r.a.createElement("img",{src:De.a,alt:"Decrement 1"})))),e>99&&a>99&&r.a.createElement(ta.a,{placement:"auto-end",overlay:r.a.createElement(aa.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},r.a.createElement("img",{className:W.a.warning,src:na.a,alt:"destination-warning"}))))}var it=oa,la=g(41),ke=g.n(la),ca=Object.defineProperty,ia=Object.defineProperties,sa=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,ua=Object.prototype.hasOwnProperty,da=Object.prototype.propertyIsEnumerable,ut=(e,t,a)=>t in e?ca(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,dt=(e,t)=>{for(var a in t||(t={}))ua.call(t,a)&&ut(e,a,t[a]);if(st)for(var a of st(t))da.call(t,a)&&ut(e,a,t[a]);return e},ft=(e,t)=>ia(e,sa(t)),fa=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function ma(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function pa({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const o=e&&e.id,i=Object(u.useCallback)(v=>o&&t(o,{scaleCoefficient:v}),[o,t]),c=Object(u.useCallback)(v=>o&&t(o,f=>ft(dt({},f),{trim:ft(dt({},f.trim),{frames:v(f.trim.frames)})})),[o,t]),[s,l]=Object(u.useState)(null),[d,w]=Object(u.useState)(null),[m,p]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&m&&(p(null),m.fn())},[d,m]),Object(u.useEffect)(()=>{l(null),p(null);let v=!1;Ee(e).then(({data:f})=>{v||l(f)})},[e]),Object(u.useEffect)(()=>{if(w(null),s){let v=!1;Y(s).then(f=>{v||w(f)})}},[s]);const{playAudioBuffer:S}=we(),C=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>C.current(),[e]);const h=Object(u.useCallback)(v=>{t(e.id,({slotNumber:f})=>({slotNumber:typeof v=="function"?v(f):v}))},[e.id,t]);return r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,e.metadata.name,r.a.createElement(_t.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},r.a.createElement(ue.a.Item,{onClick:()=>{const v=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),f=v&&v.trim();f&&t(e.id,{name:f})}},"Rename"),r.a.createElement(ue.a.Item,{onClick:()=>a(e.id)},"Duplicate"),r.a.createElement(ue.a.Divider,null),r.a.createElement(ue.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),r.a.createElement("br",null),r.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:ke.a.waveformContainer},r.a.createElement(Gt,{onSetTrimFrames:c,onSetScaleCoefficient:i,sample:e})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:v=>{if(d)C.current=S(d);else{const f=v.currentTarget;p({fn:()=>f.click()})}}},"Play audio preview")," ",r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>fa(this,null,function*(){const{sourceFileId:v,userFileInfo:f}=e.metadata,y=yield x.getSourceFileData(v),P=new Blob([y],{type:f?f.type:"audio/x-wav"});ma(P,`${e.metadata.name}${f?f.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:v=>{const f=Number(v.target.value);t(e.id,{qualityBitDepth:f})}})),r.a.createElement(it,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:h}),r.a.createElement("br",null),r.a.createElement(at,{sample:e}))}var ha=pa,de=g(141);function va({sample:e}){const{sample:{metadata:{scaleCoefficient:t}},sourceAudioBuffer:a}=Je(e),{waveformRef:n,peaks:o}=Ze(a);return r.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:n,peaks:o,scaleCoefficient:t}))}var ya=va,ba=Object.defineProperty,ga=Object.defineProperties,Sa=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,wa=Object.prototype.propertyIsEnumerable,pt=(e,t,a)=>t in e?ba(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ca=(e,t)=>{for(var a in t||(t={}))Ea.call(t,a)&&pt(e,a,t[a]);if(mt)for(var a of mt(t))wa.call(t,a)&&pt(e,a,t[a]);return e},Oa=(e,t)=>ga(e,Sa(t)),Da=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function ka(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function Aa(e){const t=e.metadata.slotNumber,[a,n]=Object(u.useState)(t);return Object(u.useEffect)(()=>{n(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new x(Oa(Ca({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:n}}function Ra({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:n}=Aa(e),[o,i]=Object(u.useState)(null),[c,s]=Object(u.useState)(null),[l,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{c instanceof AudioBuffer&&l&&(d(null),l.fn())},[c,l]),Object(u.useEffect)(()=>{i(null),d(null);let p=!1;Ee(a).then(({data:S})=>{p||i(S)})},[a]),Object(u.useEffect)(()=>{if(s(null),o){let p=!1;Y(o).then(S=>{p||s(S)})}},[o]);const{playAudioBuffer:w}=we(),m=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>m.current(),[a]),r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,a.metadata.name),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),r.a.createElement(de.a,{variant:"secondary"},r.a.createElement(de.a.Heading,null,"This is a factory sample."),r.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",r.a.createElement("span",{className:ke.a.buttonLink},r.a.createElement(N.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),r.a.createElement("div",{className:ke.a.waveformContainer},r.a.createElement(ya,{sample:a})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:p=>{if(c)m.current=w(c);else{const S=p.currentTarget;d({fn:()=>S.click()})}}},"Play audio preview")," ",r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Da(this,null,function*(){const{sourceFileId:p,userFileInfo:S}=a.metadata,C=yield x.getSourceFileData(p),h=new Blob([C],{type:S?S.type:"audio/x-wav"});ka(h,`${a.metadata.name}${S?S.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),r.a.createElement(it,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:n}),r.a.createElement("br",null),r.a.createElement(at,{sample:a}))}var Pa=Ra,ja=g(94),q=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});let ht;function Ae(){const e=ze();return ht=ht||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:oe}:{})}function Ba(){return q(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of n.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>n.deviceId===s).label;let c=1;{const s=o.getAudioTracks()[0],l=s.getSettings().channelCount;l?c=l:s.getCapabilities&&(c=(s.getCapabilities().channelCount||{}).max||c)}for(const s of o.getTracks())s.stop();a.push({device:{deviceId:n.deviceId,label:i},channelsAvailable:c})}return a})}let Re;function Ma(e){return q(this,arguments,function*({onData:t,onFinish:a}){const n=Ae();Re=Re||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield Re;const o=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=c=>{if(c.data.eventType==="data"){const s=c.data.audioChannels;t(s)}c.data.eventType==="stop"&&a()};const i=o.parameters.get("isRecording");return i.setValueAtTime(1,n.currentTime),{recorderNode:o,stop(){i.setValueAtTime(0,n.currentTime)}}})}function Ia({channelCount:e,onData:t,onFinish:a}){const o=Ae().createScriptProcessor(1024,e,e);let i=!1;return o.onaudioprocess=c=>{const s=Array(e).fill().map((l,d)=>c.inputBuffer.getChannelData(d));t(s),i&&a()},{recorderNode:o,stop(){i=!0}}}function Na(e){return q(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Ia(e):yield Ma(e)})}function xa(e){return q(this,arguments,function*({deviceId:t,channelCount:a,onStart:n,onUpdate:o}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:oe,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),c=Ae(),s=c.createMediaStreamSource(i),{recorderNode:l,stop:d}=yield Na({channelCount:a,onData:C,onFinish:P});s.connect(l),l.connect(c.destination);const w=10;n(c.sampleRate,w);const m=w*c.sampleRate;let p=0;const S=Array(a).fill([]);function C(D){let k=0;const A=[];for(let j=0;j<a;j++){const b=D[j],B=b.length,E=b.slice(0,Math.min(B,m-p));Ve(E),k||(k=E.length),A.push(E)}const R=Nt(A),O=Ue(R);S.push(O),p+=k,p>=m&&d(),o(A)}let h,v;const f=new Promise((D,k)=>{h=D,v=k});let y=!1;function P(){return q(this,null,function*(){if(y)return;try{const A=yield new Blob(S).arrayBuffer(),R=new Float32Array(A),O=Me()({channels:a,sampleRate:c.sampleRate,bitDepth:16,dataLength:R.byteLength}),j=new Uint8Array(O.length+R.byteLength);j.set(O),j.set(new Uint8Array(R.buffer),O.length),h(j)}catch(k){v(k)}const D=i.getTracks();for(const k of D)k.stop();l.disconnect(c.destination),s.disconnect(l),y=!0})}return{stop:d,mediaRecording:f}})}var Fa=g(45),fe=g.n(Fa),ee=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});const vt="capture_device_preference";let yt=null;function La(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(vt)||"null")),[n,o]=Object(u.useState)(yt),[i,c]=Object(u.useState)(n?"ok":"pending"),[s,l]=Object(u.useState)("");Object(u.useEffect)(()=>{yt=n,c("ok")},[n]);const d=Object(u.useCallback)(()=>{let b=!1;return Ba().then(B=>{b||B.length&&(o(new Map(B.map(E=>[E.device.deviceId,E]))),l(E=>E?(a.current=null,E):a.current&&B.find(({device:M})=>a.current.deviceId===M.deviceId)?a.current.deviceId:(a.current=null,B[0].device.deviceId)))}).catch(B=>{if(!b){if(B instanceof DOMException){if(B.name==="NotAllowedError"){c("denied");return}if(B.name==="NotFoundError"){c("unavailable");return}}throw B}}),()=>{b=!0}},[]),[w,m]=Object(u.useState)(1);Object(u.useEffect)(()=>{const b=n&&n.get(s);b&&(a.current&&a.current.deviceId===b.device.deviceId&&a.current.channelCount<=b.channelsAvailable?m(a.current.channelCount):m(b.channelsAvailable),a.current=null)},[n,s]),Object(u.useEffect)(()=>{s&&localStorage.setItem(vt,JSON.stringify({deviceId:s,channelCount:w}))},[s,w]);const[p,S]=Object(u.useState)("ready"),[C,h]=Object(u.useState)(null),[v,f]=Object(u.useState)(!1);Object(u.useEffect)(()=>{p!=="ready"&&f(!1)},[p]);const y=Object(u.useCallback)(()=>{f(!1)},[]),[P,D]=Object(u.useState)({fn(b){}});Object(u.useEffect)(()=>P.fn,[P]);const[k,A]=Object(u.useState)(1/0),[R,O]=Object(u.useState)(0),j=Object(u.useCallback)(()=>ee(this,null,function*(){let b=!1;const B=(I,X)=>xa({deviceId:I,channelCount:X,onStart:(J,$)=>{const te=$*J;A(J),O(te),S("capturing")},onUpdate:e}),E=a.current,{mediaRecording:M,stop:Q}=yield E?(()=>ee(this,null,function*(){try{return B(E.deviceId,E.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return B(s,w);throw I}}))():B(s,w);D({fn(I){Q(),I&&(b=!0)}});let H;try{H=yield M}catch(I){h(I),S("error");return}if(b)S("ready");else{S("finalizing");const I=yield t(H);b||(S("ready"),I==="silent"&&f(!0))}}),[s,w,e,t]);return{captureDevices:n,accessState:i,selectedCaptureDeviceId:s,selectedChannelCount:w,captureState:p,recordingError:C,showSilenceWarning:v,sampleRate:k,maxSamples:R,refreshCaptureDevices:d,setSelectedCaptureDeviceId:l,setSelectedChannelCount:m,beginRecording:j,stopRecording:P.fn,dismissSilenceWarning:y}}const Pe=3;function Ta({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:n}){const o="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:c,height:s}=e;i.clearRect(0,0,c,s),i.fillStyle=o;for(let l=0;l<a&&l<t.length;l++){const d=t[l],w=s*d,m=Math.max(Math.round(n*w),2);i.fillRect(l*Pe,s-m,Pe-1,m)}}function Wa({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),n=Object(u.useRef)(new Float32Array),o=Object(u.useRef)(0),i=Object(u.useRef)([]),c=Object(u.useRef)(1/0),s=Object(u.useRef)(0),[l,d]=Object(u.useState)(0),w=Object(u.useCallback)(E=>ee(this,null,function*(){const M=a.current,Q=n.current,H=i.current;if(H.push(E),s.current+=E[0].length,d(Math.floor(s.current/c.current)),H.reduce((X,[{length:J}])=>X+J,0)>=M){const X=yield Promise.all(E.map(($,te)=>H.reduce((Xa,Ga)=>[...Xa,Ga[te]],[])).map($=>ee(this,null,function*(){const te=yield new Blob($).arrayBuffer();return new Float32Array(te)}))),J=X.map($=>He(new Float32Array($.buffer,0,M)));Q[o.current++]=Math.max(...J),Ta({canvas:t.current,peaks:Q,drawUntil:o.current,scaleCoefficient:.3}),i.current=[X.map($=>$.slice(M))]}}),[]),{captureDevices:m,accessState:p,selectedCaptureDeviceId:S,selectedChannelCount:C,captureState:h,recordingError:v,showSilenceWarning:f,maxSamples:y,sampleRate:P,refreshCaptureDevices:D,setSelectedCaptureDeviceId:k,setSelectedChannelCount:A,beginRecording:R,stopRecording:O,dismissSilenceWarning:j}=La(w,e);c.current=P,Object(u.useEffect)(()=>{const E=t.current;E&&(E.width=E.offsetWidth,E.height=E.offsetHeight)},[p]),Object(u.useLayoutEffect)(()=>{const E=t.current;!E||(h!=="finalizing"&&E.getContext("2d").clearRect(0,0,E.width,E.height),h==="capturing"&&y&&(a.current=Math.floor(Pe*y/t.current.width),n.current=new Float32Array(Math.floor(y/a.current)),o.current=0,i.current=[],c.current=1/0,s.current=0,d(0)))},[y,h]);const[b,B]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{b&&D()},[b,D]),r.a.createElement(ne.a,{fluid:"sm"},p==="denied"?r.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:D},"try again")):p==="unavailable"?r.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:D},"try again")):r.a.createElement("div",null,r.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),f&&r.a.createElement("div",{className:fe.a.alertContainer},r.a.createElement(de.a,{dismissible:!0,variant:"warning",onClose:j},r.a.createElement(de.a.Heading,null,"Your recording was totally silent."),r.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),r.a.createElement(N.a,{className:fe.a.recordButton,type:"button",variant:h==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:h==="capturing"?()=>O():R,disabled:h==="finalizing"},r.a.createElement("canvas",{ref:t}),r.a.createElement("span",{className:fe.a.mainText},["capturing","finalizing"].includes(h)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(h)&&r.a.createElement("span",{className:fe.a.timeRecorded},"0:",String(l).padStart(2,"0"))),["capturing","finalizing"].includes(h)?r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>O(!0)},"Cancel")):r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>B(E=>!E)},"Audio input settings ",b?"\u25B2":"\u25BC"),r.a.createElement(ja.a,{in:b},r.a.createElement("div",null,r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Capture Device"),r.a.createElement(F.a.Select,{style:{width:250},value:S,onChange:E=>k(E.target.value)},m&&p==="ok"?[...m].map(([E,{device:M}])=>r.a.createElement("option",{key:E,value:E},M.label||E)):r.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Input channels"),r.a.createElement(F.a.Select,{style:{width:250},value:C,onChange:E=>A(Number(E.target.value))},[1,2].map(E=>r.a.createElement("option",{key:E,value:E,disabled:!m||!m.has(S)||m.get(S).channelsAvailable<E},E===1?"Mono":"Stereo (summed to mono)")))),r.a.createElement("br",null))))),h==="error"&&v||null,r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},type:"button",variant:"secondary",onClick:E=>{const M=E.currentTarget.querySelector("input");M&&E.target!==M&&M.click()}},"Or import an audio file",r.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:E=>{if(E.target.files&&E.target.files.length){const M=E.target.files[0];M.arrayBuffer().then(Q=>ee(this,null,function*(){const H=new Uint8Array(Q);let I;try{I=yield Y(H)}catch(X){alert("Unsupported audio format detected");return}if(I.length>10*I.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(H,M)}))}}})))}var Ha=Wa,Va=g(79),bt=g.n(Va),Ua=(e,t,a)=>new Promise((n,o)=>{var i=l=>{try{s(a.next(l))}catch(d){o(d)}},c=l=>{try{s(a.throw(l))}catch(d){o(d)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);s((a=a.apply(e,t)).next())});function za(){const[e,t]=Object(u.useState)(new Map),[a,n]=Object(u.useState)(new Map),o=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{Bt().then(n).catch(console.error)},[]);const[i,c]=Object(u.useState)(null),[s,l]=Object(u.useState)(!0);Object(u.useEffect)(()=>{x.getAllFromStorage().then(C=>{t(h=>new Map([...h,...C.map(v=>[v.id,v])]))}).finally(()=>{l(!1)})},[]);const d=Object(u.useCallback)((C,h)=>Ua(this,null,function*(){const v=yield Y(C),f=[0,0],y=yield Qe(v,f);if([...y.positive,...y.negative].every(R=>R===0))return"silent";const P=yield Rt(C);let D="",k="";if(h){const R=h.name.lastIndexOf(".");R>0?(D=h.name.slice(0,R),k=h.name.slice(R)):D=h.name}else D="New sample";const A=new x.Mutable({name:D,sourceFileId:P,trim:{frames:f,waveformPeaks:y},userFileInfo:h&&{type:h.type,ext:k}});return yield A.persist(),t(R=>new Map([[A.id,A],...R])),c(A.id),"saved"}),[]),w=Object(u.useCallback)((C,h)=>{t(v=>{const f=v.get(C);if(f&&f instanceof x.Mutable){const y=f.update(h);if(y!==f)return new Map(v).set(f.id,y)}return v})},[]),[m,p]=Object(u.useState)(!1),S=Object(u.useCallback)(C=>{c(C),p(!1)},[]);return r.a.createElement("div",null,r.a.createElement(wt,{onMenuOpen:()=>p(!0),onHeaderClick:()=>c(null)}),r.a.createElement(me.a,{show:m,onHide:()=>p(!1)},r.a.createElement(me.a.Header,{closeButton:!0}),r.a.createElement(me.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,{as:"button",onClick:()=>S(null)},"New Sample"),s?"Loading...":null,!s&&r.a.createElement(_.a,{defaultActiveKey:e.size?"user":"factory"},r.a.createElement(_.a.Item,{eventKey:"user"},r.a.createElement(_.a.Header,null,"Your Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:e,selectedSampleId:i,onSampleSelect:S}))),r.a.createElement(_.a.Item,{eventKey:"factory"},r.a.createElement(_.a.Header,null,"Factory Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:a,selectedSampleId:i,onSampleSelect:S}))))))),r.a.createElement("div",{className:bt.a.mainLayout},r.a.createElement("div",{className:bt.a.focusedSampleContainer},i&&(()=>{const C=o.get(i)||null;if(!C)return null;const h=v=>{const f=o.get(v);if(f){const y=f.duplicate();t(P=>new Map([[y.id,y],...P])),c(y.id)}};return C instanceof x.Mutable?r.a.createElement(ha,{sample:C,onSampleUpdate:w,onSampleDuplicate:h,onSampleDelete:v=>{const f=e.get(v);if(f&&f instanceof x.Mutable){f.remove();let y=null,P=!1;for(const[,D]of e){if(P){y=D.id;break}if(D.id===v){if(!y){P=!0;continue}break}y=D.id}c(y),t(D=>{const k=new Map(D);return k.delete(f.id),k})}}}):r.a.createElement(Pa,{sample:C,onSampleDuplicate:h})})(),!i&&r.a.createElement(Ha,{onRecordFinish:d}))))}var $a=za,_a=e=>{e&&e instanceof Function&&g.e(3).then(g.bind(null,149)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:o,getTTFB:i})=>{t(e),a(e),n(e),o(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),gt.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ft,null,r.a.createElement($a,null))),document.getElementById("root")),_a()},18:function(L,V,g){L.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},19:function(L,V,g){L.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},41:function(L,V,g){L.exports={buttonLink:"SampleDetail_buttonLink__1lqYj",waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},45:function(L,V,g){L.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},79:function(L,V,g){L.exports={mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}},99:function(L,V,g){}},[[131,1,2]]]);

//# sourceMappingURL=main.be451604.chunk.js.map