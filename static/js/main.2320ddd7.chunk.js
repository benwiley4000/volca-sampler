(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{15:function(Re,re,C){},23:function(Re,re,C){"use strict";C.r(re);var d=C(0),u=C.n(d),We=C(7),Te=C.n(We),la=C(15),O=C(1),Ne=C(8),Le=C.n(Ne),_e=C(2),W=C.n(_e),ne=C(25),oe=C(5);const T=31250;var Ve=Object.defineProperty,He=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,Y=(e,a,t)=>a in e?Ve(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,k=(e,a)=>{for(var t in a||(a={}))ie.call(a,t)&&Y(e,t,a[t]);if(N)for(var t of N(a))le.call(a,t)&&Y(e,t,a[t]);return e},R=(e,a)=>He(e,Ue(a)),ce=(e,a)=>{var t={};for(var r in e)ie.call(e,r)&&a.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&N)for(var r of N(e))a.indexOf(r)<0&&le.call(e,r)&&(t[r]=e[r]);return t},L=(e,a,t)=>(Y(e,typeof a!="symbol"?a+"":a,t),t),F=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const _=W.a.createInstance({name:"audio_file_data",driver:W.a.INDEXEDDB}),V=W.a.createInstance({name:"sample_metadata",driver:W.a.INDEXEDDB});function ze(e){return F(this,null,function*(){const a=Object(ne.a)();return yield _.setItem(a,e),a})}const Q="0.3.0",$e={"0.1.0":e=>{const a=e,{clip:t}=a,r=ce(a,["clip"]);return R(k({},r),{trimFrames:t.map(l=>Math.round(l*T)),metadataVersion:"0.2.0"})},"0.2.0":e=>F(void 0,null,function*(){const a=e,{trimFrames:t}=a,r=ce(a,["trimFrames"]),n=yield z(r.sourceFileId,t),l={frames:t,waveformPeaks:n};return R(k({},r),{trim:l,metadataVersion:"0.3.0"})})};function Ge(e){return F(this,null,function*(){let a=e;for(;a.metadataVersion!==Q;){const t=$e[e.metadataVersion];if(!t){console.warn(`Failed to properly upgrade metadata for sample "${a.name}"`),a={name:a.name,sourceFileId:a.sourceFileId,id:a.id,metadataVersion:Q};break}a=yield t(a)}return a})}const I=class{constructor({name:e,sourceFileId:a,trim:t,id:r=Object(ne.a)(),userFileInfo:n=null,slotNumber:l=0,dateSampled:c=Date.now(),dateModified:i=c,useCompression:o=!0,qualityBitDepth:s=16,scaleCoefficient:h=1}){this.id=r,this.metadata={name:e,sourceFileId:a,trim:t,userFileInfo:n,slotNumber:l,dateSampled:c,dateModified:i,useCompression:o,qualityBitDepth:s,scaleCoefficient:h,metadataVersion:Q}}duplicate(){const e=new I.Mutable(R(k({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,a){this.sourceFileData.set(e,a),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(r=>r!==e)];const t=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const r of t)this.sourceFileData.delete(r);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return F(this,null,function*(){{const t=this.sourceFileData.get(e);if(t)return t}if(e.includes(".")){const t=yield fetch(e);if(t.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const r=yield t.arrayBuffer(),n=new Uint8Array(r);return this.cacheSourceFileData(e,n),n}const a=yield _.getItem(e);return a?a instanceof Uint8Array?(this.cacheSourceFileData(e,a),a):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return F(this,null,function*(){const e=[];return yield V.iterate((t,r)=>{t&&e.push(Ge(t).then(n=>[r,n]))}),new Map(yield Promise.all(e))})}static getAllFromStorage(){return F(this,null,function*(){const e=yield this.getAllMetadataFromStore(),a=yield se(),t=(yield _.keys()).concat(a.map(({sourceFileId:n})=>n));return[...e].map(([n,l])=>{const{sourceFileId:c}=l;return t.includes(c)?new I.Mutable(k({id:n},l)):(console.warn(`Found metadata "${l.name||n}" with missing data "${c}; ignoring.`),null)}).filter(Boolean).sort((n,l)=>l.metadata.dateModified-n.metadata.dateModified)})}};let A=I;L(A,"Mutable",class extends I{constructor(e){super(e);setTimeout(()=>F(this,null,function*(){(yield V.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return F(this,null,function*(){yield V.setItem(this.id,this.metadata)})}update(e){const{id:a,metadata:t}=this;if(Object.keys(e).every(l=>e[l]===t[l]))return this;const r=R(k(k({},t),e),{dateModified:Date.now()}),n=new I.Mutable(k({id:a},r));return n.persist(),n}remove(){return F(this,null,function*(){if(yield V.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield I.getAllMetadataFromStore();for(const[,{sourceFileId:a}]of e)if(a===this.metadata.sourceFileId)return;yield _.removeItem(this.metadata.sourceFileId)})}}),L(A,"sourceFileData",new Map),L(A,"recentlyCachedSourceFileIds",[]),L(A,"MAX_CACHED",10);let K;function se(){return K||(K=fetch("factory-samples.json").then(e=>e.json())),K}function Xe(){return F(this,null,function*(){const e=yield se();return new Map(e.map(a=>[a.id,new A(R(k({},a),{trim:{frames:[a.trim.frames[0],a.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(oe.a)(a.trim.waveformPeaks.positive)),negative:new Float32Array(Object(oe.a)(a.trim.waveformPeaks.negative))}}}))]))})}var ue=Math.pow,Z=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});function q(e,a){const t=4,r=a[0]*t,n=e.length-a[0]-a[1];return new Float32Array(e.buffer,r,n)}function ee(e,a){const t=e.length-a[0]-a[1],r=new Float32Array(t),n=Array(e.numberOfChannels).fill().map((l,c)=>q(e.getChannelData(c),a));for(let l=0;l<t;l++){let c=0;for(let i=0;i<n.length;i++)c+=n[i][l];c/=n.length,r[l]=c}return r}function Je(e){let a=0;for(const t of e){const r=Math.abs(t);r>a&&(a=r)}return a}function Ye(e,a){if(a!==1)for(let t=0;t<e.length;t++)e[t]*=a}function Qe(e,a){const t=ue(2,a-1);for(let r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t}function de(e){for(let a=0;a<e.length;a++)e[a]>1?e[a]=1:e[a]<-1&&(e[a]=-1)}function Ke(e){const a=new Int16Array(e.length),t=ue(2,15);for(let r=0;r<e.length;r++)a[r]=e[r]===1?t-1:t*e[r];return a}function fe(){return window.AudioContext||window.webkitAudioContext}let me;function pe(){const e=fe();return me=me||new e({sampleRate:T})}function H(e){return Z(this,null,function*(){const a=new Uint8Array(e);return yield new Promise((r,n)=>{pe().decodeAudioData(a.buffer,r,n)})})}function U(e,a){return Z(this,null,function*(){const t=yield A.getSourceFileData(e),r=yield H(t);if(a)for(let n=0;n<r.numberOfChannels;n++)de(r.getChannelData(n));return r})}function he(e){return Z(this,null,function*(){const{qualityBitDepth:a,sourceFileId:t,userFileInfo:r,scaleCoefficient:n,trim:{frames:l}}=e.metadata;if(a<8||a>16||!Number.isInteger(a))throw new Error(`Expected bit depth between 8 and 16. Received: ${a}`);const c=yield U(t,Boolean(r)),i=c.numberOfChannels===1?q(c.getChannelData(0),l):ee(c,l);n!==1&&Ye(i,n),a<16&&Qe(i,a);const o=Ke(i),s=o.length*2,h=Le()({channels:1,sampleRate:c.sampleRate,bitDepth:16,dataLength:s}),p=new Uint8Array(h.length+s);return p.set(h),p.set(new Uint8Array(o.buffer),h.length),{data:p,sampleRate:16}})}const Ze={playAudioBuffer(e,a){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},ve=Object(d.createContext)(Ze);function qe({children:e}){const[a,t]=Object(d.useState)(!1),r=Object(d.useCallback)((l,{onTimeUpdate:c=()=>null,onEnded:i=()=>null}={})=>{if(a)throw new Error("Wait until audio playback has finished to start new playback");t(!0);let o,s;try{o=pe(),s=o.createBufferSource(),s.buffer=l,s.connect(o.destination),s.start()}catch(g){throw t(!1),g}const h=o.currentTime;c(0);let p=requestAnimationFrame(b);function b(){c(o.currentTime-h),p=requestAnimationFrame(b)}let E=!1;return s.addEventListener("ended",()=>{E||(c(l.duration),i()),t(!1),cancelAnimationFrame(p)}),function(){s.stop(),E=!0}},[a]),n=Object(d.useMemo)(()=>({playAudioBuffer:r,isAudioBusy:a}),[r,a]);return Object(d.createElement)(ve.Provider,{value:n},e)}function ye(){return Object(d.useContext)(ve)}var et=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const M=6,ge=M*44;function be(e,a){const t=Math.floor(M*e.length/a),r=new Float32Array(Math.floor(e.length/t)),n=new Float32Array(Math.floor(e.length/t));for(let l=0;l<r.length;l++){const c=new Float32Array(e.buffer,l*t*4,t);let i=0,o=0;for(const s of c)s>i&&(i=s),s<o&&(o=s);r[l]=Math.min(1,i),n[l]=Math.max(-1,o)}return{positive:r,negative:n}}function z(e,a){return et(this,null,function*(){const t=yield U(e,!1),r=ee(t,a);return be(r,ge)})}var tt=C(9);const at=O.a.canvas({width:"100%",height:"100%",display:"block"});function rt(e,a){function t(n,l){e.width=n,e.height=l}t(e.offsetWidth,e.offsetHeight),a({width:e.offsetWidth,height:e.offsetHeight});const r=new tt.a(([n])=>{const{width:l,height:c}=n.contentRect;t(l,c),a({width:l,height:c})});return r.observe(e),()=>r.disconnect()}function nt(e,a,t){const r=e.getContext("2d"),{width:n,height:l}=e;r.clearRect(0,0,n,l);const c=Math.floor(l*(2/3))+1;r.fillStyle="red",a.positive.forEach((o,s)=>{const h=c*o,p=Math.max(Math.round(t*h),1);r.fillRect(s*M,c-p,M-1,p)});const i=l-c;r.fillStyle="darkred",a.negative.forEach((o,s)=>{const h=i*o*-1,p=Math.round(t*h);r.fillRect(s*M,c,M-1,p)})}function ot({peaks:e,scaleCoefficient:a,waveformRef:t}){const r=Object(d.useRef)(null);Object(d.useImperativeHandle)(t,()=>r.current);const[n,l]=Object(d.useState)(Symbol()),c=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!r.current)throw new Error("Canvas should be defined");return c.current.width=r.current.offsetWidth,c.current.height=r.current.offsetHeight,rt(r.current,({width:i,height:o})=>{(i!==c.current.width||o!==c.current.height)&&(l(Symbol()),c.current.width=i,c.current.height=o)})},[]),Object(d.useLayoutEffect)(()=>{const i=r.current;if(!i)throw new Error("Canvas should be defined");let o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{nt(i,e,a)})});return()=>cancelAnimationFrame(o)},[e,a,n]),u.a.createElement(at,{ref:r})}var Se=ot;const it=O.a.div({height:"100%",overflow:"auto"}),we=O.a.div({padding:"0.5rem",border:"1px solid grey",cursor:"pointer",backgroundColor:({$selected:e})=>e?"#f3f3f3":"unset"}),lt=O.a.div({width:`${ge}px`,height:"40px"}),Ee=typeof IntersectionObserver!="undefined",ct=u.a.memo(({sample:e,selected:a,readonly:t,onSampleSelect:r})=>{const n=Object(d.useRef)(null),[l,c]=Object(d.useState)(!Ee);return Object(d.useLayoutEffect)(()=>{if(!Ee)return;const i=n.current;if(!i)throw new Error("Waveform container should be defined");const o=i.getBoundingClientRect();if(o.top+o.height>=0&&o.bottom-o.height<=window.innerHeight){c(!0);return}const s=new IntersectionObserver(([h])=>{h.isIntersecting&&(c(!0),s.unobserve(i))});return s.observe(i),()=>s.disconnect()},[]),u.a.createElement(we,{selected:a,"data-disabled":t,onClick:()=>!t&&r(e.id)},u.a.createElement("div",null,e.metadata.name),u.a.createElement(lt,{ref:n},l&&u.a.createElement(Se,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function st({samples:e,selectedSampleId:a,readonly:t,onNewSample:r,onSampleSelect:n}){return u.a.createElement(it,null,u.a.createElement(we,{"data-disabled":t,onClick:()=>!t&&r()},"New Sample"),[...e].map(([l,c])=>u.a.createElement(ct,{key:l,sample:c,selected:l===a,readonly:t,onSampleSelect:n})))}var ut=st,dt=Object.defineProperty,ft=Object.defineProperties,mt=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,Pe=(e,a,t)=>a in e?dt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,pt=(e,a)=>{for(var t in a||(a={}))Ce.call(a,t)&&Pe(e,t,a[t]);if($)for(var t of $(a))Oe.call(a,t)&&Pe(e,t,a[t]);return e},ht=(e,a)=>ft(e,mt(a)),vt=(e,a)=>{var t={};for(var r in e)Ce.call(e,r)&&a.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&$)for(var r of $(e))a.indexOf(r)<0&&Oe.call(e,r)&&(t[r]=e[r]);return t},yt=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const gt=O.a.input({position:"absolute"});function bt({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:a},scaleCoefficient:t}},onSetTrimFrames:r,onSetScaleCoefficient:n}){const l=Object(d.useMemo)(()=>e?ee(e,[0,0]):new Float32Array,[e]),c=Object(d.useRef)(null),i=Object(d.useMemo)(()=>{const p=c.current&&c.current.offsetWidth;return!p||!l.length?{positive:new Float32Array,negative:new Float32Array}:be(l,p)},[l]),o=Object(d.useMemo)(()=>{if(!e)return 0;const p=q(l,a);return Je(p)},[e,l,a]),s=1/o;Object(d.useLayoutEffect)(()=>{t>s&&n(s)},[t,s,n]);const h=t*o;return u.a.createElement(u.a.Fragment,null,u.a.createElement(gt,{type:"range",disabled:o===0,value:h,min:.1,max:1,step:.01,onChange:p=>{o!==0&&n(Number(p.target.value)/o)}}),u.a.createElement(Se,{waveformRef:c,peaks:i,scaleCoefficient:t}),u.a.createElement("button",{type:"button",disabled:t===s,onClick:()=>n(s)},"Normalize"),u.a.createElement("button",{type:"button",disabled:t===1,onClick:()=>n(1)},"Original level"))}function St(e){var a=e,{sample:t}=a,r=vt(a,["sample"]);const[n,l]=Object(d.useState)(null);Object(d.useEffect)(()=>{let i=!1;return(()=>yt(this,null,function*(){if(i)return;const o=yield U(t.metadata.sourceFileId,Boolean(t.metadata.userFileInfo));i||l([t.metadata.sourceFileId,o])}))(),()=>{i=!0}},[t.metadata.sourceFileId,t.metadata.userFileInfo]);const c=Object(d.useRef)(t);return n&&t.metadata.sourceFileId===n[0]&&(c.current=t),u.a.createElement(bt,ht(pt({},r),{sample:c.current,sourceAudioBuffer:n&&n[1]}))}var wt=St,Et=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});let Ae;function Ct(){return Et(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Ae=Ae||new Promise((a,t)=>{let r;try{r={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(n){return e.addFunction(n,"vi")},unregisterUpdateCallback(n){e.removeFunction(n)},heap8Buffer(){return e.HEAP8.buffer}}}catch(n){t(n);return}a(r)})})}var Ot=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});function Pt(e,a){let t=!1,r=()=>{};return{cancelWork(){t=!0,r()},sampleBufferPromise:(()=>Ot(this,null,function*(){const{prepareSampleBufferFromWavData:n,getSampleBufferChunkPointer:l,getSampleBufferChunkSize:c,getSampleBufferProgress:i,getSampleBufferTotalSize:o,cancelSampleBufferWork:s,registerUpdateCallback:h,unregisterUpdateCallback:p,heap8Buffer:b}=yield Ct();if(t)return new Uint8Array;const{data:E}=yield he(e);if(t)return new Uint8Array;let g,w=0;const P=h(f=>{if(t)return;const m=o(f);g||(g=new Uint8Array(m));const v=l(f),S=c(f),j=i(f);g.set(new Uint8Array(b(),v,S),j-S),w=j/m}),y=n(E,E.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,P);a(w);try{yield new Promise(f=>{let m;r=()=>{cancelAnimationFrame(m),s(y),f()},v();function v(){if(w&&(a(w),w>=1)){f();return}m=requestAnimationFrame(v)}})}finally{r=()=>{},p(P)}if(t)return new Uint8Array;if(!g)throw new Error("Unexpected condition: sampleBuffer should be defined");return g}))()}}var At=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});function Dt({sample:e}){const[a,t]=Object(d.useState)(0),[r,n]=Object(d.useState)("idle"),[l,c]=Object(d.useState)(null),i=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let h=!1;t(0),n("idle"),c(null),i.current=()=>{h=!0};try{const{sampleBufferPromise:p,cancelWork:b}=Pt(e,E=>{h||t(E)});i.current=()=>{b(),h=!0},p.then(E=>At(this,null,function*(){if(h)return;i.current=()=>{h=!0};const g=yield H(E);h||c(g)}))}catch(p){console.error(p),c(new Error(String(p)))}return()=>i.current()},[e]);const{playAudioBuffer:o,isAudioBusy:s}=ye();return u.a.createElement(u.a.Fragment,null,u.a.createElement("button",{type:"button",onClick:()=>{if(l instanceof AudioBuffer)try{n("transferring");const h=o(l,{onTimeUpdate:p=>t(p/l.duration),onEnded:()=>n("idle")});i.current=()=>{h(),n("idle")}}catch(h){console.error(h),n("error")}},disabled:s||!l||r==="transferring"},"transfer to volca sample"),u.a.createElement("br",null),l&&r==="idle"?null:r==="error"?"Error transferring":u.a.createElement(u.a.Fragment,null,u.a.createElement("p",null,l?l instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),u.a.createElement("progress",{value:a}),u.a.createElement("br",null),u.a.createElement("button",{onClick:()=>i.current()},"Cancel")),u.a.createElement("br",null))}var Ft=Dt,jt=Object.defineProperty,De=Object.getOwnPropertySymbols,kt=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable,Fe=(e,a,t)=>a in e?jt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,je=(e,a)=>{for(var t in a||(a={}))kt.call(a,t)&&Fe(e,t,a[t]);if(De)for(var t of De(a))Bt.call(a,t)&&Fe(e,t,a[t]);return e},G=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const It=O.a.div({paddingLeft:"2rem"}),Mt=O.a.div({height:"200px",backgroundColor:"#f3f3f3",maxWidth:"400px"});function ke(e,a){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=a,r.style.display="none",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(t)}function xt({sample:e,onSampleUpdate:a,onSampleDuplicate:t,onSampleDelete:r}){const[n,l]=Object(d.useState)(0),c=e&&e.metadata.sourceFileId;Object(d.useEffect)(()=>{l(0),c&&U(c,!1).then(f=>l(f.length))},[c]);const i=e&&e.id,o=Object(d.useCallback)(f=>i&&a(i,{scaleCoefficient:f}),[i,a]),[s,h]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(h(null),e){let f=!1;he(e).then(({data:m})=>{f||h(m)})}},[e]);const[p,b]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(b(null),s){let f=!1;H(s).then(m=>{f||b(m)})}},[s]);const{playAudioBuffer:E,isAudioBusy:g}=ye(),w=Object(d.useRef)(()=>{});if(Object(d.useEffect)(()=>()=>w.current(),[e]),!e)return null;const P=Math.max(0,n-e.metadata.trim.frames[1]),y=Math.max(0,n-e.metadata.trim.frames[0]);return u.a.createElement(It,null,u.a.createElement("h3",null,e.metadata.name),u.a.createElement("button",{type:"button",onClick:()=>t(e.id)},"Duplicate"),u.a.createElement("button",{type:"button",onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&r(e.id)}},"Remove"),u.a.createElement("h4",null,"Last edited: ",new Date(e.metadata.dateModified).toLocaleString()),u.a.createElement("h4",null,"Sampled: ",new Date(e.metadata.dateSampled).toLocaleString()),u.a.createElement("label",null,u.a.createElement("h4",null,"Trim start"),u.a.createElement("input",{type:"number",value:e.metadata.trim.frames[0],step:1,min:0,max:P,onChange:f=>G(this,null,function*(){if(n){const m=Number(f.target.value),v=[Math.min(m,P),e.metadata.trim.frames[1]],S=yield z(e.metadata.sourceFileId,v);a(e.id,{trim:{frames:v,waveformPeaks:S}})}else a(e.id,{trim:je({},e.metadata.trim)})})})),u.a.createElement("label",null,u.a.createElement("h4",null,"Trim end"),u.a.createElement("input",{type:"number",value:e.metadata.trim.frames[1],step:1,min:0,max:y,onChange:f=>G(this,null,function*(){if(n){const m=Number(f.target.value),v=[e.metadata.trim.frames[0],Math.min(m,y)],S=yield z(e.metadata.sourceFileId,v);a(e.id,{trim:{frames:v,waveformPeaks:S}})}else a(e.id,{trim:je({},e.metadata.trim)})})})),u.a.createElement(Mt,null,u.a.createElement(wt,{onSetTrimFrames:()=>null,onSetScaleCoefficient:o,sample:e}),u.a.createElement("button",{type:"button",onClick:()=>{p&&(w.current=E(p))},disabled:g||!p},"play"),u.a.createElement("button",{type:"button",onClick:()=>G(this,null,function*(){if(s){const f=new Blob([s],{type:"audio/x-wav"});ke(f,`${e.metadata.name}.wav`)}}),disabled:!s},"download"),u.a.createElement("button",{type:"button",onClick:()=>G(this,null,function*(){const{sourceFileId:f,userFileInfo:m}=e.metadata,v=yield A.getSourceFileData(f),S=new Blob([v],{type:m?m.type:"audio/x-wav"});ke(S,`${e.metadata.name}${m?m.ext:".wav"}`)})},"download (orig)")),u.a.createElement("h4",null,"Quality bit depth: ",e.metadata.qualityBitDepth),u.a.createElement("input",{type:"range",value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:f=>{const m=Number(f.target.value);a(e.id,{qualityBitDepth:m})}}),u.a.createElement("label",null,u.a.createElement("h4",null,"Slot number"),u.a.createElement("input",{type:"number",value:e.metadata.slotNumber,step:1,min:0,max:99,onChange:f=>{const m=Number(f.target.value);a(e.id,{slotNumber:m})}})),u.a.createElement(Ft,{sample:e}))}var Rt=xt,Wt=C(10),X=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});let Be;function te(){const e=fe();return Be=Be||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:T}:{})}function Tt(){return X(this,null,function*(){{const r=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const n of r.getTracks())n.stop()}const a=(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput"),t=[];for(const r of a){const n=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:r.deviceId,channelCount:2},video:!1}),l=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:i})=>r.deviceId===i).label,c=n.getAudioTracks().length;for(const i of n.getTracks())i.stop();t.push({device:{deviceId:r.deviceId,label:l},channelsAvailable:c})}return t})}let ae;function Nt(e){return X(this,arguments,function*({onData:a,onFinish:t}){const r=te();ae=ae||r.audioWorklet.addModule("recorderWorkletProcessor.js"),yield ae;const n=new AudioWorkletNode(r,"recorder-worklet",{parameterData:{bufferSize:1024}});n.port.onmessage=c=>{if(c.data.eventType==="data"){const i=c.data.audioChannels;a(i)}c.data.eventType==="stop"&&t()};const l=n.parameters.get("isRecording");return l.setValueAtTime(1,r.currentTime),{recorderNode:n,stop(){l.setValueAtTime(0,r.currentTime)}}})}function Lt({channelCount:e,onData:a,onFinish:t}){const n=te().createScriptProcessor(1024,e,e);let l=!1;return n.onaudioprocess=c=>{const i=Array(e).fill().map((o,s)=>c.inputBuffer.getChannelData(s));a(i),l&&t()},{recorderNode:n,stop(){l=!0}}}function _t(e){return X(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Lt(e):yield Nt(e)})}function Vt(e){return X(this,arguments,function*({deviceId:a,channelCount:t,onStart:r}){const n=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:a,channelCount:t,sampleRate:T,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),l=te(),c=l.createMediaStreamSource(n),{recorderNode:i,stop:o}=yield _t({channelCount:t,onData:E,onFinish:f});c.connect(i),i.connect(l.destination),r();const h=10*l.sampleRate;let p=0;const b=Array(t).fill([]);function E(m){let v=0;for(let S=0;S<t;S++){const j=m[S],x=j.length,D=j.slice(0,Math.min(x,h-p));de(D),v||(v=D.length),b[S].push(D)}p+=v,p>=h&&(f(),o())}let g,w;const P=new Promise((m,v)=>{g=m,w=v});let y=!1;function f(){if(y)return;try{const v=b.map(x=>{const D=new Float32Array(x.reduce((J,ia)=>J+ia.length,0));let B=0;for(const J of x)D.set(J,B),B+=J.length;return D}),S=new Wt.a;S.fromScratch(v.length,l.sampleRate,"32f",v);const j=S.toBuffer();g(j)}catch(v){w(v)}const m=n.getTracks();for(const v of m)v.stop();i.disconnect(l.destination),c.disconnect(i),y=!0}return{stop:o,mediaRecording:P}})}var Ie=Object.getOwnPropertySymbols,Ht=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable,zt=(e,a)=>{var t={};for(var r in e)Ht.call(e,r)&&a.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&Ie)for(var r of Ie(e))a.indexOf(r)<0&&Ut.call(e,r)&&(t[r]=e[r]);return t},Me=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const $t=O.a.div({padding:"2rem"});let xe=null;function Gt({onRecordStart:e,onRecordFinish:a,onRecordError:t}){const[r,n]=Object(d.useState)(xe),[l,c]=Object(d.useState)(r?"ok":"pending"),[i,o]=Object(d.useState)("");Object(d.useEffect)(()=>{xe=r,c("ok")},[r]);const s=Object(d.useCallback)(()=>{Tt().then(y=>{y.length&&(n(new Map(y.map(f=>[f.device.deviceId,f]))),o(f=>f||y[0].device.deviceId))}).catch(y=>{if(y instanceof DOMException){if(y.name==="NotAllowedError"){c("denied");return}if(y.name==="NotFoundError"){c("unavailable");return}}throw y})},[]);Object(d.useEffect)(s,[s]);const[h,p]=Object(d.useState)(1);Object(d.useEffect)(()=>{const y=r&&r.get(i);y&&p(y.channelsAvailable)},[r,i]);const[b,E]=Object(d.useState)(null);Object(d.useEffect)(()=>{b&&t(b)},[b,t]);const[g,w]=Object(d.useState)({fn:()=>{}}),P=Object(d.useCallback)(()=>Me(this,null,function*(){const{mediaRecording:y,stop:f}=yield Vt({deviceId:i,channelCount:h,onStart:e});w({fn:f});let m;try{m=yield y}catch(v){E(v);return}a(m)}),[i,h,e,a]);return{captureDevices:r,accessState:l,selectedCaptureDeviceId:i,selectedChannelCount:h,recordingError:b,refreshCaptureDevices:s,setSelectedCaptureDeviceId:o,setSelectedChannelCount:p,beginRecording:P,stopRecording:g.fn}}function Xt(e){var a=e,{captureState:t}=a,r=zt(a,["captureState"]);const{captureDevices:n,accessState:l,selectedCaptureDeviceId:c,selectedChannelCount:i,recordingError:o,refreshCaptureDevices:s,setSelectedCaptureDeviceId:h,setSelectedChannelCount:p,beginRecording:b,stopRecording:E}=Gt(r);return u.a.createElement($t,null,l==="denied"?u.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",u.a.createElement("button",{type:"button",onClick:s},"try again")):l==="unavailable"?u.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",u.a.createElement("button",{type:"button",onClick:s},"try again")):u.a.createElement("div",null,u.a.createElement("label",null,"Capture Device",u.a.createElement("select",{value:c,onChange:g=>h(g.target.value)},n&&l==="ok"?[...n].map(([g,{device:w}])=>u.a.createElement("option",{key:g,value:g},w.label||g)):u.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),u.a.createElement("label",null,"Channel count",u.a.createElement("select",{value:i,onChange:g=>p(Number(g.target.value))},[1,2].map(g=>u.a.createElement("option",{key:g,value:g,disabled:!n||!n.has(c)||n.get(c).channelsAvailable<g},g))))),u.a.createElement("button",{type:"button",onClick:t==="capturing"?E:b,disabled:t==="preparing"},["capturing","preparing"].includes(t)?"Stop":"Record"),u.a.createElement("input",{type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:g=>{if(g.target.files&&g.target.files.length){const w=g.target.files[0];w.arrayBuffer().then(P=>Me(this,null,function*(){const y=new Uint8Array(P);let f;try{f=yield H(y)}catch(m){alert("Unsupported audio format detected");return}if(f.length>10*f.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}r.onRecordFinish(y,w)}))}}}),t==="error"&&o||null)}var Jt=Xt,Yt=(e,a,t)=>new Promise((r,n)=>{var l=o=>{try{i(t.next(o))}catch(s){n(s)}},c=o=>{try{i(t.throw(o))}catch(s){n(s)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,c);i((t=t.apply(e,a)).next())});const Qt=O.a.h1({display:"flex",alignItems:"center",padding:"2rem",paddingBottom:"0px",marginBottom:"0px"}),Kt=O.a.span({color:"red"}),Zt=O.a.span({textTransform:"uppercase",textDecoration:"underline"}),qt=O.a.img({height:"1.6em",paddingLeft:"1rem"}),ea=O.a.div({padding:"2rem",display:"flex",height:"100%"}),ta=O.a.div({width:"300px",flexShrink:0,paddingRight:"0.5rem",height:"100%"}),aa=O.a.div({flexGrow:1});function ra(){const[e,a]=Object(d.useState)(!1),[t,r]=Object(d.useState)(new Map),[n,l]=Object(d.useState)(new Map);Object(d.useEffect)(()=>{Xe().then(l).catch(console.error)},[]);const[c,i]=Object(d.useState)(null),[o,s]=Object(d.useState)(!0),[h,p]=Object(d.useState)("idle"),b=e?n:t;Object(d.useEffect)(()=>{A.getAllFromStorage().then(y=>{r(f=>new Map([...f,...y.map(m=>[m.id,m])]))}).finally(()=>{s(!1)})},[]),Object(d.useEffect)(()=>{b.size&&!(c&&b.has(c))&&i([...b.values()][0].id)},[b,c]);const E=Object(d.useCallback)(()=>p("capturing"),[]),g=Object(d.useCallback)((y,f)=>Yt(this,null,function*(){p("preparing");const m=yield ze(y);let v="",S="";if(f){const B=f.name.lastIndexOf(".");B>0?(v=f.name.slice(0,B),S=f.name.slice(B)):v=f.name}else v="New one";const j=[0,0],x=yield z(m,j),D=new A.Mutable({name:v,sourceFileId:m,trim:{frames:j,waveformPeaks:x},userFileInfo:f&&{type:f.type,ext:S}});yield D.persist(),r(B=>new Map([[D.id,D],...B])),a(!1),i(D.id),p("idle")}),[]),w=Object(d.useCallback)(y=>{console.error(y),p("error")},[]),P=Object(d.useCallback)((y,f)=>{r(m=>{const v=m.get(y);if(v&&v instanceof A.Mutable){const S=v.update(f);if(S!==v)return new Map(m).set(v.id,S)}return m})},[]);return u.a.createElement("div",null,u.a.createElement(Qt,null,u.a.createElement(Kt,null,"Volca Sample",u.a.createElement(Zt,null,"r")),u.a.createElement(qt,{src:"volca_sample.png",alt:""})),u.a.createElement(ea,null,u.a.createElement("select",{value:JSON.stringify(e),onChange:y=>a(JSON.parse(y.target.value))},u.a.createElement("option",{value:"false"},"Your Samples"),u.a.createElement("option",{value:"true"},"Factory Samples")),u.a.createElement(ta,null,o?"Loading...":null,u.a.createElement(ut,{samples:b,selectedSampleId:h==="idle"?c:null,readonly:["capturing","preparing"].includes(h),onNewSample:()=>p("ready"),onSampleSelect:y=>{i(y),p("idle")}})),u.a.createElement(aa,null,h==="idle"&&u.a.createElement(Rt,{sample:c&&b.get(c)||null,onSampleUpdate:P,onSampleDuplicate:y=>{const f=b.get(y);if(f){const m=f.duplicate();r(v=>new Map([[m.id,m],...v])),a(!1),i(m.id)}},onSampleDelete:y=>{const f=b.get(y);f&&f instanceof A.Mutable&&(f.remove(),r(m=>{const v=new Map(m);return v.delete(f.id),v}))}}),h!=="idle"&&u.a.createElement(Jt,{captureState:h,onRecordStart:E,onRecordFinish:g,onRecordError:w}))))}var na=ra,oa=e=>{e&&e instanceof Function&&C.e(3).then(C.bind(null,26)).then(({getCLS:a,getFID:t,getFCP:r,getLCP:n,getTTFB:l})=>{a(e),t(e),r(e),n(e),l(e)})};Te.a.render(u.a.createElement(u.a.StrictMode,null,u.a.createElement(qe,null,u.a.createElement(na,null))),document.getElementById("root")),oa()}},[[23,1,2]]]);

//# sourceMappingURL=main.2320ddd7.chunk.js.map