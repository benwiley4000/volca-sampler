(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{100:function(L,V,g){},131:function(L,V,g){"use strict";g.r(V);var u=g(0),r=g.n(u),je=g(9),gt=g.n(je),Ya=g(99),Ka=g(100),me=g(143),ae=g(146),_=g(145),ne=g(138),Et=g(19),U=g.n(Et);function St({onMenuOpen:e,onHeaderClick:t}){return r.a.createElement("div",{className:U.a.titleBar},r.a.createElement("span",{className:U.a.menuIcon,onClick:e},"\u2630"),r.a.createElement(ne.a,{fluid:"sm",className:U.a.titleContainer},r.a.createElement("h1",{className:U.a.title,onClick:t},r.a.createElement("span",{className:U.a.titleText,"data-text":"Volca Sample"},"Volca Sample",r.a.createElement("span",{className:U.a.titleR},"r"),r.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:U.a.titleStarburst},Array(24).fill().map((a,n,{length:l})=>r.a.createElement("polygon",{key:n,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${n*360/l}deg`}})))),r.a.createElement("img",{className:U.a.titleGraphic,src:"volca_sample.png",alt:""}))),r.a.createElement("svg",{width:0,height:0},r.a.createElement("filter",{id:"outline"},r.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),r.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),r.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),r.a.createElement("feMerge",null,r.a.createElement("feMergeNode",{in:"OUTLINE"}),r.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var wt=St,Be=g(52),Ct=g(53),Me=g.n(Ct),Ot=g(44),re=g.n(Ot),Ie=g(147),Ne=g(78);const oe=31250;var Dt=Object.defineProperty,At=Object.defineProperties,kt=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,pe=(e,t,a)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,z=(e,t)=>{for(var a in t||(t={}))xe.call(t,a)&&pe(e,a,t[a]);if(le)for(var a of le(t))Fe.call(t,a)&&pe(e,a,t[a]);return e},Z=(e,t)=>At(e,kt(t)),Le=(e,t)=>{var a={};for(var n in e)xe.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&le)for(var n of le(e))t.indexOf(n)<0&&Fe.call(e,n)&&(a[n]=e[n]);return a},ce=(e,t,a)=>(pe(e,typeof t!="symbol"?t+"":t,a),a),T=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const ie=re.a.createInstance({name:"audio_file_data",driver:re.a.INDEXEDDB}),se=re.a.createInstance({name:"sample_metadata",driver:re.a.INDEXEDDB});function Rt(e){return T(this,null,function*(){const t=Object(Ie.a)();return yield ie.setItem(t,e),t})}const he="0.3.0",Pt={"0.1.0":e=>{const t=e,{clip:a}=t,n=Le(t,["clip"]);return Z(z({},n),{trimFrames:a.map(i=>Math.round(i*oe)),metadataVersion:"0.2.0"})},"0.2.0":e=>T(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=Le(t,["trimFrames"]),l=yield Ee(n.sourceFileId,!1),i=yield Qe(l,a),c={frames:a,waveformPeaks:i};return Z(z({},n),{trim:c,metadataVersion:"0.3.0"})})};function jt(e){return T(this,null,function*(){let t=e;for(;t.metadataVersion!==he;){const a=Pt[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:he};break}t=yield a(t)}return t})}const G=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(Ie.a)(),userFileInfo:l=null,slotNumber:i=0,dateSampled:c=Date.now(),dateModified:s=c,useCompression:o=!0,qualityBitDepth:d=16,scaleCoefficient:S=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:l,slotNumber:i,dateSampled:c,dateModified:s,useCompression:o,qualityBitDepth:d,scaleCoefficient:S,metadataVersion:he}}duplicate(){const e=new G.Mutable(Z(z({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return T(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),l=new Uint8Array(n);return this.cacheSourceFileData(e,l),l}const t=yield ie.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return T(this,null,function*(){const e=new Map,t=[];return yield se.iterate((a,n)=>{a&&t.push(jt(a).then(l=>{e.set(n,l)}).catch(l=>{console.error(l),console.warn(`Failed to upgrade metadata "${n}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return T(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield Te(),a=(yield ie.keys()).concat(t.map(({sourceFileId:l})=>l));return[...e].map(([l,i])=>{const{sourceFileId:c}=i;return a.includes(c)?new G.Mutable(z({id:l},i)):(console.warn(`Found metadata "${i.name||l}" with missing data "${c}; ignoring.`),null)}).filter(Boolean).sort((l,i)=>i.metadata.dateModified-l.metadata.dateModified)})}};let x=G;ce(x,"Mutable",class extends G{constructor(e){super(e);setTimeout(()=>T(this,null,function*(){(yield se.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return T(this,null,function*(){yield se.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,n=typeof e=="function"?e(a):e;if(Object.keys(n).every(c=>n[c]===a[c]))return this;const l=Z(z(z({},a),n),{dateModified:Date.now()}),i=new G.Mutable(z({id:t},l));return i.persist(),i}remove(){return T(this,null,function*(){if(yield se.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield G.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield ie.removeItem(this.metadata.sourceFileId)})}}),ce(x,"sourceFileData",new Map),ce(x,"recentlyCachedSourceFileIds",[]),ce(x,"MAX_CACHED",10);let ve;function Te(){return ve||(ve=fetch("factory-samples.json").then(e=>e.json())),ve}function Bt(){return T(this,null,function*(){const e=yield Te();return new Map(e.map(t=>[t.id,new x(Z(z({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(Ne.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(Ne.a)(t.trim.waveformPeaks.negative))}}}))]))})}var We=Math.pow,ye=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function be(e,t){const a=4,n=t[0]*a,l=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,l)}function ge(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),l=Array(e.numberOfChannels).fill().map((i,c)=>be(e.getChannelData(c),t));for(let i=0;i<a;i++){let c=0;for(let s=0;s<l.length;s++)c+=l[s][i];c/=l.length,n[i]=c}return n}function He(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function Mt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function It(e,t){const a=We(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function Ve(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function Nt(e){const t=e.length,a=e[0].length,n=new Float32Array(t*a);for(let l=0;l<n.length;l++){const i=t*l;for(let c=0;c<t;c++)n[i+c]=e[c][l]}return n}function Ue(e){const t=new Int16Array(e.length),a=We(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function ze(){return window.AudioContext||window.webkitAudioContext}let $e;function _e(){const e=ze();return $e=$e||new e({sampleRate:oe})}function Y(e){return ye(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,l)=>{_e().decodeAudioData(t.buffer,n,l)})})}function Ee(e,t){return ye(this,null,function*(){const a=yield x.getSourceFileData(e),n=yield Y(a);if(t)for(let l=0;l<n.numberOfChannels;l++)Ve(n.getChannelData(l));return n})}function Se(e){return ye(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:l,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const c=yield Ee(a,Boolean(n)),s=c.numberOfChannels===1?be(c.getChannelData(0),i):ge(c,i);l!==1&&Mt(s,l),t<16&&It(s,t);const o=Ue(s),d=o.length*2,S=Me()({channels:1,sampleRate:c.sampleRate,bitDepth:16,dataLength:d}),m=new Uint8Array(S.length+d);return m.set(S),m.set(new Uint8Array(o.buffer),S.length),{data:m,sampleRate:16}})}const xt={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},Xe=Object(u.createContext)(xt);function Ft({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((l,{onTimeUpdate:i=()=>null,onEnded:c=()=>null}={})=>{t.current();const s=_e(),o=s.createBufferSource();o.buffer=l,o.connect(s.destination),o.start();const d=s.currentTime;i(0);let S=requestAnimationFrame(m);function m(){i(s.currentTime-d),S=requestAnimationFrame(m)}let v=!1;o.addEventListener("ended",()=>{v||(i(l.duration),c()),cancelAnimationFrame(S)});function y(){o.stop(),cancelAnimationFrame(S),v=!0}return t.current=y,y},[]),n=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(Xe.Provider,{value:n},e)}function we(){return Object(u.useContext)(Xe)}var Ge=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const K=6,Ye=K*44;function Ke(e,t){const a=Math.floor(K*e.length/t),n=new Float32Array(Math.floor(e.length/a)),l=new Float32Array(Math.floor(e.length/a));for(let i=0;i<n.length;i++){const c=new Float32Array(e.buffer,i*a*4,a);let s=0,o=0;for(const d of c)d>s&&(s=d),d<o&&(o=d);n[i]=Math.min(1,s),l[i]=Math.max(-1,o)}return{positive:n,negative:l}}function Qe(e,t){return Ge(this,null,function*(){const a=ge(e,t);return Ke(a,Ye)})}function Je(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let l=!1;return(()=>Ge(this,null,function*(){if(l)return;const i=yield Ee(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));l||a([e.metadata.sourceFileId,i])}))(),()=>{l=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const n=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(n.current=e),{sample:n.current,sourceAudioBuffer:t&&t[1]}}function Ze(e){const t=Object(u.useMemo)(()=>e?ge(e,[0,0]):new Float32Array,[e]),[a,n]=Object(u.useState)(null),l=Object(u.useMemo)(()=>a&&a.offsetWidth,[a]),i=Object(u.useMemo)(()=>!l||!t.length?{positive:new Float32Array,negative:new Float32Array}:Ke(t,l),[l,t]);return{monoSamples:t,waveformRef:n,pixelWidth:l,peaks:i}}var Lt=g(88);const Tt=Be.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function Wt(e,t){function a(l,i){e.width=l,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new Lt.a(([l])=>{const{width:i,height:c}=l.contentRect;a(i,c),t({width:i,height:c})});return n.observe(e),()=>n.disconnect()}function Ht(e,t,a){const n=getComputedStyle(document.documentElement),l=n.getPropertyValue("--bs-primary"),i=n.getPropertyValue("--bs-primary-darkened"),c=e.getContext("2d");c.imageSmoothingEnabled=!1;const{width:s,height:o}=e;c.clearRect(0,0,s,o);const d=Math.floor(o*(2/3))+1;c.fillStyle=l,t.positive.forEach((m,v)=>{const y=d*m,b=Math.max(Math.round(a*y),1);c.fillRect(v*K,d-b,K-1,b)});const S=o-d;c.fillStyle=i,t.negative.forEach((m,v)=>{const y=S*m*-1,b=Math.round(a*y);c.fillRect(v*K,d,K-1,b)})}function Vt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>n.current);const[l,i]=Object(u.useState)(Symbol()),c=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return c.current.width=n.current.offsetWidth,c.current.height=n.current.offsetHeight,Wt(n.current,({width:s,height:o})=>{(s!==c.current.width||o!==c.current.height)&&(i(Symbol()),c.current.width=s,c.current.height=o)})},[]),Object(u.useLayoutEffect)(()=>{const s=n.current;if(!s)throw new Error("Canvas should be defined");let o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{Ht(s,e,t)})});return()=>cancelAnimationFrame(o)},[e,t,l]),r.a.createElement(Tt,{ref:n})}var Ce=Vt;const Ut=Be.a.div({width:`${Ye}px`,height:"40px"}),qe=typeof IntersectionObserver!="undefined",zt=r.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(u.useRef)(null),[l,i]=Object(u.useState)(!qe);return Object(u.useLayoutEffect)(()=>{if(!qe)return;const c=n.current;if(!c)throw new Error("Waveform container should be defined");const s=c.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){i(!0);return}const o=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),o.unobserve(c))});return o.observe(c),()=>o.disconnect()},[]),r.a.createElement(ae.a.Item,{active:t,onClick:()=>a(e.id)},r.a.createElement("div",null,e.metadata.name),r.a.createElement(Ut,{ref:n},l&&r.a.createElement(Ce,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function $t({samples:e,selectedSampleId:t,onSampleSelect:a}){return r.a.createElement(ae.a,{variant:"flush"},[...e].map(([n,l])=>r.a.createElement(zt,{key:n,sample:l,selected:n===t,onSampleSelect:a})))}var et=$t,_t=g(140),ue=g(93),N=g(89),F=g(142);function Xt({sample:e,onSetTrimFrames:t,onSetScaleCoefficient:a}){const{sample:{metadata:{trim:{frames:n},scaleCoefficient:l}},sourceAudioBuffer:i}=Je(e),{monoSamples:c,waveformRef:s,pixelWidth:o,peaks:d}=Ze(i),S=Object(u.useMemo)(()=>{if(!i)return 0;const f=be(c,n);return He(f)},[i,c,n]),m=1/S;Object(u.useLayoutEffect)(()=>{l>m&&a(m)},[l,m,a]);const v=Object(u.useMemo)(()=>{if(!c.length||!o)return[0,0];const f=o/c.length;return n.map(h=>h*f)},[o,c.length,n]),y=Object(u.useRef)(null),b=Object(u.useRef)(null);return Object(u.useEffect)(()=>{function f(p){if(y.current===null||!o||!c.length)return;const{pageX:w}=p,k=w-y.current;if(k){const D=k/o,O=Math.round(c.length*D);t(P=>{let R=P[0]+O;return R=Math.min(R,c.length-P[1]-2e3),R=Math.max(R,0),[R,P[1]]}),y.current=w}}function h(){y.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h)}},[o,c.length,t]),Object(u.useEffect)(()=>{function f(p){if(b.current===null||!o||!c.length)return;const{pageX:w}=p,k=b.current-w;if(k){const D=k/o,O=Math.round(c.length*D);t(P=>{let R=P[1]+O;return R=Math.min(R,c.length-P[0]-2e3),R=Math.max(R,0),[P[0],R]}),b.current=w}}function h(){b.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h)}},[o,c.length,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},r.a.createElement(N.a,{type:"button",variant:"light",disabled:l===m,onClick:()=>a(m)},"Normalize")," ",r.a.createElement(N.a,{type:"button",variant:"light",disabled:l===1,onClick:()=>a(1)},"Original level"))),r.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:s,peaks:d,scaleCoefficient:l}),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${v[0]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",y.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",y.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),y.current===null||!o||!c.length)return;const{pageX:h}=f.touches[0],p=h-y.current;if(p){const w=p/o,k=Math.round(c.length*w);t(D=>{let O=D[0]+k;return O=Math.min(O,c.length-D[1]-2e3),O=Math.max(O,0),[O,D[1]]}),y.current=h}},onTouchEnd:()=>{y.current=null},onTouchCancel:()=>{y.current=null}})),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${v[1]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",b.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",b.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),b.current===null||!o||!c.length)return;const{pageX:h}=f.touches[0],p=b.current-h;if(p){const w=p/o,k=Math.round(c.length*w);t(D=>{let O=D[1]+k;return O=Math.min(O,c.length-D[0]-2e3),O=Math.max(O,0),[D[0],O]}),b.current=h}},onTouchEnd:()=>{b.current=null},onTouchCancel:()=>{b.current=null}}))))}var Gt=Xt,Yt=g(148),Kt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});let tt;function Qt(){return Kt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return tt=tt||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(l){return e.addFunction(l,"vi")},unregisterUpdateCallback(l){e.removeFunction(l)},heap8Buffer(){return e.HEAP8.buffer}}}catch(l){a(l);return}t(n)})})}var Jt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function Zt(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Jt(this,null,function*(){const{prepareSampleBufferFromWavData:l,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:c,getSampleBufferProgress:s,getSampleBufferTotalSize:o,cancelSampleBufferWork:d,registerUpdateCallback:S,unregisterUpdateCallback:m,heap8Buffer:v}=yield Qt();if(a)return new Uint8Array;const{data:y}=yield Se(e);if(a)return new Uint8Array;let b,f=0;const h=S(w=>{if(a)return;const k=o(w);b||(b=new Uint8Array(k));const D=i(w),O=c(w),P=s(w);b.set(new Uint8Array(v(),D,O),P-O),f=P/k}),p=l(y,y.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,h);t(f);try{yield new Promise(w=>{let k;n=()=>{cancelAnimationFrame(k),d(p),w()},D();function D(){if(f&&(t(f),f>=1)){w();return}k=requestAnimationFrame(D)}})}finally{n=()=>{},m(h)}if(a)return new Uint8Array;if(!b)throw new Error("Unexpected condition: sampleBuffer should be defined");return b}))()}}var qt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ea({sample:e}){const[t,a]=Object(u.useState)(0),[n,l]=Object(u.useState)("idle"),[i,c]=Object(u.useState)(null),[s,o]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&s&&(o(null),s.fn())},[i,s]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let m=!1;a(0),l("idle"),c(null),o(null),d.current=()=>{m=!0};try{const{sampleBufferPromise:v,cancelWork:y}=Zt(e,b=>{m||a(b)});d.current=()=>{y(),m=!0},v.then(b=>qt(this,null,function*(){if(m)return;d.current=()=>{m=!0};const f=yield Y(b);m||c(f)}))}catch(v){console.error(v),c(new Error(String(v)))}return()=>d.current()},[e]);const{playAudioBuffer:S}=we();return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{type:"button",variant:"primary",onClick:m=>{if(!(i instanceof AudioBuffer)){if(!i){const v=m.currentTarget;o({fn:()=>v.click()})}return}try{l("transferring");const v=S(i,{onTimeUpdate:y=>a(y/i.duration),onEnded:()=>l("idle")});d.current=()=>{v(),l("idle")}}catch(v){console.error(v),l("error")}},disabled:i instanceof Error||n==="transferring"},"Transfer to volca sample"),r.a.createElement("br",null),i&&n==="idle"?null:n==="error"?"Error transferring":r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),r.a.createElement(Yt.a,{now:100*t}),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),r.a.createElement("br",null))}var at=ea,nt=g(73),rt=g.n(nt),ta=g(144),aa=g(139),Oe=g(74),De=g(75),na=g(90),ra=g(18),W=g.n(ra),ot=Math.pow;nt.Digit.defaultProps.offOpacity=0;const lt=(e,t)=>Math.min(199,t+ot(10,e)),ct=(e,t)=>Math.max(0,t-ot(10,e));function oa({slotNumber:e,onSlotNumberUpdate:t}){const[a,n]=Object(u.useState)(e);Object(u.useEffect)(()=>{n(e)},[e]);const[l,i]=Object(u.useState)(null),c=Object(u.useCallback)(S=>{t(m=>lt(S,m))},[t]),s=Object(u.useCallback)(S=>{t(m=>ct(S,m))},[t]),o=Object(u.useRef)(null),d=Object(u.useRef)(null);{const S=Object(u.useRef)(l);S.current=l;const m=Object(u.useRef)(a);m.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function v(A){const j=S.current;if(j!==null)switch(A.stopPropagation(),A.preventDefault(),A.key){case"ArrowDown":n(C=>ct(j,C));break;case"ArrowUp":n(C=>lt(j,C));break;case"ArrowLeft":i(C=>C!==null&&C<2?C+1:C);break;case"ArrowRight":i(C=>C&&C-1);break;case"Enter":case"Escape":i(null);break;default:break}}function y(A){const j=S.current;if(j===null)return;A.stopPropagation(),A.preventDefault();const C=m.current;if(isNaN(Number(A.key)))t(C);else{const B=String(C).padStart(3,"0").split("");B[2-j]=A.key;const E=Math.min(199,Math.max(0,Number(B.join(""))));i(j?j-1:null),t(E)}}function b(A){o.current&&o.current.contains(A.target)||i(null)}document.addEventListener("keydown",v,!0),document.addEventListener("keyup",y,!0),document.addEventListener("click",b);const f=o.current;let h=0,p=!1,w=!1,k=0;function D(A){document.body.style.userSelect="none",h=A instanceof MouseEvent?A.pageY:A.touches[0].pageY,p=!0,w=!1,k=m.current}f.addEventListener("mousedown",D),f.addEventListener("touchstart",A=>{A.preventDefault(),D(A)});function O(A){if(!p)return;const{pageY:j}=A instanceof MouseEvent?A:A.touches[0],C=2,B=Math.round((h-j)/C);B&&(w=!0,n(Math.min(199,Math.max(0,k+B))))}window.addEventListener("mousemove",O),f.addEventListener("touchmove",O);function P(){document.body.style.userSelect="unset",p=!1,w&&t(m.current)}window.addEventListener("mouseup",P),f.addEventListener("touchend",P),f.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function R(A){w||d.current&&d.current.some(j=>j.contains(A.target))||i(2)}return f.addEventListener("click",R),d.current.forEach((A,j)=>{const C=j;A.addEventListener("click",()=>{w||i(C)}),A.addEventListener("touchstart",B=>{B.preventDefault()})}),()=>{document.removeEventListener("keydown",v,!0),document.removeEventListener("keyup",y,!0),document.removeEventListener("click",b),window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",P)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((S,m)=>{m===l?S.classList.add(W.a.active):S.classList.remove(W.a.active)})},[l]),r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a.Label,null,"Destination"),r.a.createElement("br",null),r.a.createElement("div",{className:W.a.slotNumberRow},r.a.createElement("div",{className:W.a.slotNumberContainer},r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>c(2)},r.a.createElement("img",{src:Oe.a,alt:"Increment 100"})),r.a.createElement("span",{onClick:()=>c(1)},r.a.createElement("img",{src:Oe.a,alt:"Increment 10"})),r.a.createElement("span",{onClick:()=>c(0)},r.a.createElement("img",{src:Oe.a,alt:"Increment 1"}))),r.a.createElement("div",{className:W.a.slotNumber,title:`Slot ${a}`,ref:o},r.a.createElement(rt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),r.a.createElement(rt.a,{ref:S=>{const m=Object(je.findDOMNode)(S);if(m){m.querySelectorAll("circle").forEach(y=>{m.removeChild(y)});const v=document.createElementNS("http://www.w3.org/2000/svg","circle");v.classList.add(W.a.point),v.setAttribute("cx","10.7"),v.setAttribute("cy","17"),v.setAttribute("r","1"),m.appendChild(v),d.current=[].slice.call(m.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>s(2)},r.a.createElement("img",{src:De.a,alt:"Decrement 100"})),r.a.createElement("span",{onClick:()=>s(1)},r.a.createElement("img",{src:De.a,alt:"Decrement 10"})),r.a.createElement("span",{onClick:()=>s(0)},r.a.createElement("img",{src:De.a,alt:"Decrement 1"})))),e>99&&a>99&&r.a.createElement(ta.a,{placement:"auto-end",overlay:r.a.createElement(aa.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},r.a.createElement("img",{className:W.a.warning,src:na.a,alt:"destination-warning"}))))}var it=oa,la=g(41),Ae=g.n(la),ca=Object.defineProperty,ia=Object.defineProperties,sa=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,ua=Object.prototype.hasOwnProperty,da=Object.prototype.propertyIsEnumerable,ut=(e,t,a)=>t in e?ca(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,dt=(e,t)=>{for(var a in t||(t={}))ua.call(t,a)&&ut(e,a,t[a]);if(st)for(var a of st(t))da.call(t,a)&&ut(e,a,t[a]);return e},ft=(e,t)=>ia(e,sa(t)),fa=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ma(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function pa({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const l=e&&e.id,i=Object(u.useCallback)(h=>l&&t(l,{scaleCoefficient:h}),[l,t]),c=Object(u.useCallback)(h=>l&&t(l,p=>ft(dt({},p),{trim:ft(dt({},p.trim),{frames:h(p.trim.frames)})})),[l,t]),[s,o]=Object(u.useState)(null),[d,S]=Object(u.useState)(null),[m,v]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&m&&(v(null),m.fn())},[d,m]),Object(u.useEffect)(()=>{o(null),v(null);let h=!1;Se(e).then(({data:p})=>{h||o(p)})},[e]),Object(u.useEffect)(()=>{if(S(null),s){let h=!1;Y(s).then(p=>{h||S(p)})}},[s]);const{playAudioBuffer:y}=we(),b=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>b.current(),[e]);const f=Object(u.useCallback)(h=>{t(e.id,({slotNumber:p})=>({slotNumber:typeof h=="function"?h(p):h}))},[e.id,t]);return r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,e.metadata.name,r.a.createElement(_t.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},r.a.createElement(ue.a.Item,{onClick:()=>{const h=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),p=h&&h.trim();p&&t(e.id,{name:p})}},"Rename"),r.a.createElement(ue.a.Item,{onClick:()=>a(e.id)},"Duplicate"),r.a.createElement(ue.a.Divider,null),r.a.createElement(ue.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),r.a.createElement("br",null),r.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:Ae.a.waveformContainer},r.a.createElement(Gt,{onSetTrimFrames:c,onSetScaleCoefficient:i,sample:e})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:h=>{if(d)b.current=y(d);else{const p=h.currentTarget;v({fn:()=>p.click()})}}},"Play audio preview")," ",r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>fa(this,null,function*(){const{sourceFileId:h,userFileInfo:p}=e.metadata,w=yield x.getSourceFileData(h),k=new Blob([w],{type:p?p.type:"audio/x-wav"});ma(k,`${e.metadata.name}${p?p.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:h=>{const p=Number(h.target.value);t(e.id,{qualityBitDepth:p})}})),r.a.createElement(it,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:f}),r.a.createElement("br",null),r.a.createElement(at,{sample:e}))}var ha=pa,de=g(141);function va({sample:e}){const{sample:{metadata:{scaleCoefficient:t}},sourceAudioBuffer:a}=Je(e),{waveformRef:n,peaks:l}=Ze(a);return r.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:n,peaks:l,scaleCoefficient:t}))}var ya=va,ba=Object.defineProperty,ga=Object.defineProperties,Ea=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,Sa=Object.prototype.hasOwnProperty,wa=Object.prototype.propertyIsEnumerable,pt=(e,t,a)=>t in e?ba(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ca=(e,t)=>{for(var a in t||(t={}))Sa.call(t,a)&&pt(e,a,t[a]);if(mt)for(var a of mt(t))wa.call(t,a)&&pt(e,a,t[a]);return e},Oa=(e,t)=>ga(e,Ea(t)),Da=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function Aa(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function ka(e){const t=e.metadata.slotNumber,[a,n]=Object(u.useState)(t);return Object(u.useEffect)(()=>{n(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new x(Oa(Ca({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:n}}function Ra({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:n}=ka(e),[l,i]=Object(u.useState)(null),[c,s]=Object(u.useState)(null),[o,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{c instanceof AudioBuffer&&o&&(d(null),o.fn())},[c,o]),Object(u.useEffect)(()=>{i(null),d(null);let v=!1;Se(a).then(({data:y})=>{v||i(y)})},[a]),Object(u.useEffect)(()=>{if(s(null),l){let v=!1;Y(l).then(y=>{v||s(y)})}},[l]);const{playAudioBuffer:S}=we(),m=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>m.current(),[a]),r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,a.metadata.name),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),r.a.createElement(de.a,{variant:"secondary"},r.a.createElement(de.a.Heading,null,"This is a factory sample."),r.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",r.a.createElement("span",{className:Ae.a.buttonLink},r.a.createElement(N.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),r.a.createElement("div",{className:Ae.a.waveformContainer},r.a.createElement(ya,{sample:a})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:v=>{if(c)m.current=S(c);else{const y=v.currentTarget;d({fn:()=>y.click()})}}},"Play audio preview")," ",r.a.createElement(N.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Da(this,null,function*(){const{sourceFileId:v,userFileInfo:y}=a.metadata,b=yield x.getSourceFileData(v),f=new Blob([b],{type:y?y.type:"audio/x-wav"});Aa(f,`${a.metadata.name}${y?y.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),r.a.createElement(it,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:n}),r.a.createElement("br",null),r.a.createElement(at,{sample:a}))}var Pa=Ra,ja=g(94),q=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});let ht;function ke(){const e=ze();return ht=ht||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:oe}:{})}function Ba(){return q(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const l of n.getTracks())l.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>n.deviceId===s).label;let c=1;{const s=l.getAudioTracks()[0],o=s.getSettings().channelCount;o?c=o:s.getCapabilities&&(c=(s.getCapabilities().channelCount||{}).max||c)}for(const s of l.getTracks())s.stop();a.push({device:{deviceId:n.deviceId,label:i},channelsAvailable:c})}return a})}let Re;function Ma(e){return q(this,arguments,function*({onData:t,onFinish:a}){const n=ke();Re=Re||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield Re;const l=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});l.port.onmessage=c=>{if(c.data.eventType==="data"){const s=c.data.audioChannels;t(s)}c.data.eventType==="stop"&&a()};const i=l.parameters.get("isRecording");return i.setValueAtTime(1,n.currentTime),{recorderNode:l,stop(){i.setValueAtTime(0,n.currentTime)}}})}function Ia({channelCount:e,onData:t,onFinish:a}){const l=ke().createScriptProcessor(1024,e,e);let i=!1;return l.onaudioprocess=c=>{const s=Array(e).fill().map((o,d)=>c.inputBuffer.getChannelData(d));t(s),i&&a()},{recorderNode:l,stop(){i=!0}}}function Na(e){return q(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Ia(e):yield Ma(e)})}function xa(e){return q(this,arguments,function*({deviceId:t,channelCount:a,onStart:n,onUpdate:l}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:oe,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),c=ke(),s=c.createMediaStreamSource(i),{recorderNode:o,stop:d}=yield Na({channelCount:a,onData:b,onFinish:k});s.connect(o),o.connect(c.destination);const S=10;n(c.sampleRate,S);const m=S*c.sampleRate;let v=0;const y=Array(a).fill([]);function b(D){let O=0;const P=[];for(let j=0;j<a;j++){const C=D[j],B=C.length,E=C.slice(0,Math.min(B,m-v));Ve(E),O||(O=E.length),P.push(E)}const R=Nt(P),A=Ue(R);y.push(A),v+=O,v>=m&&d(),l(P)}let f,h;const p=new Promise((D,O)=>{f=D,h=O});let w=!1;function k(){return q(this,null,function*(){if(w)return;try{const P=yield new Blob(y).arrayBuffer(),R=new Float32Array(P),A=Me()({channels:a,sampleRate:c.sampleRate,bitDepth:16,dataLength:R.byteLength}),j=new Uint8Array(A.length+R.byteLength);j.set(A),j.set(new Uint8Array(R.buffer),A.length),f(j)}catch(O){h(O)}const D=i.getTracks();for(const O of D)O.stop();o.disconnect(c.destination),s.disconnect(o),w=!0})}return{stop:d,mediaRecording:p}})}var Fa=g(45),fe=g.n(Fa),ee=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const vt="capture_device_preference";let yt=null;function La(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(vt)||"null")),[n,l]=Object(u.useState)(yt),[i,c]=Object(u.useState)(n?"ok":"pending"),[s,o]=Object(u.useState)("");Object(u.useEffect)(()=>{yt=n,c("ok")},[n]);const d=Object(u.useCallback)(()=>{let C=!1;return Ba().then(B=>{C||B.length&&(l(new Map(B.map(E=>[E.device.deviceId,E]))),o(E=>E?(a.current=null,E):a.current&&B.find(({device:M})=>a.current.deviceId===M.deviceId)?a.current.deviceId:(a.current=null,B[0].device.deviceId)))}).catch(B=>{if(!C){if(B instanceof DOMException){if(B.name==="NotAllowedError"){c("denied");return}if(B.name==="NotFoundError"){c("unavailable");return}}throw B}}),()=>{C=!0}},[]),[S,m]=Object(u.useState)(1);Object(u.useEffect)(()=>{const C=n&&n.get(s);C&&(a.current&&a.current.deviceId===C.device.deviceId&&a.current.channelCount<=C.channelsAvailable?m(a.current.channelCount):m(C.channelsAvailable),a.current=null)},[n,s]),Object(u.useEffect)(()=>{s&&localStorage.setItem(vt,JSON.stringify({deviceId:s,channelCount:S}))},[s,S]);const[v,y]=Object(u.useState)("ready"),[b,f]=Object(u.useState)(null),[h,p]=Object(u.useState)(!1);Object(u.useEffect)(()=>{v!=="ready"&&p(!1)},[v]);const w=Object(u.useCallback)(()=>{p(!1)},[]),[k,D]=Object(u.useState)({fn(C){}});Object(u.useEffect)(()=>k.fn,[k]);const[O,P]=Object(u.useState)(1/0),[R,A]=Object(u.useState)(0),j=Object(u.useCallback)(()=>ee(this,null,function*(){let C=!1;const B=(I,X)=>xa({deviceId:I,channelCount:X,onStart:(J,$)=>{const te=$*J;P(J),A(te),y("capturing")},onUpdate:e}),E=a.current,{mediaRecording:M,stop:Q}=yield E?(()=>ee(this,null,function*(){try{return B(E.deviceId,E.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return B(s,S);throw I}}))():B(s,S);D({fn(I){Q(),I&&(C=!0)}});let H;try{H=yield M}catch(I){f(I),y("error");return}if(C)y("ready");else{y("finalizing");const I=yield t(H);C||(y("ready"),I==="silent"&&p(!0))}}),[s,S,e,t]);return{captureDevices:n,accessState:i,selectedCaptureDeviceId:s,selectedChannelCount:S,captureState:v,recordingError:b,showSilenceWarning:h,sampleRate:O,maxSamples:R,refreshCaptureDevices:d,setSelectedCaptureDeviceId:o,setSelectedChannelCount:m,beginRecording:j,stopRecording:k.fn,dismissSilenceWarning:w}}const Pe=3;function Ta({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:n}){const l="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:c,height:s}=e;i.clearRect(0,0,c,s),i.fillStyle=l;for(let o=0;o<a&&o<t.length;o++){const d=t[o],S=s*d,m=Math.max(Math.round(n*S),2);i.fillRect(o*Pe,s-m,Pe-1,m)}}function Wa({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),n=Object(u.useRef)(new Float32Array),l=Object(u.useRef)(0),i=Object(u.useRef)([]),c=Object(u.useRef)(1/0),s=Object(u.useRef)(0),[o,d]=Object(u.useState)(0),S=Object(u.useCallback)(E=>ee(this,null,function*(){const M=a.current,Q=n.current,H=i.current;if(H.push(E),s.current+=E[0].length,d(Math.floor(s.current/c.current)),H.reduce((X,[{length:J}])=>X+J,0)>=M){const X=yield Promise.all(E.map(($,te)=>H.reduce((Xa,Ga)=>[...Xa,Ga[te]],[])).map($=>ee(this,null,function*(){const te=yield new Blob($).arrayBuffer();return new Float32Array(te)}))),J=X.map($=>He(new Float32Array($.buffer,0,M)));Q[l.current++]=Math.max(...J),Ta({canvas:t.current,peaks:Q,drawUntil:l.current,scaleCoefficient:.3}),i.current=[X.map($=>$.slice(M))]}}),[]),{captureDevices:m,accessState:v,selectedCaptureDeviceId:y,selectedChannelCount:b,captureState:f,recordingError:h,showSilenceWarning:p,maxSamples:w,sampleRate:k,refreshCaptureDevices:D,setSelectedCaptureDeviceId:O,setSelectedChannelCount:P,beginRecording:R,stopRecording:A,dismissSilenceWarning:j}=La(S,e);c.current=k,Object(u.useEffect)(()=>{const E=t.current;E&&(E.width=E.offsetWidth,E.height=E.offsetHeight)},[v]),Object(u.useLayoutEffect)(()=>{const E=t.current;!E||(f!=="finalizing"&&E.getContext("2d").clearRect(0,0,E.width,E.height),f==="capturing"&&w&&(a.current=Math.floor(Pe*w/t.current.width),n.current=new Float32Array(Math.floor(w/a.current)),l.current=0,i.current=[],c.current=1/0,s.current=0,d(0)))},[w,f]);const[C,B]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{C&&D()},[C,D]),r.a.createElement(ne.a,{fluid:"sm"},v==="denied"?r.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:D},"try again")):v==="unavailable"?r.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:D},"try again")):r.a.createElement("div",null,r.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),p&&r.a.createElement("div",{className:fe.a.alertContainer},r.a.createElement(de.a,{dismissible:!0,variant:"warning",onClose:j},r.a.createElement(de.a.Heading,null,"Your recording was totally silent."),r.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),r.a.createElement(N.a,{className:fe.a.recordButton,type:"button",variant:f==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:f==="capturing"?()=>A():R,disabled:f==="finalizing"},r.a.createElement("canvas",{ref:t}),r.a.createElement("span",{className:fe.a.mainText},["capturing","finalizing"].includes(f)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(f)&&r.a.createElement("span",{className:fe.a.timeRecorded},"0:",String(o).padStart(2,"0"))),["capturing","finalizing"].includes(f)?r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>A(!0)},"Cancel")):r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>B(E=>!E)},"Audio input settings ",C?"\u25B2":"\u25BC"),r.a.createElement(ja.a,{in:C},r.a.createElement("div",null,r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Capture Device"),r.a.createElement(F.a.Select,{style:{width:250},value:y,onChange:E=>O(E.target.value)},m&&v==="ok"?[...m].map(([E,{device:M}])=>r.a.createElement("option",{key:E,value:E},M.label||E)):r.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Input channels"),r.a.createElement(F.a.Select,{style:{width:250},value:b,onChange:E=>P(Number(E.target.value))},[1,2].map(E=>r.a.createElement("option",{key:E,value:E,disabled:!m||!m.has(y)||m.get(y).channelsAvailable<E},E===1?"Mono":"Stereo (summed to mono)")))),r.a.createElement("br",null))))),f==="error"&&h||null,r.a.createElement("br",null),r.a.createElement(N.a,{style:{width:250},type:"button",variant:"secondary",onClick:E=>{const M=E.currentTarget.querySelector("input");M&&E.target!==M&&M.click()}},"Or import an audio file",r.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:E=>{if(E.target.files&&E.target.files.length){const M=E.target.files[0];M.arrayBuffer().then(Q=>ee(this,null,function*(){const H=new Uint8Array(Q);let I;try{I=yield Y(H)}catch(X){alert("Unsupported audio format detected");return}if(I.length>10*I.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(H,M)}))}}})))}var Ha=Wa,Va=g(79),bt=g.n(Va),Ua=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function za(){const[e,t]=Object(u.useState)(new Map),[a,n]=Object(u.useState)(new Map),l=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{Bt().then(n).catch(console.error)},[]);const[i,c]=Object(u.useState)(null),[s,o]=Object(u.useState)(!0);Object(u.useEffect)(()=>{x.getAllFromStorage().then(b=>{t(f=>new Map([...f,...b.map(h=>[h.id,h])]))}).finally(()=>{o(!1)})},[]);const d=Object(u.useCallback)((b,f)=>Ua(this,null,function*(){const h=yield Y(b),p=[0,0],w=yield Qe(h,p);if([...w.positive,...w.negative].every(R=>R===0))return"silent";const k=yield Rt(b);let D="",O="";if(f){const R=f.name.lastIndexOf(".");R>0?(D=f.name.slice(0,R),O=f.name.slice(R)):D=f.name}else D="New sample";const P=new x.Mutable({name:D,sourceFileId:k,trim:{frames:p,waveformPeaks:w},userFileInfo:f&&{type:f.type,ext:O}});return yield P.persist(),t(R=>new Map([[P.id,P],...R])),c(P.id),"saved"}),[]),S=Object(u.useCallback)((b,f)=>{t(h=>{const p=h.get(b);if(p&&p instanceof x.Mutable){const w=p.update(f);if(w!==p)return new Map(h).set(p.id,w)}return h})},[]),[m,v]=Object(u.useState)(!1),y=Object(u.useCallback)(b=>{c(b),v(!1)},[]);return r.a.createElement("div",null,r.a.createElement(wt,{onMenuOpen:()=>v(!0),onHeaderClick:()=>c(null)}),r.a.createElement(me.a,{show:m,onHide:()=>v(!1)},r.a.createElement(me.a.Header,{closeButton:!0}),r.a.createElement(me.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,{as:"button",onClick:()=>y(null)},"New Sample"),s?"Loading...":null,!s&&r.a.createElement(_.a,{defaultActiveKey:e.size?"user":"factory"},r.a.createElement(_.a.Item,{eventKey:"user"},r.a.createElement(_.a.Header,null,"Your Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:e,selectedSampleId:i,onSampleSelect:y}))),r.a.createElement(_.a.Item,{eventKey:"factory"},r.a.createElement(_.a.Header,null,"Factory Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:a,selectedSampleId:i,onSampleSelect:y}))))))),r.a.createElement("div",{className:bt.a.mainLayout},r.a.createElement("div",{className:bt.a.focusedSampleContainer},i&&(()=>{const b=l.get(i)||null;if(!b)return null;const f=h=>{const p=l.get(h);if(p){const w=p.duplicate();t(k=>new Map([[w.id,w],...k])),c(w.id)}};return b instanceof x.Mutable?r.a.createElement(ha,{sample:b,onSampleUpdate:S,onSampleDuplicate:f,onSampleDelete:h=>{const p=l.get(h);p&&p instanceof x.Mutable&&(p.remove(),t(w=>{const k=new Map(w);return k.delete(p.id),k}))}}):r.a.createElement(Pa,{sample:b,onSampleDuplicate:f})})(),!i&&r.a.createElement(Ha,{onRecordFinish:d}))))}var $a=za,_a=e=>{e&&e instanceof Function&&g.e(3).then(g.bind(null,149)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:l,getTTFB:i})=>{t(e),a(e),n(e),l(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),gt.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ft,null,r.a.createElement($a,null))),document.getElementById("root")),_a()},18:function(L,V,g){L.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},19:function(L,V,g){L.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},41:function(L,V,g){L.exports={buttonLink:"SampleDetail_buttonLink__1lqYj",waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},45:function(L,V,g){L.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},79:function(L,V,g){L.exports={mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}},99:function(L,V,g){}},[[131,1,2]]]);

//# sourceMappingURL=main.7fdaf34b.chunk.js.map