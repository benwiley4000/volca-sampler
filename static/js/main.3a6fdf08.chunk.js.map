{"version":3,"sources":["SampleList.js","factory-samples.js","utils/constants.js","store.js","utils/audioData.js","Waveform.js","utils/getSyroBindings.js","utils/syro.js","VolcaTransferControl.js","SampleDetail.js","utils/recording.js","SampleRecord.js","App.js","reportWebVitals.js","index.js"],"names":[],"mappings":"0MAGA,KAAM,IAAsB,IAAO,IAAI,CACrC,OAAQ,OACR,SAAU,SAGN,GAAiB,IAAO,IAAI,CAChC,QAAS,SACT,OAAQ,iBACR,OAAQ,UACR,gBAAiB,CAAC,CAAE,eAAiB,EAAY,UAAY,UAY/D,YAAoB,CAClB,UACA,mBACA,WACA,cACA,kBACC,CACD,MACE,mBAAC,GAAD,KACE,kBAAC,GAAD,CACE,gBAAe,EACf,QAAS,IAAM,CAAC,GAAY,KAC7B,cAGA,CAAC,GAAG,GAAS,IAAI,CAAC,CAAC,EAAI,KACtB,kBAAC,GAAD,CACE,IAAK,EACL,UAAW,IAAO,EAClB,gBAAe,EACf,QAAS,IAAM,CAAC,GAAY,EAAe,IAE3C,kBAAC,MAAD,KAAM,EAAO,SAAS,MACtB,kBAAC,MAAD,KAAK,WACM,GAAI,MAAK,EAAO,SAAS,cAAc,qBAQ7C,U,8CCvDA,IACb,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,EACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,QACR,aAAgB,+BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,OACR,aAAgB,8BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,SACR,aAAgB,gCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,QACR,aAAgB,+BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,QACR,aAAgB,+BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,QACR,aAAgB,+BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,eACR,aAAgB,sCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,eACR,aAAgB,sCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,eACR,aAAgB,sCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,eACR,aAAgB,sCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,QACR,aAAgB,+BAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,cACR,aAAgB,qCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,eACR,aAAgB,sCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,WACR,aAAgB,kCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,YACR,aAAgB,mCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,UACR,aAAgB,iCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,YAEjB,CACE,KAAQ,aACR,aAAgB,oCAChB,GAAM,uCACN,WAAc,GACd,YAAe,aC5rBZ,KAAM,GAAc,M,i0BC8C3B,KAAM,GAAqB,IAAY,eAAe,CACpD,KAAM,kBACN,OAAQ,IAAY,YAGhB,EAAsB,IAAY,eAAe,CACrD,KAAM,kBACN,OAAQ,IAAY,YAOf,YAAoC,EAAe,gCACxD,KAAM,GAAK,eACX,YAAM,GAAmB,QAAQ,EAAI,GAC9B,IAGT,KAAM,GAAmB,QAenB,GAAmB,CACvB,QAAU,GAAgB,CAIxB,KAA+D,KAAvD,SAAuD,EAA9C,KAA8C,EAA9C,CAAT,SAQR,MAPoB,QACf,GADe,CAElB,WACE,EAAK,IAAK,GAAM,KAAK,MAAM,EAAI,IAEjC,gBAAiB,YAUvB,YAAyB,EAAa,CACpC,GAAI,GAAe,EACnB,KAAO,EAAa,kBAAoB,GAAkB,CAIxD,KAAM,GAAiB,GAAiB,EAAY,iBACpD,GAAI,CAAC,EAAgB,CACnB,QAAQ,KACN,mDAAmD,EAAa,SAElE,EAAe,CACb,KAAM,EAAa,KACnB,aAAc,EAAa,aAC3B,GAAI,EAAa,GACjB,gBAAiB,GAEnB,MAEF,EAAe,EAAe,GAEhC,MAA8D,GAGzD,aAAsB,CAI3B,YAAY,CACV,OACA,eACA,KAAK,eACL,eAAe,KACf,aAAa,EACb,cAAc,KAAK,MACnB,eAAe,EACf,iBAAiB,GACjB,kBAAkB,GAClB,mBAAmB,EACnB,aAAa,CAAC,EAAG,IAChB,CAED,KAAK,GAAK,EAKV,KAAK,SAAW,CACd,OACA,eACA,eACA,aACA,cACA,eACA,iBACA,kBACA,mBACA,aACA,gBAAiB,GAOrB,WAAY,CACV,KAAM,GAAO,GAAI,GAAgB,QAAQ,OACpC,KAAK,UAD+B,CAEvC,KAAM,GAAG,KAAK,SAAS,cACvB,aAAc,KAAK,SAGrB,SAAK,UACE,QAyFF,qBAAoB,EAAc,EAAM,CAC7C,KAAK,eAAe,IAAI,EAAc,GACtC,KAAK,4BAA8B,CACjC,EACA,GAAG,KAAK,4BAA4B,OAAQ,GAAO,IAAO,IAE5D,KAAM,GAAQ,KAAK,4BAA4B,MAAM,KAAK,YAC1D,SAAW,KAAgB,GACzB,KAAK,eAAe,OAAO,GAE7B,KAAK,4BAA8B,KAAK,4BAA4B,MAClE,EACA,KAAK,kBAQI,mBAAkB,EAAc,gCAC3C,CACE,KAAM,GAAO,KAAK,eAAe,IAAI,GACrC,GAAI,EACF,MAAO,GAGX,GAAI,EAAa,SAAS,KAAM,CAC9B,KAAM,GAAM,KAAM,OAAM,GACxB,GAAI,EAAI,QAAU,IAChB,MAAO,SAAQ,OACb,GAAI,OAAM,gCAAgC,OAI9C,KAAM,GAAS,KAAM,GAAI,cACnB,EAAO,GAAI,YAAW,GAC5B,YAAK,oBAAoB,EAAc,GAChC,EAKT,KAAM,GAAO,KAAM,GAAmB,QAAQ,GAC9C,MAAI,GACE,YAAgB,YAClB,MAAK,oBAAoB,EAAc,GAChC,GAEF,QAAQ,OAAO,qCAEjB,QAAQ,OAAO,+BAMX,0BAA0B,gCAIrC,KAAM,GAAiB,GAAI,KAC3B,YAAM,GAAoB,QAAQ,CAAC,EAAU,IAAO,CAClD,GAAI,EAAU,CACZ,KAAM,GAAmB,GAAgB,GACzC,EAAe,IAAI,EAAI,MAGpB,UAGI,oBAAoB,gCAC/B,KAAM,GAAiB,KAAM,MAAK,0BAC5B,EAAa,MAAM,GAAmB,QAAQ,OAClD,GAAoB,IAAI,CAAC,CAAE,kBAAmB,IAkBhD,MAfE,CAAC,GAAG,GACD,IAAI,CAAC,CAAC,EAAI,KAAc,CACvB,KAAM,CAAE,gBAAiB,EACzB,MAAK,GAAU,SAAS,GAQjB,GAAI,GAAgB,QAAQ,GAAE,MAAO,IAP1C,SAAQ,KACN,mBACE,EAAS,MAAQ,yBACK,gBAEnB,QAIV,OAAO,SACV,KAAK,CAAC,EAAG,IAAM,EAAE,SAAS,aAAe,EAAE,SAAS,kBArOnD,QAoDE,EApDF,EAoDE,UAAU,aAAc,EAAgB,CAI7C,YAAY,EAAuB,CACjC,MAAM,GACN,WAAW,IAAY,wBAEhB,MADa,GAAoB,QAC7B,SAAS,KAAK,KACrB,QAAQ,KACN,sCAAsC,KAAK,yBAM7C,SAAU,gCACd,KAAM,GAAoB,QAAQ,KAAK,GAAI,KAAK,YAOlD,OAAO,EAAQ,CACb,KAAM,CAAE,KAAI,YAAa,KAEzB,GAEI,OAAO,KAAK,GACZ,MAAO,GAAQ,EAAO,KAAS,EAAS,IAE1C,MAAO,MAKT,KAAM,GAAc,SACf,GACA,GAFe,CAGlB,aAAc,KAAK,QAEf,EAAe,GAAI,GAAgB,QAAQ,GAAE,MAAO,IAE1D,SAAa,UACN,EAGH,QAAS,gCAGb,GAFA,KAAM,GAAoB,WAAW,KAAK,IAEtC,KAAK,SAAS,aAAa,SAAS,KACtC,OAGF,KAAM,GAAc,KAAM,GAAgB,0BAC1C,SAAW,CAAC,CAAE,CAAE,kBAAmB,GACjC,GAAI,IAAiB,KAAK,SAAS,aAEjC,OAIJ,KAAM,GAAmB,WAAW,KAAK,SAAS,mBAQ/C,EA3HF,EA2HE,iBAAiB,GAAI,MAMrB,EAjIF,EAiIE,8BAA8B,IAG9B,EApIF,EAoIE,aAAa,IAsGf,KAAM,IAAiB,GAAI,KAChC,GAAoB,IAAK,GAAW,CAAC,EAAO,GAAI,GAAI,GAAgB,M,yNCxV/D,WAAwB,EAAO,EAAY,CAChD,KAAM,GAAmB,EACnB,EAAa,EAAW,GAAK,EAC7B,EAAa,EAAM,OAAS,EAAW,GAAK,EAAW,GAC7D,MAAO,IAAI,cAAa,EAAM,OAAQ,EAAY,GAO7C,YAAuC,EAAa,EAAY,CACrE,KAAM,GAAgB,EAAY,OAAS,EAAW,GAAK,EAAW,GAChE,EAAU,GAAI,cAAa,GAC3B,EAAkC,MAAM,EAAY,kBACvD,OACA,IAAI,CAAC,EAAG,IAAM,EAAe,EAAY,eAAe,GAAI,IAC/D,OAAS,GAAI,EAAG,EAAI,EAAe,IAAK,CACtC,GAAI,GAAa,EACjB,OAAS,GAAI,EAAG,EAAI,EAAS,OAAQ,IACnC,GAAc,EAAS,GAAG,GAE5B,GAAc,EAAS,OACvB,EAAQ,GAAK,EAEf,MAAO,GAQF,YAAwB,EAAS,CACtC,GAAI,GAAO,EACX,SAAW,KAAU,GAAS,CAC5B,KAAM,GAAM,KAAK,IAAI,GACjB,EAAM,GACR,GAAO,GAGX,MAAO,GAST,YAAsB,EAAS,EAAM,CACnC,GAAI,IAAS,EACX,OAAS,GAAI,EAAG,EAAI,EAAQ,OAAQ,IAClC,EAAQ,IAAM,EAWpB,YAAuC,EAAS,EAAiB,CAC/D,KAAM,GAAY,KAAM,EAAkB,GAC1C,OAAS,GAAI,EAAG,EAAI,EAAQ,OAAQ,IAClC,EAAQ,GAAK,KAAK,MAAM,EAAQ,GAAK,GAAa,EAW/C,YAAgC,EAAS,CAC9C,OAAS,GAAI,EAAG,EAAI,EAAQ,OAAQ,IAC9B,EAAQ,GAAK,EACf,EAAQ,GAAK,EACJ,EAAQ,GAAK,IACtB,GAAQ,GAAK,IAQnB,YAA+B,EAAS,CACtC,KAAM,GAAY,GAAI,YAAW,EAAQ,QACnC,EAAY,KAAK,IACvB,OAAS,GAAI,EAAG,EAAI,EAAQ,OAAQ,IAClC,EAAU,GAAK,EAAQ,KAAO,EAAI,EAAY,EAAI,EAAY,EAAQ,GAExE,MAAO,GAMT,GAAI,IAEJ,aAAiC,CAC/B,MAAQ,IACN,IAAsB,GAAI,cAAa,CAAE,WAAY,IAOlD,WAA8C,EAAiB,gCAEpE,KAAM,GAAa,GAAI,YAAW,GAOlC,MAHoB,MAAM,IAAI,SAAQ,CAAC,EAAS,IAAW,CACzD,KAAwB,gBAAgB,EAAW,OAAQ,EAAS,OAUjE,WAAoC,EAAc,EAAmB,gCAC1E,KAAM,GAAiB,KAAM,GAAgB,kBAAkB,GACzD,EAAc,KAAM,GAA+B,GACzD,GAAI,EACF,OAAS,GAAU,EAAG,EAAU,EAAY,iBAAkB,IAC5D,GAAuB,EAAY,eAAe,IAGtD,MAAO,KASF,WAAqC,EAAiB,gCAC3D,KAAM,CACJ,kBACA,eACA,eACA,mBACA,cACE,EAAgB,SACpB,GACE,EAAkB,GAClB,EAAkB,IAClB,CAAC,OAAO,UAAU,GAElB,KAAM,IAAI,OACR,kDAAkD,KAGtD,KAAM,GAAoB,KAAM,GAC9B,EACA,QAAQ,IAEJ,EACJ,EAAkB,mBAAqB,EACnC,EAAe,EAAkB,eAAe,GAAI,GACpD,GAA8B,EAAmB,GACnD,IAAqB,GACvB,GAAa,EAAS,GAEpB,EAAkB,IACpB,GAA8B,EAAS,GAEzC,KAAM,GAAY,GAAsB,GAClC,EAAoB,EAAU,OAAS,EAIvC,EAAY,KAAkB,CAClC,SAAU,EACV,WAAY,EAAkB,WAC9B,SAAU,GACV,WAAY,IAER,EAAY,GAAI,YAAW,EAAU,OAAS,GACpD,SAAU,IAAI,GACd,EAAU,IAAI,GAAI,YAAW,EAAU,QAAS,EAAU,QACnD,CACL,KAAM,EACN,WAAY,MAIhB,KAAM,IAAmC,CASvC,gBAAgB,EAAa,EAAM,CACjC,KAAM,IAAI,OAAM,6CAElB,YAAa,IAGT,GAAuB,wBAAc,IAMpC,YAAsC,CAAE,YAAY,CACzD,KAAM,CAAC,EAAa,GAAkB,mBAAS,IAEzC,EAAkB,sBAItB,CAAC,EAAa,CAAE,eAAe,IAAM,KAAM,UAAU,IAAM,MAAS,KAAO,CACzE,GAAI,EACF,KAAM,IAAI,OACR,gEAGJ,EAAe,IAIf,GAAI,GAIA,EACJ,GAAI,CACF,EAAe,KACf,EAAS,EAAa,qBACtB,EAAO,OAAS,EAChB,EAAO,QAAQ,EAAa,aAC5B,EAAO,cACA,EADA,CAEP,QAAe,IACT,EAER,KAAM,GAAY,EAAa,YAC/B,EAAa,GACb,GAAI,GAAQ,sBAAsB,GAClC,YAA6B,CAC3B,EAAa,EAAa,YAAc,GACxC,EAAQ,sBAAsB,GAEhC,GAAI,GAAU,GACd,SAAO,iBAAiB,QAAS,IAAM,CAChC,GACH,GAAa,EAAY,UACzB,KAEF,EAAe,IACf,qBAAqB,KAEhB,UAAgB,CACrB,EAAO,OACP,EAAU,KAGd,CAAC,IAGG,EAAe,kBACnB,IAAO,EACL,kBACA,gBAEF,CAAC,EAAiB,IAGpB,MAAO,yBACL,GAAqB,SACrB,CAAE,MAAO,GACT,GAIG,aAAmC,CACxC,MAAO,sBAAW,I,uxBCrSpB,KAAM,IAAa,EAEb,GAAc,IAAO,IAAI,CAC7B,MAAO,OACP,OAAQ,OACR,SAAU,WACV,SAAU,WAGN,GAAkB,IAAO,IAAI,CACjC,MAAO,OACP,OAAQ,CAAC,CAAE,eAAiB,EAAY,MAAQ,MAChD,QAAS,OACT,WAAY,CAAC,CAAE,eAAiB,EAAY,WAAa,eAGrD,GAAS,IAAO,IAAI,CACxB,MAAO,OACP,OAAQ,CAAC,CAAE,uBAAwB,GAAG,IAAM,KAC5C,WAAY,SACZ,QAAS,OACT,WAAY,CAAC,CAAE,eAAiB,EAAY,WAAa,eAGrD,GAAM,IAAO,IAAI,CACrB,MAAO,GAAG,OACV,OAAQ,CAAC,CAAE,aAAY,eACrB,GAAG,IAAO,GAAY,EAAI,IAAM,KAClC,aAAc,QAGV,GAAW,IAAO,IAAI,CAC1B,gBAAiB,CAAC,CAAE,eAAiB,EAAY,MAAQ,UACzD,OAAQ,SAMJ,GAAa,IAAO,MAAM,CAC9B,SAAU,WACV,IAAK,EACL,KAAM,IAWR,YAA4B,EAAS,EAAW,CAE9C,KAAM,GAAW,GAAI,cAAa,KAAK,MAAM,EAAQ,OAAS,IACxD,EAAW,GAAI,cAAa,KAAK,MAAM,EAAQ,OAAS,IAC9D,OAAS,GAAI,EAAG,EAAI,EAAS,OAAQ,IAAK,CACxC,KAAM,GAAQ,GAAI,cAChB,EAAQ,OACR,EAAI,EAAY,EAChB,GAEF,GAAI,GAAM,EACN,EAAM,EACV,SAAW,KAAU,GACf,EAAS,GACX,GAAM,GAEJ,EAAS,GACX,GAAM,GAGV,EAAS,GAAK,EACd,EAAS,GAAK,EAEhB,MAAO,CAAE,WAAU,YAcrB,YAAkB,CAChB,oBACA,OAAQ,CACN,SAAU,CAAE,aAAY,qBAE1B,kBACA,yBACC,CACD,KAAM,GAAc,kBAClB,IACE,EACI,GAA8B,EAAmB,CAAC,EAAG,IACrD,GAAI,cACV,CAAC,IAMG,EAAc,iBAAO,MAErB,EAAQ,kBAAQ,IAAM,CAC1B,KAAM,GAAa,EAAY,SAAW,EAAY,QAAQ,YAC9D,GAAI,CAAC,GAAc,CAAC,EAAY,OAC9B,MAAO,CACL,SAAU,GAAI,cACd,SAAU,GAAI,eAGlB,KAAM,GAAY,KAAK,MACpB,GAAa,EAAY,OAAU,GAEtC,MAAO,IAAmB,EAAa,IACtC,CAAC,IAEE,EAAoB,kBAAQ,IAAM,CACtC,GAAI,CAAC,EACH,MAAO,GAET,KAAM,GAAc,EAAe,EAAa,GAEhD,MADmB,IAAe,IAEjC,CAAC,EAAmB,EAAa,IAE9B,EAAiB,EAAI,EAG3B,0BAAgB,IAAM,CAChB,EAAmB,GACrB,EAAsB,IAEvB,CAAC,EAAkB,EAAgB,IAEtC,KAAM,GAAa,EAAmB,EAEtC,MACE,qCACE,kBAAC,GAAD,CAAa,IAAK,GACf,CAAC,GAAM,IAAO,IAAK,GAAa,CAC/B,KAAM,GAAM,EAAW,WAAa,WACpC,MACE,mBAAC,GAAD,CAAiB,MAAU,UAAW,GACpC,kBAAC,GAAD,CAAQ,kBAAmB,EAAkB,UAAW,GACrD,GAAG,IAAI,KAAK,EAAM,GAAM,CAAC,EAAW,IACnC,kBAAC,GAAD,CAAK,IAAK,EAAO,WAAY,EAAW,UAAW,GACjD,kBAAC,GAAD,CAAU,UAAW,UAOjC,kBAAC,GAAD,CACE,KAAK,QACL,SAAU,IAAsB,EAChC,MAAO,EACP,IAAK,GACL,IAAK,EACL,KAAM,IACN,SAAW,GAAM,CACX,IAAsB,GAG1B,EAAsB,OAAO,EAAE,OAAO,OAAS,OAIrD,kBAAC,SAAD,CACE,KAAK,SACL,SAAU,IAAqB,EAC/B,QAAS,IAAM,EAAsB,IACtC,aAGD,kBAAC,SAAD,CACE,KAAK,SACL,SAAU,IAAqB,EAC/B,QAAS,IAAM,EAAsB,IACtC,mBAWP,YAAuB,EAAqB,CAArB,QAAE,WAAF,EAAa,KAAb,EAAa,CAAX,WACvB,KAAM,CAAC,EAAmB,GAAwB,mBACH,MAE/C,oBAAU,IAAM,CACd,GAAI,GAAY,GACf,WAAY,yBACX,GAAI,EAAW,OACf,KAAM,GAAc,KAAM,GACxB,EAAO,SAAS,aAChB,QAAQ,EAAO,SAAS,eAEtB,GACJ,EAAqB,CAAC,EAAO,SAAS,aAAc,SAE/C,IAAM,CACX,EAAY,KAEb,CAAC,EAAO,SAAS,aAAc,EAAO,SAAS,eAKlD,KAAM,GAAkB,iBAAO,GAC/B,MACE,IACA,EAAO,SAAS,eAAiB,EAAkB,IAEnD,GAAgB,QAAU,GAI1B,kBAAC,GAAD,SACM,GADN,CAEE,OAAQ,EAAgB,QACxB,kBAAmB,GAAqB,EAAkB,MAKjD,U,0MC9Nf,GAAI,IAEG,aAAiC,iCACtC,GAAI,MAAO,QAAO,sBAAyB,WACzC,MAAO,SAAQ,OACb,0DAGJ,KAAM,GAAS,KAAM,QAAO,uBAC5B,MAAQ,IACN,IACA,GAAI,SAAQ,CAAC,EAAS,IAAW,CAI/B,GAAI,GACJ,GAAI,CACF,EAAe,CACb,+BAAgC,EAAO,MACrC,iCACA,KACA,CAAC,QAAS,SAAU,SAAU,SAAU,WAQ1C,qCAAsC,CACpC,KAAM,IAAI,OACR,qEAGJ,uBAAwB,EAAO,MAC7B,yBACA,SACA,CAAC,WAEH,oBAAqB,EAAO,MAAM,sBAAuB,SAAU,CACjE,WAEF,wBAAyB,EAAO,MAC9B,0BACA,SACA,CAAC,WAEH,uBAAuB,EAAI,CACzB,MAAO,GAAO,YAAY,EAAI,OAEhC,yBAAyB,EAAS,CAChC,EAAO,eAAe,IAExB,aAAc,CACZ,MAAO,GAAO,MAAM,eAGjB,EAHiB,CAIxB,EAAO,GACP,OAEF,EAAQ,O,8MCtFP,YAA+B,EAAiB,EAAY,iCACjE,KAAM,CACJ,iCACA,yBACA,sBACA,0BACA,yBACA,2BACA,eACE,KAAM,MACJ,CAAE,QAAS,KAAM,GAAsB,GAI7C,GAAI,GACA,EAAW,EACf,KAAM,GAAW,EAAwB,GAAiC,CACxE,KAAM,GAAgB,EAAuB,GACvC,EAAa,EAAoB,GAClC,GACH,GAAe,GAAI,YAAW,IAGhC,EAAa,IAAI,GAAI,YAAW,IAAe,EAAe,IAC9D,EACE,EAAwB,GAAgC,IAE5D,EACE,EACA,EAAK,OACL,EAAgB,SAAS,WACzB,EAAgB,SAAS,gBACzB,EAAgB,SAAS,eAAiB,EAAI,EAC9C,GAEF,EAAW,GACX,GAAI,CACF,KACE,IAAI,SAAS,GAAY,CACvB,IACA,YAAyB,CAGvB,GAAI,GACF,GAAW,GACP,GAAY,GAAG,CACjB,IACA,OAGJ,sBAAsB,cAK5B,EAAyB,GAE3B,GAAI,CAAC,EACH,KAAM,IAAI,OAAM,wDAElB,MAAO,K,8MCvDT,YAA8B,CAAE,UAAU,CACxC,KAAM,CAAC,EAAc,GAAmB,mBAAS,GAC3C,CAAC,EAAmB,GAAwB,mBACc,QAG1D,EAAO,iBAAO,IAAM,IAC1B,oBAAU,IACD,IAAM,EAAK,UACjB,CAAC,IACJ,KAAM,CAAE,kBAAiB,eAAgB,KACzC,MACE,qCACE,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAY,yBACnB,GAAI,CACF,GAAI,GAAY,GAChB,EAAK,QAAU,IAAM,CACnB,EAAqB,QACrB,EAAY,IAEd,EAAgB,GAChB,EAAqB,WACrB,KAAM,GAAe,KAAM,IAAgB,EAAS,GAAa,CAC1D,GACH,EAAgB,KAGpB,GAAI,EACF,OAEF,EAAqB,gBACrB,KAAM,GAAc,KAAM,GACxB,GAEF,GAAI,EACF,OAEF,KAAM,GAAe,EAAgB,EAAa,CAChD,aAAe,GACb,EAAgB,EAAc,EAAY,UAC5C,QAAS,IAAM,EAAqB,UAEtC,EAAK,QAAU,IAAM,CACnB,IACA,EAAqB,eAEhB,EAFgB,CAGvB,QAAQ,MAAM,GACd,EAAqB,YAGzB,SACE,GACA,IAAsB,WACtB,IAAsB,gBAEzB,4BAGD,kBAAC,KAAD,MACC,IAAsB,OAAS,KAAO,IAAsB,QAC3D,qBAEA,oCACE,kBAAC,IAAD,KACG,IAAsB,UACnB,+BACA,mCAEN,kBAAC,WAAD,CAAU,MAAO,IACjB,kBAAC,KAAD,MACA,kBAAC,SAAD,CAAQ,QAAS,IAAM,EAAK,WAAW,WAG3C,kBAAC,KAAD,OAKS,U,yMCjFf,KAAM,IAAwB,IAAO,IAAI,CACvC,YAAa,SAGT,GAAoB,IAAO,IAAI,CACnC,OAAQ,QACR,gBAAiB,UACjB,SAAU,UAOZ,YAAsB,EAAM,EAAU,CACpC,KAAM,GAAM,IAAI,gBAAgB,GAC1B,EAAI,SAAS,cAAc,KACjC,EAAE,KAAO,EACT,EAAE,SAAW,EACb,EAAE,MAAM,QAAU,OAClB,SAAS,KAAK,YAAY,GAC1B,EAAE,QACF,EAAE,SACF,IAAI,gBAAgB,GAWtB,YAAsB,CACpB,SACA,iBACA,oBACA,kBACC,CACD,KAAM,CAAC,EAAc,GAAmB,mBAAS,GAC3C,EAAe,GAAU,EAAO,SAAS,aAC/C,oBAAU,IAAM,CAId,EAAgB,GACZ,GACF,EAAqB,EAAc,IAAO,KAAM,GAC9C,EAAgB,EAAY,UAG/B,CAAC,IACJ,KAAM,GAAW,GAAU,EAAO,GAI5B,EAA4B,sBAC/B,GACC,GAAY,EAAe,EAAU,CAAE,qBACzC,CAAC,EAAU,IAEP,CAAE,kBAAiB,eAAgB,KACzC,GAAI,CAAC,EACH,MAAO,MAET,KAAM,GAAe,KAAK,IACxB,EACA,EAAe,EAAO,SAAS,WAAW,IAEtC,EAAa,KAAK,IAAI,EAAG,EAAe,EAAO,SAAS,WAAW,IACzE,MACE,mBAAC,GAAD,KACE,kBAAC,KAAD,KAAK,EAAO,SAAS,MACrB,kBAAC,SAAD,CAAQ,KAAK,SAAS,QAAS,IAAM,EAAkB,EAAO,KAAK,aAGnE,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAM,CAEX,OAAO,QACL,mCAAmC,EAAO,SAAS,UAGrD,EAAe,EAAO,MAG3B,UAGD,kBAAC,KAAD,KAAI,gBACY,GAAI,MAAK,EAAO,SAAS,cAAc,kBAEvD,kBAAC,KAAD,KAAI,YAAU,GAAI,MAAK,EAAO,SAAS,aAAa,kBACpD,kBAAC,QAAD,KACE,kBAAC,KAAD,KAAI,cACJ,kBAAC,QAAD,CACE,KAAK,SACL,MAAO,EAAO,SAAS,WAAW,GAClC,KAAM,EACN,IAAK,EACL,IAAK,EACL,SAAW,GAAM,CACf,GAAI,EAAc,CAChB,KAAM,GAAY,OAAO,EAAE,OAAO,OAClC,EAAe,EAAO,GAAI,CACxB,WAAY,CACV,KAAK,IAAI,EAAW,GACpB,EAAO,SAAS,WAAW,UAI/B,GAAe,EAAO,GAAI,CACxB,WAAY,CAAC,GAAG,EAAO,SAAS,kBAM1C,kBAAC,QAAD,KACE,kBAAC,KAAD,KAAI,YACJ,kBAAC,QAAD,CACE,KAAK,SACL,MAAO,EAAO,SAAS,WAAW,GAClC,KAAM,EACN,IAAK,EACL,IAAK,EACL,SAAW,GAAM,CACf,GAAI,EAAc,CAChB,KAAM,GAAU,OAAO,EAAE,OAAO,OAChC,EAAe,EAAO,GAAI,CACxB,WAAY,CACV,EAAO,SAAS,WAAW,GAC3B,KAAK,IAAI,EAAS,UAItB,GAAe,EAAO,GAAI,CACxB,WAAY,CAAC,GAAG,EAAO,SAAS,kBAM1C,kBAAC,GAAD,KACE,kBAAC,GAAD,CACE,gBAAiB,IAAM,KACvB,sBAAuB,EACvB,WAEF,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAY,wBACnB,KAAM,CAAE,QAAS,KAAM,GAAsB,GACvC,EAAc,KAAM,GAA+B,GACzD,EAAgB,KAElB,SAAU,GACX,QAGD,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAY,wBACnB,KAAM,CAAE,QAAS,KAAM,GAAsB,GACvC,EAAO,GAAI,MAAK,CAAC,GAAO,CAC5B,KAAM,gBAER,GAAa,EAAM,GAAG,EAAO,SAAS,eAEzC,YAGD,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAY,wBACnB,KAAM,CAAE,eAAc,gBAAiB,EAAO,SACxC,EAAO,KAAM,GAAgB,kBAAkB,GAC/C,EAAO,GAAI,MAAK,CAAC,GAAO,CAC5B,KAAM,EAAe,EAAa,KAAO,gBAE3C,GACE,EACA,GAAG,EAAO,SAAS,OACjB,EAAe,EAAa,IAAM,aAIzC,oBAIH,kBAAC,KAAD,KAAI,sBAAoB,EAAO,SAAS,iBACxC,kBAAC,QAAD,CACE,KAAK,QACL,MAAO,EAAO,SAAS,gBACvB,KAAM,EACN,IAAK,EACL,IAAK,GACL,SAAW,GAAM,CACf,KAAM,GAAkB,OAAO,EAAE,OAAO,OACxC,EAAe,EAAO,GAAI,CAAE,uBAGhC,kBAAC,QAAD,KACE,kBAAC,KAAD,KAAI,eACJ,kBAAC,QAAD,CACE,KAAK,SACL,MAAO,EAAO,SAAS,WACvB,KAAM,EACN,IAAK,EACL,IAAK,GACL,SAAW,GAAM,CACf,KAAM,GAAa,OAAO,EAAE,OAAO,OACnC,EAAe,EAAO,GAAI,CAAE,mBAIlC,kBAAC,GAAD,CAAsB,YAKb,U,iNCrOf,GAAI,IAEJ,YAAoC,CAClC,MAAQ,IACN,IACA,GAAI,cACF,UAAU,aAAa,0BAA0B,WAC7C,CAAE,WAAY,GACd,IAWH,aAAsC,gCAE3C,KAAM,GAAoB,MADJ,WAAU,aAAa,oBACX,OAC/B,GAAW,EAAO,OAAS,cAKxB,EAAiB,GACvB,SAAW,KAAU,GAAmB,CACtC,KAAM,GAAS,KAAM,WAAU,aAAa,aAAa,CAEvD,MAAO,CAAE,SAAU,EAAO,SAAU,aAAc,GAClD,MAAO,KAIH,EACH,MAAM,WAAU,aAAa,oBAAoB,KAChD,CAAC,CAAE,cAAe,EAAO,WAAa,GAExC,MAGI,EAAoB,EAAO,iBAAiB,OAClD,SAAW,KAAS,GAAO,YACzB,EAAM,OAER,EAAe,KAAK,CAClB,OAAQ,CAAE,SAAU,EAAO,SAAU,MAAO,GAC5C,sBAGJ,MAAO,KAoBT,GAAI,GAKJ,YAAiD,EAAsB,mCAAtB,CAAE,SAAQ,YAAY,CACrE,KAAM,GAAe,IACrB,EACE,GACA,EAAa,aAAa,UAAU,+BACtC,KAAM,GACN,KAAM,GACJ,GAAI,kBAAiB,EAAc,mBAAoB,CACrD,cAAe,CACb,WAAY,QAIlB,EAAa,KAAK,UAAa,GAAM,CACnC,GAAI,EAAE,KAAK,YAAc,OAAQ,CAI/B,KAAM,GAAgB,EAAE,KAAK,cAC7B,EAAO,GAGL,EAAE,KAAK,YAAc,QACvB,KAGJ,KAAM,GACJ,EAAa,WAAW,IAAI,eAE9B,SAAiB,eAAe,EAAG,EAAa,aACzC,CACL,eACA,MAAO,CACL,EAAiB,eAAe,EAAG,EAAa,iBAStD,YAA8C,CAC5C,eACA,SACA,YACC,CAED,KAAM,GAAe,IAAa,sBAChC,KACA,EACA,GAGF,GAAI,GAAU,GACd,SAAa,eAAkB,GAAM,CACnC,KAAM,GAAuC,MAAM,GAChD,OACA,IAAI,CAAC,EAAG,IAAM,EAAE,YAAY,eAAe,IAC9C,EAAO,GACH,GACF,KAGG,CACL,eACA,MAAO,CACL,EAAU,KAShB,YAAqC,EAAS,gCAC5C,MAAI,OAAO,mBAAqB,YACvB,GAAqC,GAEvC,KAAM,IAAkC,KAW1C,YAA4B,EAAqC,mCAArC,CAAE,WAAU,eAAc,WAAW,CACtE,KAAM,GAAS,KAAM,WAAU,aAAa,aAAa,CAIvD,MAAO,CACL,WACA,eACA,WAAY,EACZ,iBAAkB,GAGlB,gBAAiB,GACjB,iBAAkB,IAEpB,MAAO,KAEH,EAAe,IACf,EAAwB,EAAa,wBAAwB,GAC7D,CAAE,eAAc,QAAS,KAAM,IAAsB,CACzD,eACA,SACA,aAEF,EAAsB,QAAQ,GAC9B,EAAa,QAAQ,EAAa,aAClC,IAGA,KAAM,GAAa,GAAmB,EAAa,WACnD,GAAI,GAAkB,EAItB,KAAM,GAAiB,MAAM,GAAc,KAAK,IAKhD,WAAgB,EAAe,CAI7B,GAAI,GAAc,EAClB,OAAS,GAAU,EAAG,EAAU,EAAc,IAAW,CACvD,KAAM,GAAQ,EAAc,GACtB,EAAY,EAAM,OAClB,EAAc,EAAM,MACxB,EACA,KAAK,IAAI,EAAW,EAAa,IAEnC,GAAuB,GAClB,GACH,GAAc,EAAY,QAE5B,EAAe,GAAS,KAAK,GAE/B,GAAmB,EAEf,GAAmB,GACrB,KACA,KAOJ,GAAI,GAIA,EAIJ,KAAM,GAAiB,GAAI,SAAQ,CAAC,EAAS,IAAW,CACtD,EAAS,EACT,EAAU,IAEZ,GAAI,GAAW,GAEf,YAAoB,CAClB,GAAI,EACF,OAIF,GAAI,CACF,KAAM,GAAU,EAAe,IAAK,GAAW,CAC7C,KAAM,GAAS,GAAI,cACjB,EAAO,OAAO,CAAC,EAAK,KAAU,EAAM,GAAM,OAAQ,IAEpD,GAAI,IAAS,EACb,SAAW,KAAS,GAClB,EAAO,IAAI,EAAO,IAClB,IAAU,EAAM,OAElB,MAAO,KAEH,EAAM,GAAI,MAChB,EAAI,YAAY,EAAQ,OAAQ,EAAa,WAAY,MAAO,GAChE,KAAM,GAAY,EAAI,WACtB,EAAO,SACA,EADA,CAEP,EAAQ,GAIV,KAAM,GAAS,EAAO,YACtB,SAAW,KAAS,GAClB,EAAM,OAER,EAAa,WAAW,EAAa,aACrC,EAAsB,WAAW,GACjC,EAAW,GAGb,MAAO,CACL,OACA,oB,6dClSJ,KAAM,IAAkB,IAAO,IAAI,CACjC,QAAS,SAMX,GAAI,IAAuB,KAa3B,YAA2B,CAAE,gBAAe,iBAAgB,iBAAiB,CAC3E,KAAM,CAAC,EAAgB,GAAqB,mBAAS,IAC/C,CAAC,EAAa,GAAkB,mBAElC,EAAiB,KAAO,WAGtB,CAAC,EAAyB,GAA8B,mBAAS,IACvE,oBAAU,IAAM,CACd,GAAuB,EACvB,EAAe,OACd,CAAC,IACJ,KAAM,GAAwB,sBAAY,IAAM,CAC9C,KACG,KAAM,GAAY,CACb,EAAQ,QACV,GACE,GAAI,KAAI,EAAQ,IAAK,GAAM,CAAC,EAAE,OAAO,SAAU,MAEjD,EAA4B,GAAO,GAAM,EAAQ,GAAG,OAAO,aAG9D,MAAO,GAAQ,CACd,GAAI,YAAe,cAAc,CAC/B,GAAI,EAAI,OAAS,kBAAmB,CAClC,EAAe,UACf,OAEF,GAAI,EAAI,OAAS,gBAAiB,CAChC,EAAe,eACf,QAGJ,KAAM,MAET,IACH,oBAAU,EAAuB,CAAC,IAClC,KAAM,CAAC,EAAsB,GAA2B,mBAAS,GACjE,oBAAU,IAAM,CACd,KAAM,GACJ,GAAkB,EAAe,IAAI,GACnC,GACF,EAAwB,EAAmB,oBAE5C,CAAC,EAAgB,IACpB,KAAM,CAAC,EAAgB,GAAqB,mBAClB,MAE1B,oBAAU,IAAM,CACV,GACF,EAAc,IAEf,CAAC,EAAgB,IAEpB,KAAM,CAAC,EAAM,GAAW,mBAAS,CAAE,GAAI,IAAM,KACvC,EAAuB,sBAAY,IAAY,yBACnD,KAAM,CAAE,iBAAgB,QAAS,KAAM,IAAa,CAClD,SAAU,EACV,aAAc,EACd,QAAS,IAEX,EAAQ,CAAE,GAAI,IAId,GAAI,GACJ,GAAI,CACF,EAAY,KAAM,SACX,EADW,CAElB,EAAkB,GAClB,OAEF,EAAe,KACd,CACD,EACA,EACA,EACA,IAEF,MAAO,CACL,iBACA,cACA,0BACA,uBACA,iBACA,wBACA,6BACA,0BACA,eAAgB,EAChB,cAAe,EAAK,IAWxB,YAAsB,EAAgC,CAAhC,QAAE,iBAAF,EAAmB,KAAnB,EAAmB,CAAjB,iBACtB,KAAM,CACJ,iBACA,cACA,0BACA,uBACA,iBACA,wBACA,6BACA,0BACA,iBACA,iBACE,GAAkB,GAEtB,MACE,mBAAC,GAAD,KACG,IAAgB,SACf,kBAAC,IAAD,KAAG,wGAE+B,IAChC,kBAAC,SAAD,CAAQ,KAAK,SAAS,QAAS,GAAuB,cAItD,IAAgB,cAClB,kBAAC,IAAD,KAAG,gFAES,IACV,kBAAC,SAAD,CAAQ,KAAK,SAAS,QAAS,GAAuB,cAKxD,kBAAC,MAAD,KACE,kBAAC,QAAD,KAAO,iBAEL,kBAAC,SAAD,CACE,MAAO,EACP,SAAW,GAAM,EAA2B,EAAE,OAAO,QAEpD,GAAkB,IAAgB,KACjC,CAAC,GAAG,GAAgB,IAAI,CAAC,CAAC,EAAI,CAAE,aAC9B,kBAAC,SAAD,CAAQ,IAAK,EAAI,MAAO,GACrB,EAAO,OAAS,IAIrB,kBAAC,SAAD,CAAQ,MAAM,GAAG,SAAQ,IAAC,wBAMhC,kBAAC,QAAD,KAAO,gBAEL,kBAAC,SAAD,CACE,MAAO,EACP,SAAW,GAAM,EAAwB,OAAO,EAAE,OAAO,SAExD,CAAC,EAAG,GAAG,IAAK,GACX,kBAAC,SAAD,CACE,IAAK,EACL,MAAO,EACP,SACE,CAAC,GACD,CAAC,EAAe,IAAI,IAElB,EAAe,IAAI,GACnB,kBAAoB,GAGvB,OAOb,kBAAC,SAAD,CACE,KAAK,SACL,QAAS,IAAiB,YAAc,EAAgB,EACxD,SAAU,IAAiB,aAE1B,CAAC,YAAa,aAAa,SAAS,GAAgB,OAAS,UAEhE,kBAAC,QAAD,CACE,KAAK,OACL,OAAO,yBACP,SAAW,GAAM,CACf,GAAI,EAAE,OAAO,OAAS,EAAE,OAAO,MAAM,OAAQ,CAC3C,KAAM,GAAO,EAAE,OAAO,MAAM,GAC5B,EAAK,cAAc,KAAY,GAAgB,yBAC7C,KAAM,GAAkB,GAAI,YAAW,GAIvC,GAAI,GACJ,GAAI,CACF,EAAc,KAAM,GAClB,SAEK,EAFL,CAGF,MAAM,qCACN,OAEF,GAAI,EAAY,OAAS,GAAK,EAAY,WAAY,CACpD,MACE,4DAEF,OAEF,EAAU,eAAe,EAAiB,UAKhD,IAAiB,SAAW,GAAmB,MAKxC,U,0MC3Of,KAAM,IAAQ,IAAO,GAAG,CACtB,QAAS,OACT,WAAY,SACZ,QAAS,OACT,cAAe,MACf,aAAc,QAGV,GAAY,IAAO,KAAK,CAC5B,MAAO,QAGH,GAAS,IAAO,KAAK,CACzB,cAAe,YACf,eAAgB,cAGZ,GAAe,IAAO,IAAI,CAC9B,OAAQ,QACR,YAAa,SAGT,GAAa,IAAO,IAAI,CAC5B,QAAS,OACT,QAAS,OACT,OAAQ,SAGJ,GAAsB,IAAO,IAAI,CACrC,MAAO,QACP,WAAY,EACZ,aAAc,SACd,OAAQ,SAGJ,GAAyB,IAAO,IAAI,CACxC,SAAU,IAGZ,aAAe,CACb,KAAM,CAAC,EAAuB,GAA4B,mBAAS,IAC7D,CAAC,EAAS,GAAc,mBACiB,GAAI,MAE7C,CAAC,EAAiB,GAAsB,mBACd,MAE1B,CAAC,EAAgB,GAAqB,mBAAS,IAC/C,CAAC,EAAc,GAAmB,mBACgB,QAElD,EAAqB,EAAwB,GAAiB,EACpE,oBAAU,IAAM,CAEd,EAAgB,oBACb,KAAM,GAAkB,CACvB,EACG,GACC,GAAI,KAAI,CACN,GAAG,EACH,GAAG,EAAc,IACd,GAC2C,CAAC,EAAO,GAAI,SAMjE,QAAQ,IAAM,CACb,EAAkB,OAErB,IACH,oBAAU,IAAM,CAEZ,EAAmB,MACnB,CAAE,IAAmB,EAAmB,IAAI,KAE5C,EAAmB,CAAC,GAAG,EAAmB,UAAU,GAAG,KAExD,CAAC,EAAoB,IAExB,KAAM,GAAoB,sBAAY,IAAM,EAAgB,aAAc,IAKpE,EAAqB,sBAAY,CAAO,EAAiB,IAAa,yBAC1E,EAAgB,aAChB,KAAM,GAAe,KAAM,IAAqB,GAIhD,GAAI,GAAO,GACP,EAAoB,GACxB,GAAI,EAAU,CACZ,KAAM,GAAe,EAAS,KAAK,YAAY,KAC3C,EAAe,EACjB,GAAO,EAAS,KAAK,MAAM,EAAG,GAC9B,EAAoB,EAAS,KAAK,MAAM,IAExC,EAAO,EAAS,SAGlB,GAAO,UAET,KAAM,GAAS,GAAI,GAAgB,QAAQ,CACzC,OACA,eACA,aAAc,GAAY,CACxB,KAAM,EAAS,KACf,IAAK,KAGT,KAAM,GAAO,UACb,EAAY,GAAY,GAAI,KAAI,CAAC,CAAC,EAAO,GAAI,GAAS,GAAG,KACzD,EAAyB,IACzB,EAAmB,EAAO,IAC1B,EAAgB,UACf,IAKG,EAAoB,sBAAa,GAAQ,CAC7C,QAAQ,MAAM,GACd,EAAgB,UACf,IAEG,EAAqB,sBAAY,CAAC,EAAI,IAAW,CACrD,EAAY,GAAY,CACtB,KAAM,GAAS,EAAQ,IAAI,GAC3B,GAAI,GAAU,YAAkB,GAAgB,QAAS,CACvD,KAAM,GAAU,EAAO,OAAO,GAC9B,GAAI,IAAY,EACd,MAAO,IAAI,KAAI,GAAS,IAAI,EAAO,GAAI,GAG3C,MAAO,MAER,IAEH,MACE,mBAAC,MAAD,KACE,kBAAC,GAAD,KACE,kBAAC,GAAD,KAAW,eAET,kBAAC,GAAD,KAAQ,MAEV,kBAAC,GAAD,CAAc,IAAI,mBAAmB,IAAI,MAE3C,kBAAC,GAAD,KACE,kBAAC,SAAD,CACE,MAAO,KAAK,UAAU,GACtB,SAAW,GAAM,EAAyB,KAAK,MAAM,EAAE,OAAO,SAE9D,kBAAC,SAAD,CAAQ,MAAM,SAAQ,gBACtB,kBAAC,SAAD,CAAQ,MAAM,QAAO,oBAEvB,kBAAC,GAAD,KACG,EAAiB,aAAe,KACjC,kBAAC,GAAD,CACE,QAAS,EACT,iBAAkB,IAAiB,OAAS,EAAkB,KAC9D,SAAU,CAAC,YAAa,aAAa,SAAS,GAC9C,YAAa,IAAM,EAAgB,SACnC,eAAiB,GAAO,CACtB,EAAmB,GACnB,EAAgB,YAItB,kBAAC,GAAD,KACG,IAAiB,QAChB,kBAAC,GAAD,CACE,OACG,GAAmB,EAAmB,IAAI,IAC3C,KAEF,eAAgB,EAChB,kBAAoB,GAAO,CACzB,KAAM,GAAS,EAAmB,IAAI,GACtC,GAAI,EAAQ,CACV,KAAM,GAAY,EAAO,YACzB,EACG,GACC,GAAI,KAAI,CAAC,CAAC,EAAU,GAAI,GAAY,GAAG,KAE3C,EAAyB,IAEzB,EAAmB,EAAU,MAGjC,eAAiB,GAAO,CACtB,KAAM,GAAS,EAAmB,IAAI,GAClC,GAAU,YAAkB,GAAgB,SAC9C,GAAO,SACP,EAAY,GAAY,CACtB,KAAM,GAAa,GAAI,KAAI,GAC3B,SAAW,OAAO,EAAO,IAClB,QAMhB,IAAiB,QAChB,kBAAC,GAAD,CACE,eACA,cAAe,EACf,eAAgB,EAChB,cAAe,OASd,UCxNA,GAZU,GAAgB,CACnC,GAAe,YAAuB,WACxC,6BAAqB,KAAK,CAAC,CAAE,SAAQ,SAAQ,SAAQ,SAAQ,aAAc,CACzE,EAAO,GACP,EAAO,GACP,EAAO,GACP,EAAO,GACP,EAAQ,MCHd,KAAS,OACP,kBAAC,IAAM,WAAP,KACE,kBAAC,GAAD,KACE,kBAAC,GAAD,QAGJ,SAAS,eAAe,SAM1B,O","file":"static/js/main.3a6fdf08.chunk.js","sourcesContent":["import React from 'react';\nimport { styled } from 'tonami';\n\nconst SampleListContainer = styled.div({\n  height: '100%',\n  overflow: 'auto',\n});\n\nconst SampleListItem = styled.div({\n  padding: '0.5rem',\n  border: '1px solid grey',\n  cursor: 'pointer',\n  backgroundColor: ({ $selected }) => ($selected ? '#f3f3f3' : 'unset'),\n});\n\n/**\n * @param {{\n *   samples: Map<string, import('./store').SampleContainer>;\n *   selectedSampleId: string | null;\n *   readonly: boolean;\n *   onNewSample: () => void;\n *   onSampleSelect: (id: string) => void;\n * }} props\n */\nfunction SampleList({\n  samples,\n  selectedSampleId,\n  readonly,\n  onNewSample,\n  onSampleSelect,\n}) {\n  return (\n    <SampleListContainer>\n      <SampleListItem\n        data-disabled={readonly}\n        onClick={() => !readonly && onNewSample()}\n      >\n        New Sample\n      </SampleListItem>\n      {[...samples].map(([id, sample]) => (\n        <SampleListItem\n          key={id}\n          $selected={id === selectedSampleId}\n          data-disabled={readonly}\n          onClick={() => !readonly && onSampleSelect(id)}\n        >\n          <div>{sample.metadata.name}</div>\n          <div>\n            Updated {new Date(sample.metadata.dateModified).toLocaleString()}\n          </div>\n        </SampleListItem>\n      ))}\n    </SampleListContainer>\n  );\n}\n\nexport default SampleList;\n","/* eslint-disable import/no-anonymous-default-export */\nexport default [\n  {\n    \"name\": \"Kick 1\",\n    \"sourceFileId\": \"factory-samples/00 Kick 1.wav\",\n    \"id\": \"532d9ea7-68d2-4ae8-a04a-d77ca846eaf4\",\n    \"slotNumber\": 0,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 2\",\n    \"sourceFileId\": \"factory-samples/01 Kick 2.wav\",\n    \"id\": \"2c02cc42-fbc2-465b-a4a3-255a7a30b15e\",\n    \"slotNumber\": 1,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 3\",\n    \"sourceFileId\": \"factory-samples/02 Kick 3.wav\",\n    \"id\": \"72d9c6d6-6e99-4b6b-b01a-63e1439f371a\",\n    \"slotNumber\": 2,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 4\",\n    \"sourceFileId\": \"factory-samples/03 Kick 4.wav\",\n    \"id\": \"3c96acbe-076b-48a3-afe9-51e828e37974\",\n    \"slotNumber\": 3,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 5\",\n    \"sourceFileId\": \"factory-samples/04 Kick 5.wav\",\n    \"id\": \"3a733799-b8fb-4c3b-a42e-dc7fa6c1d455\",\n    \"slotNumber\": 4,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 6\",\n    \"sourceFileId\": \"factory-samples/05 Kick 6.wav\",\n    \"id\": \"60437205-d894-45a1-b96c-ecf731b79998\",\n    \"slotNumber\": 5,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 7\",\n    \"sourceFileId\": \"factory-samples/06 Kick 7.wav\",\n    \"id\": \"0b98be31-7481-4c04-8b70-54ef9d0b29ed\",\n    \"slotNumber\": 6,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 8\",\n    \"sourceFileId\": \"factory-samples/07 Kick 8.wav\",\n    \"id\": \"136f1f35-680c-4368-9dda-02151767ba3c\",\n    \"slotNumber\": 7,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 9\",\n    \"sourceFileId\": \"factory-samples/08 Kick 9.wav\",\n    \"id\": \"4ceeb5c4-aa88-43a5-976a-05b48ab6d113\",\n    \"slotNumber\": 8,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Kick 10\",\n    \"sourceFileId\": \"factory-samples/09 Kick 10.wav\",\n    \"id\": \"44970d9e-f138-408a-b2b0-ac9e89b79e4b\",\n    \"slotNumber\": 9,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 1\",\n    \"sourceFileId\": \"factory-samples/10 Snare 1.wav\",\n    \"id\": \"7f5e74b9-1449-48ea-b386-f5cc874a8a93\",\n    \"slotNumber\": 10,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 2\",\n    \"sourceFileId\": \"factory-samples/11 Snare 2.wav\",\n    \"id\": \"b5bb806d-2f90-4808-bdc0-b5d11c55cb61\",\n    \"slotNumber\": 11,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 3\",\n    \"sourceFileId\": \"factory-samples/12 Snare 3.wav\",\n    \"id\": \"fa53587b-9271-437b-b117-8522bee81b27\",\n    \"slotNumber\": 12,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 4\",\n    \"sourceFileId\": \"factory-samples/13 Snare 4.wav\",\n    \"id\": \"f672dc32-573a-4a07-a531-532b2b07e9b8\",\n    \"slotNumber\": 13,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 5\",\n    \"sourceFileId\": \"factory-samples/14 Snare 5.wav\",\n    \"id\": \"98d5a8a1-f460-4603-891f-556416a1f1d8\",\n    \"slotNumber\": 14,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 6\",\n    \"sourceFileId\": \"factory-samples/15 Snare 6.wav\",\n    \"id\": \"b139e9f5-1f45-4910-b831-c772849c709b\",\n    \"slotNumber\": 15,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 7\",\n    \"sourceFileId\": \"factory-samples/16 Snare 7.wav\",\n    \"id\": \"e9dee8da-7bf4-49f2-8812-a859ea4660fa\",\n    \"slotNumber\": 16,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 8\",\n    \"sourceFileId\": \"factory-samples/17 Snare 8.wav\",\n    \"id\": \"5c64f7c9-203e-41a7-8c17-5efddf3f0e2c\",\n    \"slotNumber\": 17,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 9\",\n    \"sourceFileId\": \"factory-samples/18 Snare 9.wav\",\n    \"id\": \"8b46a4ba-0a91-4463-af39-0d47dc635a74\",\n    \"slotNumber\": 18,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 10\",\n    \"sourceFileId\": \"factory-samples/19 Snare 10.wav\",\n    \"id\": \"018704c5-2a0f-4367-8db1-3302270bc152\",\n    \"slotNumber\": 19,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 11\",\n    \"sourceFileId\": \"factory-samples/20 Snare 11.wav\",\n    \"id\": \"ac18e017-5df3-421c-9802-033d000c4f01\",\n    \"slotNumber\": 20,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Snare 12\",\n    \"sourceFileId\": \"factory-samples/21 Snare 12.wav\",\n    \"id\": \"5a0ab3f0-5f82-4c96-9dd8-1f4a8715bc96\",\n    \"slotNumber\": 21,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 1\",\n    \"sourceFileId\": \"factory-samples/22 Clap 1.wav\",\n    \"id\": \"6d196928-5f5f-48d3-924c-aaa698a3c520\",\n    \"slotNumber\": 22,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 2\",\n    \"sourceFileId\": \"factory-samples/23 Clap 2.wav\",\n    \"id\": \"e3952972-e23d-4003-8a7d-66a5f96ed3f4\",\n    \"slotNumber\": 23,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 3\",\n    \"sourceFileId\": \"factory-samples/24 Clap 3.wav\",\n    \"id\": \"53280ff9-034b-4764-b5d5-b18a87f428fa\",\n    \"slotNumber\": 24,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 4\",\n    \"sourceFileId\": \"factory-samples/25 Clap 4.wav\",\n    \"id\": \"32e2f536-2206-495f-92ae-96aacfeb5faa\",\n    \"slotNumber\": 25,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 5\",\n    \"sourceFileId\": \"factory-samples/26 Clap 5.wav\",\n    \"id\": \"40d8b34f-7bfe-4720-a008-c3ad15c68442\",\n    \"slotNumber\": 26,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 6\",\n    \"sourceFileId\": \"factory-samples/27 Clap 6.wav\",\n    \"id\": \"143901a6-741f-4ac2-8cdf-b8df56ee7dc3\",\n    \"slotNumber\": 27,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 7\",\n    \"sourceFileId\": \"factory-samples/28 Clap 7.wav\",\n    \"id\": \"cf9be332-a4a9-48d7-a7b5-9656a6563706\",\n    \"slotNumber\": 28,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Clap 8\",\n    \"sourceFileId\": \"factory-samples/29 Clap 8.wav\",\n    \"id\": \"e940db81-d23d-4afc-82b5-4e31bf2afe8d\",\n    \"slotNumber\": 29,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 1\",\n    \"sourceFileId\": \"factory-samples/30 Hihat 1.wav\",\n    \"id\": \"0aeebe13-6226-4d52-a185-e3d3bb66319e\",\n    \"slotNumber\": 30,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 2\",\n    \"sourceFileId\": \"factory-samples/31 Hihat 2.wav\",\n    \"id\": \"a95c7744-4957-464c-86bf-eb6719feb5f4\",\n    \"slotNumber\": 31,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 3\",\n    \"sourceFileId\": \"factory-samples/32 Hihat 3.wav\",\n    \"id\": \"ac047fbe-5029-4099-beec-74c5f3a6edc9\",\n    \"slotNumber\": 32,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 4\",\n    \"sourceFileId\": \"factory-samples/33 Hihat 4.wav\",\n    \"id\": \"298ec467-02e6-465e-8408-c4e8055bbf1b\",\n    \"slotNumber\": 33,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 5\",\n    \"sourceFileId\": \"factory-samples/34 Hihat 5.wav\",\n    \"id\": \"6565b986-4cd7-44c0-98a2-bcc86bc97d32\",\n    \"slotNumber\": 34,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 6\",\n    \"sourceFileId\": \"factory-samples/35 Hihat 6.wav\",\n    \"id\": \"82215816-6ca6-4d4a-b6ed-e164e68cffdc\",\n    \"slotNumber\": 35,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 7\",\n    \"sourceFileId\": \"factory-samples/36 Hihat 7.wav\",\n    \"id\": \"63bd1a36-9f42-4409-a4dd-27c83c6ce46c\",\n    \"slotNumber\": 36,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 8\",\n    \"sourceFileId\": \"factory-samples/37 Hihat 8.wav\",\n    \"id\": \"bf47420d-498f-46cc-875c-9fc9614d53d9\",\n    \"slotNumber\": 37,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 9\",\n    \"sourceFileId\": \"factory-samples/38 Hihat 9.wav\",\n    \"id\": \"f628e650-12d0-4b4c-bb91-7bb64fa2e39e\",\n    \"slotNumber\": 38,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Hihat 10\",\n    \"sourceFileId\": \"factory-samples/39 Hihat 10.wav\",\n    \"id\": \"8a21640b-f16b-4b87-930f-7d9f88435041\",\n    \"slotNumber\": 39,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Crash\",\n    \"sourceFileId\": \"factory-samples/40 Crash.wav\",\n    \"id\": \"42c8bdb0-7562-466c-b0a0-5abd4108faa0\",\n    \"slotNumber\": 40,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Ride\",\n    \"sourceFileId\": \"factory-samples/41 Ride.wav\",\n    \"id\": \"177fab98-417f-4872-92e1-1ed8e493abb1\",\n    \"slotNumber\": 41,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Swoosh\",\n    \"sourceFileId\": \"factory-samples/42 Swoosh.wav\",\n    \"id\": \"edf63812-b9b4-4a30-b5c4-b5932b189a3c\",\n    \"slotNumber\": 42,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthRim\",\n    \"sourceFileId\": \"factory-samples/43 SynthRim.wav\",\n    \"id\": \"665f7021-1e46-40e8-b411-4fde9fb2b404\",\n    \"slotNumber\": 43,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthTom 1\",\n    \"sourceFileId\": \"factory-samples/44 SynthTom 1.wav\",\n    \"id\": \"3dbc03e6-e4b2-464f-9b1c-c52e3fa20a2b\",\n    \"slotNumber\": 44,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthTom 2\",\n    \"sourceFileId\": \"factory-samples/45 SynthTom 2.wav\",\n    \"id\": \"c0b465b4-90ff-48dc-b3a4-8433371863b9\",\n    \"slotNumber\": 45,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthTom 3\",\n    \"sourceFileId\": \"factory-samples/46 SynthTom 3.wav\",\n    \"id\": \"ccd3d40e-9314-4716-957f-1a4310bc5e7a\",\n    \"slotNumber\": 46,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthTom 4\",\n    \"sourceFileId\": \"factory-samples/47 SynthTom 4.wav\",\n    \"id\": \"40cf4c67-ef4f-45c9-aba0-086c635588e3\",\n    \"slotNumber\": 47,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Tom 1\",\n    \"sourceFileId\": \"factory-samples/48 Tom 1.wav\",\n    \"id\": \"258498bf-2214-448a-ad59-2a6604303062\",\n    \"slotNumber\": 48,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Tom 2\",\n    \"sourceFileId\": \"factory-samples/49 Tom 2.wav\",\n    \"id\": \"76745927-e8ae-4cc9-aacd-df520c67e53b\",\n    \"slotNumber\": 49,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthCow\",\n    \"sourceFileId\": \"factory-samples/50 SynthCow.wav\",\n    \"id\": \"4f3f4db5-6ac4-44be-977a-b85fe28a22fa\",\n    \"slotNumber\": 50,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Bongo\",\n    \"sourceFileId\": \"factory-samples/51 Bongo.wav\",\n    \"id\": \"9f75c65d-c3f0-4c77-a6f4-3bec01b6690e\",\n    \"slotNumber\": 51,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"DoncaClaves\",\n    \"sourceFileId\": \"factory-samples/52 DoncaClaves.wav\",\n    \"id\": \"a5bc878c-65de-40d3-978d-c7bc7dbe4247\",\n    \"slotNumber\": 52,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthShaker\",\n    \"sourceFileId\": \"factory-samples/53 SynthShaker.wav\",\n    \"id\": \"46d63232-454b-4a77-8851-43a459d77110\",\n    \"slotNumber\": 53,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Tambourine\",\n    \"sourceFileId\": \"factory-samples/54 Tambourine.wav\",\n    \"id\": \"33d8c8be-887c-4718-8813-8c2ba4341335\",\n    \"slotNumber\": 54,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Cowbell\",\n    \"sourceFileId\": \"factory-samples/55 Cowbell.wav\",\n    \"id\": \"b21a2d76-a568-4f85-8fad-3b3314e95e85\",\n    \"slotNumber\": 55,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"DoncaSConga\",\n    \"sourceFileId\": \"factory-samples/56 DoncaSConga.wav\",\n    \"id\": \"2aeed069-974f-4e8e-aad1-7c97a460b3c8\",\n    \"slotNumber\": 56,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"DoncaLBongo\",\n    \"sourceFileId\": \"factory-samples/57 DoncaLBongo.wav\",\n    \"id\": \"4d7929a0-d1c7-4bd0-a4f2-d218cd29cc8e\",\n    \"slotNumber\": 57,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthPerc\",\n    \"sourceFileId\": \"factory-samples/58 SynthPerc.wav\",\n    \"id\": \"28d100b4-a1cb-4d95-bae5-692c24cc07ef\",\n    \"slotNumber\": 58,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"WhiteNoise\",\n    \"sourceFileId\": \"factory-samples/59 WhiteNoise.wav\",\n    \"id\": \"6bb0571b-c9de-4aa8-8c15-5924c278da1e\",\n    \"slotNumber\": 59,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 1\",\n    \"sourceFileId\": \"factory-samples/60 SynthHit 1.wav\",\n    \"id\": \"668a76fe-d748-4f99-bfa1-115ae378d364\",\n    \"slotNumber\": 60,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 2\",\n    \"sourceFileId\": \"factory-samples/61 SynthHit 2.wav\",\n    \"id\": \"ec130f7d-2562-4cfe-abaa-38e68c345f93\",\n    \"slotNumber\": 61,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 3\",\n    \"sourceFileId\": \"factory-samples/62 SynthHit 3.wav\",\n    \"id\": \"e4548eca-20a9-413f-8a5c-ff999e38e40b\",\n    \"slotNumber\": 62,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 4\",\n    \"sourceFileId\": \"factory-samples/63 SynthHit 4.wav\",\n    \"id\": \"f73b63a1-43b6-4a69-be8b-d23285b1f395\",\n    \"slotNumber\": 63,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 5\",\n    \"sourceFileId\": \"factory-samples/64 SynthHit 5.wav\",\n    \"id\": \"553cebd0-6f8d-4c09-bf7a-b2e54f41e6eb\",\n    \"slotNumber\": 64,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 6\",\n    \"sourceFileId\": \"factory-samples/65 SynthHit 6.wav\",\n    \"id\": \"2c042a7f-04e4-47e7-976d-5c83af823c38\",\n    \"slotNumber\": 65,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 7\",\n    \"sourceFileId\": \"factory-samples/66 SynthHit 7.wav\",\n    \"id\": \"86103fb1-7e67-4f6b-a2c8-134c0162fdd6\",\n    \"slotNumber\": 66,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 8\",\n    \"sourceFileId\": \"factory-samples/67 SynthHit 8.wav\",\n    \"id\": \"8dd3a15c-21ba-4f66-bb18-4f0eacc322c0\",\n    \"slotNumber\": 67,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 9\",\n    \"sourceFileId\": \"factory-samples/68 SynthHit 9.wav\",\n    \"id\": \"db43ca10-35fc-407f-8b4f-a50b46b437e6\",\n    \"slotNumber\": 68,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynthHit 10\",\n    \"sourceFileId\": \"factory-samples/69 SynthHit 10.wav\",\n    \"id\": \"3e47a74d-c0ed-407d-9181-f04d7d5ae737\",\n    \"slotNumber\": 69,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"PianoChord 1\",\n    \"sourceFileId\": \"factory-samples/70 PianoChord 1.wav\",\n    \"id\": \"d0cb5f10-e808-44ba-891b-68927d5963c2\",\n    \"slotNumber\": 70,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"PianoChord 2\",\n    \"sourceFileId\": \"factory-samples/71 PianoChord 2.wav\",\n    \"id\": \"c36a1fb2-2a3a-4eda-9421-b9906b94d073\",\n    \"slotNumber\": 71,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"PianoChord 3\",\n    \"sourceFileId\": \"factory-samples/72 PianoChord 3.wav\",\n    \"id\": \"3400b6a4-e649-41d6-b76e-de70413984f9\",\n    \"slotNumber\": 72,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"EPChord 1\",\n    \"sourceFileId\": \"factory-samples/73 EPChord 1.wav\",\n    \"id\": \"c0d219a6-556e-44af-a41a-2fe4eb8364ae\",\n    \"slotNumber\": 73,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"EPChord 2\",\n    \"sourceFileId\": \"factory-samples/74 EPChord 2.wav\",\n    \"id\": \"95c7b48f-1953-4728-959b-c2d745716135\",\n    \"slotNumber\": 74,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"EPChord 3\",\n    \"sourceFileId\": \"factory-samples/75 EPChord 3.wav\",\n    \"id\": \"424dc317-ce6f-4183-879c-34b045fdcaa5\",\n    \"slotNumber\": 75,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"EPChord 4\",\n    \"sourceFileId\": \"factory-samples/76 EPChord 4.wav\",\n    \"id\": \"73838f71-751d-4dee-9315-f99029ebef6b\",\n    \"slotNumber\": 76,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"OrganChord\",\n    \"sourceFileId\": \"factory-samples/77 OrganChord.wav\",\n    \"id\": \"f0cd369f-bc38-497f-a730-e11fb889c725\",\n    \"slotNumber\": 77,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"BandHit 1\",\n    \"sourceFileId\": \"factory-samples/78 BandHit 1.wav\",\n    \"id\": \"c570c9cb-2409-4db6-8c13-eee2bb0299c7\",\n    \"slotNumber\": 78,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"BandHit 2\",\n    \"sourceFileId\": \"factory-samples/79 BandHit 2.wav\",\n    \"id\": \"f28238ce-7641-4367-8873-76823f24a314\",\n    \"slotNumber\": 79,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"BandHit 3\",\n    \"sourceFileId\": \"factory-samples/80 BandHit 3.wav\",\n    \"id\": \"ae1a1a41-d573-40a8-94d4-ec608efd39ed\",\n    \"slotNumber\": 80,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"StringsHit 1\",\n    \"sourceFileId\": \"factory-samples/81 StringsHit 1.wav\",\n    \"id\": \"e13d0000-b4c8-47fd-b625-9a1fa774b098\",\n    \"slotNumber\": 81,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Choir\",\n    \"sourceFileId\": \"factory-samples/82 Choir.wav\",\n    \"id\": \"0d4895f4-3f66-4192-9078-ece068ac7bc9\",\n    \"slotNumber\": 82,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"GuitarHit 1\",\n    \"sourceFileId\": \"factory-samples/83 GuitarHit 1.wav\",\n    \"id\": \"ee42a6b1-0ccf-4868-a3a3-681a35557fac\",\n    \"slotNumber\": 83,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"GuitarHit 2\",\n    \"sourceFileId\": \"factory-samples/84 GuitarHit 2.wav\",\n    \"id\": \"32ae637c-bd6b-4c34-8eb2-a06170d4d652\",\n    \"slotNumber\": 84,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"KalimbaChord\",\n    \"sourceFileId\": \"factory-samples/85 KalimbaChord.wav\",\n    \"id\": \"afdf5485-a62b-4b77-a889-fe7744389528\",\n    \"slotNumber\": 85,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"SynChord\",\n    \"sourceFileId\": \"factory-samples/86 SynChord.wav\",\n    \"id\": \"7edc0655-63b6-4563-87ee-3b8f773450aa\",\n    \"slotNumber\": 86,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"BellChord\",\n    \"sourceFileId\": \"factory-samples/87 BellChord.wav\",\n    \"id\": \"88f345dd-e77f-471a-b5db-af5548dd285f\",\n    \"slotNumber\": 87,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"WindChime\",\n    \"sourceFileId\": \"factory-samples/88 WindChime.wav\",\n    \"id\": \"7d8f1df3-4479-40f6-821c-f7ec78899c06\",\n    \"slotNumber\": 88,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Airhorn\",\n    \"sourceFileId\": \"factory-samples/89 Airhorn.wav\",\n    \"id\": \"655142f7-cc68-40a2-a0ab-f772a4f38f1f\",\n    \"slotNumber\": 89,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 1\",\n    \"sourceFileId\": \"factory-samples/90 VocalHit 1.wav\",\n    \"id\": \"8a693d6c-da20-4c07-beed-eca84dad9d4a\",\n    \"slotNumber\": 90,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 2\",\n    \"sourceFileId\": \"factory-samples/91 VocalHit 2.wav\",\n    \"id\": \"50b7b83c-86d3-4e99-87eb-e9e3bd68bc43\",\n    \"slotNumber\": 91,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 3\",\n    \"sourceFileId\": \"factory-samples/92 VocalHit 3.wav\",\n    \"id\": \"2428d49a-7ff7-451e-aafb-9893083ce60e\",\n    \"slotNumber\": 92,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 4\",\n    \"sourceFileId\": \"factory-samples/93 VocalHit 4.wav\",\n    \"id\": \"cc8814ca-44aa-405f-9789-611599b1da45\",\n    \"slotNumber\": 93,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 5\",\n    \"sourceFileId\": \"factory-samples/94 VocalHit 5.wav\",\n    \"id\": \"6c622c48-f830-42c9-8a0e-617b384794f2\",\n    \"slotNumber\": 94,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 6\",\n    \"sourceFileId\": \"factory-samples/95 VocalHit 6.wav\",\n    \"id\": \"22c47a01-7f62-419b-b65b-0afad6fa9094\",\n    \"slotNumber\": 95,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 7\",\n    \"sourceFileId\": \"factory-samples/96 VocalHit 7.wav\",\n    \"id\": \"6b508746-2228-4015-b621-5edddfa50158\",\n    \"slotNumber\": 96,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 8\",\n    \"sourceFileId\": \"factory-samples/97 VocalHit 8.wav\",\n    \"id\": \"61852d62-38d9-4487-8d15-2ad5f9192da6\",\n    \"slotNumber\": 97,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"VocalHit 9\",\n    \"sourceFileId\": \"factory-samples/98 VocalHit 9.wav\",\n    \"id\": \"c1e09230-3fb6-4d45-9b08-a615e8e5ad0b\",\n    \"slotNumber\": 98,\n    \"dateSampled\": 1412121600000\n  },\n  {\n    \"name\": \"Doncamatic\",\n    \"sourceFileId\": \"factory-samples/99 Doncamatic.wav\",\n    \"id\": \"959d37c9-440b-422d-b429-40b94338b0ab\",\n    \"slotNumber\": 99,\n    \"dateSampled\": 1412121600000\n  }\n];","export const SAMPLE_RATE = 31250;\n","import localforage from 'localforage';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport factorySampleParams from './factory-samples.js';\nimport { SAMPLE_RATE } from './utils/constants.js';\n\n/**\n * @typedef {object} SampleContainerParams\n * @property {string} name\n * @property {string} sourceFileId\n * @property {string} [id]\n * @property {{ type: string; ext: string } | null} [userFileInfo]\n * @property {number} [slotNumber]\n * @property {number} [dateSampled]\n * @property {number} [dateModified]\n * @property {boolean} [useCompression]\n * @property {number} [qualityBitDepth]\n * @property {number} [scaleCoefficient]\n * @property {[number, number]} [trimFrames]\n */\n\n/**\n * @typedef {object} SampleMetadata\n * @property {string} name\n * @property {string} sourceFileId\n * @property {{ type: string; ext: string } | null} userFileInfo\n * @property {number} slotNumber\n * @property {number} dateSampled\n * @property {number} dateModified\n * @property {boolean} useCompression\n * @property {number} qualityBitDepth\n * @property {number} scaleCoefficient\n * @property {[number, number]} trimFrames\n * @property {string} metadataVersion\n */\n\n/**\n * @typedef {object} SampleMetadataUpdate\n * @property {string} [name]\n * @property {number} [slotNumber]\n * @property {boolean} [useCompression]\n * @property {number} [qualityBitDepth]\n * @property {number} [scaleCoefficient]\n * @property {[number, number]} [trimFrames]\n */\n\nconst audioFileDataStore = localforage.createInstance({\n  name: 'audio_file_data',\n  driver: localforage.INDEXEDDB,\n});\n\nconst sampleMetadataStore = localforage.createInstance({\n  name: 'sample_metadata',\n  driver: localforage.INDEXEDDB,\n});\n\n/**\n * @param {Uint8Array} audioFileData\n * @returns {Promise<string>} id\n */\nexport async function storeAudioSourceFile(audioFileData) {\n  const id = uuidv4();\n  await audioFileDataStore.setItem(id, audioFileData);\n  return id;\n}\n\nconst METADATA_VERSION = '0.2.0';\n\n// These properties are considered fundamental and should never break\n/**\n * @typedef {{\n *   name: string;\n *   sourceFileId: string;\n *   id: string;\n *   metadataVersion: string;\n * }} OldMetadata\n */\n\n/**\n * @type {Record<string, (oldMetadata: OldMetadata) => OldMetadata>}\n */\nconst metadataUpgrades = {\n  '0.1.0': (oldMetadata) => {\n    /**\n     * @typedef {OldMetadata & { clip: [number, number] }} PrevMetadata\n     */\n    const { clip, ...prevMetadata } = /** @type {PrevMetadata} */ (oldMetadata);\n    const newMetadata = {\n      ...prevMetadata,\n      trimFrames: /** @type {[number, number]} */ (\n        clip.map((c) => Math.round(c * SAMPLE_RATE))\n      ),\n      metadataVersion: '0.2.0',\n    };\n    return newMetadata;\n  },\n};\n\n/**\n * @param {OldMetadata} oldMetadata\n * @returns {SampleMetadata}\n */\nfunction upgradeMetadata(oldMetadata) {\n  let prevMetadata = oldMetadata;\n  while (prevMetadata.metadataVersion !== METADATA_VERSION) {\n    /**\n     * @type {(typeof metadataUpgrades)[string] | undefined}\n     */\n    const matchedUpgrade = metadataUpgrades[oldMetadata.metadataVersion];\n    if (!matchedUpgrade) {\n      console.warn(\n        `Failed to properly upgrade metadata for sample \"${prevMetadata.name}\"`\n      );\n      prevMetadata = {\n        name: prevMetadata.name,\n        sourceFileId: prevMetadata.sourceFileId,\n        id: prevMetadata.id,\n        metadataVersion: METADATA_VERSION,\n      };\n      break;\n    }\n    prevMetadata = matchedUpgrade(prevMetadata);\n  }\n  return /** @type {SampleMetadata} */ (/** @type {unknown} */ (prevMetadata));\n}\n\nexport class SampleContainer {\n  /**\n   * @param {SampleContainerParams} sampleContainerParams\n   */\n  constructor({\n    name,\n    sourceFileId,\n    id = uuidv4(),\n    userFileInfo = null,\n    slotNumber = 0,\n    dateSampled = Date.now(),\n    dateModified = dateSampled,\n    useCompression = true,\n    qualityBitDepth = 16,\n    scaleCoefficient = 1,\n    trimFrames = [0, 0],\n  }) {\n    /** @readonly */\n    this.id = id;\n    /**\n     * @readonly\n     * @type {SampleMetadata}\n     */\n    this.metadata = {\n      name,\n      sourceFileId,\n      userFileInfo,\n      slotNumber,\n      dateSampled,\n      dateModified,\n      useCompression,\n      qualityBitDepth,\n      scaleCoefficient,\n      trimFrames,\n      metadataVersion: METADATA_VERSION,\n    };\n  }\n\n  /**\n   * @returns {SampleContainer}\n   */\n  duplicate() {\n    const copy = new SampleContainer.Mutable({\n      ...this.metadata,\n      name: `${this.metadata.name} (copy)`,\n      dateModified: Date.now(),\n    });\n    // async - does not block\n    copy.persist();\n    return copy;\n  }\n\n  static Mutable = class extends SampleContainer {\n    /**\n     * @param {SampleContainerParams} sampleContainerParams\n     */\n    constructor(sampleContainerParams) {\n      super(sampleContainerParams);\n      setTimeout(async () => {\n        const ids = await sampleMetadataStore.keys();\n        if (!ids.includes(this.id)) {\n          console.warn(\n            `Expected sample metadata container ${this.id} to be persisted`\n          );\n        }\n      });\n    }\n\n    async persist() {\n      await sampleMetadataStore.setItem(this.id, this.metadata);\n    }\n\n    /**\n     * @param {SampleMetadataUpdate} update\n     * @returns {SampleContainer}\n     */\n    update(update) {\n      const { id, metadata } = this;\n      // if the update doesn't change anything, return the existing container\n      if (\n        /** @type {(keyof SampleMetadataUpdate)[]} */ (\n          Object.keys(update)\n        ).every((key) => update[key] === metadata[key])\n      ) {\n        return this;\n      }\n      /**\n       * @type {SampleMetadata}\n       */\n      const newMetadata = {\n        ...metadata,\n        ...update,\n        dateModified: Date.now(),\n      };\n      const newContainer = new SampleContainer.Mutable({ id, ...newMetadata });\n      // async - does not block\n      newContainer.persist();\n      return newContainer;\n    }\n\n    async remove() {\n      await sampleMetadataStore.removeItem(this.id);\n      // if the source file is on the server, don't worry about cleanup\n      if (this.metadata.sourceFileId.includes('.')) {\n        return;\n      }\n      // check if source file is used by other sample containers\n      const allMetadata = await SampleContainer.getAllMetadataFromStore();\n      for (const [, { sourceFileId }] of allMetadata) {\n        if (sourceFileId === this.metadata.sourceFileId) {\n          // still used.. don't do anything\n          return;\n        }\n      }\n      // clean up dangling source file from storage\n      await audioFileDataStore.removeItem(this.metadata.sourceFileId);\n    }\n  };\n\n  /**\n   * @private\n   * @type {Map<string, Uint8Array>}\n   */\n  static sourceFileData = new Map();\n\n  /**\n   * @private\n   * @type {string[]}\n   */\n  static recentlyCachedSourceFileIds = [];\n\n  /** @readonly @private */\n  static MAX_CACHED = 10;\n\n  /**\n   * @param {string} sourceFileId\n   * @param {Uint8Array} data\n   */\n  static cacheSourceFileData(sourceFileId, data) {\n    this.sourceFileData.set(sourceFileId, data);\n    this.recentlyCachedSourceFileIds = [\n      sourceFileId,\n      ...this.recentlyCachedSourceFileIds.filter((id) => id !== sourceFileId),\n    ];\n    const stale = this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);\n    for (const sourceFileId of stale) {\n      this.sourceFileData.delete(sourceFileId);\n    }\n    this.recentlyCachedSourceFileIds = this.recentlyCachedSourceFileIds.slice(\n      0,\n      this.MAX_CACHED\n    );\n  }\n\n  /**\n   * @param {string} sourceFileId\n   * @returns {Promise<Uint8Array>}\n   */\n  static async getSourceFileData(sourceFileId) {\n    {\n      const data = this.sourceFileData.get(sourceFileId);\n      if (data) {\n        return data;\n      }\n    }\n    if (sourceFileId.includes('.')) {\n      const res = await fetch(sourceFileId);\n      if (res.status >= 400) {\n        return Promise.reject(\n          new Error(`Failed to fetch source file \"${sourceFileId}\"`)\n        );\n      }\n      // assume it's a URL pointing to a an audio file\n      const buffer = await res.arrayBuffer();\n      const data = new Uint8Array(buffer);\n      this.cacheSourceFileData(sourceFileId, data);\n      return data;\n    }\n    /**\n     * @type {unknown}\n     */\n    const data = await audioFileDataStore.getItem(sourceFileId);\n    if (data) {\n      if (data instanceof Uint8Array) {\n        this.cacheSourceFileData(sourceFileId, data);\n        return data;\n      }\n      return Promise.reject('Source data is of unexpected type');\n    }\n    return Promise.reject('Missing source data');\n  }\n\n  /**\n   * @protected\n   */\n  static async getAllMetadataFromStore() {\n    /**\n     * @type {Map<string, SampleMetadata>}\n     */\n    const sampleMetadata = new Map();\n    await sampleMetadataStore.iterate((metadata, id) => {\n      if (metadata) {\n        const upgradedMetadata = upgradeMetadata(metadata);\n        sampleMetadata.set(id, upgradedMetadata);\n      }\n    });\n    return sampleMetadata;\n  }\n\n  static async getAllFromStorage() {\n    const sampleMetadata = await this.getAllMetadataFromStore();\n    const sourceIds = (await audioFileDataStore.keys()).concat(\n      factorySampleParams.map(({ sourceFileId }) => sourceFileId)\n    );\n    const sampleContainers = /** @type {SampleContainer[]} */ (\n      [...sampleMetadata]\n        .map(([id, metadata]) => {\n          const { sourceFileId } = metadata;\n          if (!sourceIds.includes(sourceFileId)) {\n            console.warn(\n              `Found metadata \"${\n                metadata.name || id\n              }\" with missing data \"${sourceFileId}; ignoring.`\n            );\n            return null;\n          }\n          return new SampleContainer.Mutable({ id, ...metadata });\n        })\n        .filter(Boolean)\n    ).sort((a, b) => b.metadata.dateModified - a.metadata.dateModified);\n    return sampleContainers;\n  }\n}\n\nexport const factorySamples = new Map(\n  factorySampleParams.map((params) => [params.id, new SampleContainer(params)])\n);\n","import {\n  createContext,\n  createElement,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\nimport getWavFileHeaders from 'wav-headers';\n\nimport { SampleContainer } from '../store.js';\nimport { SAMPLE_RATE } from './constants.js';\n\n/**\n * @param {Float32Array} array\n * @param {[number, number]} trimFrames\n */\nexport function getTrimmedView(array, trimFrames) {\n  const frameSizeInBytes = 4;\n  const byteOffset = trimFrames[0] * frameSizeInBytes;\n  const viewLength = array.length - trimFrames[0] - trimFrames[1];\n  return new Float32Array(array.buffer, byteOffset, viewLength);\n}\n\n/**\n * @param {AudioBuffer} audioBuffer\n * @param {[number, number]} trimFrames\n */\nexport function getMonoSamplesFromAudioBuffer(audioBuffer, trimFrames) {\n  const trimmedLength = audioBuffer.length - trimFrames[0] - trimFrames[1];\n  const samples = new Float32Array(trimmedLength);\n  const channels = /** @type {void[]} */ (Array(audioBuffer.numberOfChannels))\n    .fill()\n    .map((_, i) => getTrimmedView(audioBuffer.getChannelData(i), trimFrames));\n  for (let i = 0; i < trimmedLength; i++) {\n    let monoSample = 0;\n    for (let j = 0; j < channels.length; j++) {\n      monoSample += channels[j][i];\n    }\n    monoSample /= channels.length;\n    samples[i] = monoSample;\n  }\n  return samples;\n}\n\n/**\n * Finds most significant magnitude in array of samples.\n * @param {Float32Array} samples array of floats between -1 and 1\n * @returns {number} peak value between 0 and 1\n */\nexport function findSamplePeak(samples) {\n  let peak = 0;\n  for (const sample of samples) {\n    const abs = Math.abs(sample);\n    if (abs > peak) {\n      peak = abs;\n    }\n  }\n  return peak;\n}\n\n/**\n * Scales an array of samples according to a specified coefficient.\n * Note: mutates input array (no return value).\n * @param {Float32Array} samples array of floats\n * @param {number} coef float value to multiply against each sample\n */\nfunction scaleSamples(samples, coef) {\n  if (coef !== 1) {\n    for (let i = 0; i < samples.length; i++) {\n      samples[i] *= coef;\n    }\n  }\n}\n\n/**\n * Reduces precision of samples by converting them to integers of a given bit\n * depth then back to floats. Note: mutates input array (no return value).\n * @param {Float32Array} samples array of floats between -1 and 1\n * @param {number} qualityBitDepth number from 8 to 16\n */\nfunction applyQualityBitDepthToSamples(samples, qualityBitDepth) {\n  const signedMax = 2 ** (qualityBitDepth - 1);\n  for (let i = 0; i < samples.length; i++) {\n    samples[i] = Math.round(samples[i] * signedMax) / signedMax;\n  }\n}\n\n/**\n * Check for values greater than 1 or less than -1 and just clamp them (ideally\n * we shouldn't have out-of-bounds samples but this sometimes happens.. by\n * clamping them we kind of force the user to deal with the input levels).\n * Note: mutates input array (no return value).\n * @param {Float32Array} samples array of floats\n */\nexport function clampOutOfBoundsValues(samples) {\n  for (let i = 0; i < samples.length; i++) {\n    if (samples[i] > 1) {\n      samples[i] = 1;\n    } else if (samples[i] < -1) {\n      samples[i] = -1;\n    }\n  }\n}\n\n/**\n * @param {Float32Array} samples\n */\nfunction convertSamplesTo16Bit(samples) {\n  const samples16 = new Int16Array(samples.length);\n  const signedMax = 2 ** 15;\n  for (let i = 0; i < samples.length; i++) {\n    samples16[i] = samples[i] === 1 ? signedMax - 1 : signedMax * samples[i];\n  }\n  return samples16;\n}\n\n/**\n * @type {AudioContext | undefined}\n */\nlet targetAudioContext;\n\nfunction getTargetAudioContext() {\n  return (targetAudioContext =\n    targetAudioContext || new AudioContext({ sampleRate: SAMPLE_RATE }));\n}\n\n/**\n * @param {Uint8Array} audioFileBuffer audio file to transform into audio buffer\n * @returns {Promise<AudioBuffer>}\n */\nexport async function getAudioBufferForAudioFileData(audioFileBuffer) {\n  // make a copy of the data (since decodeAudioData will empty the source array)\n  const bufferCopy = new Uint8Array(audioFileBuffer);\n  /**\n   * @type {AudioBuffer}\n   */\n  const audioBuffer = await new Promise((resolve, reject) => {\n    getTargetAudioContext().decodeAudioData(bufferCopy.buffer, resolve, reject);\n  });\n  return audioBuffer;\n}\n\n/**\n * @param {string} sourceFileId sourceFileId to grab from store\n * @param {boolean} shouldClampValues do we need to clamp out of bounds values\n * @returns {Promise<AudioBuffer>}\n */\nexport async function getSourceAudioBuffer(sourceFileId, shouldClampValues) {\n  const sourceFileData = await SampleContainer.getSourceFileData(sourceFileId);\n  const audioBuffer = await getAudioBufferForAudioFileData(sourceFileData);\n  if (shouldClampValues) {\n    for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {\n      clampOutOfBoundsValues(audioBuffer.getChannelData(channel));\n    }\n  }\n  return audioBuffer;\n}\n\n/**\n * Given sample container, returns a 16-bit mono wav file with the sample's\n * metadata parameters applied\n * @param {import('../store').SampleContainer} sampleContainer\n * @returns {Promise<{ data: Uint8Array; sampleRate: number }>}\n */\nexport async function getTargetWavForSample(sampleContainer) {\n  const {\n    qualityBitDepth,\n    sourceFileId,\n    userFileInfo,\n    scaleCoefficient,\n    trimFrames,\n  } = sampleContainer.metadata;\n  if (\n    qualityBitDepth < 8 ||\n    qualityBitDepth > 16 ||\n    !Number.isInteger(qualityBitDepth)\n  ) {\n    throw new Error(\n      `Expected bit depth between 8 and 16. Received: ${qualityBitDepth}`\n    );\n  }\n  const sourceAudioBuffer = await getSourceAudioBuffer(\n    sourceFileId,\n    Boolean(userFileInfo)\n  );\n  const samples =\n    sourceAudioBuffer.numberOfChannels === 1\n      ? getTrimmedView(sourceAudioBuffer.getChannelData(0), trimFrames)\n      : getMonoSamplesFromAudioBuffer(sourceAudioBuffer, trimFrames);\n  if (scaleCoefficient !== 1) {\n    scaleSamples(samples, scaleCoefficient);\n  }\n  if (qualityBitDepth < 16) {\n    applyQualityBitDepthToSamples(samples, qualityBitDepth);\n  }\n  const samples16 = convertSamplesTo16Bit(samples);\n  const samplesByteLength = samples16.length * 2;\n  /**\n   * @type {Uint8Array}\n   */\n  const wavHeader = getWavFileHeaders({\n    channels: 1,\n    sampleRate: sourceAudioBuffer.sampleRate,\n    bitDepth: 16,\n    dataLength: samplesByteLength,\n  });\n  const wavBuffer = new Uint8Array(wavHeader.length + samplesByteLength);\n  wavBuffer.set(wavHeader);\n  wavBuffer.set(new Uint8Array(samples16.buffer), wavHeader.length);\n  return {\n    data: wavBuffer,\n    sampleRate: 16,\n  };\n}\n\nconst audioPlaybackContextDefaultValue = {\n  /**\n   * @param {AudioBuffer} audioBuffer buffer to play\n   * @param {{\n   *   onTimeUpdate?: (currentTime: number) => void;\n   *   onEnded?: () => void;\n   * }} [opts]\n   * @returns {() => void} stop\n   */\n  playAudioBuffer(audioBuffer, opts) {\n    throw new Error('Must render AudioPlaybackContextProvider');\n  },\n  isAudioBusy: false,\n};\n\nconst AudioPlaybackContext = createContext(audioPlaybackContextDefaultValue);\n\n/**\n * @param {React.PropsWithChildren<{}>} props\n * @returns\n */\nexport function AudioPlaybackContextProvider({ children }) {\n  const [isAudioBusy, setIsAudioBusy] = useState(false);\n\n  const playAudioBuffer = useCallback(\n    /**\n     * @type {(typeof audioPlaybackContextDefaultValue.playAudioBuffer)}\n     */\n    (audioBuffer, { onTimeUpdate = () => null, onEnded = () => null } = {}) => {\n      if (isAudioBusy) {\n        throw new Error(\n          'Wait until audio playback has finished to start new playback'\n        );\n      }\n      setIsAudioBusy(true);\n      /**\n       * @type {AudioContext}\n       */\n      let audioContext;\n      /**\n       * @type {AudioBufferSourceNode}\n       */\n      let source;\n      try {\n        audioContext = getTargetAudioContext();\n        source = audioContext.createBufferSource();\n        source.buffer = audioBuffer;\n        source.connect(audioContext.destination);\n        source.start();\n      } catch (err) {\n        setIsAudioBusy(false);\n        throw err;\n      }\n      const startTime = audioContext.currentTime;\n      onTimeUpdate(0);\n      let frame = requestAnimationFrame(updateCurrentTime);\n      function updateCurrentTime() {\n        onTimeUpdate(audioContext.currentTime - startTime);\n        frame = requestAnimationFrame(updateCurrentTime);\n      }\n      let stopped = false;\n      source.addEventListener('ended', () => {\n        if (!stopped) {\n          onTimeUpdate(audioBuffer.duration);\n          onEnded();\n        }\n        setIsAudioBusy(false);\n        cancelAnimationFrame(frame);\n      });\n      return function stop() {\n        source.stop();\n        stopped = true;\n      };\n    },\n    [isAudioBusy]\n  );\n\n  const contextValue = useMemo(\n    () => ({\n      playAudioBuffer,\n      isAudioBusy,\n    }),\n    [playAudioBuffer, isAudioBusy]\n  );\n\n  return createElement(\n    AudioPlaybackContext.Provider,\n    { value: contextValue },\n    children\n  );\n}\n\nexport function useAudioPlaybackContext() {\n  return useContext(AudioPlaybackContext);\n}\n","import React, {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { styled } from 'tonami';\n\nimport {\n  getSourceAudioBuffer,\n  getMonoSamplesFromAudioBuffer,\n  findSamplePeak,\n  getTrimmedView,\n} from './utils/audioData.js';\n\nconst groupWidth = 6;\n\nconst WaveformDiv = styled.div({\n  width: '100%',\n  height: '100%',\n  position: 'relative',\n  overflow: 'hidden',\n});\n\nconst WaveformSection = styled.div({\n  width: '100%',\n  height: ({ $positive }) => ($positive ? '67%' : '33%'),\n  display: 'flex',\n  alignItems: ({ $positive }) => ($positive ? 'flex-end' : 'flex-start'),\n});\n\nconst Scaled = styled.div({\n  width: '100%',\n  height: ({ $scaleCoefficient }) => `${100 * $scaleCoefficient}%`,\n  willChange: 'height',\n  display: 'flex',\n  alignItems: ({ $positive }) => ($positive ? 'flex-end' : 'flex-start'),\n});\n\nconst Bar = styled.div({\n  width: `${groupWidth}px`,\n  height: ({ $amplitude, $positive }) =>\n    `${100 * ($positive ? 1 : -1) * $amplitude}%`,\n  paddingRight: '1px',\n});\n\nconst BarInner = styled.div({\n  backgroundColor: ({ $positive }) => ($positive ? 'red' : 'darkred'),\n  height: '100%',\n});\n\n/**\n * @type {React.FC<React.InputHTMLAttributes<HTMLInputElement>>}\n */\nconst ScaleInput = styled.input({\n  position: 'absolute',\n  top: 0,\n  left: 0,\n});\n\n/**\n * @param {Float32Array} samples an array of floats from -1 to 1\n * @param {number} groupSize the number of samples represented for each peak\n * @returns {{\n *   positive: Float32Array;\n *   negative: Float32Array;\n * }} arrays of peak positive and negative values\n */\nfunction getPeaksForSamples(samples, groupSize) {\n  // Cut off whatever's left after dividing into blocks of length [groupSize]\n  const positive = new Float32Array(Math.floor(samples.length / groupSize));\n  const negative = new Float32Array(Math.floor(samples.length / groupSize));\n  for (let i = 0; i < positive.length; i++) {\n    const group = new Float32Array(\n      samples.buffer,\n      i * groupSize * 4,\n      groupSize\n    );\n    let max = 0;\n    let min = 0;\n    for (const sample of group) {\n      if (sample > max) {\n        max = sample;\n      }\n      if (sample < min) {\n        min = sample;\n      }\n    }\n    positive[i] = max;\n    negative[i] = min;\n  }\n  return { positive, negative };\n}\n\n/**\n * @typedef {{\n *   sample: import('./store').SampleContainer;\n *   onSetTrimFrames: (trimFrames: [number, number]) => void;\n *   onSetScaleCoefficient: (scaleCoefficient: number) => void;\n * }} WaveformProps\n */\n\n/**\n * @param {WaveformProps & { sourceAudioBuffer: AudioBuffer | null }} props\n */\nfunction Waveform({\n  sourceAudioBuffer,\n  sample: {\n    metadata: { trimFrames, scaleCoefficient },\n  },\n  onSetTrimFrames,\n  onSetScaleCoefficient,\n}) {\n  const monoSamples = useMemo(\n    () =>\n      sourceAudioBuffer\n        ? getMonoSamplesFromAudioBuffer(sourceAudioBuffer, [0, 0])\n        : new Float32Array(),\n    [sourceAudioBuffer]\n  );\n\n  /**\n   * @type {React.RefObject<HTMLDivElement>}\n   */\n  const waveformRef = useRef(null);\n\n  const peaks = useMemo(() => {\n    const pixelWidth = waveformRef.current && waveformRef.current.offsetWidth;\n    if (!pixelWidth || !monoSamples.length) {\n      return {\n        positive: new Float32Array(),\n        negative: new Float32Array(),\n      };\n    }\n    const groupSize = Math.floor(\n      (groupWidth * monoSamples.length) / pixelWidth\n    );\n    return getPeaksForSamples(monoSamples, groupSize);\n  }, [monoSamples]);\n\n  const trimmedSamplePeak = useMemo(() => {\n    if (!sourceAudioBuffer) {\n      return 0;\n    }\n    const trimmedView = getTrimmedView(monoSamples, trimFrames);\n    const samplePeak = findSamplePeak(trimmedView);\n    return samplePeak;\n  }, [sourceAudioBuffer, monoSamples, trimFrames]);\n\n  const maxCoefficient = 1 / trimmedSamplePeak;\n\n  // ensure that our max scaled sample in our trimmed view doesn't exceed 1 / -1\n  useLayoutEffect(() => {\n    if (scaleCoefficient > maxCoefficient) {\n      onSetScaleCoefficient(maxCoefficient);\n    }\n  }, [scaleCoefficient, maxCoefficient, onSetScaleCoefficient]);\n\n  const peakTarget = scaleCoefficient * trimmedSamplePeak;\n\n  return (\n    <>\n      <WaveformDiv ref={waveformRef}>\n        {[true, false].map((positive) => {\n          const key = positive ? 'positive' : 'negative';\n          return (\n            <WaveformSection key={key} $positive={positive}>\n              <Scaled $scaleCoefficient={scaleCoefficient} $positive={positive}>\n                {[].map.call(peaks[key], (amplitude, index) => (\n                  <Bar key={index} $amplitude={amplitude} $positive={positive}>\n                    <BarInner $positive={positive} />\n                  </Bar>\n                ))}\n              </Scaled>\n            </WaveformSection>\n          );\n        })}\n        <ScaleInput\n          type=\"range\"\n          disabled={trimmedSamplePeak === 0}\n          value={peakTarget}\n          min={0.1}\n          max={1}\n          step={0.01}\n          onChange={(e) => {\n            if (trimmedSamplePeak === 0) {\n              return;\n            }\n            onSetScaleCoefficient(Number(e.target.value) / trimmedSamplePeak);\n          }}\n        />\n      </WaveformDiv>\n      <button\n        type=\"button\"\n        disabled={scaleCoefficient === maxCoefficient}\n        onClick={() => onSetScaleCoefficient(maxCoefficient)}\n      >\n        Normalize\n      </button>\n      <button\n        type=\"button\"\n        disabled={scaleCoefficient === 1}\n        onClick={() => onSetScaleCoefficient(1)}\n      >\n        Original level\n      </button>\n    </>\n  );\n}\n\n/**\n *\n * @param {WaveformProps} props\n */\nfunction AsyncWaveform({ sample, ...rest }) {\n  const [loadedAudioBuffer, setSourceAudioBuffer] = useState(\n    /** @type {[string, AudioBuffer] | null} */ (null)\n  );\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      if (cancelled) return;\n      const audioBuffer = await getSourceAudioBuffer(\n        sample.metadata.sourceFileId,\n        Boolean(sample.metadata.userFileInfo)\n      );\n      if (cancelled) return;\n      setSourceAudioBuffer([sample.metadata.sourceFileId, audioBuffer]);\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, [sample.metadata.sourceFileId, sample.metadata.userFileInfo]);\n\n  // We need to hold onto an internal state because when the sample changes,\n  // the sourceAudioBuffer loads asynchronously and we want to avoid trying\n  // to apply the new sample's metadata to the old sample's audio.\n  const displayedSample = useRef(sample);\n  if (\n    loadedAudioBuffer &&\n    sample.metadata.sourceFileId === loadedAudioBuffer[0]\n  ) {\n    displayedSample.current = sample;\n  }\n\n  return (\n    <Waveform\n      {...rest}\n      sample={displayedSample.current}\n      sourceAudioBuffer={loadedAudioBuffer && loadedAudioBuffer[1]}\n    />\n  );\n}\n\nexport default AsyncWaveform;\n","/**\n * @typedef {{\n *   prepareSampleBufferFromWavData(\n *     wavData: Uint8Array,\n *     bytes: number,\n *     slotNumber: number,\n *     quality: number,\n *     useCompression: 0 | 1,\n *     onUpdate: number\n *   ): void;\n *   prepareSampleBufferFrom16BitPcmData(\n *     wavData: Uint8Array,\n *     bytes: number,\n *     rate: number,\n *     slotNumber: number,\n *     quality: number,\n *     useCompression: 0 | 1,\n *     onUpdate: number\n *   ): void;\n *   getSampleBufferPointer(sampleBufferContainer: number): number;\n *   getSampleBufferSize(sampleBufferContainer: number): number;\n *   getSampleBufferProgress(sampleBufferContainer: number): number;\n *   registerUpdateCallback(\n *     cb: (sampleBufferContainer: number) => void\n *   ): number;\n *   unregisterUpdateCallback(pointer: number): void;\n *   heap8Buffer(): ArrayBuffer;\n * }} SyroBindings\n */\n\n/**\n * @type {Promise<SyroBindings> | undefined}\n */\nlet syroBindingsPromise;\n\nexport async function getSyroBindings() {\n  if (typeof window.CREATE_SYRO_BINDINGS !== 'function') {\n    return Promise.reject(\n      'Expected CREATE_SYRO_BINDINGS global function to exist'\n    );\n  }\n  const Module = await window.CREATE_SYRO_BINDINGS();\n  return (syroBindingsPromise =\n    syroBindingsPromise ||\n    new Promise((resolve, reject) => {\n      /**\n       * @type {SyroBindings}\n       */\n      let syroBindings;\n      try {\n        syroBindings = {\n          prepareSampleBufferFromWavData: Module.cwrap(\n            'prepareSampleBufferFromWavData',\n            null,\n            ['array', 'number', 'number', 'number', 'number']\n          ),\n          // TODO: put this back when C function works correctly\n          // prepareSampleBufferFrom16BitPcmData: Module.cwrap(\n          //   'prepareSampleBufferFrom16BitPcmData',\n          //   null,\n          //   ['array', 'number', 'number', 'number', 'number', 'number']\n          // ),\n          prepareSampleBufferFrom16BitPcmData() {\n            throw new Error(\n              'This function does not work. Use prepareSampleBufferFromWavData.'\n            );\n          },\n          getSampleBufferPointer: Module.cwrap(\n            'getSampleBufferPointer',\n            'number',\n            ['number']\n          ),\n          getSampleBufferSize: Module.cwrap('getSampleBufferSize', 'number', [\n            'number',\n          ]),\n          getSampleBufferProgress: Module.cwrap(\n            'getSampleBufferProgress',\n            'number',\n            ['number']\n          ),\n          registerUpdateCallback(cb) {\n            return Module.addFunction(cb, 'vi');\n          },\n          unregisterUpdateCallback(pointer) {\n            Module.removeFunction(pointer);\n          },\n          heap8Buffer() {\n            return Module.HEAP8.buffer;\n          },\n        };\n      } catch (err) {\n        reject(err);\n        return;\n      }\n      resolve(syroBindings);\n    }));\n}\n","import { getSyroBindings } from './getSyroBindings.js';\nimport { getTargetWavForSample } from './audioData.js';\n\n/**\n * @param {import('../store').SampleContainer} sampleContainer\n * @param {(progress: number) => void} onProgress\n * @returns {Promise<Uint8Array>}\n */\nexport async function getSampleBuffer(sampleContainer, onProgress) {\n  const {\n    prepareSampleBufferFromWavData,\n    getSampleBufferPointer,\n    getSampleBufferSize,\n    getSampleBufferProgress,\n    registerUpdateCallback,\n    unregisterUpdateCallback,\n    heap8Buffer,\n  } = await getSyroBindings();\n  const { data } = await getTargetWavForSample(sampleContainer);\n  /**\n   * @type {Uint8Array | undefined}\n   */\n  let sampleBuffer;\n  let progress = 0;\n  const onUpdate = registerUpdateCallback((sampleBufferContainerPointer) => {\n    const bufferPointer = getSampleBufferPointer(sampleBufferContainerPointer);\n    const bufferSize = getSampleBufferSize(sampleBufferContainerPointer);\n    if (!sampleBuffer) {\n      sampleBuffer = new Uint8Array(bufferSize);\n    }\n    // save a new copy of the data so it doesn't disappear\n    sampleBuffer.set(new Uint8Array(heap8Buffer(), bufferPointer, bufferSize));\n    progress =\n      getSampleBufferProgress(sampleBufferContainerPointer) / bufferSize;\n  });\n  prepareSampleBufferFromWavData(\n    data,\n    data.length,\n    sampleContainer.metadata.slotNumber,\n    sampleContainer.metadata.qualityBitDepth,\n    sampleContainer.metadata.useCompression ? 1 : 0,\n    onUpdate\n  );\n  onProgress(progress);\n  try {\n    await /** @type {Promise<void>} */ (\n      new Promise((resolve) => {\n        checkProgress();\n        function checkProgress() {\n          // TODO: find a way to detect if the web worker failed to load, in\n          // which case we should reject the promise\n          if (progress) {\n            onProgress(progress);\n            if (progress >= 1) {\n              resolve();\n              return;\n            }\n          }\n          requestAnimationFrame(checkProgress);\n        }\n      })\n    );\n  } finally {\n    unregisterUpdateCallback(onUpdate);\n  }\n  if (!sampleBuffer) {\n    throw new Error('Unexpected condition: sampleBuffer should be defined');\n  }\n  return sampleBuffer;\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\nimport {\n  getAudioBufferForAudioFileData,\n  useAudioPlaybackContext,\n} from './utils/audioData.js';\nimport { getSampleBuffer } from './utils/syro.js';\n\n/**\n * @param {{\n *   sample: import('./store').SampleContainer;\n * }} props\n */\nfunction VolcaTransferControl({ sample }) {\n  const [syroProgress, setSyroProgress] = useState(0);\n  const [syroTransferState, setSyroTransferState] = useState(\n    /** @type {'loading' | 'transferring' | 'error' | 'idle'} */ ('idle')\n  );\n  // to be set when transfer is started\n  const stop = useRef(() => {});\n  useEffect(() => {\n    return () => stop.current();\n  }, [sample]);\n  const { playAudioBuffer, isAudioBusy } = useAudioPlaybackContext();\n  return (\n    <>\n      <button\n        type=\"button\"\n        onClick={async () => {\n          try {\n            let cancelled = false;\n            stop.current = () => {\n              setSyroTransferState('idle');\n              cancelled = true;\n            };\n            setSyroProgress(0);\n            setSyroTransferState('loading');\n            const sampleBuffer = await getSampleBuffer(sample, (progress) => {\n              if (!cancelled) {\n                setSyroProgress(progress);\n              }\n            });\n            if (cancelled) {\n              return;\n            }\n            setSyroTransferState('transferring');\n            const audioBuffer = await getAudioBufferForAudioFileData(\n              sampleBuffer\n            );\n            if (cancelled) {\n              return;\n            }\n            const stopPlayback = playAudioBuffer(audioBuffer, {\n              onTimeUpdate: (currentTime) =>\n                setSyroProgress(currentTime / audioBuffer.duration),\n              onEnded: () => setSyroTransferState('idle'),\n            });\n            stop.current = () => {\n              stopPlayback();\n              setSyroTransferState('idle');\n            };\n          } catch (err) {\n            console.error(err);\n            setSyroTransferState('error');\n          }\n        }}\n        disabled={\n          isAudioBusy ||\n          syroTransferState === 'loading' ||\n          syroTransferState === 'transferring'\n        }\n      >\n        transfer to volca sample\n      </button>\n      <br />\n      {syroTransferState === 'idle' ? null : syroTransferState === 'error' ? (\n        'Error transferring'\n      ) : (\n        <>\n          <p>\n            {syroTransferState === 'loading'\n              ? 'Preparing sample transfer...'\n              : 'Transferring to Volca Sample...'}\n          </p>\n          <progress value={syroProgress} />\n          <br />\n          <button onClick={() => stop.current()}>Cancel</button>\n        </>\n      )}\n      <br />\n    </>\n  );\n}\n\nexport default VolcaTransferControl;\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { styled } from 'tonami';\n\nimport Waveform from './Waveform.js';\nimport {\n  getTargetWavForSample,\n  getSourceAudioBuffer,\n  getAudioBufferForAudioFileData,\n  useAudioPlaybackContext,\n} from './utils/audioData.js';\nimport { SampleContainer } from './store.js';\nimport VolcaTransferControl from './VolcaTransferControl.js';\n\nconst SampleDetailContainer = styled.div({\n  paddingLeft: '2rem',\n});\n\nconst WaveformContainer = styled.div({\n  height: '200px',\n  backgroundColor: '#f3f3f3',\n  maxWidth: '400px',\n});\n\n/**\n * @param {Blob} blob\n * @param {string} filename\n */\nfunction downloadBlob(blob, filename) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.style.display = 'none';\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\n/**\n * @param {{\n *   sample: import('./store').SampleContainer | null;\n *   onSampleUpdate: (id: string, update: import('./store').SampleMetadataUpdate) => void;\n *   onSampleDuplicate: (id: string) => void;\n *   onSampleDelete: (id: string) => void;\n * }} props\n */\nfunction SampleDetail({\n  sample,\n  onSampleUpdate,\n  onSampleDuplicate,\n  onSampleDelete,\n}) {\n  const [sampleLength, setSampleLength] = useState(0);\n  const sourceFileId = sample && sample.metadata.sourceFileId;\n  useEffect(() => {\n    // when the source file id changes, we should temporarily set the sample\n    // length to 0 so that we can't make changes to the trimming until the\n    // sample length is loaded\n    setSampleLength(0);\n    if (sourceFileId) {\n      getSourceAudioBuffer(sourceFileId, false).then((audioBuffer) =>\n        setSampleLength(audioBuffer.length)\n      );\n    }\n  }, [sourceFileId]);\n  const sampleId = sample && sample.id;\n  /**\n   * @type {(scaleCoefficient: number) => void}\n   */\n  const handleSetScaleCoefficient = useCallback(\n    (scaleCoefficient) =>\n      sampleId && onSampleUpdate(sampleId, { scaleCoefficient }),\n    [sampleId, onSampleUpdate]\n  );\n  const { playAudioBuffer, isAudioBusy } = useAudioPlaybackContext();\n  if (!sample) {\n    return null;\n  }\n  const maxTrimStart = Math.max(\n    0,\n    sampleLength - sample.metadata.trimFrames[1]\n  );\n  const maxTrimEnd = Math.max(0, sampleLength - sample.metadata.trimFrames[0]);\n  return (\n    <SampleDetailContainer>\n      <h3>{sample.metadata.name}</h3>\n      <button type=\"button\" onClick={() => onSampleDuplicate(sample.id)}>\n        Duplicate\n      </button>\n      <button\n        type=\"button\"\n        onClick={() => {\n          if (\n            window.confirm(\n              `Are you sure you want to delete ${sample.metadata.name}?`\n            )\n          ) {\n            onSampleDelete(sample.id);\n          }\n        }}\n      >\n        Remove\n      </button>\n      <h4>\n        Last edited: {new Date(sample.metadata.dateModified).toLocaleString()}\n      </h4>\n      <h4>Sampled: {new Date(sample.metadata.dateSampled).toLocaleString()}</h4>\n      <label>\n        <h4>Trim start</h4>\n        <input\n          type=\"number\"\n          value={sample.metadata.trimFrames[0]}\n          step={1}\n          min={0}\n          max={maxTrimStart}\n          onChange={(e) => {\n            if (sampleLength) {\n              const trimStart = Number(e.target.value);\n              onSampleUpdate(sample.id, {\n                trimFrames: [\n                  Math.min(trimStart, maxTrimStart),\n                  sample.metadata.trimFrames[1],\n                ],\n              });\n            } else {\n              onSampleUpdate(sample.id, {\n                trimFrames: [...sample.metadata.trimFrames],\n              });\n            }\n          }}\n        />\n      </label>\n      <label>\n        <h4>Trim end</h4>\n        <input\n          type=\"number\"\n          value={sample.metadata.trimFrames[1]}\n          step={1}\n          min={0}\n          max={maxTrimEnd}\n          onChange={(e) => {\n            if (sampleLength) {\n              const trimEnd = Number(e.target.value);\n              onSampleUpdate(sample.id, {\n                trimFrames: [\n                  sample.metadata.trimFrames[0],\n                  Math.min(trimEnd, maxTrimEnd),\n                ],\n              });\n            } else {\n              onSampleUpdate(sample.id, {\n                trimFrames: [...sample.metadata.trimFrames],\n              });\n            }\n          }}\n        />\n      </label>\n      <WaveformContainer>\n        <Waveform\n          onSetTrimFrames={() => null}\n          onSetScaleCoefficient={handleSetScaleCoefficient}\n          sample={sample}\n        />\n        <button\n          type=\"button\"\n          onClick={async () => {\n            const { data } = await getTargetWavForSample(sample);\n            const audioBuffer = await getAudioBufferForAudioFileData(data);\n            playAudioBuffer(audioBuffer);\n          }}\n          disabled={isAudioBusy}\n        >\n          play\n        </button>\n        <button\n          type=\"button\"\n          onClick={async () => {\n            const { data } = await getTargetWavForSample(sample);\n            const blob = new Blob([data], {\n              type: 'audio/x-wav',\n            });\n            downloadBlob(blob, `${sample.metadata.name}.wav`);\n          }}\n        >\n          download\n        </button>\n        <button\n          type=\"button\"\n          onClick={async () => {\n            const { sourceFileId, userFileInfo } = sample.metadata;\n            const data = await SampleContainer.getSourceFileData(sourceFileId);\n            const blob = new Blob([data], {\n              type: userFileInfo ? userFileInfo.type : 'audio/x-wav',\n            });\n            downloadBlob(\n              blob,\n              `${sample.metadata.name}${\n                userFileInfo ? userFileInfo.ext : '.wav'\n              }`\n            );\n          }}\n        >\n          download (orig)\n        </button>\n      </WaveformContainer>\n      <h4>Quality bit depth: {sample.metadata.qualityBitDepth}</h4>\n      <input\n        type=\"range\"\n        value={sample.metadata.qualityBitDepth}\n        step={1}\n        min={8}\n        max={16}\n        onChange={(e) => {\n          const qualityBitDepth = Number(e.target.value);\n          onSampleUpdate(sample.id, { qualityBitDepth });\n        }}\n      />\n      <label>\n        <h4>Slot number</h4>\n        <input\n          type=\"number\"\n          value={sample.metadata.slotNumber}\n          step={1}\n          min={0}\n          max={99}\n          onChange={(e) => {\n            const slotNumber = Number(e.target.value);\n            onSampleUpdate(sample.id, { slotNumber });\n          }}\n        />\n      </label>\n      <VolcaTransferControl sample={sample} />\n    </SampleDetailContainer>\n  );\n}\n\nexport default SampleDetail;\n","import { WaveFile } from 'wavefile';\n\nimport { clampOutOfBoundsValues } from './audioData.js';\nimport { SAMPLE_RATE } from './constants.js';\n\n/**\n * @type {AudioContext | undefined}\n */\nlet recordingAudioContext;\n\nfunction getRecordingAudioContext() {\n  return (recordingAudioContext =\n    recordingAudioContext ||\n    new AudioContext(\n      navigator.mediaDevices.getSupportedConstraints().sampleRate\n        ? { sampleRate: SAMPLE_RATE }\n        : {}\n    ));\n}\n\n/**\n * @typedef {{ device: { deviceId: string; label: string }; channelsAvailable: number }} AudioDeviceInfoContainer\n */\n\n/**\n * @returns {Promise<AudioDeviceInfoContainer[]>}\n */\nexport async function getAudioInputDevices() {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  const audioInputDevices = devices.filter(\n    (device) => device.kind === 'audioinput'\n  );\n  /**\n   * @type {AudioDeviceInfoContainer[]}\n   */\n  const infoContainers = [];\n  for (const device of audioInputDevices) {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      // try to grab stereo audio\n      audio: { deviceId: device.deviceId, channelCount: 2 },\n      video: false,\n    });\n    // for Firefox, which requires us to check this info after\n    // permissions have been granted\n    const realLabel = /** @type {MediaDeviceInfo} */ (\n      (await navigator.mediaDevices.enumerateDevices()).find(\n        ({ deviceId }) => device.deviceId === deviceId\n      )\n    ).label;\n    // TODO: validate this is the right way to get the channel count..\n    // maybe we have to wait for data available or something else?\n    const channelsAvailable = stream.getAudioTracks().length;\n    for (const track of stream.getTracks()) {\n      track.stop();\n    }\n    infoContainers.push({\n      device: { deviceId: device.deviceId, label: realLabel },\n      channelsAvailable,\n    });\n  }\n  return infoContainers;\n}\n\n/**\n * @typedef {Omit<AudioWorkletNode, 'parameters'> & {\n *   parameters: Map<'isRecording' | 'bufferSize', AudioParam>\n * }} TAudioWorkletNode\n */\n\n/**\n * @typedef {{\n *  channelCount: number;\n *  onData: (audioChannels: Float32Array[]) => void;\n *  onFinish: () => void;\n * }} PcmRecorderNodeOptions\n */\n\n/**\n * @type {Promise<void> | undefined}\n */\nlet recorderWorkletProcessorPromise;\n/**\n * @param {PcmRecorderNodeOptions} options\n * @returns {Promise<{ recorderNode: TAudioWorkletNode; stop: () => void }>}\n */\nasync function createAudioWorkletPcmRecorderNode({ onData, onFinish }) {\n  const audioContext = getRecordingAudioContext();\n  recorderWorkletProcessorPromise =\n    recorderWorkletProcessorPromise ||\n    audioContext.audioWorklet.addModule('recorderWorkletProcessor.js');\n  await recorderWorkletProcessorPromise;\n  const recorderNode = /** @type {TAudioWorkletNode} */ (\n    new AudioWorkletNode(audioContext, 'recorder-worklet', {\n      parameterData: {\n        bufferSize: 1024,\n      },\n    })\n  );\n  recorderNode.port.onmessage = (e) => {\n    if (e.data.eventType === 'data') {\n      /**\n       * @type {Float32Array[]}\n       */\n      const audioChannels = e.data.audioChannels;\n      onData(audioChannels);\n    }\n\n    if (e.data.eventType === 'stop') {\n      onFinish();\n    }\n  };\n  const isRecordingParam = /** @type {AudioParam} */ (\n    recorderNode.parameters.get('isRecording')\n  );\n  isRecordingParam.setValueAtTime(1, audioContext.currentTime);\n  return {\n    recorderNode,\n    stop() {\n      isRecordingParam.setValueAtTime(0, audioContext.currentTime);\n    },\n  };\n}\n\n/**\n * @param {PcmRecorderNodeOptions} options\n * @returns {{ recorderNode: ScriptProcessorNode; stop: () => void }}\n */\nfunction createScriptProcessorPcmRecorderNode({\n  channelCount,\n  onData,\n  onFinish,\n}) {\n  const audioContext = getRecordingAudioContext();\n  const recorderNode = audioContext.createScriptProcessor(\n    1024,\n    channelCount,\n    channelCount\n  );\n  // to be set by user if they want to stop recording before time limit reached\n  let stopped = false;\n  recorderNode.onaudioprocess = (e) => {\n    const audioChannels = /** @type {void[]} */ (Array(channelCount))\n      .fill()\n      .map((_, i) => e.inputBuffer.getChannelData(i));\n    onData(audioChannels);\n    if (stopped) {\n      onFinish();\n    }\n  };\n  return {\n    recorderNode,\n    stop() {\n      stopped = true;\n    },\n  };\n}\n\n/**\n * @param {PcmRecorderNodeOptions} options\n * @returns {Promise<{ recorderNode: AudioNode; stop: () => void }>}\n */\nasync function createPcmRecorderNode(options) {\n  if (typeof AudioWorkletNode === 'undefined') {\n    return createScriptProcessorPcmRecorderNode(options);\n  }\n  return await createAudioWorkletPcmRecorderNode(options);\n}\n\n/**\n * @param {{\n *   deviceId: string;\n *   channelCount: number;\n *   onStart: () => void;\n * }} options\n * @returns {Promise<{ mediaRecording: Promise<Uint8Array>; stop: () => void }>}\n */\nexport async function captureAudio({ deviceId, channelCount, onStart }) {\n  const stream = await navigator.mediaDevices.getUserMedia({\n    // TODO: support more recording configuration options\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#properties_of_audio_tracks\n    // autoGainControl, echoCancellation, latency, noiseSuppression, volume\n    audio: {\n      deviceId,\n      channelCount,\n      sampleRate: SAMPLE_RATE,\n      echoCancellation: false,\n      // TODO: add advanced controls for these options\n      // @ts-ignore (should be in type)\n      autoGainControl: false,\n      noiseSuppression: false,\n    },\n    video: false,\n  });\n  const audioContext = getRecordingAudioContext();\n  const mediaStreamSourceNode = audioContext.createMediaStreamSource(stream);\n  const { recorderNode, stop } = await createPcmRecorderNode({\n    channelCount,\n    onData,\n    onFinish,\n  });\n  mediaStreamSourceNode.connect(recorderNode);\n  recorderNode.connect(audioContext.destination);\n  onStart();\n\n  const timeLimitSeconds = 10;\n  const maxSamples = timeLimitSeconds * audioContext.sampleRate;\n  let samplesRecorded = 0;\n  /**\n   * @type {Float32Array[][]}\n   */\n  const recordedChunks = Array(channelCount).fill([]);\n\n  /**\n   * @param {Float32Array[]} audioChannels\n   */\n  function onData(audioChannels) {\n    /**\n     * @type {number}\n     */\n    let sampleCount = 0;\n    for (let channel = 0; channel < channelCount; channel++) {\n      const chunk = audioChannels[channel];\n      const chunkSize = chunk.length;\n      const chunkSliced = chunk.slice(\n        0,\n        Math.min(chunkSize, maxSamples - samplesRecorded)\n      );\n      clampOutOfBoundsValues(chunkSliced);\n      if (!sampleCount) {\n        sampleCount = chunkSliced.length;\n      }\n      recordedChunks[channel].push(chunkSliced);\n    }\n    samplesRecorded += sampleCount;\n    // should never be >, but just in case we did something wrong we use >=\n    if (samplesRecorded >= maxSamples) {\n      onFinish();\n      stop();\n    }\n  }\n\n  /**\n   * @type {(wavBuffer: Uint8Array) => void}\n   */\n  let onDone;\n  /**\n   * @type {(error: unknown) => void}\n   */\n  let onError;\n  /**\n   * @type {Promise<Uint8Array>}\n   */\n  const mediaRecording = new Promise((resolve, reject) => {\n    onDone = resolve;\n    onError = reject;\n  });\n  let finished = false;\n\n  function onFinish() {\n    if (finished) {\n      return;\n    }\n\n    // create wav file\n    try {\n      const samples = recordedChunks.map((chunks) => {\n        const merged = new Float32Array(\n          chunks.reduce((len, chunk) => len + chunk.length, 0)\n        );\n        let offset = 0;\n        for (const chunk of chunks) {\n          merged.set(chunk, offset);\n          offset += chunk.length;\n        }\n        return merged;\n      });\n      const wav = new WaveFile();\n      wav.fromScratch(samples.length, audioContext.sampleRate, '32f', samples);\n      const wavBuffer = wav.toBuffer();\n      onDone(wavBuffer);\n    } catch (err) {\n      onError(err);\n    }\n\n    // clean up\n    const tracks = stream.getTracks();\n    for (const track of tracks) {\n      track.stop();\n    }\n    recorderNode.disconnect(audioContext.destination);\n    mediaStreamSourceNode.disconnect(recorderNode);\n    finished = true;\n  }\n\n  return {\n    stop,\n    mediaRecording,\n  };\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { styled } from 'tonami';\n\nimport { getAudioBufferForAudioFileData } from './utils/audioData.js';\nimport { captureAudio, getAudioInputDevices } from './utils/recording.js';\n\nconst SampleRecordDiv = styled.div({\n  padding: '2rem',\n});\n\n/**\n * @type {Map<string, import('./utils/recording').AudioDeviceInfoContainer> | null}\n */\nlet cachedCaptureDevices = null;\n\n/**\n * @typedef {{\n *   onRecordStart: () => void;\n *   onRecordFinish: (audioFileBuffer: Uint8Array, userFile?: File) => void;\n *   onRecordError: (err: unknown) => void;\n * }} MediaRecordingCallbacks\n */\n\n/**\n * @param {MediaRecordingCallbacks} callbacks\n */\nfunction useMediaRecording({ onRecordStart, onRecordFinish, onRecordError }) {\n  const [captureDevices, setCaptureDevices] = useState(cachedCaptureDevices);\n  const [accessState, setAccessState] = useState(\n    /** @type {'pending' | 'ok' | 'denied' | 'unavailable'} */ (\n      captureDevices ? 'ok' : 'pending'\n    )\n  );\n  const [selectedCaptureDeviceId, setSelectedCaptureDeviceId] = useState('');\n  useEffect(() => {\n    cachedCaptureDevices = captureDevices;\n    setAccessState('ok');\n  }, [captureDevices]);\n  const refreshCaptureDevices = useCallback(() => {\n    getAudioInputDevices()\n      .then((devices) => {\n        if (devices.length) {\n          setCaptureDevices(\n            new Map(devices.map((d) => [d.device.deviceId, d]))\n          );\n          setSelectedCaptureDeviceId((id) => id || devices[0].device.deviceId);\n        }\n      })\n      .catch((err) => {\n        if (err instanceof DOMException) {\n          if (err.name === 'NotAllowedError') {\n            setAccessState('denied');\n            return;\n          }\n          if (err.name === 'NotFoundError') {\n            setAccessState('unavailable');\n            return;\n          }\n        }\n        throw err;\n      });\n  }, []);\n  useEffect(refreshCaptureDevices, [refreshCaptureDevices]);\n  const [selectedChannelCount, setSelectedChannelCount] = useState(1);\n  useEffect(() => {\n    const selectedDeviceInfo =\n      captureDevices && captureDevices.get(selectedCaptureDeviceId);\n    if (selectedDeviceInfo) {\n      setSelectedChannelCount(selectedDeviceInfo.channelsAvailable);\n    }\n  }, [captureDevices, selectedCaptureDeviceId]);\n  const [recordingError, setRecordingError] = useState(\n    /** @type {unknown} */ (null)\n  );\n  useEffect(() => {\n    if (recordingError) {\n      onRecordError(recordingError);\n    }\n  }, [recordingError, onRecordError]);\n  // to be set when recording is started\n  const [stop, setStop] = useState({ fn: () => {} });\n  const handleBeginRecording = useCallback(async () => {\n    const { mediaRecording, stop } = await captureAudio({\n      deviceId: selectedCaptureDeviceId,\n      channelCount: selectedChannelCount,\n      onStart: onRecordStart,\n    });\n    setStop({ fn: stop });\n    /**\n     * @type {Uint8Array}\n     */\n    let wavBuffer;\n    try {\n      wavBuffer = await mediaRecording;\n    } catch (err) {\n      setRecordingError(err);\n      return;\n    }\n    onRecordFinish(wavBuffer);\n  }, [\n    selectedCaptureDeviceId,\n    selectedChannelCount,\n    onRecordStart,\n    onRecordFinish,\n  ]);\n  return {\n    captureDevices,\n    accessState,\n    selectedCaptureDeviceId,\n    selectedChannelCount,\n    recordingError,\n    refreshCaptureDevices,\n    setSelectedCaptureDeviceId,\n    setSelectedChannelCount,\n    beginRecording: handleBeginRecording,\n    stopRecording: stop.fn,\n  };\n}\n\n/**\n * @typedef {'ready' | 'capturing' | 'preparing' | 'error' | 'idle'} CaptureState\n */\n\n/**\n * @param {{ captureState: CaptureState } & MediaRecordingCallbacks} props\n */\nfunction SampleRecord({ captureState, ...callbacks }) {\n  const {\n    captureDevices,\n    accessState,\n    selectedCaptureDeviceId,\n    selectedChannelCount,\n    recordingError,\n    refreshCaptureDevices,\n    setSelectedCaptureDeviceId,\n    setSelectedChannelCount,\n    beginRecording,\n    stopRecording,\n  } = useMediaRecording(callbacks);\n\n  return (\n    <SampleRecordDiv>\n      {accessState === 'denied' ? (\n        <p>\n          Looks like you didn't grant access to your audio input device. Please\n          give Volca Sampler access, then{' '}\n          <button type=\"button\" onClick={refreshCaptureDevices}>\n            try again\n          </button>\n        </p>\n      ) : accessState === 'unavailable' ? (\n        <p>\n          Volca Sampler couldn't find any audio input devices. Please connect\n          one, then{' '}\n          <button type=\"button\" onClick={refreshCaptureDevices}>\n            try again\n          </button>\n        </p>\n      ) : (\n        <div>\n          <label>\n            Capture Device\n            <select\n              value={selectedCaptureDeviceId}\n              onChange={(e) => setSelectedCaptureDeviceId(e.target.value)}\n            >\n              {captureDevices && accessState === 'ok' ? (\n                [...captureDevices].map(([id, { device }]) => (\n                  <option key={id} value={id}>\n                    {device.label || id}\n                  </option>\n                ))\n              ) : (\n                <option value=\"\" disabled>\n                  Loading devices...\n                </option>\n              )}\n            </select>\n          </label>\n          <label>\n            Channel count\n            <select\n              value={selectedChannelCount}\n              onChange={(e) => setSelectedChannelCount(Number(e.target.value))}\n            >\n              {[1, 2].map((count) => (\n                <option\n                  key={count}\n                  value={count}\n                  disabled={\n                    !captureDevices ||\n                    !captureDevices.has(selectedCaptureDeviceId) ||\n                    /** @type {import('./utils/recording').AudioDeviceInfoContainer} */ (\n                      captureDevices.get(selectedCaptureDeviceId)\n                    ).channelsAvailable < count\n                  }\n                >\n                  {count}\n                </option>\n              ))}\n            </select>\n          </label>\n        </div>\n      )}\n      <button\n        type=\"button\"\n        onClick={captureState === 'capturing' ? stopRecording : beginRecording}\n        disabled={captureState === 'preparing'}\n      >\n        {['capturing', 'preparing'].includes(captureState) ? 'Stop' : 'Record'}\n      </button>\n      <input\n        type=\"file\"\n        accept=\"audio/*,.wav,.mp3,.ogg\"\n        onChange={(e) => {\n          if (e.target.files && e.target.files.length) {\n            const file = e.target.files[0];\n            file.arrayBuffer().then(async (arrayBuffer) => {\n              const audioFileBuffer = new Uint8Array(arrayBuffer);\n              /**\n               * @type {AudioBuffer}\n               */\n              let audioBuffer;\n              try {\n                audioBuffer = await getAudioBufferForAudioFileData(\n                  audioFileBuffer\n                );\n              } catch (err) {\n                alert('Unsupported audio format detected');\n                return;\n              }\n              if (audioBuffer.length > 10 * audioBuffer.sampleRate) {\n                alert(\n                  'Please select an audio file no more than 10 seconds long'\n                );\n                return;\n              }\n              callbacks.onRecordFinish(audioFileBuffer, file);\n            });\n          }\n        }}\n      />\n      {(captureState === 'error' && recordingError) || null}\n    </SampleRecordDiv>\n  );\n}\n\nexport default SampleRecord;\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { styled } from 'tonami';\n\nimport SampleList from './SampleList.js';\nimport SampleDetail from './SampleDetail.js';\nimport SampleRecord from './SampleRecord.js';\nimport {\n  factorySamples,\n  SampleContainer,\n  storeAudioSourceFile,\n} from './store.js';\n\nconst Title = styled.h1({\n  display: 'flex',\n  alignItems: 'center',\n  padding: '2rem',\n  paddingBottom: '0px',\n  marginBottom: '0px',\n});\n\nconst TitleText = styled.span({\n  color: 'red',\n});\n\nconst TitleR = styled.span({\n  textTransform: 'uppercase',\n  textDecoration: 'underline',\n});\n\nconst TitleGraphic = styled.img({\n  height: '1.6em',\n  paddingLeft: '1rem',\n});\n\nconst MainLayout = styled.div({\n  padding: '2rem',\n  display: 'flex',\n  height: '100%',\n});\n\nconst SampleListContainer = styled.div({\n  width: '200px',\n  flexShrink: 0,\n  paddingRight: '0.5rem',\n  height: '100%',\n});\n\nconst FocusedSampleContainer = styled.div({\n  flexGrow: 1,\n});\n\nfunction App() {\n  const [showingFactorySamples, setShowingFactorySamples] = useState(false);\n  const [samples, setSamples] = useState(\n    /** @type {Map<string, SampleContainer>} */ (new Map())\n  );\n  const [focusedSampleId, setFocusedSampleId] = useState(\n    /** @type {string | null} */ (null)\n  );\n  const [loadingSamples, setLoadingSamples] = useState(true);\n  const [captureState, setCaptureState] = useState(\n    /** @type {import('./SampleRecord').CaptureState} */ ('idle')\n  );\n  const selectedSampleBank = showingFactorySamples ? factorySamples : samples;\n  useEffect(() => {\n    // TODO: error handling\n    SampleContainer.getAllFromStorage()\n      .then((storedSamples) => {\n        setSamples(\n          (samples) =>\n            new Map([\n              ...samples,\n              ...storedSamples.map(\n                (sample) =>\n                  /** @type {[string, SampleContainer]} */ ([sample.id, sample])\n              ),\n            ])\n        );\n        // TODO: automatically set focused sample id to first.. easier with useReducer maybe\n      })\n      .finally(() => {\n        setLoadingSamples(false);\n      });\n  }, []);\n  useEffect(() => {\n    if (\n      selectedSampleBank.size &&\n      !(focusedSampleId && selectedSampleBank.has(focusedSampleId))\n    ) {\n      setFocusedSampleId([...selectedSampleBank.values()][0].id);\n    }\n  }, [selectedSampleBank, focusedSampleId]);\n\n  const handleRecordStart = useCallback(() => setCaptureState('capturing'), []);\n\n  /**\n   * @type {(audioFileBuffer: Uint8Array, userFile?: File) => void}\n   * */\n  const handleRecordFinish = useCallback(async (audioFileBuffer, userFile) => {\n    setCaptureState('preparing');\n    const sourceFileId = await storeAudioSourceFile(audioFileBuffer);\n    /**\n     * @type {string}\n     */\n    let name = '';\n    let userFileExtension = '';\n    if (userFile) {\n      const lastDotIndex = userFile.name.lastIndexOf('.');\n      if (lastDotIndex > 0) {\n        name = userFile.name.slice(0, lastDotIndex);\n        userFileExtension = userFile.name.slice(lastDotIndex);\n      } else {\n        name = userFile.name;\n      }\n    } else {\n      name = 'New one';\n    }\n    const sample = new SampleContainer.Mutable({\n      name,\n      sourceFileId,\n      userFileInfo: userFile && {\n        type: userFile.type,\n        ext: userFileExtension,\n      },\n    });\n    await sample.persist();\n    setSamples((samples) => new Map([[sample.id, sample], ...samples]));\n    setShowingFactorySamples(false);\n    setFocusedSampleId(sample.id);\n    setCaptureState('idle');\n  }, []);\n\n  /**\n   * @type {(err: unknown) => void}\n   * */\n  const handleRecordError = useCallback((err) => {\n    console.error(err);\n    setCaptureState('error');\n  }, []);\n\n  const handleSampleUpdate = useCallback((id, update) => {\n    setSamples((samples) => {\n      const sample = samples.get(id);\n      if (sample && sample instanceof SampleContainer.Mutable) {\n        const updated = sample.update(update);\n        if (updated !== sample) {\n          return new Map(samples).set(sample.id, updated);\n        }\n      }\n      return samples;\n    });\n  }, []);\n\n  return (\n    <div>\n      <Title>\n        <TitleText>\n          Volca Sample\n          <TitleR>r</TitleR>\n        </TitleText>\n        <TitleGraphic src=\"volca_sample.png\" alt=\"\" />\n      </Title>\n      <MainLayout>\n        <select\n          value={JSON.stringify(showingFactorySamples)}\n          onChange={(e) => setShowingFactorySamples(JSON.parse(e.target.value))}\n        >\n          <option value=\"false\">Your Samples</option>\n          <option value=\"true\">Factory Samples</option>\n        </select>\n        <SampleListContainer>\n          {loadingSamples ? 'Loading...' : null}\n          <SampleList\n            samples={selectedSampleBank}\n            selectedSampleId={captureState === 'idle' ? focusedSampleId : null}\n            readonly={['capturing', 'preparing'].includes(captureState)}\n            onNewSample={() => setCaptureState('ready')}\n            onSampleSelect={(id) => {\n              setFocusedSampleId(id);\n              setCaptureState('idle');\n            }}\n          />\n        </SampleListContainer>\n        <FocusedSampleContainer>\n          {captureState === 'idle' && (\n            <SampleDetail\n              sample={\n                (focusedSampleId && selectedSampleBank.get(focusedSampleId)) ||\n                null\n              }\n              onSampleUpdate={handleSampleUpdate}\n              onSampleDuplicate={(id) => {\n                const sample = selectedSampleBank.get(id);\n                if (sample) {\n                  const newSample = sample.duplicate();\n                  setSamples(\n                    (samples) =>\n                      new Map([[newSample.id, newSample], ...samples])\n                  );\n                  setShowingFactorySamples(false);\n                  // TODO: scroll new sample into view\n                  setFocusedSampleId(newSample.id);\n                }\n              }}\n              onSampleDelete={(id) => {\n                const sample = selectedSampleBank.get(id);\n                if (sample && sample instanceof SampleContainer.Mutable) {\n                  sample.remove();\n                  setSamples((samples) => {\n                    const newSamples = new Map(samples);\n                    newSamples.delete(sample.id);\n                    return newSamples;\n                  });\n                }\n              }}\n            />\n          )}\n          {captureState !== 'idle' && (\n            <SampleRecord\n              captureState={captureState}\n              onRecordStart={handleRecordStart}\n              onRecordFinish={handleRecordFinish}\n              onRecordError={handleRecordError}\n            />\n          )}\n        </FocusedSampleContainer>\n      </MainLayout>\n    </div>\n  );\n}\n\nexport default App;\n","/**\n * @param {import('web-vitals').ReportHandler} [onPerfEntry]\n */\nconst reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App.js';\nimport reportWebVitals from './reportWebVitals.js';\nimport { AudioPlaybackContextProvider } from './utils/audioData';\n\nReactDOM.render(\n  <React.StrictMode>\n    <AudioPlaybackContextProvider>\n      <App />\n    </AudioPlaybackContextProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}