(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{64:function(Ne,le,O){},75:function(Ne,le,O){"use strict";O.r(le);var d=O(0),i=O.n(d),Ve=O(14),ze=O.n(Ve),pa=O(64),A=O(6);const He=A.a.h1({display:"flex",alignItems:"center",padding:"2rem 1rem 1rem",marginBottom:"0px",backgroundColor:"#f3f3f3",borderBottom:"1px solid #ccc",position:"sticky",top:0}),Ue=A.a.span({marginRight:"1rem",cursor:"pointer"}),Xe=A.a.span({color:"red",whiteSpace:"nowrap"}),$e=A.a.span({textTransform:"uppercase",textDecoration:"underline"}),Ge=A.a.img({height:"1.6em",paddingLeft:"1rem"});function Ye({onMenuOpen:e}){return i.a.createElement(He,null,i.a.createElement(Ue,{onClick:e},"\u2630"),i.a.createElement(Xe,null,"Volca Sample",i.a.createElement($e,null,"r")),i.a.createElement(Ge,{src:"volca_sample.png",alt:""}))}var Ke=Ye,L=O(87),Je=O(52),Qe=O.n(Je),Ze=O(36),N=O.n(Ze),ie=O(88),ce=O(51);const V=31250;var qe=Object.defineProperty,_e=Object.defineProperties,et=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,Z=(e,t,a)=>t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,F=(e,t)=>{for(var a in t||(t={}))se.call(t,a)&&Z(e,a,t[a]);if(z)for(var a of z(t))ue.call(t,a)&&Z(e,a,t[a]);return e},W=(e,t)=>_e(e,et(t)),de=(e,t)=>{var a={};for(var n in e)se.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&z)for(var n of z(e))t.indexOf(n)<0&&ue.call(e,n)&&(a[n]=e[n]);return a},H=(e,t,a)=>(Z(e,typeof t!="symbol"?t+"":t,a),a),I=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const U=N.a.createInstance({name:"audio_file_data",driver:N.a.INDEXEDDB}),X=N.a.createInstance({name:"sample_metadata",driver:N.a.INDEXEDDB});function tt(e){return I(this,null,function*(){const t=Object(ie.a)();return yield U.setItem(t,e),t})}const q="0.3.0",at={"0.1.0":e=>{const t=e,{clip:a}=t,n=de(t,["clip"]);return W(F({},n),{trimFrames:a.map(o=>Math.round(o*V)),metadataVersion:"0.2.0"})},"0.2.0":e=>I(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=de(t,["trimFrames"]),l=yield Ce(n.sourceFileId,a),o={frames:a,waveformPeaks:l};return W(F({},n),{trim:o,metadataVersion:"0.3.0"})})};function nt(e){return I(this,null,function*(){let t=e;for(;t.metadataVersion!==q;){const a=at[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:q};break}t=yield a(t)}return t})}const R=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(ie.a)(),userFileInfo:l=null,slotNumber:o=0,dateSampled:s=Date.now(),dateModified:c=s,useCompression:r=!0,qualityBitDepth:u=16,scaleCoefficient:S=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:l,slotNumber:o,dateSampled:s,dateModified:c,useCompression:r,qualityBitDepth:u,scaleCoefficient:S,metadataVersion:q}}duplicate(){const e=new R.Mutable(W(F({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return I(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),l=new Uint8Array(n);return this.cacheSourceFileData(e,l),l}const t=yield U.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return I(this,null,function*(){const e=[];return yield X.iterate((a,n)=>{a&&e.push(nt(a).then(l=>[n,l]))}),new Map(yield Promise.all(e))})}static getAllFromStorage(){return I(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield fe(),a=(yield U.keys()).concat(t.map(({sourceFileId:l})=>l));return[...e].map(([l,o])=>{const{sourceFileId:s}=o;return a.includes(s)?new R.Mutable(F({id:l},o)):(console.warn(`Found metadata "${o.name||l}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort((l,o)=>o.metadata.dateModified-l.metadata.dateModified)})}};let B=R;H(B,"Mutable",class extends R{constructor(e){super(e);setTimeout(()=>I(this,null,function*(){(yield X.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return I(this,null,function*(){yield X.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this;if(Object.keys(e).every(o=>e[o]===a[o]))return this;const n=W(F(F({},a),e),{dateModified:Date.now()}),l=new R.Mutable(F({id:t},n));return l.persist(),l}remove(){return I(this,null,function*(){if(yield X.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield R.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield U.removeItem(this.metadata.sourceFileId)})}}),H(B,"sourceFileData",new Map),H(B,"recentlyCachedSourceFileIds",[]),H(B,"MAX_CACHED",10);let _;function fe(){return _||(_=fetch("factory-samples.json").then(e=>e.json())),_}function rt(){return I(this,null,function*(){const e=yield fe();return new Map(e.map(t=>[t.id,new B(W(F({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(ce.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(ce.a)(t.trim.waveformPeaks.negative))}}}))]))})}var me=Math.pow,ee=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});function te(e,t){const a=4,n=t[0]*a,l=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,l)}function ae(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),l=Array(e.numberOfChannels).fill().map((o,s)=>te(e.getChannelData(s),t));for(let o=0;o<a;o++){let s=0;for(let c=0;c<l.length;c++)s+=l[c][o];s/=l.length,n[o]=s}return n}function ot(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function lt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function it(e,t){const a=me(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function pe(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function ct(e){const t=new Int16Array(e.length),a=me(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function he(){return window.AudioContext||window.webkitAudioContext}let ve;function ye(){const e=he();return ve=ve||new e({sampleRate:V})}function $(e){return ee(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,l)=>{ye().decodeAudioData(t.buffer,n,l)})})}function G(e,t){return ee(this,null,function*(){const a=yield B.getSourceFileData(e),n=yield $(a);if(t)for(let l=0;l<n.numberOfChannels;l++)pe(n.getChannelData(l));return n})}function ge(e){return ee(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:l,trim:{frames:o}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const s=yield G(a,Boolean(n)),c=s.numberOfChannels===1?te(s.getChannelData(0),o):ae(s,o);l!==1&&lt(c,l),t<16&&it(c,t);const r=ct(c),u=r.length*2,S=Qe()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:u}),b=new Uint8Array(S.length+u);return b.set(S),b.set(new Uint8Array(r.buffer),S.length),{data:b,sampleRate:16}})}const st={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},be=Object(d.createContext)(st);function ut({children:e}){const[t,a]=Object(d.useState)(!1),n=Object(d.useCallback)((o,{onTimeUpdate:s=()=>null,onEnded:c=()=>null}={})=>{if(t)throw new Error("Wait until audio playback has finished to start new playback");a(!0);let r,u;try{r=ye(),u=r.createBufferSource(),u.buffer=o,u.connect(r.destination),u.start()}catch(f){throw a(!1),f}const S=r.currentTime;s(0);let b=requestAnimationFrame(C);function C(){s(r.currentTime-S),b=requestAnimationFrame(C)}let P=!1;return u.addEventListener("ended",()=>{P||(s(o.duration),c()),a(!1),cancelAnimationFrame(b)}),function(){u.stop(),P=!0}},[t]),l=Object(d.useMemo)(()=>({playAudioBuffer:n,isAudioBusy:t}),[n,t]);return Object(d.createElement)(be.Provider,{value:l},e)}function we(){return Object(d.useContext)(be)}var dt=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const T=6,Se=T*44;function Ee(e,t){const a=Math.floor(T*e.length/t),n=new Float32Array(Math.floor(e.length/a)),l=new Float32Array(Math.floor(e.length/a));for(let o=0;o<n.length;o++){const s=new Float32Array(e.buffer,o*a*4,a);let c=0,r=0;for(const u of s)u>c&&(c=u),u<r&&(r=u);n[o]=Math.min(1,c),l[o]=Math.max(-1,r)}return{positive:n,negative:l}}function Ce(e,t){return dt(this,null,function*(){const a=yield G(e,!1),n=ae(a,t);return Ee(n,Se)})}var ft=O(53);const mt=A.a.canvas({width:"100%",height:"100%",display:"block"});function pt(e,t){function a(l,o){e.width=l,e.height=o}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new ft.a(([l])=>{const{width:o,height:s}=l.contentRect;a(o,s),t({width:o,height:s})});return n.observe(e),()=>n.disconnect()}function ht(e,t,a){const n=e.getContext("2d"),{width:l,height:o}=e;n.clearRect(0,0,l,o);const s=Math.floor(o*(2/3))+1;n.fillStyle="red",t.positive.forEach((r,u)=>{const S=s*r,b=Math.max(Math.round(a*S),1);n.fillRect(u*T,s-b,T-1,b)});const c=o-s;n.fillStyle="darkred",t.negative.forEach((r,u)=>{const S=c*r*-1,b=Math.round(a*S);n.fillRect(u*T,s,T-1,b)})}function vt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(d.useRef)(null);Object(d.useImperativeHandle)(a,()=>n.current);const[l,o]=Object(d.useState)(Symbol()),s=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return s.current.width=n.current.offsetWidth,s.current.height=n.current.offsetHeight,pt(n.current,({width:c,height:r})=>{(c!==s.current.width||r!==s.current.height)&&(o(Symbol()),s.current.width=c,s.current.height=r)})},[]),Object(d.useLayoutEffect)(()=>{const c=n.current;if(!c)throw new Error("Canvas should be defined");let r=requestAnimationFrame(()=>{r=requestAnimationFrame(()=>{ht(c,e,t)})});return()=>cancelAnimationFrame(r)},[e,t,l]),i.a.createElement(mt,{ref:n})}var Oe=vt;const yt=A.a.div({width:`${Se}px`,height:"40px"}),Pe=typeof IntersectionObserver!="undefined",gt=i.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(d.useRef)(null),[l,o]=Object(d.useState)(!Pe);return Object(d.useLayoutEffect)(()=>{if(!Pe)return;const s=n.current;if(!s)throw new Error("Waveform container should be defined");const c=s.getBoundingClientRect();if(c.top+c.height>=0&&c.bottom-c.height<=window.innerHeight){o(!0);return}const r=new IntersectionObserver(([u])=>{u.isIntersecting&&(o(!0),r.unobserve(s))});return r.observe(s),()=>r.disconnect()},[]),i.a.createElement(L.a.Item,{active:t,onClick:()=>a(e.id)},i.a.createElement("div",null,e.metadata.name),i.a.createElement(yt,{ref:n},l&&i.a.createElement(Oe,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function bt({samples:e,selectedSampleId:t,onSampleSelect:a}){return i.a.createElement(L.a,{variant:"flush"},[...e].map(([n,l])=>i.a.createElement(gt,{key:n,sample:l,selected:n===t,onSampleSelect:a})))}var De=bt,M=O(54),wt=Object.defineProperty,St=Object.defineProperties,Et=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,je=(e,t,a)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ct=(e,t)=>{for(var a in t||(t={}))Ae.call(t,a)&&je(e,a,t[a]);if(Y)for(var a of Y(t))Me.call(t,a)&&je(e,a,t[a]);return e},Ot=(e,t)=>St(e,Et(t)),Pt=(e,t)=>{var a={};for(var n in e)Ae.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&Y)for(var n of Y(e))t.indexOf(n)<0&&Me.call(e,n)&&(a[n]=e[n]);return a},Dt=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const ha=A.a.input({position:"absolute"});function At({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:t},scaleCoefficient:a}},onSetTrimFrames:n,onSetScaleCoefficient:l}){const o=Object(d.useMemo)(()=>e?ae(e,[0,0]):new Float32Array,[e]),[s,c]=Object(d.useState)(null),r=Object(d.useMemo)(()=>s&&s.offsetWidth,[s]),u=Object(d.useMemo)(()=>!r||!o.length?{positive:new Float32Array,negative:new Float32Array}:Ee(o,r),[r,o]),S=Object(d.useMemo)(()=>{if(!e)return 0;const p=te(o,t);return ot(p)},[e,o,t]),b=1/S;Object(d.useLayoutEffect)(()=>{a>b&&l(b)},[a,b,l]);const C=a*S,P=Object(d.useMemo)(()=>{if(!o.length||!r)return[0,0];const p=r/o.length;return t.map(v=>v*p)},[r,o.length,t]),f=Object(d.useRef)(null),m=Object(d.useRef)(null);return Object(d.useEffect)(()=>{function p(g){if(f.current===null||!r||!o.length)return;const{pageX:y}=g,h=y-f.current;if(h){const w=h/r,E=Math.round(o.length*w);n(k=>{let D=k[0]+E;return D=Math.min(D,o.length-k[1]-2e3),D=Math.max(D,0),[D,k[1]]}),f.current=y}}function v(){f.current=null,delete document.body.style.userSelect}return window.addEventListener("mousemove",p),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",v)}},[r,o.length,n]),Object(d.useEffect)(()=>{function p(g){if(m.current===null||!r||!o.length)return;const{pageX:y}=g,h=m.current-y;if(h){const w=h/r,E=Math.round(o.length*w);n(k=>{let D=k[1]+E;return D=Math.min(D,o.length-k[0]-2e3),D=Math.max(D,0),[k[0],D]}),m.current=y}}function v(){m.current=null,delete document.body.style.userSelect}return window.addEventListener("mousemove",p),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",v)}},[r,o.length,n]),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},i.a.createElement(M.a,{type:"button",variant:"light",disabled:a===b,onClick:()=>l(b)},"Normalize")," ",i.a.createElement(M.a,{type:"button",variant:"light",disabled:a===1,onClick:()=>l(1)},"Original level"))),i.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},i.a.createElement(Oe,{waveformRef:c,peaks:u,scaleCoefficient:a}),i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${P[0]}px)`,background:"#f3f3f3"}},i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"black"}}),i.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(50%)"},onTouchStart:p=>{p.preventDefault(),document.body.style.userSelect="none",f.current=p.touches[0].pageX},onMouseDown:p=>{document.body.style.userSelect="none",f.current=p.pageX},onTouchMove:p=>{if(p.preventDefault(),f.current===null||!r||!o.length)return;const{pageX:v}=p.touches[0],g=v-f.current;if(g){const y=g/r,h=Math.round(o.length*y);n(w=>{let E=w[0]+h;return E=Math.min(E,o.length-w[1]-2e3),E=Math.max(E,0),[E,w[1]]}),f.current=v}},onTouchEnd:()=>{f.current=null},onTouchCancel:()=>{f.current=null}})),i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${P[1]}px)`,background:"#f3f3f3"}},i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"black"}}),i.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:p=>{p.preventDefault(),document.body.style.userSelect="none",m.current=p.touches[0].pageX},onMouseDown:p=>{document.body.style.userSelect="none",m.current=p.pageX},onTouchMove:p=>{if(p.preventDefault(),m.current===null||!r||!o.length)return;const{pageX:v}=p.touches[0],g=m.current-v;if(g){const y=g/r,h=Math.round(o.length*y);n(w=>{let E=w[1]+h;return E=Math.min(E,o.length-w[0]-2e3),E=Math.max(E,0),[w[0],E]}),m.current=v}},onTouchEnd:()=>{m.current=null},onTouchCancel:()=>{m.current=null}}))))}function Mt(e){var t=e,{sample:a}=t,n=Pt(t,["sample"]);const[l,o]=Object(d.useState)(null);Object(d.useEffect)(()=>{let c=!1;return(()=>Dt(this,null,function*(){if(c)return;const r=yield G(a.metadata.sourceFileId,Boolean(a.metadata.userFileInfo));c||o([a.metadata.sourceFileId,r])}))(),()=>{c=!0}},[a.metadata.sourceFileId,a.metadata.userFileInfo]);const s=Object(d.useRef)(a);return l&&a.metadata.sourceFileId===l[0]&&(s.current=a),i.a.createElement(At,Ot(Ct({},n),{sample:s.current,sourceAudioBuffer:l&&l[1]}))}var jt=Mt,kt=O(89),Bt=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});let ke;function It(){return Bt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return ke=ke||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(l){return e.addFunction(l,"vi")},unregisterUpdateCallback(l){e.removeFunction(l)},heap8Buffer(){return e.HEAP8.buffer}}}catch(l){a(l);return}t(n)})})}var Ft=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});function xt(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Ft(this,null,function*(){const{prepareSampleBufferFromWavData:l,getSampleBufferChunkPointer:o,getSampleBufferChunkSize:s,getSampleBufferProgress:c,getSampleBufferTotalSize:r,cancelSampleBufferWork:u,registerUpdateCallback:S,unregisterUpdateCallback:b,heap8Buffer:C}=yield It();if(a)return new Uint8Array;const{data:P}=yield ge(e);if(a)return new Uint8Array;let f,m=0;const p=S(g=>{if(a)return;const y=r(g);f||(f=new Uint8Array(y));const h=o(g),w=s(g),E=c(g);f.set(new Uint8Array(C(),h,w),E-w),m=E/y}),v=l(P,P.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,p);t(m);try{yield new Promise(g=>{let y;n=()=>{cancelAnimationFrame(y),u(v),g()},h();function h(){if(m&&(t(m),m>=1)){g();return}y=requestAnimationFrame(h)}})}finally{n=()=>{},b(p)}if(a)return new Uint8Array;if(!f)throw new Error("Unexpected condition: sampleBuffer should be defined");return f}))()}}var Rt=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});function Tt({sample:e}){const[t,a]=Object(d.useState)(0),[n,l]=Object(d.useState)("idle"),[o,s]=Object(d.useState)(null),[c,r]=Object(d.useState)(null);Object(d.useEffect)(()=>{o instanceof AudioBuffer&&c&&(r(null),c.fn())},[o,c]);const u=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let C=!1;a(0),l("idle"),s(null),r(null),u.current=()=>{C=!0};try{const{sampleBufferPromise:P,cancelWork:f}=xt(e,m=>{C||a(m)});u.current=()=>{f(),C=!0},P.then(m=>Rt(this,null,function*(){if(C)return;u.current=()=>{C=!0};const p=yield $(m);C||s(p)}))}catch(P){console.error(P),s(new Error(String(P)))}return()=>u.current()},[e]);const{playAudioBuffer:S,isAudioBusy:b}=we();return i.a.createElement(i.a.Fragment,null,i.a.createElement(M.a,{type:"button",variant:"primary",onClick:C=>{const P=C.currentTarget;if(!(o instanceof AudioBuffer)){o||r({fn:()=>P.click()});return}try{l("transferring");const f=S(o,{onTimeUpdate:m=>a(m/o.duration),onEnded:()=>l("idle")});u.current=()=>{f(),l("idle")}}catch(f){console.error(f),l("error")}},disabled:b||o instanceof Error||n==="transferring"},"Transfer to volca sample"),i.a.createElement("br",null),o&&n==="idle"?null:n==="error"?"Error transferring":i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,o?o instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),i.a.createElement(kt.a,{now:100*t}),i.a.createElement("br",null),i.a.createElement(M.a,{type:"button",variant:"light",onClick:()=>u.current()},"Cancel")),i.a.createElement("br",null))}var Wt=Tt,Lt=O(82),Nt=O(83),K=O(58),j=O(85),Vt=Object.defineProperty,zt=Object.defineProperties,Ht=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,Ut=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable,Ie=(e,t,a)=>t in e?Vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Fe=(e,t)=>{for(var a in t||(t={}))Ut.call(t,a)&&Ie(e,a,t[a]);if(Be)for(var a of Be(t))Xt.call(t,a)&&Ie(e,a,t[a]);return e},xe=(e,t)=>zt(e,Ht(t)),$t=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const Gt=A.a.div({height:"200px",maxWidth:"400px"});function Yt(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function Kt({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const[l,o]=Object(d.useState)(0),s=e&&e.metadata.sourceFileId;Object(d.useEffect)(()=>{o(0),s&&G(s,!1).then(y=>o(y.length))},[s]);const c=e&&e.id,r=Object(d.useCallback)(y=>c&&t(c,{scaleCoefficient:y}),[c,t]),u=Object(d.useCallback)(y=>c&&t(c,h=>xe(Fe({},h),{trim:xe(Fe({},h.trim),{frames:y(h.trim.frames)})})),[c,t]),[S,b]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(b(null),e){let y=!1;ge(e).then(({data:h})=>{y||b(h)})}},[e]);const[C,P]=Object(d.useState)(null);Object(d.useEffect)(()=>{if(P(null),S){let y=!1;$(S).then(h=>{y||P(h)})}},[S]);const{playAudioBuffer:f,isAudioBusy:m}=we(),p=Object(d.useRef)(()=>{});if(Object(d.useEffect)(()=>()=>p.current(),[e]),!e)return null;const v=Math.max(0,l-e.metadata.trim.frames[1]),g=Math.max(0,l-e.metadata.trim.frames[0]);return i.a.createElement(Lt.a,{fluid:"sm"},i.a.createElement("h2",null,e.metadata.name,i.a.createElement(Nt.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},i.a.createElement(K.a.Item,{onClick:()=>{const y=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),h=y&&y.trim();h&&t(e.id,{name:h})}},"Rename"),i.a.createElement(K.a.Item,{onClick:()=>a(e.id)},"Duplicate"),i.a.createElement(K.a.Divider,null),i.a.createElement(K.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),i.a.createElement("p",null,i.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),i.a.createElement("br",null),i.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(Gt,null,i.a.createElement(jt,{onSetTrimFrames:u,onSetScaleCoefficient:r,sample:e})),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(M.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>{C&&(p.current=f(C))},disabled:m||!C},"Play audio preview")," ",i.a.createElement(M.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>$t(this,null,function*(){const{sourceFileId:y,userFileInfo:h}=e.metadata,w=yield B.getSourceFileData(y),E=new Blob([w],{type:h?h.type:"audio/x-wav"});Yt(E,`${e.metadata.name}${h?h.ext:".wav"}`)})},"Download original file"),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(j.a.Group,null,i.a.createElement(j.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),i.a.createElement(j.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:y=>{const h=Number(y.target.value);t(e.id,{qualityBitDepth:h})}})),i.a.createElement(j.a.Group,null,i.a.createElement(j.a.Label,null,"Slot number"),i.a.createElement(j.a.Control,{type:"number",value:e.metadata.slotNumber,step:1,min:0,max:99,onChange:y=>{const h=Number(y.target.value);t(e.id,{slotNumber:h})}})),i.a.createElement("br",null),i.a.createElement(Wt,{sample:e}))}var Jt=Kt,Qt=O(59),Zt=O(57),J=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});let Re;function ne(){const e=he();return Re=Re||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:V}:{})}function qt(){return J(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const l of n.getTracks())l.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),o=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:c})=>n.deviceId===c).label,s=l.getAudioTracks().length;for(const c of l.getTracks())c.stop();a.push({device:{deviceId:n.deviceId,label:o},channelsAvailable:s})}return a})}let re;function _t(e){return J(this,arguments,function*({onData:t,onFinish:a}){const n=ne();re=re||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield re;const l=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});l.port.onmessage=s=>{if(s.data.eventType==="data"){const c=s.data.audioChannels;t(c)}s.data.eventType==="stop"&&a()};const o=l.parameters.get("isRecording");return o.setValueAtTime(1,n.currentTime),{recorderNode:l,stop(){o.setValueAtTime(0,n.currentTime)}}})}function ea({channelCount:e,onData:t,onFinish:a}){const l=ne().createScriptProcessor(1024,e,e);let o=!1;return l.onaudioprocess=s=>{const c=Array(e).fill().map((r,u)=>s.inputBuffer.getChannelData(u));t(c),o&&a()},{recorderNode:l,stop(){o=!0}}}function ta(e){return J(this,null,function*(){return typeof AudioWorkletNode=="undefined"?ea(e):yield _t(e)})}function aa(e){return J(this,arguments,function*({deviceId:t,channelCount:a,onStart:n}){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:V,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),o=ne(),s=o.createMediaStreamSource(l),{recorderNode:c,stop:r}=yield ta({channelCount:a,onData:P,onFinish:g});s.connect(c),c.connect(o.destination),n();const S=10*o.sampleRate;let b=0;const C=Array(a).fill([]);function P(y){let h=0;for(let w=0;w<a;w++){const E=y[w],k=E.length,D=E.slice(0,Math.min(k,S-b));pe(D),h||(h=D.length),C[w].push(D)}b+=h,b>=S&&(g(),r())}let f,m;const p=new Promise((y,h)=>{f=y,m=h});let v=!1;function g(){if(v)return;try{const h=C.map(k=>{const D=new Float32Array(k.reduce((Q,ma)=>Q+ma.length,0));let Le=0;for(const Q of k)D.set(Q,Le),Le+=Q.length;return D}),w=new Zt.a;w.fromScratch(h.length,o.sampleRate,"32f",h);const E=w.toBuffer();f(E)}catch(h){m(h)}const y=l.getTracks();for(const h of y)h.stop();c.disconnect(o.destination),s.disconnect(c),v=!0}return{stop:r,mediaRecording:p}})}var Te=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const na=A.a.div({});let We=null;function ra(e){const[t,a]=Object(d.useState)(We),[n,l]=Object(d.useState)(t?"ok":"pending"),[o,s]=Object(d.useState)("");Object(d.useEffect)(()=>{We=t,l("ok")},[t]);const c=Object(d.useCallback)(()=>{let v=!1;return qt().then(g=>{v||g.length&&(a(new Map(g.map(y=>[y.device.deviceId,y]))),s(y=>y||g[0].device.deviceId))}).catch(g=>{if(!v){if(g instanceof DOMException){if(g.name==="NotAllowedError"){l("denied");return}if(g.name==="NotFoundError"){l("unavailable");return}}throw g}}),()=>{v=!0}},[]);Object(d.useEffect)(c,[c]);const[r,u]=Object(d.useState)(1);Object(d.useEffect)(()=>{const v=t&&t.get(o);v&&u(v.channelsAvailable)},[t,o]);const[S,b]=Object(d.useState)("ready"),[C,P]=Object(d.useState)(null),[f,m]=Object(d.useState)({fn(v){}}),p=Object(d.useCallback)(()=>Te(this,null,function*(){let v=!1;const{mediaRecording:g,stop:y}=yield aa({deviceId:o,channelCount:r,onStart:()=>b("capturing")});m({fn(w){y(),w&&(v=!0)}});let h;try{h=yield g}catch(w){P(w),b("error");return}v?b("ready"):(b("finalizing"),e(h))}),[o,r,e]);return{captureDevices:t,accessState:n,selectedCaptureDeviceId:o,selectedChannelCount:r,captureState:S,recordingError:C,refreshCaptureDevices:c,setSelectedCaptureDeviceId:s,setSelectedChannelCount:u,beginRecording:p,stopRecording:f.fn}}function oa({onRecordFinish:e}){const{captureDevices:t,accessState:a,selectedCaptureDeviceId:n,selectedChannelCount:l,captureState:o,recordingError:s,refreshCaptureDevices:c,setSelectedCaptureDeviceId:r,setSelectedChannelCount:u,beginRecording:S,stopRecording:b}=ra(e),[C,P]=Object(d.useState)(!1);return i.a.createElement(na,null,a==="denied"?i.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",i.a.createElement(M.a,{type:"button",variant:"secondary",onClick:c},"try again")):a==="unavailable"?i.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",i.a.createElement(M.a,{type:"button",variant:"secondary",onClick:c},"try again")):i.a.createElement("div",null,i.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),i.a.createElement(M.a,{type:"button",variant:o==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:o==="capturing"?()=>b():S,disabled:o==="finalizing"},["capturing","finalizing"].includes(o)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(o)?i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(M.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>b(!0)},"Cancel")):i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement(M.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>P(f=>!f)},"Audio input settings ",C?"\u25B2":"\u25BC"),i.a.createElement(Qt.a,{in:C},i.a.createElement("div",null,i.a.createElement(j.a.Group,null,i.a.createElement(j.a.Label,null,"Capture Device"),i.a.createElement(j.a.Select,{style:{width:250},value:n,onChange:f=>r(f.target.value)},t&&a==="ok"?[...t].map(([f,{device:m}])=>i.a.createElement("option",{key:f,value:f},m.label||f)):i.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),i.a.createElement(j.a.Group,null,i.a.createElement(j.a.Label,null,"Input channels"),i.a.createElement(j.a.Select,{style:{width:250},value:l,onChange:f=>u(Number(f.target.value))},[1,2].map(f=>i.a.createElement("option",{key:f,value:f,disabled:!t||!t.has(n)||t.get(n).channelsAvailable<f},f===1?"Mono":"Stereo (summed to mono)")))),i.a.createElement("br",null))),i.a.createElement("br",null),i.a.createElement(M.a,{style:{width:250},type:"button",variant:"secondary",onClick:f=>{const m=f.currentTarget.querySelector("input");m&&f.target!==m&&m.click()}},"Or import an audio file",i.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:f=>{if(f.target.files&&f.target.files.length){const m=f.target.files[0];m.arrayBuffer().then(p=>Te(this,null,function*(){const v=new Uint8Array(p);let g;try{g=yield $(v)}catch(y){alert("Unsupported audio format detected");return}if(g.length>10*g.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(v,m)}))}}})))),o==="error"&&s||null)}var la=oa,oe=O(84),x=O(86),ia=(e,t,a)=>new Promise((n,l)=>{var o=r=>{try{c(a.next(r))}catch(u){l(u)}},s=r=>{try{c(a.throw(r))}catch(u){l(u)}},c=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,s);c((a=a.apply(e,t)).next())});const ca=A.a.div({padding:"2rem",display:"flex",height:"100%"}),sa=A.a.div({flexGrow:1});function ua(){const[e,t]=Object(d.useState)(new Map),[a,n]=Object(d.useState)(new Map),l=Object(d.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(d.useEffect)(()=>{rt().then(n).catch(console.error)},[]);const[o,s]=Object(d.useState)(null),[c,r]=Object(d.useState)(!0);Object(d.useEffect)(()=>{B.getAllFromStorage().then(f=>{t(m=>new Map([...m,...f.map(p=>[p.id,p])]))}).finally(()=>{r(!1)})},[]);const u=Object(d.useCallback)((f,m)=>ia(this,null,function*(){const p=yield tt(f);let v="",g="";if(m){const E=m.name.lastIndexOf(".");E>0?(v=m.name.slice(0,E),g=m.name.slice(E)):v=m.name}else v="New sample";const y=[0,0],h=yield Ce(p,y),w=new B.Mutable({name:v,sourceFileId:p,trim:{frames:y,waveformPeaks:h},userFileInfo:m&&{type:m.type,ext:g}});yield w.persist(),t(E=>new Map([[w.id,w],...E])),s(w.id)}),[]),S=Object(d.useCallback)((f,m)=>{t(p=>{const v=p.get(f);if(v&&v instanceof B.Mutable){const g=v.update(typeof m=="function"?m(v.metadata):m);if(g!==v)return new Map(p).set(v.id,g)}return p})},[]),[b,C]=Object(d.useState)(!1),P=Object(d.useCallback)(f=>{s(f),C(!1)},[]);return i.a.createElement("div",null,i.a.createElement(Ke,{onMenuOpen:()=>C(!0)}),i.a.createElement(oe.a,{show:b,onHide:()=>C(!1)},i.a.createElement(oe.a.Header,{closeButton:!0}),i.a.createElement(oe.a.Body,null,i.a.createElement(L.a,null,i.a.createElement(L.a.Item,{as:"button",onClick:()=>P(null)},"New Sample"),c?"Loading...":null,!c&&i.a.createElement(x.a,{defaultActiveKey:e.size?"user":"factory"},i.a.createElement(x.a.Item,{eventKey:"user"},i.a.createElement(x.a.Header,null,"Your Samples"),i.a.createElement(x.a.Body,{style:{padding:0}},i.a.createElement(De,{samples:e,selectedSampleId:o,onSampleSelect:P}))),i.a.createElement(x.a.Item,{eventKey:"factory"},i.a.createElement(x.a.Header,null,"Factory Samples"),i.a.createElement(x.a.Body,{style:{padding:0}},i.a.createElement(De,{samples:a,selectedSampleId:o,onSampleSelect:P}))))))),i.a.createElement(ca,null,i.a.createElement(sa,null,o&&i.a.createElement(Jt,{sample:l.get(o)||null,onSampleUpdate:S,onSampleDuplicate:f=>{const m=l.get(f);if(m){const p=m.duplicate();t(v=>new Map([[p.id,p],...v])),s(p.id)}},onSampleDelete:f=>{const m=l.get(f);m&&m instanceof B.Mutable&&(m.remove(),t(p=>{const v=new Map(p);return v.delete(m.id),v}))}}),!o&&i.a.createElement(la,{onRecordFinish:u}))))}var da=ua,fa=e=>{e&&e instanceof Function&&O.e(3).then(O.bind(null,90)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:l,getTTFB:o})=>{t(e),a(e),n(e),l(e),o(e)})};ze.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(ut,null,i.a.createElement(da,null))),document.getElementById("root")),fa()}},[[75,1,2]]]);

//# sourceMappingURL=main.8480529f.chunk.js.map