(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{16:function(L,H,C){L.exports={title:"Header_title__R3bRx",menuIcon:"Header_menuIcon__swn7p",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleGraphicContainer:"Header_titleGraphicContainer__28hyH",titleGraphic:"Header_titleGraphic__3S89F"}},65:function(L,H,C){},66:function(L,H,C){},77:function(L,H,C){"use strict";C.r(H);var d=C(0),c=C.n(d),ze=C(14),Ue=C.n(ze),fa=C(65),ma=C(66),R=C(11),Ge=C(16),B=C.n(Ge);function Xe({onMenuOpen:e,onHeaderClick:t}){return c.a.createElement("h1",{className:B.a.title,onClick:t},c.a.createElement("span",{className:B.a.menuIcon,onClick:a=>{a.stopPropagation(),e()}},"\u2630"),c.a.createElement("span",{className:B.a.titleText,"data-text":"Volca Sample"},"Volca Sample",c.a.createElement("span",{className:B.a.titleR},"r")),c.a.createElement("div",{className:B.a.titleGraphicContainer},c.a.createElement("img",{className:B.a.titleGraphic,src:"volca_sample.png",alt:""}),c.a.createElement("img",{className:B.a.titleGraphic,src:"volca_sample.png",alt:""}),c.a.createElement("img",{className:B.a.titleGraphic,src:"volca_sample.png",alt:""}),c.a.createElement("img",{className:B.a.titleGraphic,src:"volca_sample.png",alt:""})))}var $e=Xe,V=C(89),Je=C(53),Ke=C.n(Je),Ye=C(37),z=C.n(Ye),se=C(90),ue=C(52);const U=31250;var Qe=Object.defineProperty,Ze=Object.defineProperties,_e=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,de=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,q=(e,t,a)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,I=(e,t)=>{for(var a in t||(t={}))de.call(t,a)&&q(e,a,t[a]);if(G)for(var a of G(t))fe.call(t,a)&&q(e,a,t[a]);return e},N=(e,t)=>Ze(e,_e(t)),me=(e,t)=>{var a={};for(var n in e)de.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&G)for(var n of G(e))t.indexOf(n)<0&&fe.call(e,n)&&(a[n]=e[n]);return a},X=(e,t,a)=>(q(e,typeof t!="symbol"?t+"":t,a),a),k=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});const $=z.a.createInstance({name:"audio_file_data",driver:z.a.INDEXEDDB}),J=z.a.createInstance({name:"sample_metadata",driver:z.a.INDEXEDDB});function qe(e){return k(this,null,function*(){const t=Object(se.a)();return yield $.setItem(t,e),t})}const ee="0.3.0",et={"0.1.0":e=>{const t=e,{clip:a}=t,n=me(t,["clip"]);return N(I({},n),{trimFrames:a.map(l=>Math.round(l*U)),metadataVersion:"0.2.0"})},"0.2.0":e=>k(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=me(t,["trimFrames"]),o=yield Pe(n.sourceFileId,a),l={frames:a,waveformPeaks:o};return N(I({},n),{trim:l,metadataVersion:"0.3.0"})})};function tt(e){return k(this,null,function*(){let t=e;for(;t.metadataVersion!==ee;){const a=et[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:ee};break}t=yield a(t)}return t})}const x=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(se.a)(),userFileInfo:o=null,slotNumber:l=0,dateSampled:i=Date.now(),dateModified:s=i,useCompression:r=!0,qualityBitDepth:u=16,scaleCoefficient:O=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:o,slotNumber:l,dateSampled:i,dateModified:s,useCompression:r,qualityBitDepth:u,scaleCoefficient:O,metadataVersion:ee}}duplicate(){const e=new x.Mutable(N(I({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return k(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),o=new Uint8Array(n);return this.cacheSourceFileData(e,o),o}const t=yield $.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return k(this,null,function*(){const e=new Map,t=[];return yield J.iterate((a,n)=>{a&&t.push(tt(a).then(o=>{e.set(n,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${n}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return k(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield pe(),a=(yield $.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,l])=>{const{sourceFileId:i}=l;return a.includes(i)?new x.Mutable(I({id:o},l)):(console.warn(`Found metadata "${l.name||o}" with missing data "${i}; ignoring.`),null)}).filter(Boolean).sort((o,l)=>l.metadata.dateModified-o.metadata.dateModified)})}};let j=x;X(j,"Mutable",class extends x{constructor(e){super(e);setTimeout(()=>k(this,null,function*(){(yield J.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return k(this,null,function*(){yield J.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,n=typeof e=="function"?e(a):e;if(Object.keys(n).every(i=>n[i]===a[i]))return this;const o=N(I(I({},a),n),{dateModified:Date.now()}),l=new x.Mutable(I({id:t},o));return l.persist(),l}remove(){return k(this,null,function*(){if(yield J.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield x.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield $.removeItem(this.metadata.sourceFileId)})}}),X(j,"sourceFileData",new Map),X(j,"recentlyCachedSourceFileIds",[]),X(j,"MAX_CACHED",10);let te;function pe(){return te||(te=fetch("factory-samples.json").then(e=>e.json())),te}function at(){return k(this,null,function*(){const e=yield pe();return new Map(e.map(t=>[t.id,new j(N(I({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(ue.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(ue.a)(t.trim.waveformPeaks.negative))}}}))]))})}var he=Math.pow,ae=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});function ne(e,t){const a=4,n=t[0]*a,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,o)}function re(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),o=Array(e.numberOfChannels).fill().map((l,i)=>ne(e.getChannelData(i),t));for(let l=0;l<a;l++){let i=0;for(let s=0;s<o.length;s++)i+=o[s][l];i/=o.length,n[l]=i}return n}function nt(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function rt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function ot(e,t){const a=he(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function ve(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function lt(e){const t=new Int16Array(e.length),a=he(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function ye(){return window.AudioContext||window.webkitAudioContext}let ge;function be(){const e=ye();return ge=ge||new e({sampleRate:U})}function K(e){return ae(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,o)=>{be().decodeAudioData(t.buffer,n,o)})})}function oe(e,t){return ae(this,null,function*(){const a=yield j.getSourceFileData(e),n=yield K(a);if(t)for(let o=0;o<n.numberOfChannels;o++)ve(n.getChannelData(o));return n})}function Se(e){return ae(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:o,trim:{frames:l}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const i=yield oe(a,Boolean(n)),s=i.numberOfChannels===1?ne(i.getChannelData(0),l):re(i,l);o!==1&&rt(s,o),t<16&&ot(s,t);const r=lt(s),u=r.length*2,O=Ke()({channels:1,sampleRate:i.sampleRate,bitDepth:16,dataLength:u}),E=new Uint8Array(O.length+u);return E.set(O),E.set(new Uint8Array(r.buffer),O.length),{data:E,sampleRate:16}})}const ct={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},we=Object(d.createContext)(ct);function it({children:e}){const[t,a]=Object(d.useState)(!1),n=Object(d.useCallback)((l,{onTimeUpdate:i=()=>null,onEnded:s=()=>null}={})=>{if(t)throw new Error("Wait until audio playback has finished to start new playback");a(!0);let r,u;try{r=be(),u=r.createBufferSource(),u.buffer=l,u.connect(r.destination),u.start()}catch(m){throw a(!1),m}const O=r.currentTime;i(0);let E=requestAnimationFrame(g);function g(){i(r.currentTime-O),E=requestAnimationFrame(g)}let y=!1;return u.addEventListener("ended",()=>{y||(i(l.duration),s()),a(!1),cancelAnimationFrame(E)}),function(){u.stop(),y=!0}},[t]),o=Object(d.useMemo)(()=>({playAudioBuffer:n,isAudioBusy:t}),[n,t]);return Object(d.createElement)(we.Provider,{value:o},e)}function Ee(){return Object(d.useContext)(we)}var st=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});const T=6,Ce=T*44;function Oe(e,t){const a=Math.floor(T*e.length/t),n=new Float32Array(Math.floor(e.length/a)),o=new Float32Array(Math.floor(e.length/a));for(let l=0;l<n.length;l++){const i=new Float32Array(e.buffer,l*a*4,a);let s=0,r=0;for(const u of i)u>s&&(s=u),u<r&&(r=u);n[l]=Math.min(1,s),o[l]=Math.max(-1,r)}return{positive:n,negative:o}}function Pe(e,t){return st(this,null,function*(){const a=yield oe(e,!1),n=re(a,t);return Oe(n,Ce)})}var ut=C(54);const dt=R.a.canvas({width:"100%",height:"100%",display:"block"});function ft(e,t){function a(o,l){e.width=o,e.height=l}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new ut.a(([o])=>{const{width:l,height:i}=o.contentRect;a(l,i),t({width:l,height:i})});return n.observe(e),()=>n.disconnect()}function mt(e,t,a){const n=getComputedStyle(document.documentElement),o=n.getPropertyValue("--bs-primary"),l=n.getPropertyValue("--bs-primary-darkened"),i=e.getContext("2d"),{width:s,height:r}=e;i.clearRect(0,0,s,r);const u=Math.floor(r*(2/3))+1;i.fillStyle=o,t.positive.forEach((E,g)=>{const y=u*E,m=Math.max(Math.round(a*y),1);i.fillRect(g*T,u-m,T-1,m)});const O=r-u;i.fillStyle=l,t.negative.forEach((E,g)=>{const y=O*E*-1,m=Math.round(a*y);i.fillRect(g*T,u,T-1,m)})}function pt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(d.useRef)(null);Object(d.useImperativeHandle)(a,()=>n.current);const[o,l]=Object(d.useState)(Symbol()),i=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return i.current.width=n.current.offsetWidth,i.current.height=n.current.offsetHeight,ft(n.current,({width:s,height:r})=>{(s!==i.current.width||r!==i.current.height)&&(l(Symbol()),i.current.width=s,i.current.height=r)})},[]),Object(d.useLayoutEffect)(()=>{const s=n.current;if(!s)throw new Error("Canvas should be defined");let r=requestAnimationFrame(()=>{r=requestAnimationFrame(()=>{mt(s,e,t)})});return()=>cancelAnimationFrame(r)},[e,t,o]),c.a.createElement(dt,{ref:n})}var De=pt;const ht=R.a.div({width:`${Ce}px`,height:"40px"}),Ae=typeof IntersectionObserver!="undefined",vt=c.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(d.useRef)(null),[o,l]=Object(d.useState)(!Ae);return Object(d.useLayoutEffect)(()=>{if(!Ae)return;const i=n.current;if(!i)throw new Error("Waveform container should be defined");const s=i.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){l(!0);return}const r=new IntersectionObserver(([u])=>{u.isIntersecting&&(l(!0),r.unobserve(i))});return r.observe(i),()=>r.disconnect()},[]),c.a.createElement(V.a.Item,{active:t,onClick:()=>a(e.id)},c.a.createElement("div",null,e.metadata.name),c.a.createElement(ht,{ref:n},o&&c.a.createElement(De,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function yt({samples:e,selectedSampleId:t,onSampleSelect:a}){return c.a.createElement(V.a,{variant:"flush"},[...e].map(([n,o])=>c.a.createElement(vt,{key:n,sample:o,selected:n===t,onSampleSelect:a})))}var Me=yt,A=C(55),gt=Object.defineProperty,bt=Object.defineProperties,St=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,Be=(e,t,a)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,wt=(e,t)=>{for(var a in t||(t={}))je.call(t,a)&&Be(e,a,t[a]);if(Y)for(var a of Y(t))ke.call(t,a)&&Be(e,a,t[a]);return e},Et=(e,t)=>bt(e,St(t)),Ct=(e,t)=>{var a={};for(var n in e)je.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&Y)for(var n of Y(e))t.indexOf(n)<0&&ke.call(e,n)&&(a[n]=e[n]);return a},Ot=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});function Pt({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:t},scaleCoefficient:a}},onSetTrimFrames:n,onSetScaleCoefficient:o}){const l=Object(d.useMemo)(()=>e?re(e,[0,0]):new Float32Array,[e]),[i,s]=Object(d.useState)(null),r=Object(d.useMemo)(()=>i&&i.offsetWidth,[i]),u=Object(d.useMemo)(()=>!r||!l.length?{positive:new Float32Array,negative:new Float32Array}:Oe(l,r),[r,l]),O=Object(d.useMemo)(()=>{if(!e)return 0;const f=ne(l,t);return nt(f)},[e,l,t]),E=1/O;Object(d.useLayoutEffect)(()=>{a>E&&o(E)},[a,E,o]);const g=Object(d.useMemo)(()=>{if(!l.length||!r)return[0,0];const f=r/l.length;return t.map(p=>p*f)},[r,l.length,t]),y=Object(d.useRef)(null),m=Object(d.useRef)(null);return Object(d.useEffect)(()=>{function f(h){if(y.current===null||!r||!l.length)return;const{pageX:v}=h,b=v-y.current;if(b){const S=b/r,w=Math.round(l.length*S);n(P=>{let D=P[0]+w;return D=Math.min(D,l.length-P[1]-2e3),D=Math.max(D,0),[D,P[1]]}),y.current=v}}function p(){y.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",p)}},[r,l.length,n]),Object(d.useEffect)(()=>{function f(h){if(m.current===null||!r||!l.length)return;const{pageX:v}=h,b=m.current-v;if(b){const S=b/r,w=Math.round(l.length*S);n(P=>{let D=P[1]+w;return D=Math.min(D,l.length-P[0]-2e3),D=Math.max(D,0),[P[0],D]}),m.current=v}}function p(){m.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",p)}},[r,l.length,n]),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{style:{position:"relative"}},c.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},c.a.createElement(A.a,{type:"button",variant:"light",disabled:a===E,onClick:()=>o(E)},"Normalize")," ",c.a.createElement(A.a,{type:"button",variant:"light",disabled:a===1,onClick:()=>o(1)},"Original level"))),c.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},c.a.createElement(De,{waveformRef:s,peaks:u,scaleCoefficient:a}),c.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${g[0]}px)`,background:"#f3f3f3"}},c.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"black"}}),c.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",y.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",y.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),y.current===null||!r||!l.length)return;const{pageX:p}=f.touches[0],h=p-y.current;if(h){const v=h/r,b=Math.round(l.length*v);n(S=>{let w=S[0]+b;return w=Math.min(w,l.length-S[1]-2e3),w=Math.max(w,0),[w,S[1]]}),y.current=p}},onTouchEnd:()=>{y.current=null},onTouchCancel:()=>{y.current=null}})),c.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${g[1]}px)`,background:"#f3f3f3"}},c.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"black"}}),c.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",m.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",m.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),m.current===null||!r||!l.length)return;const{pageX:p}=f.touches[0],h=m.current-p;if(h){const v=h/r,b=Math.round(l.length*v);n(S=>{let w=S[1]+b;return w=Math.min(w,l.length-S[0]-2e3),w=Math.max(w,0),[S[0],w]}),m.current=p}},onTouchEnd:()=>{m.current=null},onTouchCancel:()=>{m.current=null}}))))}function Dt(e){var t=e,{sample:a}=t,n=Ct(t,["sample"]);const[o,l]=Object(d.useState)(null);Object(d.useEffect)(()=>{let s=!1;return(()=>Ot(this,null,function*(){if(s)return;const r=yield oe(a.metadata.sourceFileId,Boolean(a.metadata.userFileInfo));s||l([a.metadata.sourceFileId,r])}))(),()=>{s=!0}},[a.metadata.sourceFileId,a.metadata.userFileInfo]);const i=Object(d.useRef)(a);return o&&a.metadata.sourceFileId===o[0]&&(i.current=a),c.a.createElement(Pt,Et(wt({},n),{sample:i.current,sourceAudioBuffer:o&&o[1]}))}var At=Dt,Mt=C(91),jt=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});let Ie;function kt(){return jt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Ie=Ie||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){a(o);return}t(n)})})}var Bt=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});function It(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Bt(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:l,getSampleBufferChunkSize:i,getSampleBufferProgress:s,getSampleBufferTotalSize:r,cancelSampleBufferWork:u,registerUpdateCallback:O,unregisterUpdateCallback:E,heap8Buffer:g}=yield kt();if(a)return new Uint8Array;const{data:y}=yield Se(e);if(a)return new Uint8Array;let m,f=0;const p=O(v=>{if(a)return;const b=r(v);m||(m=new Uint8Array(b));const S=l(v),w=i(v),P=s(v);m.set(new Uint8Array(g(),S,w),P-w),f=P/b}),h=o(y,y.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,p);t(f);try{yield new Promise(v=>{let b;n=()=>{cancelAnimationFrame(b),u(h),v()},S();function S(){if(f&&(t(f),f>=1)){v();return}b=requestAnimationFrame(S)}})}finally{n=()=>{},E(p)}if(a)return new Uint8Array;if(!m)throw new Error("Unexpected condition: sampleBuffer should be defined");return m}))()}}var Ft=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});function Rt({sample:e}){const[t,a]=Object(d.useState)(0),[n,o]=Object(d.useState)("idle"),[l,i]=Object(d.useState)(null),[s,r]=Object(d.useState)(null);Object(d.useEffect)(()=>{l instanceof AudioBuffer&&s&&(r(null),s.fn())},[l,s]);const u=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let g=!1;a(0),o("idle"),i(null),r(null),u.current=()=>{g=!0};try{const{sampleBufferPromise:y,cancelWork:m}=It(e,f=>{g||a(f)});u.current=()=>{m(),g=!0},y.then(f=>Ft(this,null,function*(){if(g)return;u.current=()=>{g=!0};const p=yield K(f);g||i(p)}))}catch(y){console.error(y),i(new Error(String(y)))}return()=>u.current()},[e]);const{playAudioBuffer:O,isAudioBusy:E}=Ee();return c.a.createElement(c.a.Fragment,null,c.a.createElement(A.a,{type:"button",variant:"primary",onClick:g=>{if(!(l instanceof AudioBuffer)){if(!l){const y=g.currentTarget;r({fn:()=>y.click()})}return}try{o("transferring");const y=O(l,{onTimeUpdate:m=>a(m/l.duration),onEnded:()=>o("idle")});u.current=()=>{y(),o("idle")}}catch(y){console.error(y),o("error")}},disabled:E||l instanceof Error||n==="transferring"},"Transfer to volca sample"),c.a.createElement("br",null),l&&n==="idle"?null:n==="error"?"Error transferring":c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,l?l instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),c.a.createElement(Mt.a,{now:100*t}),c.a.createElement("br",null),c.a.createElement(A.a,{type:"button",variant:"light",onClick:()=>u.current()},"Cancel")),c.a.createElement("br",null))}var xt=Rt,Tt=C(84),Wt=C(85),Q=C(59),M=C(87),Nt=Object.defineProperty,Lt=Object.defineProperties,Ht=Object.getOwnPropertyDescriptors,Fe=Object.getOwnPropertySymbols,Vt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable,Re=(e,t,a)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,xe=(e,t)=>{for(var a in t||(t={}))Vt.call(t,a)&&Re(e,a,t[a]);if(Fe)for(var a of Fe(t))zt.call(t,a)&&Re(e,a,t[a]);return e},Te=(e,t)=>Lt(e,Ht(t)),Ut=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});const Gt=R.a.div({height:"200px",maxWidth:"400px"});function Xt(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function $t({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const o=e&&e.id,l=Object(d.useCallback)(p=>o&&t(o,{scaleCoefficient:p}),[o,t]),i=Object(d.useCallback)(p=>o&&t(o,h=>Te(xe({},h),{trim:Te(xe({},h.trim),{frames:p(h.trim.frames)})})),[o,t]),[s,r]=Object(d.useState)(null),[u,O]=Object(d.useState)(null),[E,g]=Object(d.useState)(null);Object(d.useEffect)(()=>{u instanceof AudioBuffer&&E&&(g(null),E.fn())},[u,E]),Object(d.useEffect)(()=>{if(r(null),g(null),e){let p=!1;Se(e).then(({data:h})=>{p||r(h)})}},[e]),Object(d.useEffect)(()=>{if(O(null),s){let p=!1;K(s).then(h=>{p||O(h)})}},[s]);const{playAudioBuffer:y,isAudioBusy:m}=Ee(),f=Object(d.useRef)(()=>{});return Object(d.useEffect)(()=>()=>f.current(),[e]),e?c.a.createElement(Tt.a,{fluid:"sm"},c.a.createElement("h2",null,e.metadata.name,c.a.createElement(Wt.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},c.a.createElement(Q.a.Item,{onClick:()=>{const p=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),h=p&&p.trim();h&&t(e.id,{name:h})}},"Rename"),c.a.createElement(Q.a.Item,{onClick:()=>a(e.id)},"Duplicate"),c.a.createElement(Q.a.Divider,null),c.a.createElement(Q.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),c.a.createElement("p",null,c.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),c.a.createElement("br",null),c.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(Gt,null,c.a.createElement(At,{onSetTrimFrames:i,onSetScaleCoefficient:l,sample:e})),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(A.a,{type:"button",variant:"secondary",size:"sm",onClick:p=>{if(u)f.current=y(u);else{const h=p.currentTarget;g({fn:()=>h.click()})}},disabled:m},"Play audio preview")," ",c.a.createElement(A.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Ut(this,null,function*(){const{sourceFileId:p,userFileInfo:h}=e.metadata,v=yield j.getSourceFileData(p),b=new Blob([v],{type:h?h.type:"audio/x-wav"});Xt(b,`${e.metadata.name}${h?h.ext:".wav"}`)})},"Download original file"),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),c.a.createElement(M.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:p=>{const h=Number(p.target.value);t(e.id,{qualityBitDepth:h})}})),c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Slot number"),c.a.createElement(M.a.Control,{type:"number",value:e.metadata.slotNumber,step:1,min:0,max:99,onChange:p=>{const h=Number(p.target.value);t(e.id,{slotNumber:h})}})),c.a.createElement("br",null),c.a.createElement(xt,{sample:e})):null}var Jt=$t,Kt=C(60),Yt=C(58),Z=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});let We;function le(){const e=ye();return We=We||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:U}:{})}function Qt(){return Z(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of n.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),l=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>n.deviceId===s).label,i=(o.getAudioTracks()[0].getCapabilities().channelCount||{}).max||1;for(const s of o.getTracks())s.stop();a.push({device:{deviceId:n.deviceId,label:l},channelsAvailable:i})}return a})}let ce;function Zt(e){return Z(this,arguments,function*({onData:t,onFinish:a}){const n=le();ce=ce||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield ce;const o=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=i=>{if(i.data.eventType==="data"){const s=i.data.audioChannels;t(s)}i.data.eventType==="stop"&&a()};const l=o.parameters.get("isRecording");return l.setValueAtTime(1,n.currentTime),{recorderNode:o,stop(){l.setValueAtTime(0,n.currentTime)}}})}function _t({channelCount:e,onData:t,onFinish:a}){const o=le().createScriptProcessor(1024,e,e);let l=!1;return o.onaudioprocess=i=>{const s=Array(e).fill().map((r,u)=>i.inputBuffer.getChannelData(u));t(s),l&&a()},{recorderNode:o,stop(){l=!0}}}function qt(e){return Z(this,null,function*(){return typeof AudioWorkletNode=="undefined"?_t(e):yield Zt(e)})}function ea(e){return Z(this,arguments,function*({deviceId:t,channelCount:a,onStart:n}){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:U,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),l=le(),i=l.createMediaStreamSource(o),{recorderNode:s,stop:r}=yield qt({channelCount:a,onData:y,onFinish:v});i.connect(s),s.connect(l.destination),n();const O=10*l.sampleRate;let E=0;const g=Array(a).fill([]);function y(b){let S=0;for(let w=0;w<a;w++){const P=b[w],D=P.length,W=P.slice(0,Math.min(D,O-E));ve(W),S||(S=W.length),g[w].push(W)}E+=S,E>=O&&(v(),r())}let m,f;const p=new Promise((b,S)=>{m=b,f=S});let h=!1;function v(){if(h)return;try{const S=g.map(D=>{const W=new Float32Array(D.reduce((_,da)=>_+da.length,0));let Ve=0;for(const _ of D)W.set(_,Ve),Ve+=_.length;return W}),w=new Yt.a;w.fromScratch(S.length,l.sampleRate,"32f",S);const P=w.toBuffer();m(P)}catch(S){f(S)}const b=o.getTracks();for(const S of b)S.stop();s.disconnect(l.destination),i.disconnect(s),h=!0}return{stop:r,mediaRecording:p}})}var Ne=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});const ta=R.a.div({}),Le="capture_device_preference";let He=null;function aa(e){const t=Object(d.useRef)(JSON.parse(localStorage.getItem(Le)||"null")),[a,n]=Object(d.useState)(He),[o,l]=Object(d.useState)(a?"ok":"pending"),[i,s]=Object(d.useState)("");Object(d.useEffect)(()=>{He=a,l("ok")},[a]);const r=Object(d.useCallback)(()=>{let v=!1;return Qt().then(b=>{v||b.length&&(n(new Map(b.map(S=>[S.device.deviceId,S]))),s(S=>S?(t.current=null,S):t.current&&b.find(({device:w})=>t.current.deviceId===w.deviceId)?t.current.deviceId:(t.current=null,b[0].device.deviceId)))}).catch(b=>{if(!v){if(b instanceof DOMException){if(b.name==="NotAllowedError"){l("denied");return}if(b.name==="NotFoundError"){l("unavailable");return}}throw b}}),()=>{v=!0}},[]);Object(d.useEffect)(r,[r]);const[u,O]=Object(d.useState)(1);Object(d.useEffect)(()=>{const v=a&&a.get(i);v&&(t.current&&t.current.deviceId===v.device.deviceId&&t.current.channelCount<=v.channelsAvailable?O(t.current.channelCount):O(v.channelsAvailable),t.current=null)},[a,i]),Object(d.useEffect)(()=>{i&&localStorage.setItem(Le,JSON.stringify({deviceId:i,channelCount:u}))},[i,u]);const[E,g]=Object(d.useState)("ready"),[y,m]=Object(d.useState)(null),[f,p]=Object(d.useState)({fn(v){}}),h=Object(d.useCallback)(()=>Ne(this,null,function*(){let v=!1;const{mediaRecording:b,stop:S}=yield ea({deviceId:i,channelCount:u,onStart:()=>g("capturing")});p({fn(P){S(),P&&(v=!0)}});let w;try{w=yield b}catch(P){m(P),g("error");return}v?g("ready"):(g("finalizing"),e(w))}),[i,u,e]);return{captureDevices:a,accessState:o,selectedCaptureDeviceId:i,selectedChannelCount:u,captureState:E,recordingError:y,refreshCaptureDevices:r,setSelectedCaptureDeviceId:s,setSelectedChannelCount:O,beginRecording:h,stopRecording:f.fn}}function na({onRecordFinish:e}){const{captureDevices:t,accessState:a,selectedCaptureDeviceId:n,selectedChannelCount:o,captureState:l,recordingError:i,refreshCaptureDevices:s,setSelectedCaptureDeviceId:r,setSelectedChannelCount:u,beginRecording:O,stopRecording:E}=aa(e),[g,y]=Object(d.useState)(!1);return c.a.createElement(ta,null,a==="denied"?c.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",c.a.createElement(A.a,{type:"button",variant:"secondary",onClick:s},"try again")):a==="unavailable"?c.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",c.a.createElement(A.a,{type:"button",variant:"secondary",onClick:s},"try again")):c.a.createElement("div",null,c.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),c.a.createElement(A.a,{type:"button",variant:l==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:l==="capturing"?()=>E():O,disabled:l==="finalizing"},["capturing","finalizing"].includes(l)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(l)?c.a.createElement(c.a.Fragment,null,c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(A.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>E(!0)},"Cancel")):c.a.createElement(c.a.Fragment,null,c.a.createElement("br",null),c.a.createElement(A.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>y(m=>!m)},"Audio input settings ",g?"\u25B2":"\u25BC"),c.a.createElement(Kt.a,{in:g},c.a.createElement("div",null,c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Capture Device"),c.a.createElement(M.a.Select,{style:{width:250},value:n,onChange:m=>r(m.target.value)},t&&a==="ok"?[...t].map(([m,{device:f}])=>c.a.createElement("option",{key:m,value:m},f.label||m)):c.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),c.a.createElement(M.a.Group,null,c.a.createElement(M.a.Label,null,"Input channels"),c.a.createElement(M.a.Select,{style:{width:250},value:o,onChange:m=>u(Number(m.target.value))},[1,2].map(m=>c.a.createElement("option",{key:m,value:m,disabled:!t||!t.has(n)||t.get(n).channelsAvailable<m},m===1?"Mono":"Stereo (summed to mono)")))),c.a.createElement("br",null))))),l==="error"&&i||null,c.a.createElement("br",null),c.a.createElement(A.a,{style:{width:250},type:"button",variant:"secondary",onClick:m=>{const f=m.currentTarget.querySelector("input");f&&m.target!==f&&f.click()}},"Or import an audio file",c.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:m=>{if(m.target.files&&m.target.files.length){const f=m.target.files[0];f.arrayBuffer().then(p=>Ne(this,null,function*(){const h=new Uint8Array(p);let v;try{v=yield K(h)}catch(b){alert("Unsupported audio format detected");return}if(v.length>10*v.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(h,f)}))}}})))}var ra=na,ie=C(86),F=C(88),oa=(e,t,a)=>new Promise((n,o)=>{var l=r=>{try{s(a.next(r))}catch(u){o(u)}},i=r=>{try{s(a.throw(r))}catch(u){o(u)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,i);s((a=a.apply(e,t)).next())});const la=R.a.div({padding:"2rem",display:"flex",height:"100%"}),ca=R.a.div({flexGrow:1});function ia(){const[e,t]=Object(d.useState)(new Map),[a,n]=Object(d.useState)(new Map),o=Object(d.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(d.useEffect)(()=>{at().then(n).catch(console.error)},[]);const[l,i]=Object(d.useState)(null),[s,r]=Object(d.useState)(!0);Object(d.useEffect)(()=>{j.getAllFromStorage().then(m=>{t(f=>new Map([...f,...m.map(p=>[p.id,p])]))}).finally(()=>{r(!1)})},[]);const u=Object(d.useCallback)((m,f)=>oa(this,null,function*(){const p=yield qe(m);let h="",v="";if(f){const P=f.name.lastIndexOf(".");P>0?(h=f.name.slice(0,P),v=f.name.slice(P)):h=f.name}else h="New sample";const b=[0,0],S=yield Pe(p,b),w=new j.Mutable({name:h,sourceFileId:p,trim:{frames:b,waveformPeaks:S},userFileInfo:f&&{type:f.type,ext:v}});yield w.persist(),t(P=>new Map([[w.id,w],...P])),i(w.id)}),[]),O=Object(d.useCallback)((m,f)=>{t(p=>{const h=p.get(m);if(h&&h instanceof j.Mutable){const v=h.update(f);if(v!==h)return new Map(p).set(h.id,v)}return p})},[]),[E,g]=Object(d.useState)(!1),y=Object(d.useCallback)(m=>{i(m),g(!1)},[]);return c.a.createElement("div",null,c.a.createElement($e,{onMenuOpen:()=>g(!0),onHeaderClick:()=>i(null)}),c.a.createElement(ie.a,{show:E,onHide:()=>g(!1)},c.a.createElement(ie.a.Header,{closeButton:!0}),c.a.createElement(ie.a.Body,null,c.a.createElement(V.a,null,c.a.createElement(V.a.Item,{as:"button",onClick:()=>y(null)},"New Sample"),s?"Loading...":null,!s&&c.a.createElement(F.a,{defaultActiveKey:e.size?"user":"factory"},c.a.createElement(F.a.Item,{eventKey:"user"},c.a.createElement(F.a.Header,null,"Your Samples"),c.a.createElement(F.a.Body,{style:{padding:0}},c.a.createElement(Me,{samples:e,selectedSampleId:l,onSampleSelect:y}))),c.a.createElement(F.a.Item,{eventKey:"factory"},c.a.createElement(F.a.Header,null,"Factory Samples"),c.a.createElement(F.a.Body,{style:{padding:0}},c.a.createElement(Me,{samples:a,selectedSampleId:l,onSampleSelect:y}))))))),c.a.createElement(la,null,c.a.createElement(ca,null,l&&c.a.createElement(Jt,{sample:o.get(l)||null,onSampleUpdate:O,onSampleDuplicate:m=>{const f=o.get(m);if(f){const p=f.duplicate();t(h=>new Map([[p.id,p],...h])),i(p.id)}},onSampleDelete:m=>{const f=o.get(m);f&&f instanceof j.Mutable&&(f.remove(),t(p=>{const h=new Map(p);return h.delete(f.id),h}))}}),!l&&c.a.createElement(ra,{onRecordFinish:u}))))}var sa=ia,ua=e=>{e&&e instanceof Function&&C.e(3).then(C.bind(null,92)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:o,getTTFB:l})=>{t(e),a(e),n(e),o(e),l(e)})};Ue.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(it,null,c.a.createElement(sa,null))),document.getElementById("root")),ua()}},[[77,1,2]]]);

//# sourceMappingURL=main.593a2d6f.chunk.js.map