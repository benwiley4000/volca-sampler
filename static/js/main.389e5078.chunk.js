(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{115:function(N,V,w){"use strict";w.r(V);var d=w(0),l=w.n(d),Oe=w(9),ut=w.n(Oe),Ln=w(83),Tn=w(84),Z=w(23),dt=w(24),_=w.n(dt);function ft({onMenuOpen:e,onHeaderClick:t}){return l.a.createElement("h1",{className:_.a.title,onClick:t},l.a.createElement("span",{className:_.a.menuIcon,onClick:n=>{n.stopPropagation(),e()}},"\u2630"),l.a.createElement("span",{className:_.a.titleText,"data-text":"Volca Sample"},"Volca Sample",l.a.createElement("span",{className:_.a.titleR},"r"),l.a.createElement("div",{className:_.a.titleStarburst},Array(24).fill().map((n,a,{length:o})=>l.a.createElement("span",{key:a,style:{"--rotation":`${a*360/o}deg`}})))),l.a.createElement("img",{className:_.a.titleGraphic,src:"volca_sample.png",alt:""}),l.a.createElement("svg",{width:0,height:0},l.a.createElement("filter",{id:"outline"},l.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),l.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),l.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),l.a.createElement("feMerge",null,l.a.createElement("feMergeNode",{in:"OUTLINE"}),l.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var mt=ft,q=w(127),pt=w(46),De=w.n(pt),ht=w(40),ee=w.n(ht),Pe=w(128),ke=w(63);const te=31250;var vt=Object.defineProperty,yt=Object.defineProperties,gt=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,se=(e,t,n)=>t in e?vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Ae.call(t,n)&&se(e,n,t[n]);if(ne)for(var n of ne(t))Me.call(t,n)&&se(e,n,t[n]);return e},K=(e,t)=>yt(e,gt(t)),je=(e,t)=>{var n={};for(var a in e)Ae.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&ne)for(var a of ne(e))t.indexOf(a)<0&&Me.call(e,a)&&(n[a]=e[a]);return n},ae=(e,t,n)=>(se(e,typeof t!="symbol"?t+"":t,n),n),F=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});const re=ee.a.createInstance({name:"audio_file_data",driver:ee.a.INDEXEDDB}),oe=ee.a.createInstance({name:"sample_metadata",driver:ee.a.INDEXEDDB});function bt(e){return F(this,null,function*(){const t=Object(Pe.a)();return yield re.setItem(t,e),t})}const ue="0.3.0",Et={"0.1.0":e=>{const t=e,{clip:n}=t,a=je(t,["clip"]);return K(T({},a),{trimFrames:n.map(c=>Math.round(c*te)),metadataVersion:"0.2.0"})},"0.2.0":e=>F(void 0,null,function*(){const t=e,{trimFrames:n}=t,a=je(t,["trimFrames"]),o=yield _e(a.sourceFileId,n),c={frames:n,waveformPeaks:o};return K(T({},a),{trim:c,metadataVersion:"0.3.0"})})};function St(e){return F(this,null,function*(){let t=e;for(;t.metadataVersion!==ue;){const n=Et[e.metadataVersion];if(!n){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:ue};break}t=yield n(t)}return t})}const X=class{constructor({name:e,sourceFileId:t,trim:n,id:a=Object(Pe.a)(),userFileInfo:o=null,slotNumber:c=0,dateSampled:i=Date.now(),dateModified:s=i,useCompression:r=!0,qualityBitDepth:u=16,scaleCoefficient:b=1}){this.id=a,this.metadata={name:e,sourceFileId:t,trim:n,userFileInfo:o,slotNumber:c,dateSampled:i,dateModified:s,useCompression:r,qualityBitDepth:u,scaleCoefficient:b,metadataVersion:ue}}duplicate(){const e=new X.Mutable(K(T({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(a=>a!==e)];const n=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const a of n)this.sourceFileData.delete(a);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return F(this,null,function*(){{const n=this.sourceFileData.get(e);if(n)return n}if(e.includes(".")){const n=yield fetch(e);if(n.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const a=yield n.arrayBuffer(),o=new Uint8Array(a);return this.cacheSourceFileData(e,o),o}const t=yield re.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return F(this,null,function*(){const e=new Map,t=[];return yield oe.iterate((n,a)=>{n&&t.push(St(n).then(o=>{e.set(a,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${a}" (${n.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return F(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield Re(),n=(yield re.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,c])=>{const{sourceFileId:i}=c;return n.includes(i)?new X.Mutable(T({id:o},c)):(console.warn(`Found metadata "${c.name||o}" with missing data "${i}; ignoring.`),null)}).filter(Boolean).sort((o,c)=>c.metadata.dateModified-o.metadata.dateModified)})}};let x=X;ae(x,"Mutable",class extends X{constructor(e){super(e);setTimeout(()=>F(this,null,function*(){(yield oe.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return F(this,null,function*(){yield oe.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:n}=this,a=typeof e=="function"?e(n):e;if(Object.keys(a).every(i=>a[i]===n[i]))return this;const o=K(T(T({},n),a),{dateModified:Date.now()}),c=new X.Mutable(T({id:t},o));return c.persist(),c}remove(){return F(this,null,function*(){if(yield oe.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield X.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield re.removeItem(this.metadata.sourceFileId)})}}),ae(x,"sourceFileData",new Map),ae(x,"recentlyCachedSourceFileIds",[]),ae(x,"MAX_CACHED",10);let de;function Re(){return de||(de=fetch("factory-samples.json").then(e=>e.json())),de}function wt(){return F(this,null,function*(){const e=yield Re();return new Map(e.map(t=>[t.id,new x(K(T({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(ke.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(ke.a)(t.trim.waveformPeaks.negative))}}}))]))})}var Ie=Math.pow,fe=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});function me(e,t){const n=4,a=t[0]*n,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,a,o)}function pe(e,t){const n=e.length-t[0]-t[1],a=new Float32Array(n),o=Array(e.numberOfChannels).fill().map((c,i)=>me(e.getChannelData(i),t));for(let c=0;c<n;c++){let i=0;for(let s=0;s<o.length;s++)i+=o[s][c];i/=o.length,a[c]=i}return a}function Be(e){let t=0;for(const n of e){const a=Math.abs(n);a>t&&(t=a)}return t}function Ct(e,t){if(t!==1)for(let n=0;n<e.length;n++)e[n]*=t}function Ot(e,t){const n=Ie(2,t-1);for(let a=0;a<e.length;a++)e[a]=Math.round(e[a]*n)/n}function xe(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function Dt(e){const t=e.length,n=e[0].length,a=new Float32Array(t*n);for(let o=0;o<a.length;o++){const c=t*o;for(let i=0;i<t;i++)a[c+i]=e[i][o]}return a}function Ne(e){const t=new Int16Array(e.length),n=Ie(2,15);for(let a=0;a<e.length;a++)t[a]=e[a]===1?n-1:n*e[a];return t}function Fe(){return window.AudioContext||window.webkitAudioContext}let Le;function Te(){const e=Fe();return Le=Le||new e({sampleRate:te})}function le(e){return fe(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((a,o)=>{Te().decodeAudioData(t.buffer,a,o)})})}function he(e,t){return fe(this,null,function*(){const n=yield x.getSourceFileData(e),a=yield le(n);if(t)for(let o=0;o<a.numberOfChannels;o++)xe(a.getChannelData(o));return a})}function We(e){return fe(this,null,function*(){const{qualityBitDepth:t,sourceFileId:n,userFileInfo:a,scaleCoefficient:o,trim:{frames:c}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const i=yield he(n,Boolean(a)),s=i.numberOfChannels===1?me(i.getChannelData(0),c):pe(i,c);o!==1&&Ct(s,o),t<16&&Ot(s,t);const r=Ne(s),u=r.length*2,b=De()({channels:1,sampleRate:i.sampleRate,bitDepth:16,dataLength:u}),v=new Uint8Array(b.length+u);return v.set(b),v.set(new Uint8Array(r.buffer),b.length),{data:v,sampleRate:16}})}const Pt={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},He=Object(d.createContext)(Pt);function kt({children:e}){const[t,n]=Object(d.useState)(!1),a=Object(d.useCallback)((c,{onTimeUpdate:i=()=>null,onEnded:s=()=>null}={})=>{if(t)throw new Error("Wait until audio playback has finished to start new playback");n(!0);let r,u;try{r=Te(),u=r.createBufferSource(),u.buffer=c,u.connect(r.destination),u.start()}catch(g){throw n(!1),g}const b=r.currentTime;i(0);let v=requestAnimationFrame(E);function E(){i(r.currentTime-b),v=requestAnimationFrame(E)}let y=!1;return u.addEventListener("ended",()=>{y||(i(c.duration),s()),n(!1),cancelAnimationFrame(v)}),function(){u.stop(),y=!0}},[t]),o=Object(d.useMemo)(()=>({playAudioBuffer:a,isAudioBusy:t}),[a,t]);return Object(d.createElement)(He.Provider,{value:o},e)}function Ve(){return Object(d.useContext)(He)}var At=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});const $=6,ze=$*44;function Ue(e,t){const n=Math.floor($*e.length/t),a=new Float32Array(Math.floor(e.length/n)),o=new Float32Array(Math.floor(e.length/n));for(let c=0;c<a.length;c++){const i=new Float32Array(e.buffer,c*n*4,n);let s=0,r=0;for(const u of i)u>s&&(s=u),u<r&&(r=u);a[c]=Math.min(1,s),o[c]=Math.max(-1,r)}return{positive:a,negative:o}}function _e(e,t){return At(this,null,function*(){const n=yield he(e,!1),a=pe(n,t);return Ue(a,ze)})}var Mt=w(72);const jt=Z.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function Rt(e,t){function n(o,c){e.width=o,e.height=c}n(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const a=new Mt.a(([o])=>{const{width:c,height:i}=o.contentRect;n(c,i),t({width:c,height:i})});return a.observe(e),()=>a.disconnect()}function It(e,t,n){const a=getComputedStyle(document.documentElement),o=a.getPropertyValue("--bs-primary"),c=a.getPropertyValue("--bs-primary-darkened"),i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:s,height:r}=e;i.clearRect(0,0,s,r);const u=Math.floor(r*(2/3))+1;i.fillStyle=o,t.positive.forEach((v,E)=>{const y=u*v,g=Math.max(Math.round(n*y),1);i.fillRect(E*$,u-g,$-1,g)});const b=r-u;i.fillStyle=c,t.negative.forEach((v,E)=>{const y=b*v*-1,g=Math.round(n*y);i.fillRect(E*$,u,$-1,g)})}function Bt({peaks:e,scaleCoefficient:t,waveformRef:n}){const a=Object(d.useRef)(null);Object(d.useImperativeHandle)(n,()=>a.current);const[o,c]=Object(d.useState)(Symbol()),i=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!a.current)throw new Error("Canvas should be defined");return i.current.width=a.current.offsetWidth,i.current.height=a.current.offsetHeight,Rt(a.current,({width:s,height:r})=>{(s!==i.current.width||r!==i.current.height)&&(c(Symbol()),i.current.width=s,i.current.height=r)})},[]),Object(d.useLayoutEffect)(()=>{const s=a.current;if(!s)throw new Error("Canvas should be defined");let r=requestAnimationFrame(()=>{r=requestAnimationFrame(()=>{It(s,e,t)})});return()=>cancelAnimationFrame(r)},[e,t,o]),l.a.createElement(jt,{ref:a})}var Xe=Bt;const xt=Z.a.div({width:`${ze}px`,height:"40px"}),$e=typeof IntersectionObserver!="undefined",Nt=l.a.memo(({sample:e,selected:t,onSampleSelect:n})=>{const a=Object(d.useRef)(null),[o,c]=Object(d.useState)(!$e);return Object(d.useLayoutEffect)(()=>{if(!$e)return;const i=a.current;if(!i)throw new Error("Waveform container should be defined");const s=i.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){c(!0);return}const r=new IntersectionObserver(([u])=>{u.isIntersecting&&(c(!0),r.unobserve(i))});return r.observe(i),()=>r.disconnect()},[]),l.a.createElement(q.a.Item,{active:t,onClick:()=>n(e.id)},l.a.createElement("div",null,e.metadata.name),l.a.createElement(xt,{ref:a},o&&l.a.createElement(Xe,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function Ft({samples:e,selectedSampleId:t,onSampleSelect:n}){return l.a.createElement(q.a,{variant:"flush"},[...e].map(([a,o])=>l.a.createElement(Nt,{key:a,sample:o,selected:a===t,onSampleSelect:n})))}var Ge=Ft,Lt=w(122),Tt=w(123),ce=w(77),B=w(73),L=w(125),Wt=Object.defineProperty,Ht=Object.defineProperties,Vt=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable,Qe=(e,t,n)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zt=(e,t)=>{for(var n in t||(t={}))Ke.call(t,n)&&Qe(e,n,t[n]);if(ie)for(var n of ie(t))Ye.call(t,n)&&Qe(e,n,t[n]);return e},Ut=(e,t)=>Ht(e,Vt(t)),_t=(e,t)=>{var n={};for(var a in e)Ke.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&ie)for(var a of ie(e))t.indexOf(a)<0&&Ye.call(e,a)&&(n[a]=e[a]);return n},Xt=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});function $t({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:t},scaleCoefficient:n}},onSetTrimFrames:a,onSetScaleCoefficient:o}){const c=Object(d.useMemo)(()=>e?pe(e,[0,0]):new Float32Array,[e]),[i,s]=Object(d.useState)(null),r=Object(d.useMemo)(()=>i&&i.offsetWidth,[i]),u=Object(d.useMemo)(()=>!r||!c.length?{positive:new Float32Array,negative:new Float32Array}:Ue(c,r),[r,c]),b=Object(d.useMemo)(()=>{if(!e)return 0;const f=me(c,t);return Be(f)},[e,c,t]),v=1/b;Object(d.useLayoutEffect)(()=>{n>v&&o(v)},[n,v,o]);const E=Object(d.useMemo)(()=>{if(!c.length||!r)return[0,0];const f=r/c.length;return t.map(m=>m*f)},[r,c.length,t]),y=Object(d.useRef)(null),g=Object(d.useRef)(null);return Object(d.useEffect)(()=>{function f(p){if(y.current===null||!r||!c.length)return;const{pageX:D}=p,k=D-y.current;if(k){const A=k/r,C=Math.round(c.length*A);a(M=>{let O=M[0]+C;return O=Math.min(O,c.length-M[1]-2e3),O=Math.max(O,0),[O,M[1]]}),y.current=D}}function m(){y.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m)}},[r,c.length,a]),Object(d.useEffect)(()=>{function f(p){if(g.current===null||!r||!c.length)return;const{pageX:D}=p,k=g.current-D;if(k){const A=k/r,C=Math.round(c.length*A);a(M=>{let O=M[1]+C;return O=Math.min(O,c.length-M[0]-2e3),O=Math.max(O,0),[M[0],O]}),g.current=D}}function m(){g.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m)}},[r,c.length,a]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{style:{position:"relative"}},l.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},l.a.createElement(B.a,{type:"button",variant:"light",disabled:n===v,onClick:()=>o(v)},"Normalize")," ",l.a.createElement(B.a,{type:"button",variant:"light",disabled:n===1,onClick:()=>o(1)},"Original level"))),l.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},l.a.createElement(Xe,{waveformRef:s,peaks:u,scaleCoefficient:n}),l.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${E[0]}px)`,background:"#f3f3f3"}},l.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"var(--bs-dark)"}}),l.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",y.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",y.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),y.current===null||!r||!c.length)return;const{pageX:m}=f.touches[0],p=m-y.current;if(p){const D=p/r,k=Math.round(c.length*D);a(A=>{let C=A[0]+k;return C=Math.min(C,c.length-A[1]-2e3),C=Math.max(C,0),[C,A[1]]}),y.current=m}},onTouchEnd:()=>{y.current=null},onTouchCancel:()=>{y.current=null}})),l.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${E[1]}px)`,background:"#f3f3f3"}},l.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"var(--bs-dark)"}}),l.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",g.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",g.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),g.current===null||!r||!c.length)return;const{pageX:m}=f.touches[0],p=g.current-m;if(p){const D=p/r,k=Math.round(c.length*D);a(A=>{let C=A[1]+k;return C=Math.min(C,c.length-A[0]-2e3),C=Math.max(C,0),[A[0],C]}),g.current=m}},onTouchEnd:()=>{g.current=null},onTouchCancel:()=>{g.current=null}}))))}function Gt(e){var t=e,{sample:n}=t,a=_t(t,["sample"]);const[o,c]=Object(d.useState)(null);Object(d.useEffect)(()=>{let s=!1;return(()=>Xt(this,null,function*(){if(s)return;const r=yield he(n.metadata.sourceFileId,Boolean(n.metadata.userFileInfo));s||c([n.metadata.sourceFileId,r])}))(),()=>{s=!0}},[n.metadata.sourceFileId,n.metadata.userFileInfo]);const i=Object(d.useRef)(n);return o&&n.metadata.sourceFileId===o[0]&&(i.current=n),l.a.createElement($t,Ut(zt({},a),{sample:i.current,sourceAudioBuffer:o&&o[1]}))}var Kt=Gt,Yt=w(129),Qt=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});let Je;function Jt(){return Qt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Je=Je||new Promise((t,n)=>{let a;try{a={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){n(o);return}t(a)})})}var Zt=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});function qt(e,t){let n=!1,a=()=>{};return{cancelWork(){n=!0,a()},sampleBufferPromise:(()=>Zt(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:c,getSampleBufferChunkSize:i,getSampleBufferProgress:s,getSampleBufferTotalSize:r,cancelSampleBufferWork:u,registerUpdateCallback:b,unregisterUpdateCallback:v,heap8Buffer:E}=yield Jt();if(n)return new Uint8Array;const{data:y}=yield We(e);if(n)return new Uint8Array;let g,f=0;const m=b(D=>{if(n)return;const k=r(D);g||(g=new Uint8Array(k));const A=c(D),C=i(D),M=s(D);g.set(new Uint8Array(E(),A,C),M-C),f=M/k}),p=o(y,y.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,m);t(f);try{yield new Promise(D=>{let k;a=()=>{cancelAnimationFrame(k),u(p),D()},A();function A(){if(f&&(t(f),f>=1)){D();return}k=requestAnimationFrame(A)}})}finally{a=()=>{},v(m)}if(n)return new Uint8Array;if(!g)throw new Error("Unexpected condition: sampleBuffer should be defined");return g}))()}}var en=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});function tn({sample:e}){const[t,n]=Object(d.useState)(0),[a,o]=Object(d.useState)("idle"),[c,i]=Object(d.useState)(null),[s,r]=Object(d.useState)(null);Object(d.useEffect)(()=>{c instanceof AudioBuffer&&s&&(r(null),s.fn())},[c,s]);const u=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let E=!1;n(0),o("idle"),i(null),r(null),u.current=()=>{E=!0};try{const{sampleBufferPromise:y,cancelWork:g}=qt(e,f=>{E||n(f)});u.current=()=>{g(),E=!0},y.then(f=>en(this,null,function*(){if(E)return;u.current=()=>{E=!0};const m=yield le(f);E||i(m)}))}catch(y){console.error(y),i(new Error(String(y)))}return()=>u.current()},[e]);const{playAudioBuffer:b,isAudioBusy:v}=Ve();return l.a.createElement(l.a.Fragment,null,l.a.createElement(B.a,{type:"button",variant:"primary",onClick:E=>{if(!(c instanceof AudioBuffer)){if(!c){const y=E.currentTarget;r({fn:()=>y.click()})}return}try{o("transferring");const y=b(c,{onTimeUpdate:g=>n(g/c.duration),onEnded:()=>o("idle")});u.current=()=>{y(),o("idle")}}catch(y){console.error(y),o("error")}},disabled:v||c instanceof Error||a==="transferring"},"Transfer to volca sample"),l.a.createElement("br",null),c&&a==="idle"?null:a==="error"?"Error transferring":l.a.createElement(l.a.Fragment,null,l.a.createElement("p",null,c?c instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),l.a.createElement(Yt.a,{now:100*t}),l.a.createElement("br",null),l.a.createElement(B.a,{type:"button",variant:"light",onClick:()=>u.current()},"Cancel")),l.a.createElement("br",null))}var nn=tn,Ze=w(57),qe=w.n(Ze),ve=w(58),ye=w(59),an=w(22),z=w.n(an),et=Math.pow;Ze.Digit.defaultProps.offOpacity=0;const tt=(e,t)=>Math.min(199,t+et(10,e)),nt=(e,t)=>Math.max(0,t-et(10,e));function rn({sample:e,onSampleUpdate:t}){const[n,a]=Object(d.useState)(e.metadata.slotNumber);Object(d.useEffect)(()=>{a(e.metadata.slotNumber)},[e.metadata.slotNumber]);const[o,c]=Object(d.useState)(null),i=Object(d.useCallback)(b=>{t(e.id,({slotNumber:v})=>({slotNumber:tt(b,v)}))},[e.id,t]),s=Object(d.useCallback)(b=>{t(e.id,({slotNumber:v})=>({slotNumber:nt(b,v)}))},[e.id,t]),r=Object(d.useRef)(null),u=Object(d.useRef)(null);{const b=Object(d.useRef)(o);b.current=o;const v=Object(d.useRef)(e.id);v.current=e.id;const E=Object(d.useRef)(n);E.current=n,Object(d.useEffect)(()=>{if(!u.current)throw new Error("Expected elements to exist");u.current.forEach((S,h)=>{const P=h;S.addEventListener("click",()=>{c(P)}),S.addEventListener("touchstart",R=>{R.preventDefault()})});function y(S){const h=b.current;if(h!==null)switch(S.stopPropagation(),S.preventDefault(),S.key){case"ArrowDown":a(P=>nt(h,P));break;case"ArrowUp":a(P=>tt(h,P));break;case"ArrowLeft":c(P=>P!==null&&P<2?P+1:P);break;case"ArrowRight":c(P=>P&&P-1);break;case"Enter":case"Escape":c(null);break;default:break}}function g(S){const h=b.current;if(h===null)return;S.stopPropagation(),S.preventDefault();const P=E.current;if(isNaN(Number(S.key)))t(v.current,{slotNumber:P});else{const R=String(P).padStart(3,"0").split("");R[2-h]=S.key;const I=Math.min(199,Math.max(0,Number(R.join(""))));c(h?h-1:null),t(v.current,{slotNumber:I})}}function f(S){r.current&&r.current.contains(S.target)||c(null)}document.addEventListener("keydown",y,!0),document.addEventListener("keyup",g,!0),document.addEventListener("click",f);const m=r.current;let p=0,D=!1,k=!1,A=0;function C(S){document.body.style.userSelect="none",p=S instanceof MouseEvent?S.pageY:S.touches[0].pageY,D=!0,k=!1,A=E.current}m.addEventListener("mousedown",C),m.addEventListener("touchstart",S=>{S.preventDefault(),C(S)});function M(S){if(!D)return;k=!0;const{pageY:h}=S instanceof MouseEvent?S:S.touches[0],P=2,R=Math.round((p-h)/P);a(Math.min(199,Math.max(0,A+R)))}window.addEventListener("mousemove",M),m.addEventListener("touchmove",M);function O(){document.body.style.userSelect="unset",D=!1,k&&t(v.current,{slotNumber:E.current})}window.addEventListener("mouseup",O),m.addEventListener("touchend",O),m.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function j(S){k||u.current&&u.current.some(h=>h.contains(S.target))||c(2)}return m.addEventListener("click",j),()=>{document.removeEventListener("keydown",y,!0),document.removeEventListener("keyup",g,!0),document.removeEventListener("click",f),window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",O)}},[t])}return Object(d.useEffect)(()=>{if(!u.current)throw new Error("Expected elements to exist");u.current.forEach((b,v)=>{v===o?b.classList.add(z.a.active):b.classList.remove(z.a.active)})},[o]),l.a.createElement(l.a.Fragment,null,l.a.createElement(L.a.Label,null,"Destination"),l.a.createElement("br",null),l.a.createElement("div",{className:z.a.slotNumberContainer},l.a.createElement("div",{className:z.a.arrowControls},l.a.createElement("span",{onClick:()=>i(2)},l.a.createElement("img",{src:ve.a,alt:"Increment 100"})),l.a.createElement("span",{onClick:()=>i(1)},l.a.createElement("img",{src:ve.a,alt:"Increment 10"})),l.a.createElement("span",{onClick:()=>i(0)},l.a.createElement("img",{src:ve.a,alt:"Increment 1"}))),l.a.createElement("div",{className:z.a.slotNumber,title:`Slot ${n}`,ref:r},l.a.createElement(qe.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),l.a.createElement(qe.a,{ref:b=>{const v=Object(Oe.findDOMNode)(b);if(v){v.querySelectorAll("circle").forEach(y=>{v.removeChild(y)});const E=document.createElementNS("http://www.w3.org/2000/svg","circle");E.classList.add(z.a.point),v.appendChild(E),u.current=[].slice.call(v.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(n).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),l.a.createElement("div",{className:z.a.arrowControls},l.a.createElement("span",{onClick:()=>s(2)},l.a.createElement("img",{src:ye.a,alt:"Decrement 100"})),l.a.createElement("span",{onClick:()=>s(1)},l.a.createElement("img",{src:ye.a,alt:"Decrement 10"})),l.a.createElement("span",{onClick:()=>s(0)},l.a.createElement("img",{src:ye.a,alt:"Decrement 1"})))))}var on=rn,ln=w(74),cn=w.n(ln),sn=Object.defineProperty,un=Object.defineProperties,dn=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertySymbols,fn=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable,rt=(e,t,n)=>t in e?sn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ot=(e,t)=>{for(var n in t||(t={}))fn.call(t,n)&&rt(e,n,t[n]);if(at)for(var n of at(t))mn.call(t,n)&&rt(e,n,t[n]);return e},lt=(e,t)=>un(e,dn(t)),pn=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});function hn(e,t){const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(n)}function vn({sample:e,onSampleUpdate:t,onSampleDuplicate:n,onSampleDelete:a}){const o=e&&e.id,c=Object(d.useCallback)(m=>o&&t(o,{scaleCoefficient:m}),[o,t]),i=Object(d.useCallback)(m=>o&&t(o,p=>lt(ot({},p),{trim:lt(ot({},p.trim),{frames:m(p.trim.frames)})})),[o,t]),[s,r]=Object(d.useState)(null),[u,b]=Object(d.useState)(null),[v,E]=Object(d.useState)(null);Object(d.useEffect)(()=>{u instanceof AudioBuffer&&v&&(E(null),v.fn())},[u,v]),Object(d.useEffect)(()=>{if(r(null),E(null),e){let m=!1;We(e).then(({data:p})=>{m||r(p)})}},[e]),Object(d.useEffect)(()=>{if(b(null),s){let m=!1;le(s).then(p=>{m||b(p)})}},[s]);const{playAudioBuffer:y,isAudioBusy:g}=Ve(),f=Object(d.useRef)(()=>{});return Object(d.useEffect)(()=>()=>f.current(),[e]),e?l.a.createElement(Lt.a,{fluid:"sm"},l.a.createElement("h2",null,e.metadata.name,l.a.createElement(Tt.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},l.a.createElement(ce.a.Item,{onClick:()=>{const m=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),p=m&&m.trim();p&&t(e.id,{name:p})}},"Rename"),l.a.createElement(ce.a.Item,{onClick:()=>n(e.id)},"Duplicate"),l.a.createElement(ce.a.Divider,null),l.a.createElement(ce.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&a(e.id)}},"Delete"))),l.a.createElement("p",null,l.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),l.a.createElement("br",null),l.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("div",{className:cn.a.waveformContainer},l.a.createElement(Kt,{onSetTrimFrames:i,onSetScaleCoefficient:c,sample:e})),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(B.a,{type:"button",variant:"secondary",size:"sm",onClick:m=>{if(u)f.current=y(u);else{const p=m.currentTarget;E({fn:()=>p.click()})}},disabled:g},"Play audio preview")," ",l.a.createElement(B.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>pn(this,null,function*(){const{sourceFileId:m,userFileInfo:p}=e.metadata,D=yield x.getSourceFileData(m),k=new Blob([D],{type:p?p.type:"audio/x-wav"});hn(k,`${e.metadata.name}${p?p.ext:".wav"}`)})},"Download original file"),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(L.a.Group,null,l.a.createElement(L.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),l.a.createElement(L.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:m=>{const p=Number(m.target.value);t(e.id,{qualityBitDepth:p})}})),l.a.createElement(on,{sample:e,onSampleUpdate:t}),l.a.createElement("br",null),l.a.createElement(nn,{sample:e})):null}var yn=vn,gn=w(78),Y=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});let ct;function ge(){const e=Fe();return ct=ct||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:te}:{})}function bn(){return Y(this,null,function*(){{const a=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of a.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="audioinput"),n=[];for(const a of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:a.deviceId,channelCount:2},video:!1}),c=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>a.deviceId===s).label;let i=1;{const s=o.getAudioTracks()[0],r=s.getSettings().channelCount;r?i=r:s.getCapabilities&&(i=(s.getCapabilities().channelCount||{}).max||i)}for(const s of o.getTracks())s.stop();n.push({device:{deviceId:a.deviceId,label:c},channelsAvailable:i})}return n})}let be;function En(e){return Y(this,arguments,function*({onData:t,onFinish:n}){const a=ge();be=be||a.audioWorklet.addModule("recorderWorkletProcessor.js"),yield be;const o=new AudioWorkletNode(a,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=i=>{if(i.data.eventType==="data"){const s=i.data.audioChannels;t(s)}i.data.eventType==="stop"&&n()};const c=o.parameters.get("isRecording");return c.setValueAtTime(1,a.currentTime),{recorderNode:o,stop(){c.setValueAtTime(0,a.currentTime)}}})}function Sn({channelCount:e,onData:t,onFinish:n}){const o=ge().createScriptProcessor(1024,e,e);let c=!1;return o.onaudioprocess=i=>{const s=Array(e).fill().map((r,u)=>i.inputBuffer.getChannelData(u));t(s),c&&n()},{recorderNode:o,stop(){c=!0}}}function wn(e){return Y(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Sn(e):yield En(e)})}function Cn(e){return Y(this,arguments,function*({deviceId:t,channelCount:n,onStart:a,onUpdate:o}){const c=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:n,sampleRate:te,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),i=ge(),s=i.createMediaStreamSource(c),{recorderNode:r,stop:u}=yield wn({channelCount:n,onData:g,onFinish:k});s.connect(r),r.connect(i.destination);const b=10;a(i.sampleRate,b);const v=b*i.sampleRate;let E=0;const y=Array(n).fill([]);function g(A){let C=0;const M=[];for(let S=0;S<n;S++){const h=A[S],P=h.length,R=h.slice(0,Math.min(P,v-E));xe(R),C||(C=R.length),M.push(R)}const O=Dt(M),j=Ne(O);y.push(j),E+=C,E>=v&&u(),o(M)}let f,m;const p=new Promise((A,C)=>{f=A,m=C});let D=!1;function k(){return Y(this,null,function*(){if(D)return;try{const M=yield new Blob(y).arrayBuffer(),O=new Float32Array(M),j=De()({channels:n,sampleRate:i.sampleRate,bitDepth:16,dataLength:O.byteLength}),S=new Uint8Array(j.length+O.byteLength);S.set(j),S.set(new Uint8Array(O.buffer),j.length),f(S)}catch(C){m(C)}const A=c.getTracks();for(const C of A)C.stop();r.disconnect(i.destination),s.disconnect(r),D=!0})}return{stop:u,mediaRecording:p}})}var On=w(60),Ee=w.n(On),Q=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});const it="capture_device_preference";let st=null;function Dn(e,t){const n=Object(d.useRef)(JSON.parse(localStorage.getItem(it)||"null")),[a,o]=Object(d.useState)(st),[c,i]=Object(d.useState)(a?"ok":"pending"),[s,r]=Object(d.useState)("");Object(d.useEffect)(()=>{st=a,i("ok")},[a]);const u=Object(d.useCallback)(()=>{let O=!1;return bn().then(j=>{O||j.length&&(o(new Map(j.map(S=>[S.device.deviceId,S]))),r(S=>S?(n.current=null,S):n.current&&j.find(({device:h})=>n.current.deviceId===h.deviceId)?n.current.deviceId:(n.current=null,j[0].device.deviceId)))}).catch(j=>{if(!O){if(j instanceof DOMException){if(j.name==="NotAllowedError"){i("denied");return}if(j.name==="NotFoundError"){i("unavailable");return}}throw j}}),()=>{O=!0}},[]),[b,v]=Object(d.useState)(1);Object(d.useEffect)(()=>{const O=a&&a.get(s);O&&(n.current&&n.current.deviceId===O.device.deviceId&&n.current.channelCount<=O.channelsAvailable?v(n.current.channelCount):v(O.channelsAvailable),n.current=null)},[a,s]),Object(d.useEffect)(()=>{s&&localStorage.setItem(it,JSON.stringify({deviceId:s,channelCount:b}))},[s,b]);const[E,y]=Object(d.useState)("ready"),[g,f]=Object(d.useState)(null),[m,p]=Object(d.useState)({fn(O){}}),[D,k]=Object(d.useState)(1/0),[A,C]=Object(d.useState)(0),M=Object(d.useCallback)(()=>Q(this,null,function*(){let O=!1;const j=(I,G)=>Cn({deviceId:I,channelCount:G,onStart:(W,J)=>{const H=J*W;k(W),C(H),y("capturing")},onUpdate:e}),S=n.current,{mediaRecording:h,stop:P}=yield S?(()=>Q(this,null,function*(){try{return j(S.deviceId,S.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return j(s,b);throw I}}))():j(s,b);p({fn(I){P(),I&&(O=!0)}});let R;try{R=yield h}catch(I){f(I),y("error");return}O?y("ready"):(y("finalizing"),t(R))}),[s,b,e,t]);return{captureDevices:a,accessState:c,selectedCaptureDeviceId:s,selectedChannelCount:b,captureState:E,recordingError:g,sampleRate:D,maxSamples:A,refreshCaptureDevices:u,setSelectedCaptureDeviceId:r,setSelectedChannelCount:v,beginRecording:M,stopRecording:m.fn}}const Se=3;function Pn({canvas:e,peaks:t,scaleCoefficient:n}){const a="#fff",o=e.getContext("2d");o.imageSmoothingEnabled=!1;const{width:c,height:i}=e;o.clearRect(0,0,c,i),o.fillStyle=a;for(let s=0;s<t.length;s++){const r=t[s];if(r===0)continue;const u=i*r,b=Math.max(Math.round(n*u),2);o.fillRect(s*Se,i-b,Se-1,b)}}function kn({onRecordFinish:e}){const t=Object(d.useRef)(null),n=Object(d.useRef)(0),a=Object(d.useRef)(new Float32Array),o=Object(d.useRef)(0),c=Object(d.useRef)([]),i=Object(d.useRef)(1/0),s=Object(d.useRef)(0),[r,u]=Object(d.useState)(0),b=Object(d.useCallback)(h=>Q(this,null,function*(){const P=n.current,R=a.current,I=c.current;if(I.push(h),s.current+=h[0].length,u(Math.floor(s.current/i.current)),I.reduce((W,[{length:J}])=>W+J,0)>=P){const W=yield Promise.all(h.map((H,Ce)=>I.reduce((Nn,Fn)=>[...Nn,Fn[Ce]],[])).map(H=>Q(this,null,function*(){const Ce=yield new Blob(H).arrayBuffer();return new Float32Array(Ce)}))),J=W.map(H=>Be(new Float32Array(H.buffer,0,P)));R[o.current]=Math.max(...J),Pn({canvas:t.current,peaks:R,scaleCoefficient:.3}),o.current++,c.current=[W.map(H=>H.slice(P))]}}),[]),{captureDevices:v,accessState:E,selectedCaptureDeviceId:y,selectedChannelCount:g,captureState:f,recordingError:m,maxSamples:p,sampleRate:D,refreshCaptureDevices:k,setSelectedCaptureDeviceId:A,setSelectedChannelCount:C,beginRecording:M,stopRecording:O}=Dn(b,e);i.current=D,Object(d.useEffect)(()=>{const h=t.current;h&&(h.width=h.offsetWidth,h.height=h.offsetHeight)},[E]),Object(d.useLayoutEffect)(()=>{const h=t.current;!h||(f!=="finalizing"&&h.getContext("2d").clearRect(0,0,h.width,h.height),f==="capturing"&&p&&(n.current=Math.floor(Se*p/t.current.width),a.current=new Float32Array(Math.floor(p/n.current)),o.current=0,c.current=[],i.current=1/0,s.current=0,u(0)))},[p,f]);const[j,S]=Object(d.useState)(!1);return Object(d.useEffect)(()=>{j&&k()},[j,k]),l.a.createElement("div",null,E==="denied"?l.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",l.a.createElement(B.a,{type:"button",variant:"secondary",onClick:k},"try again")):E==="unavailable"?l.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",l.a.createElement(B.a,{type:"button",variant:"secondary",onClick:k},"try again")):l.a.createElement("div",null,l.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),l.a.createElement(B.a,{className:Ee.a.recordButton,type:"button",variant:f==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:f==="capturing"?()=>O():M,disabled:f==="finalizing"},l.a.createElement("canvas",{ref:t}),l.a.createElement("span",{className:Ee.a.mainText},["capturing","finalizing"].includes(f)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(f)&&l.a.createElement("span",{className:Ee.a.timeRecorded},"0:",String(r).padStart(2,"0"))),["capturing","finalizing"].includes(f)?l.a.createElement(l.a.Fragment,null,l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(B.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>O(!0)},"Cancel")):l.a.createElement(l.a.Fragment,null,l.a.createElement("br",null),l.a.createElement(B.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>S(h=>!h)},"Audio input settings ",j?"\u25B2":"\u25BC"),l.a.createElement(gn.a,{in:j},l.a.createElement("div",null,l.a.createElement(L.a.Group,null,l.a.createElement(L.a.Label,null,"Capture Device"),l.a.createElement(L.a.Select,{style:{width:250},value:y,onChange:h=>A(h.target.value)},v&&E==="ok"?[...v].map(([h,{device:P}])=>l.a.createElement("option",{key:h,value:h},P.label||h)):l.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),l.a.createElement(L.a.Group,null,l.a.createElement(L.a.Label,null,"Input channels"),l.a.createElement(L.a.Select,{style:{width:250},value:g,onChange:h=>C(Number(h.target.value))},[1,2].map(h=>l.a.createElement("option",{key:h,value:h,disabled:!v||!v.has(y)||v.get(y).channelsAvailable<h},h===1?"Mono":"Stereo (summed to mono)")))),l.a.createElement("br",null))))),f==="error"&&m||null,l.a.createElement("br",null),l.a.createElement(B.a,{style:{width:250},type:"button",variant:"secondary",onClick:h=>{const P=h.currentTarget.querySelector("input");P&&h.target!==P&&P.click()}},"Or import an audio file",l.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:h=>{if(h.target.files&&h.target.files.length){const P=h.target.files[0];P.arrayBuffer().then(R=>Q(this,null,function*(){const I=new Uint8Array(R);let G;try{G=yield le(I)}catch(W){alert("Unsupported audio format detected");return}if(G.length>10*G.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(I,P)}))}}})))}var An=kn,we=w(124),U=w(126),Mn=(e,t,n)=>new Promise((a,o)=>{var c=r=>{try{s(n.next(r))}catch(u){o(u)}},i=r=>{try{s(n.throw(r))}catch(u){o(u)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,i);s((n=n.apply(e,t)).next())});const jn=Z.a.div({padding:"2rem",display:"flex",height:"100%"}),Rn=Z.a.div({flexGrow:1});function In(){const[e,t]=Object(d.useState)(new Map),[n,a]=Object(d.useState)(new Map),o=Object(d.useMemo)(()=>new Map([...e,...n]),[e,n]);Object(d.useEffect)(()=>{wt().then(a).catch(console.error)},[]);const[c,i]=Object(d.useState)(null),[s,r]=Object(d.useState)(!0);Object(d.useEffect)(()=>{x.getAllFromStorage().then(g=>{t(f=>new Map([...f,...g.map(m=>[m.id,m])]))}).finally(()=>{r(!1)})},[]);const u=Object(d.useCallback)((g,f)=>Mn(this,null,function*(){const m=yield bt(g);let p="",D="";if(f){const M=f.name.lastIndexOf(".");M>0?(p=f.name.slice(0,M),D=f.name.slice(M)):p=f.name}else p="New sample";const k=[0,0],A=yield _e(m,k),C=new x.Mutable({name:p,sourceFileId:m,trim:{frames:k,waveformPeaks:A},userFileInfo:f&&{type:f.type,ext:D}});yield C.persist(),t(M=>new Map([[C.id,C],...M])),i(C.id)}),[]),b=Object(d.useCallback)((g,f)=>{t(m=>{const p=m.get(g);if(p&&p instanceof x.Mutable){const D=p.update(f);if(D!==p)return new Map(m).set(p.id,D)}return m})},[]),[v,E]=Object(d.useState)(!1),y=Object(d.useCallback)(g=>{i(g),E(!1)},[]);return l.a.createElement("div",null,l.a.createElement(mt,{onMenuOpen:()=>E(!0),onHeaderClick:()=>i(null)}),l.a.createElement(we.a,{show:v,onHide:()=>E(!1)},l.a.createElement(we.a.Header,{closeButton:!0}),l.a.createElement(we.a.Body,null,l.a.createElement(q.a,null,l.a.createElement(q.a.Item,{as:"button",onClick:()=>y(null)},"New Sample"),s?"Loading...":null,!s&&l.a.createElement(U.a,{defaultActiveKey:e.size?"user":"factory"},l.a.createElement(U.a.Item,{eventKey:"user"},l.a.createElement(U.a.Header,null,"Your Samples"),l.a.createElement(U.a.Body,{style:{padding:0}},l.a.createElement(Ge,{samples:e,selectedSampleId:c,onSampleSelect:y}))),l.a.createElement(U.a.Item,{eventKey:"factory"},l.a.createElement(U.a.Header,null,"Factory Samples"),l.a.createElement(U.a.Body,{style:{padding:0}},l.a.createElement(Ge,{samples:n,selectedSampleId:c,onSampleSelect:y}))))))),l.a.createElement(jn,null,l.a.createElement(Rn,null,c&&l.a.createElement(yn,{sample:o.get(c)||null,onSampleUpdate:b,onSampleDuplicate:g=>{const f=o.get(g);if(f){const m=f.duplicate();t(p=>new Map([[m.id,m],...p])),i(m.id)}},onSampleDelete:g=>{const f=o.get(g);f&&f instanceof x.Mutable&&(f.remove(),t(m=>{const p=new Map(m);return p.delete(f.id),p}))}}),!c&&l.a.createElement(An,{onRecordFinish:u}))))}var Bn=In,xn=e=>{e&&e instanceof Function&&w.e(3).then(w.bind(null,130)).then(({getCLS:t,getFID:n,getFCP:a,getLCP:o,getTTFB:c})=>{t(e),n(e),a(e),o(e),c(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),ut.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(kt,null,l.a.createElement(Bn,null))),document.getElementById("root")),xn()},22:function(N,V,w){N.exports={slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3"}},24:function(N,V,w){N.exports={title:"Header_title__R3bRx",menuIcon:"Header_menuIcon__swn7p",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},60:function(N,V,w){N.exports={recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},74:function(N,V,w){N.exports={waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},83:function(N,V,w){},84:function(N,V,w){}},[[115,1,2]]]);

//# sourceMappingURL=main.389e5078.chunk.js.map