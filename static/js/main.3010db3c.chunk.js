(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{102:function(U,te,p){},103:function(U,te,p){},134:function(U,te,p){"use strict";p.r(te);var u=p(0),n=p.n(u),Qe=p(10),_t=p.n(Qe),yn=p(102),bn=p(103),Pe=p(146),he=p(149),le=p(148),ye=p(141),Ht=p(20),re=p.n(Ht);function Vt({onMenuOpen:e,onHeaderClick:t}){return n.a.createElement("div",{className:re.a.titleBar},n.a.createElement("span",{className:re.a.menuIcon,onClick:e},"\u2630"),n.a.createElement(ye.a,{fluid:"sm",className:re.a.titleContainer},n.a.createElement("h1",{className:re.a.title,onClick:t},n.a.createElement("span",{className:re.a.titleText,"data-text":"Volca Sample"},"Volca Sample",n.a.createElement("span",{className:re.a.titleR},"r"),n.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:re.a.titleStarburst},Array(24).fill().map((a,r,{length:o})=>n.a.createElement("polygon",{key:r,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${r*360/o}deg`}})))),n.a.createElement("img",{className:re.a.titleGraphic,src:"volca_sample.png",alt:""}))),n.a.createElement("svg",{width:0,height:0},n.a.createElement("filter",{id:"outline"},n.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),n.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),n.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),n.a.createElement("feMerge",null,n.a.createElement("feMergeNode",{in:"OUTLINE"}),n.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var Ut=Vt,Je=p(53),zt=p(54),Ze=p.n(zt),$t=p(45),be=p.n($t),qe=p(150),et=p(79);const ge=31250;var Xt=Object.defineProperty,Gt=Object.defineProperties,Yt=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,Re=(e,t,a)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,ae=(e,t)=>{for(var a in t||(t={}))tt.call(t,a)&&Re(e,a,t[a]);if(Ee)for(var a of Ee(t))at.call(t,a)&&Re(e,a,t[a]);return e},ce=(e,t)=>Gt(e,Yt(t)),Be=(e,t)=>{var a={};for(var r in e)tt.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&Ee)for(var r of Ee(e))t.indexOf(r)<0&&at.call(e,r)&&(a[r]=e[r]);return a},Se=(e,t,a)=>(Re(e,typeof t!="symbol"?t+"":t,a),a),Q=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const we=be.a.createInstance({name:"audio_file_data",driver:be.a.INDEXEDDB}),Ce=be.a.createInstance({name:"sample_metadata",driver:be.a.INDEXEDDB});function Kt(e){return Q(this,null,function*(){const t=Object(qe.a)();return yield we.setItem(t,e),t})}const Me="0.4.0",Qt={"0.1.0":e=>{const t=e,{clip:a}=t,r=Be(t,["clip"]);return ce(ae({},r),{trimFrames:a.map(i=>Math.round(i*ge)),metadataVersion:"0.2.0"})},"0.2.0":e=>Q(void 0,null,function*(){const t=e,{trimFrames:a}=t,r=Be(t,["trimFrames"]),o=yield Fe(r.sourceFileId,!1),i=yield vt(o,a),s={frames:a,waveformPeaks:i};return ce(ae({},r),{trim:s,metadataVersion:"0.3.0"})}),"0.3.0":e=>{const t=e,{dateSampled:a,dateModified:r}=t,o=Be(t,["dateSampled","dateModified"]);return ce(ae({},o),{dateSampled:new Date(a).toISOString(),dateModified:new Date(r).toISOString(),metadataVersion:"0.4.0"})}};function Jt(e){return Q(this,null,function*(){let t=e;for(;t.metadataVersion!==Me;){const a=Qt[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:Me};break}t=yield a(t)}return t})}const ie=class{constructor({name:e,sourceFileId:t,trim:a,id:r=Object(qe.a)(),userFileInfo:o=null,slotNumber:i=0,dateSampled:s=new Date().toISOString(),dateModified:c=s,useCompression:l=!0,qualityBitDepth:d=16,scaleCoefficient:g=1}){this.id=r,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:o,slotNumber:i,dateSampled:s,dateModified:c,useCompression:l,qualityBitDepth:d,scaleCoefficient:g,metadataVersion:Me}}duplicate(){const e=new ie.Mutable(ce(ae({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:new Date().toISOString()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(r=>r!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const r of a)this.sourceFileData.delete(r);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return Q(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const r=yield a.arrayBuffer(),o=new Uint8Array(r);return this.cacheSourceFileData(e,o),o}const t=yield we.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return Q(this,null,function*(){const e=new Map,t=[];return yield Ce.iterate((a,r)=>{a&&t.push(Jt(a).then(o=>{e.set(r,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${r}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return Q(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield nt(),a=(yield we.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,i])=>{const{sourceFileId:s}=i;return a.includes(s)?new ie.Mutable(ae({id:o},i)):(console.warn(`Found metadata "${i.name||o}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort((o,i)=>o>i?-1:i>o?1:0)})}};let z=ie;Se(z,"Mutable",class extends ie{constructor(e){super(e);setTimeout(()=>Q(this,null,function*(){(yield Ce.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return Q(this,null,function*(){yield Ce.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,r=typeof e=="function"?e(a):e;if(Object.keys(r).every(s=>r[s]===a[s]))return this;const o=ce(ae(ae({},a),r),{dateModified:new Date().toISOString()}),i=new ie.Mutable(ae({id:t},o));return i.persist(),i}remove(){return Q(this,null,function*(){if(yield Ce.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield ie.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield we.removeItem(this.metadata.sourceFileId)})}}),Se(z,"sourceFileData",new Map),Se(z,"recentlyCachedSourceFileIds",[]),Se(z,"MAX_CACHED",10);let Ie;function nt(){return Ie||(Ie=fetch("factory-samples.json").then(e=>e.json())),Ie}function Zt(){return Q(this,null,function*(){const e=yield nt();return new Map(e.map(t=>[t.id,new z(ce(ae({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(et.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(et.a)(t.trim.waveformPeaks.negative))}}}))]))})}var rt=Math.pow,Ne=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Le(e,t){const a=4,r=t[0]*a,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,r,o)}function xe(e,t){const a=e.length-t[0]-t[1],r=new Float32Array(a),o=Array(e.numberOfChannels).fill().map((i,s)=>Le(e.getChannelData(s),t));for(let i=0;i<a;i++){let s=0;for(let c=0;c<o.length;c++)s+=o[c][i];s/=o.length,r[i]=s}return r}function ot(e){let t=0;for(const a of e){const r=Math.abs(a);r>t&&(t=r)}return t}function qt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function ea(e,t){const a=rt(2,t-1);for(let r=0;r<e.length;r++)e[r]=Math.round(e[r]*a)/a}function lt(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function ta(e){const t=e.length,a=e[0].length,r=new Float32Array(t*a);for(let o=0;o<r.length;o++){const i=t*o;for(let s=0;s<t;s++)r[i+s]=e[s][o]}return r}function ct(e){const t=new Int16Array(e.length),a=rt(2,15);for(let r=0;r<e.length;r++)t[r]=e[r]===1?a-1:a*e[r];return t}function it(){return window.AudioContext||window.webkitAudioContext}let st;function ut(){const e=it();return st=st||new e({sampleRate:ge})}function se(e){return Ne(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((r,o)=>{ut().decodeAudioData(t.buffer,r,o)})})}function Fe(e,t){return Ne(this,null,function*(){const a=yield z.getSourceFileData(e),r=yield se(a);if(t)for(let o=0;o<r.numberOfChannels;o++)lt(r.getChannelData(o));return r})}function Te(e){return Ne(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:r,scaleCoefficient:o,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const s=yield Fe(a,Boolean(r)),c=s.numberOfChannels===1?Le(s.getChannelData(0),i):xe(s,i);o!==1&&qt(c,o),t<16&&ea(c,t);const l=ct(c),d=l.length*2,g=Ze()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:d}),f=new Uint8Array(g.length+d);return f.set(g),f.set(new Uint8Array(l.buffer),g.length),{data:f,sampleRate:16}})}const aa={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},dt=Object(u.createContext)(aa);function na({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((o,{onTimeUpdate:i=()=>null,onEnded:s=()=>null}={})=>{t.current();const c=ut(),l=c.createBufferSource();l.buffer=o,l.connect(c.destination),l.start();const d=c.currentTime;i(0);let g=requestAnimationFrame(f);function f(){i(c.currentTime-d),g=requestAnimationFrame(f)}let m=!1;l.addEventListener("ended",()=>{m||(i(o.duration),s()),cancelAnimationFrame(g)});function h(){m||(l.stop(),cancelAnimationFrame(g),s(),m=!0)}return t.current=h,h},[]),r=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(dt.Provider,{value:r},e)}function Oe(){return Object(u.useContext)(dt)}var ft=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const ue=6,mt=ue*44;function pt(e,t){const a=Math.floor(ue*e.length/t),r=new Float32Array(Math.floor(e.length/a)),o=new Float32Array(Math.floor(e.length/a));for(let i=0;i<r.length;i++){const s=new Float32Array(e.buffer,i*a*4,a);let c=0,l=0;for(const d of s)d>c&&(c=d),d<l&&(l=d);r[i]=Math.min(1,c),o[i]=Math.max(-1,l)}return{positive:r,negative:o}}function vt(e,t){return ft(this,null,function*(){const a=xe(e,t);return pt(a,mt)})}function ht(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let o=!1;return(()=>ft(this,null,function*(){if(o)return;const i=yield Fe(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));o||a([e.metadata.sourceFileId,i])}))(),()=>{o=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const r=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(r.current=e),{sample:r.current,sourceAudioBuffer:t&&t[1]}}function yt(e){const t=Object(u.useMemo)(()=>e?xe(e,[0,0]):new Float32Array,[e]),[a,r]=Object(u.useState)(null),o=Object(u.useMemo)(()=>a&&a.offsetWidth,[a]),i=Object(u.useMemo)(()=>!o||!t.length?{positive:new Float32Array,negative:new Float32Array}:pt(t,o),[o,t]);return{monoSamples:t,waveformRef:r,pixelWidth:o,peaks:i}}var ra=p(89);const oa=Je.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function la(e,t){function a(o,i){e.width=o,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const r=new ra.a(([o])=>{const{width:i,height:s}=o.contentRect;a(i,s),t({width:i,height:s})});return r.observe(e),()=>r.disconnect()}function ca(e,t,a){const r=getComputedStyle(document.documentElement),o=r.getPropertyValue("--bs-primary"),i=r.getPropertyValue("--bs-primary-darkened"),s=e.getContext("2d");s.imageSmoothingEnabled=!1;const{width:c,height:l}=e;s.clearRect(0,0,c,l);const d=Math.floor(l*(2/3))+1;s.fillStyle=o,t.positive.forEach((f,m)=>{const h=d*f,S=Math.max(Math.round(a*h),1);s.fillRect(m*ue,d-S,ue-1,S)});const g=l-d;s.fillStyle=i,t.negative.forEach((f,m)=>{const h=g*f*-1,S=Math.round(a*h);s.fillRect(m*ue,d,ue-1,S)})}function ia({peaks:e,scaleCoefficient:t,waveformRef:a}){const r=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>r.current);const[o,i]=Object(u.useState)(Symbol()),s=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!r.current)throw new Error("Canvas should be defined");return s.current.width=r.current.offsetWidth,s.current.height=r.current.offsetHeight,la(r.current,({width:c,height:l})=>{(c!==s.current.width||l!==s.current.height)&&(i(Symbol()),s.current.width=c,s.current.height=l)})},[]),Object(u.useLayoutEffect)(()=>{const c=r.current;if(!c)throw new Error("Canvas should be defined");let l=requestAnimationFrame(()=>{l=requestAnimationFrame(()=>{ca(c,e,t)})});return()=>cancelAnimationFrame(l)},[e,t,o]),n.a.createElement(oa,{ref:r})}var We=ia;const sa=Je.a.div({width:`${mt}px`,height:"40px"}),bt=typeof IntersectionObserver!="undefined",ua=n.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const r=Object(u.useRef)(null),[o,i]=Object(u.useState)(!bt);return Object(u.useLayoutEffect)(()=>{if(!bt)return;const s=r.current;if(!s)throw new Error("Waveform container should be defined");const c=s.getBoundingClientRect();if(c.top+c.height>=0&&c.bottom-c.height<=window.innerHeight){i(!0);return}const l=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),l.unobserve(s))});return l.observe(s),()=>l.disconnect()},[]),n.a.createElement(he.a.Item,{active:t,onClick:()=>a(e.id)},n.a.createElement("div",null,e.metadata.name),n.a.createElement(sa,{ref:r},o&&n.a.createElement(We,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function da({samples:e,selectedSampleId:t,onSampleSelect:a}){return n.a.createElement(he.a,{variant:"flush"},[...e].map(([r,o])=>n.a.createElement(ua,{key:r,sample:o,selected:r===t,onSampleSelect:a})))}var gt=da,fa=p(143),De=p(96),_=p(92),X=p(145),ma=p(90),pa=p(91),va=p(6),T=p.n(va);function ke(e,t){return`0:${e.toFixed(t).padStart(3+t,"0")}`}function ha({sample:e,previewWav:t,onSetTrimFrames:a,onSetScaleCoefficient:r}){const{sample:{metadata:{trim:{frames:o},scaleCoefficient:i}},sourceAudioBuffer:s}=ht(e),{monoSamples:c,waveformRef:l,pixelWidth:d,peaks:g}=yt(s),f=Object(u.useMemo)(()=>{if(!s)return 0;const H=Le(c,o);return ot(H)},[s,c,o]),m=1/f;Object(u.useLayoutEffect)(()=>{i>m&&r(m)},[i,m,r]);const[h,S]=Object(u.useState)(o);Object(u.useEffect)(()=>{S(o)},[o]);const b=Object(u.useMemo)(()=>{if(!c.length||!d)return[0,0];const H=d/c.length;return h.map(x=>x*H)},[d,c.length,h]),E=Object(u.useRef)(null),y=Object(u.useRef)(null),w=Object(u.useRef)(null),A=Object(u.useRef)(null),D=Object(u.useRef)(null),j=Object(u.useRef)(null);{const H=Object(u.useMemo)(()=>{if(!d||!c.length)return null;const N=Math.max(2e3,Math.ceil(10*c.length/d));return{pixelWidth:d,monoSamplesLength:c.length,minFrameWidth:N}},[d,c.length]),x=Object(u.useRef)(h);x.current=h,Object(u.useEffect)(()=>{if(!H||!E.current||!y.current||!D.current)return;const{pixelWidth:I,monoSamplesLength:N,minFrameWidth:G}=H,{left:Y}=D.current.getBoundingClientRect();function J(k){k.preventDefault(),document.body.style.userSelect="none";const{pageX:W}=k instanceof MouseEvent?k:k.touches[0];w.current=W}function de(k){k.preventDefault(),document.body.style.userSelect="none";const{pageX:W}=k instanceof MouseEvent?k:k.touches[0];A.current=W}function fe(k){if(k.preventDefault(),k.detail===2){a(()=>[0,0]);return}document.body.style.userSelect="none";const{clientX:W}=k instanceof MouseEvent?k:k.touches[0],me=(W-Y)/I,K=Math.round(N*me),V=K+G,F=V<N?V:K-G;F<0||(S([Math.min(K,F),N-1-Math.max(K,F)]),j.current=K)}function Xe(k){if(w.current===null)return;k.preventDefault();const{pageX:W}=k instanceof MouseEvent?k:k.touches[0],oe=W-w.current;if(oe){const me=oe/I,K=Math.round(N*me);S(V=>{let F=V[0]+K;return F=Math.min(F,N-V[1]-G),F=Math.max(F,0),[F,V[1]]}),w.current=W}}function Ge(k){if(A.current===null)return;k.preventDefault();const{pageX:W}=k instanceof MouseEvent?k:k.touches[0],oe=A.current-W;if(oe){const me=oe/I,K=Math.round(N*me);S(V=>{let F=V[1]+K;return F=Math.min(F,N-V[0]-G),F=Math.max(F,0),[V[0],F]}),A.current=W}}function Ye(k){if(j.current===null)return;k.preventDefault();const W=j.current,{clientX:oe}=k instanceof MouseEvent?k:k.touches[0],K=(oe-Y)/I,V=Math.max(0,Math.min(N-1,Math.round(N*K)));if(V!==j.current){const F=W+G,Ke=W-G,Wt=V>W?F<N?Math.max(V,F):Ke:Ke>=0?Math.min(V,Ke):F;S([Math.min(W,Wt),N-1-Math.max(W,Wt)])}}function Tt(k){Xe(k),Ge(k),Ye(k)}function $(k){(w.current!==null||A.current!==null||j.current!==null)&&(k.preventDefault(),a(()=>x.current),w.current=null,A.current=null,j.current=null),document.body.style.userSelect="unset"}const Z=E.current,q=y.current,ee=D.current;return Z.addEventListener("touchstart",J),Z.addEventListener("mousedown",J),q.addEventListener("touchstart",de),q.addEventListener("mousedown",de),ee.addEventListener("touchstart",fe),ee.addEventListener("mousedown",fe),Z.addEventListener("touchmove",Xe),q.addEventListener("touchmove",Ge),ee.addEventListener("touchmove",Ye),window.addEventListener("mousemove",Tt),Z.addEventListener("touchend",$),Z.addEventListener("touchcancel",$),q.addEventListener("touchend",$),q.addEventListener("touchcancel",$),ee.addEventListener("touchend",$),ee.addEventListener("touchcancel",$),window.addEventListener("mouseup",$),()=>{Z.removeEventListener("touchstart",J),Z.removeEventListener("mousedown",J),q.removeEventListener("touchstart",de),q.removeEventListener("mousedown",de),ee.removeEventListener("touchstart",fe),ee.removeEventListener("mousedown",fe),Z.removeEventListener("touchmove",Xe),q.removeEventListener("touchmove",Ge),ee.removeEventListener("touchmove",Ye),window.removeEventListener("mousemove",Tt),Z.removeEventListener("touchend",$),Z.removeEventListener("touchcancel",$),q.removeEventListener("touchend",$),q.removeEventListener("touchcancel",$),ee.removeEventListener("touchend",$),ee.removeEventListener("touchcancel",$),window.removeEventListener("mouseup",$)}},[H,a])}const{playAudioBuffer:B}=Oe(),M=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>M.current(),[e,h]);const[O,P]=Object(u.useState)(null);Object(u.useEffect)(()=>{t instanceof AudioBuffer&&O&&(P(null),O.fn())},[t,O]);const[C,R]=Object(u.useState)(0),[v,L]=Object(u.useState)(!1);return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:T.a.scaleButtonsContainer},n.a.createElement("div",{className:T.a.scaleButtons},n.a.createElement(_.a,{type:"button",variant:"light",disabled:i===m,onClick:()=>r(m)},"Normalize")," ",n.a.createElement(_.a,{type:"button",variant:"light",disabled:i===1,onClick:()=>r(1)},"Original level"))),n.a.createElement("div",{className:[T.a.waveformContainer,v?T.a.playbackActive:""].join(" "),style:{"--trim-pixels-left":`${b[0]}px`,"--trim-pixels-right":`${b[1]}px`,"--playback-progress":`${100*C}%`}},n.a.createElement(We,{waveformRef:l,peaks:g,scaleCoefficient:i}),n.a.createElement("div",{className:T.a.playbackOverlay},n.a.createElement("div",{className:T.a.playback})),n.a.createElement("div",{className:[T.a.trim,T.a.left].join(" ")},n.a.createElement("div",{className:T.a.bar}),n.a.createElement("div",{ref:E,className:T.a.handle}),s&&Boolean(c.length)&&n.a.createElement("span",{className:T.a.time},ke(s.duration*h[0]/c.length,2))),n.a.createElement("div",{className:[T.a.trim,T.a.right].join(" ")},n.a.createElement("div",{className:T.a.bar}),n.a.createElement("div",{ref:y,className:T.a.handle}),s&&Boolean(c.length)&&n.a.createElement("span",{className:T.a.time},ke(s.duration*(c.length-1-h[1])/c.length,2))),n.a.createElement("div",{ref:D,className:T.a.waveformOverlay}),n.a.createElement("div",{className:T.a.playbackButtonContainer},n.a.createElement(_.a,{variant:"dark",onClick:H=>{if(v){M.current();return}if(t)M.current=B(t,{onTimeUpdate(x){R(x/t.duration)},onEnded(){L(!1)}}),R(0),L(!0);else{const x=H.currentTarget;P({fn:()=>x.click()})}}},n.a.createElement("img",{src:v?pa.a:ma.a,alt:"Play preview"})),t&&n.a.createElement("span",null,ke(v?C*t.duration:t.duration,1)))))}var ya=ha,ba=p(151),ga=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});let Et;function Ea(){return ga(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Et=Et||new Promise((t,a)=>{let r;try{r={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){a(o);return}t(r)})})}var Sa=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function wa(e,t){let a=!1,r=()=>{};return{cancelWork(){a=!0,r()},sampleBufferPromise:(()=>Sa(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:s,getSampleBufferProgress:c,getSampleBufferTotalSize:l,cancelSampleBufferWork:d,registerUpdateCallback:g,unregisterUpdateCallback:f,heap8Buffer:m}=yield Ea();if(a)return new Uint8Array;const{data:h}=yield Te(e);if(a)return new Uint8Array;let S,b=0;const E=g(w=>{if(a)return;const A=l(w);S||(S=new Uint8Array(A));const D=i(w),j=s(w),B=c(w);S.set(new Uint8Array(m(),D,j),B-j),b=B/A}),y=o(h,h.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,E);t(b);try{yield new Promise(w=>{let A;r=()=>{cancelAnimationFrame(A),d(y),w()},D();function D(){if(b&&(t(b),b>=1)){w();return}A=requestAnimationFrame(D)}})}finally{r=()=>{},f(E)}if(a)return new Uint8Array;if(!S)throw new Error("Unexpected condition: sampleBuffer should be defined");return S}))()}}var Ca=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Oa({sample:e}){const[t,a]=Object(u.useState)(0),[r,o]=Object(u.useState)("idle"),[i,s]=Object(u.useState)(null),[c,l]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&c&&(l(null),c.fn())},[i,c]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let f=!1;a(0),o("idle"),s(null),l(null),d.current=()=>{f=!0};try{const{sampleBufferPromise:m,cancelWork:h}=wa(e,S=>{f||a(S)});d.current=()=>{h(),f=!0},m.then(S=>Ca(this,null,function*(){if(f)return;d.current=()=>{f=!0};const b=yield se(S);f||s(b)}))}catch(m){console.error(m),s(new Error(String(m)))}return()=>d.current()},[e]);const{playAudioBuffer:g}=Oe();return n.a.createElement(n.a.Fragment,null,n.a.createElement(_.a,{type:"button",variant:"primary",onClick:f=>{if(!(i instanceof AudioBuffer)){if(!i){const m=f.currentTarget;l({fn:()=>m.click()})}return}try{o("transferring");const m=g(i,{onTimeUpdate:h=>a(h/i.duration),onEnded:()=>o("idle")});d.current=()=>{m(),o("idle")}}catch(m){console.error(m),o("error")}},disabled:i instanceof Error||r==="transferring"},"Transfer to volca sample"),n.a.createElement("br",null),i&&r==="idle"?null:r==="error"?"Error transferring":n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),n.a.createElement(ba.a,{now:100*t}),n.a.createElement("br",null),n.a.createElement(_.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),n.a.createElement("br",null))}var St=Oa,wt=p(74),Ct=p.n(wt),Da=p(147),ka=p(142),_e=p(75),He=p(76),ja=p(93),Aa=p(19),ne=p.n(Aa),Ot=Math.pow;wt.Digit.defaultProps.offOpacity=0;const Dt=(e,t)=>Math.min(199,t+Ot(10,e)),kt=(e,t)=>Math.max(0,t-Ot(10,e));function Pa({slotNumber:e,onSlotNumberUpdate:t}){const[a,r]=Object(u.useState)(e);Object(u.useEffect)(()=>{r(e)},[e]);const[o,i]=Object(u.useState)(null),s=Object(u.useCallback)(g=>{t(f=>Dt(g,f))},[t]),c=Object(u.useCallback)(g=>{t(f=>kt(g,f))},[t]),l=Object(u.useRef)(null),d=Object(u.useRef)(null);{const g=Object(u.useRef)(o);g.current=o;const f=Object(u.useRef)(a);f.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function m(O){const P=g.current;if(P!==null)switch(O.stopPropagation(),O.preventDefault(),O.key){case"ArrowDown":r(C=>kt(P,C));break;case"ArrowUp":r(C=>Dt(P,C));break;case"ArrowLeft":i(C=>C!==null&&C<2?C+1:C);break;case"ArrowRight":i(C=>C&&C-1);break;case"Enter":case"Escape":i(null);break;default:break}}function h(O){const P=g.current;if(P===null)return;O.stopPropagation(),O.preventDefault();const C=f.current;if(isNaN(Number(O.key)))t(C);else{const R=String(C).padStart(3,"0").split("");R[2-P]=O.key;const v=Math.min(199,Math.max(0,Number(R.join(""))));i(P?P-1:null),t(v)}}function S(O){l.current&&l.current.contains(O.target)||i(null)}document.addEventListener("keydown",m,!0),document.addEventListener("keyup",h,!0),document.addEventListener("click",S);const b=l.current;let E=0,y=!1,w=!1,A=0;function D(O){document.body.style.userSelect="none",E=O instanceof MouseEvent?O.pageY:O.touches[0].pageY,y=!0,w=!1,A=f.current}b.addEventListener("mousedown",D),b.addEventListener("touchstart",O=>{O.preventDefault(),D(O)});function j(O){if(!y)return;const{pageY:P}=O instanceof MouseEvent?O:O.touches[0],C=2,R=Math.round((E-P)/C);R&&(w=!0,r(Math.min(199,Math.max(0,A+R))))}window.addEventListener("mousemove",j),b.addEventListener("touchmove",j);function B(){document.body.style.userSelect="unset",y=!1,w&&t(f.current)}window.addEventListener("mouseup",B),b.addEventListener("touchend",B),b.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function M(O){w||d.current&&d.current.some(P=>P.contains(O.target))||i(2)}return b.addEventListener("click",M),d.current.forEach((O,P)=>{const C=P;O.addEventListener("click",()=>{w||i(C)}),O.addEventListener("touchstart",R=>{R.preventDefault()})}),()=>{document.removeEventListener("keydown",m,!0),document.removeEventListener("keyup",h,!0),document.removeEventListener("click",S),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",B)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((g,f)=>{f===o?g.classList.add(ne.a.active):g.classList.remove(ne.a.active)})},[o]),n.a.createElement(n.a.Fragment,null,n.a.createElement(X.a.Label,null,"Destination"),n.a.createElement("br",null),n.a.createElement("div",{className:ne.a.slotNumberRow},n.a.createElement("div",{className:ne.a.slotNumberContainer},n.a.createElement("div",{className:ne.a.arrowControls},n.a.createElement("span",{onClick:()=>s(2)},n.a.createElement("img",{src:_e.a,alt:"Increment 100"})),n.a.createElement("span",{onClick:()=>s(1)},n.a.createElement("img",{src:_e.a,alt:"Increment 10"})),n.a.createElement("span",{onClick:()=>s(0)},n.a.createElement("img",{src:_e.a,alt:"Increment 1"}))),n.a.createElement("div",{className:ne.a.slotNumber,title:`Slot ${a}`,ref:l},n.a.createElement(Ct.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),n.a.createElement(Ct.a,{ref:g=>{const f=Object(Qe.findDOMNode)(g);if(f){f.querySelectorAll("circle").forEach(h=>{f.removeChild(h)});const m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.classList.add(ne.a.point),m.setAttribute("cx","10.7"),m.setAttribute("cy","17"),m.setAttribute("r","1"),f.appendChild(m),d.current=[].slice.call(f.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),n.a.createElement("div",{className:ne.a.arrowControls},n.a.createElement("span",{onClick:()=>c(2)},n.a.createElement("img",{src:He.a,alt:"Decrement 100"})),n.a.createElement("span",{onClick:()=>c(1)},n.a.createElement("img",{src:He.a,alt:"Decrement 10"})),n.a.createElement("span",{onClick:()=>c(0)},n.a.createElement("img",{src:He.a,alt:"Decrement 1"})))),e>99&&a>99&&n.a.createElement(Da.a,{placement:"auto-end",overlay:n.a.createElement(ka.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},n.a.createElement("img",{className:ne.a.warning,src:ja.a,alt:"destination-warning"}))))}var jt=Pa,Ra=p(42),Ve=p.n(Ra),Ba=Object.defineProperty,Ma=Object.defineProperties,Ia=Object.getOwnPropertyDescriptors,At=Object.getOwnPropertySymbols,Na=Object.prototype.hasOwnProperty,La=Object.prototype.propertyIsEnumerable,Pt=(e,t,a)=>t in e?Ba(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Rt=(e,t)=>{for(var a in t||(t={}))Na.call(t,a)&&Pt(e,a,t[a]);if(At)for(var a of At(t))La.call(t,a)&&Pt(e,a,t[a]);return e},Bt=(e,t)=>Ma(e,Ia(t)),xa=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Fa(e,t){const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)}function Ta({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:r}){const o=e&&e.id,i=Object(u.useCallback)(E=>o&&t(o,{scaleCoefficient:E}),[o,t]),s=Object(u.useCallback)(E=>o&&t(o,y=>Bt(Rt({},y),{trim:Bt(Rt({},y.trim),{frames:E(y.trim.frames)})})),[o,t]),[c,l]=Object(u.useState)(null),[d,g]=Object(u.useState)(null),[f,m]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&f&&(m(null),f.fn())},[d,f]),Object(u.useEffect)(()=>{l(null),m(null);let E=!1;Te(e).then(({data:y})=>{E||l(y)})},[e]),Object(u.useEffect)(()=>{if(g(null),c){let E=!1;se(c).then(y=>{E||g(y)})}},[c]);const{playAudioBuffer:h}=Oe(),S=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>S.current(),[e]);const b=Object(u.useCallback)(E=>{t(e.id,({slotNumber:y})=>({slotNumber:typeof E=="function"?E(y):E}))},[e.id,t]);return n.a.createElement(ye.a,{fluid:"sm"},n.a.createElement("h2",null,e.metadata.name,n.a.createElement(fa.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},n.a.createElement(De.a.Item,{onClick:()=>{const E=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),y=E&&E.trim();y&&t(e.id,{name:y})}},"Rename"),n.a.createElement(De.a.Item,{onClick:()=>a(e.id)},"Duplicate"),n.a.createElement(De.a.Divider,null),n.a.createElement(De.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&r(e.id)}},"Delete"))),n.a.createElement("p",null,n.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),n.a.createElement("br",null),n.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",{className:Ve.a.waveformContainer},n.a.createElement(ya,{onSetTrimFrames:s,onSetScaleCoefficient:i,sample:e,previewWav:d})),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(_.a,{type:"button",variant:"secondary",size:"sm",onClick:E=>{if(d)S.current=h(d);else{const y=E.currentTarget;m({fn:()=>y.click()})}}},"Play audio preview")," ",n.a.createElement(_.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>xa(this,null,function*(){const{sourceFileId:E,userFileInfo:y}=e.metadata,w=yield z.getSourceFileData(E),A=new Blob([w],{type:y?y.type:"audio/x-wav"});Fa(A,`${e.metadata.name}${y?y.ext:".wav"}`)})},"Download original file"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(X.a.Group,null,n.a.createElement(X.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),n.a.createElement(X.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:E=>{const y=Number(E.target.value);t(e.id,{qualityBitDepth:y})}})),n.a.createElement(jt,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:b}),n.a.createElement("br",null),n.a.createElement(St,{sample:e}))}var Wa=Ta,je=p(144);function _a({sample:e}){const{sample:{metadata:{scaleCoefficient:t}},sourceAudioBuffer:a}=ht(e),{waveformRef:r,peaks:o}=yt(a);return n.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},n.a.createElement(We,{waveformRef:r,peaks:o,scaleCoefficient:t}))}var Ha=_a,Va=Object.defineProperty,Ua=Object.defineProperties,za=Object.getOwnPropertyDescriptors,Mt=Object.getOwnPropertySymbols,$a=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable,It=(e,t,a)=>t in e?Va(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ga=(e,t)=>{for(var a in t||(t={}))$a.call(t,a)&&It(e,a,t[a]);if(Mt)for(var a of Mt(t))Xa.call(t,a)&&It(e,a,t[a]);return e},Ya=(e,t)=>Ua(e,za(t)),Ka=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Qa(e,t){const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)}function Ja(e){const t=e.metadata.slotNumber,[a,r]=Object(u.useState)(t);return Object(u.useEffect)(()=>{r(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new z(Ya(Ga({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:r}}function Za({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:r}=Ja(e),[o,i]=Object(u.useState)(null),[s,c]=Object(u.useState)(null),[l,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{s instanceof AudioBuffer&&l&&(d(null),l.fn())},[s,l]),Object(u.useEffect)(()=>{i(null),d(null);let m=!1;Te(a).then(({data:h})=>{m||i(h)})},[a]),Object(u.useEffect)(()=>{if(c(null),o){let m=!1;se(o).then(h=>{m||c(h)})}},[o]);const{playAudioBuffer:g}=Oe(),f=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>f.current(),[a]),n.a.createElement(ye.a,{fluid:"sm"},n.a.createElement("h2",null,a.metadata.name),n.a.createElement("p",null,n.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),n.a.createElement(je.a,{variant:"secondary"},n.a.createElement(je.a.Heading,null,"This is a factory sample."),n.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",n.a.createElement("span",{className:Ve.a.buttonLink},n.a.createElement(_.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),n.a.createElement("div",{className:Ve.a.waveformContainer},n.a.createElement(Ha,{sample:a})),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(_.a,{type:"button",variant:"secondary",size:"sm",onClick:m=>{if(s)f.current=g(s);else{const h=m.currentTarget;d({fn:()=>h.click()})}}},"Play audio preview")," ",n.a.createElement(_.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Ka(this,null,function*(){const{sourceFileId:m,userFileInfo:h}=a.metadata,S=yield z.getSourceFileData(m),b=new Blob([S],{type:h?h.type:"audio/x-wav"});Qa(b,`${a.metadata.name}${h?h.ext:".wav"}`)})},"Download original file"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(X.a.Group,null,n.a.createElement(X.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),n.a.createElement(X.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),n.a.createElement(jt,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:r}),n.a.createElement("br",null),n.a.createElement(St,{sample:a}))}var qa=Za,en=p(97),pe=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});let Nt;function Ue(){const e=it();return Nt=Nt||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:ge}:{})}function tn(){return pe(this,null,function*(){{const r=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of r.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput"),a=[];for(const r of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:r.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:c})=>r.deviceId===c).label;let s=1;{const c=o.getAudioTracks()[0],l=c.getSettings().channelCount;l?s=l:c.getCapabilities&&(s=(c.getCapabilities().channelCount||{}).max||s)}for(const c of o.getTracks())c.stop();a.push({device:{deviceId:r.deviceId,label:i},channelsAvailable:s})}return a})}let ze;function an(e){return pe(this,arguments,function*({onData:t,onFinish:a}){const r=Ue();ze=ze||r.audioWorklet.addModule("recorderWorkletProcessor.js"),yield ze;const o=new AudioWorkletNode(r,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=s=>{if(s.data.eventType==="data"){const c=s.data.audioChannels;t(c)}s.data.eventType==="stop"&&a()};const i=o.parameters.get("isRecording");return i.setValueAtTime(1,r.currentTime),{recorderNode:o,stop(){i.setValueAtTime(0,r.currentTime)}}})}function nn({channelCount:e,onData:t,onFinish:a}){const o=Ue().createScriptProcessor(1024,e,e);let i=!1;return o.onaudioprocess=s=>{const c=Array(e).fill().map((l,d)=>s.inputBuffer.getChannelData(d));t(c),i&&a()},{recorderNode:o,stop(){i=!0}}}function rn(e){return pe(this,null,function*(){return typeof AudioWorkletNode=="undefined"?nn(e):yield an(e)})}function on(e){return pe(this,arguments,function*({deviceId:t,channelCount:a,onStart:r,onUpdate:o}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:ge,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),s=Ue(),c=s.createMediaStreamSource(i),{recorderNode:l,stop:d}=yield rn({channelCount:a,onData:S,onFinish:A});c.connect(l),l.connect(s.destination);const g=10;r(s.sampleRate,g);const f=g*s.sampleRate;let m=0;const h=Array(a).fill([]);function S(D){let j=0;const B=[];for(let P=0;P<a;P++){const C=D[P],R=C.length,v=C.slice(0,Math.min(R,f-m));lt(v),j||(j=v.length),B.push(v)}const M=ta(B),O=ct(M);h.push(O),m+=j,m>=f&&d(),o(B)}let b,E;const y=new Promise((D,j)=>{b=D,E=j});let w=!1;function A(){return pe(this,null,function*(){if(w)return;try{const B=yield new Blob(h).arrayBuffer(),M=new Float32Array(B),O=Ze()({channels:a,sampleRate:s.sampleRate,bitDepth:16,dataLength:M.byteLength}),P=new Uint8Array(O.length+M.byteLength);P.set(O),P.set(new Uint8Array(M.buffer),O.length),b(P)}catch(j){E(j)}const D=i.getTracks();for(const j of D)j.stop();l.disconnect(s.destination),c.disconnect(l),w=!0})}return{stop:d,mediaRecording:y}})}var ln=p(46),Ae=p.n(ln),ve=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const Lt="capture_device_preference";let xt=null;function cn(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(Lt)||"null")),[r,o]=Object(u.useState)(xt),[i,s]=Object(u.useState)(r?"ok":"pending"),[c,l]=Object(u.useState)("");Object(u.useEffect)(()=>{xt=r,s("ok")},[r]);const d=Object(u.useCallback)(()=>{let C=!1;return tn().then(R=>{C||R.length&&(o(new Map(R.map(v=>[v.device.deviceId,v]))),l(v=>v?(a.current=null,v):a.current&&R.find(({device:L})=>a.current.deviceId===L.deviceId)?a.current.deviceId:(a.current=null,R[0].device.deviceId)))}).catch(R=>{if(!C){if(R instanceof DOMException){if(R.name==="NotAllowedError"){s("denied");return}if(R.name==="NotFoundError"){s("unavailable");return}}throw R}}),()=>{C=!0}},[]),[g,f]=Object(u.useState)(1);Object(u.useEffect)(()=>{const C=r&&r.get(c);C&&(a.current&&a.current.deviceId===C.device.deviceId&&a.current.channelCount<=C.channelsAvailable?f(a.current.channelCount):f(C.channelsAvailable),a.current=null)},[r,c]),Object(u.useEffect)(()=>{c&&localStorage.setItem(Lt,JSON.stringify({deviceId:c,channelCount:g}))},[c,g]);const[m,h]=Object(u.useState)("ready"),[S,b]=Object(u.useState)(null),[E,y]=Object(u.useState)(!1);Object(u.useEffect)(()=>{m!=="ready"&&y(!1)},[m]);const w=Object(u.useCallback)(()=>{y(!1)},[]),[A,D]=Object(u.useState)({fn(C){}});Object(u.useEffect)(()=>A.fn,[A]);const[j,B]=Object(u.useState)(1/0),[M,O]=Object(u.useState)(0),P=Object(u.useCallback)(()=>ve(this,null,function*(){let C=!1;const R=(I,N)=>on({deviceId:I,channelCount:N,onStart:(G,Y)=>{const J=Y*G;B(G),O(J),h("capturing")},onUpdate:e}),v=a.current,{mediaRecording:L,stop:H}=yield v?(()=>ve(this,null,function*(){try{return R(v.deviceId,v.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return R(c,g);throw I}}))():R(c,g);D({fn(I){H(),I&&(C=!0)}});let x;try{x=yield L}catch(I){b(I),h("error");return}if(C)h("ready");else{h("finalizing");const I=yield t(x);C||(h("ready"),I==="silent"&&y(!0))}}),[c,g,e,t]);return{captureDevices:r,accessState:i,selectedCaptureDeviceId:c,selectedChannelCount:g,captureState:m,recordingError:S,showSilenceWarning:E,sampleRate:j,maxSamples:M,refreshCaptureDevices:d,setSelectedCaptureDeviceId:l,setSelectedChannelCount:f,beginRecording:P,stopRecording:A.fn,dismissSilenceWarning:w}}const $e=3;function sn({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:r}){const o="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:s,height:c}=e;i.clearRect(0,0,s,c),i.fillStyle=o;for(let l=0;l<a&&l<t.length;l++){const d=t[l],g=c*d,f=Math.max(Math.round(r*g),2);i.fillRect(l*$e,c-f,$e-1,f)}}function un({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),r=Object(u.useRef)(new Float32Array),o=Object(u.useRef)(0),i=Object(u.useRef)([]),s=Object(u.useRef)(1/0),c=Object(u.useRef)(0),[l,d]=Object(u.useState)(0),g=Object(u.useCallback)(v=>ve(this,null,function*(){const L=a.current,H=r.current,x=i.current;if(x.push(v),c.current+=v[0].length,d(Math.floor(c.current/s.current)),x.reduce((N,[{length:G}])=>N+G,0)>=L){const N=yield Promise.all(v.map((Y,J)=>x.reduce((de,fe)=>[...de,fe[J]],[])).map(Y=>ve(this,null,function*(){const J=yield new Blob(Y).arrayBuffer();return new Float32Array(J)}))),G=N.map(Y=>ot(new Float32Array(Y.buffer,0,L)));H[o.current++]=Math.max(...G),sn({canvas:t.current,peaks:H,drawUntil:o.current,scaleCoefficient:.3}),i.current=[N.map(Y=>Y.slice(L))]}}),[]),{captureDevices:f,accessState:m,selectedCaptureDeviceId:h,selectedChannelCount:S,captureState:b,recordingError:E,showSilenceWarning:y,maxSamples:w,sampleRate:A,refreshCaptureDevices:D,setSelectedCaptureDeviceId:j,setSelectedChannelCount:B,beginRecording:M,stopRecording:O,dismissSilenceWarning:P}=cn(g,e);s.current=A,Object(u.useEffect)(()=>{const v=t.current;v&&(v.width=v.offsetWidth,v.height=v.offsetHeight)},[m]),Object(u.useLayoutEffect)(()=>{const v=t.current;!v||(b!=="finalizing"&&v.getContext("2d").clearRect(0,0,v.width,v.height),b==="capturing"&&w&&(a.current=Math.floor($e*w/t.current.width),r.current=new Float32Array(Math.floor(w/a.current)),o.current=0,i.current=[],s.current=1/0,c.current=0,d(0)))},[w,b]);const[C,R]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{C&&D()},[C,D]),n.a.createElement(ye.a,{fluid:"sm"},m==="denied"?n.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",n.a.createElement(_.a,{type:"button",variant:"secondary",onClick:D},"try again")):m==="unavailable"?n.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",n.a.createElement(_.a,{type:"button",variant:"secondary",onClick:D},"try again")):n.a.createElement("div",null,n.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),y&&n.a.createElement("div",{className:Ae.a.alertContainer},n.a.createElement(je.a,{dismissible:!0,variant:"warning",onClose:P},n.a.createElement(je.a.Heading,null,"Your recording was totally silent."),n.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),n.a.createElement(_.a,{className:Ae.a.recordButton,type:"button",variant:b==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:b==="capturing"?()=>O():M,disabled:b==="finalizing"},n.a.createElement("canvas",{ref:t}),n.a.createElement("span",{className:Ae.a.mainText},["capturing","finalizing"].includes(b)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(b)&&n.a.createElement("span",{className:Ae.a.timeRecorded},"0:",String(l).padStart(2,"0"))),["capturing","finalizing"].includes(b)?n.a.createElement(n.a.Fragment,null,n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(_.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>O(!0)},"Cancel")):n.a.createElement(n.a.Fragment,null,n.a.createElement("br",null),n.a.createElement(_.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>R(v=>!v)},"Audio input settings ",C?"\u25B2":"\u25BC"),n.a.createElement(en.a,{in:C},n.a.createElement("div",null,n.a.createElement(X.a.Group,null,n.a.createElement(X.a.Label,null,"Capture Device"),n.a.createElement(X.a.Select,{style:{width:250},value:h,onChange:v=>j(v.target.value)},f&&m==="ok"?[...f].map(([v,{device:L}])=>n.a.createElement("option",{key:v,value:v},L.label||v)):n.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),n.a.createElement(X.a.Group,null,n.a.createElement(X.a.Label,null,"Input channels"),n.a.createElement(X.a.Select,{style:{width:250},value:S,onChange:v=>B(Number(v.target.value))},[1,2].map(v=>n.a.createElement("option",{key:v,value:v,disabled:!f||!f.has(h)||f.get(h).channelsAvailable<v},v===1?"Mono":"Stereo (summed to mono)")))),n.a.createElement("br",null))))),b==="error"&&E||null,n.a.createElement("br",null),n.a.createElement(_.a,{style:{width:250},type:"button",variant:"secondary",onClick:v=>{const L=v.currentTarget.querySelector("input");L&&v.target!==L&&L.click()}},"Or import an audio file",n.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:v=>{if(v.target.files&&v.target.files.length){const L=v.target.files[0];L.arrayBuffer().then(H=>ve(this,null,function*(){const x=new Uint8Array(H);let I;try{I=yield se(x)}catch(N){alert("Unsupported audio format detected");return}if(I.length>10*I.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(x,L)}))}}})))}var dn=un,fn=p(80),Ft=p.n(fn),mn=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function pn(){const[e,t]=Object(u.useState)(new Map),[a,r]=Object(u.useState)(new Map),o=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{Zt().then(r).catch(console.error)},[]);const[i,s]=Object(u.useState)(null),[c,l]=Object(u.useState)(!0);Object(u.useEffect)(()=>{z.getAllFromStorage().then(S=>{t(b=>new Map([...b,...S.map(E=>[E.id,E])]))}).finally(()=>{l(!1)})},[]);const d=Object(u.useCallback)((S,b)=>mn(this,null,function*(){const E=yield se(S),y=[0,0],w=yield vt(E,y);if([...w.positive,...w.negative].every(M=>M===0))return"silent";const A=yield Kt(S);let D="",j="";if(b){const M=b.name.lastIndexOf(".");M>0?(D=b.name.slice(0,M),j=b.name.slice(M)):D=b.name}else D="New sample";const B=new z.Mutable({name:D,sourceFileId:A,trim:{frames:y,waveformPeaks:w},userFileInfo:b&&{type:b.type,ext:j}});return yield B.persist(),t(M=>new Map([[B.id,B],...M])),s(B.id),"saved"}),[]),g=Object(u.useCallback)((S,b)=>{t(E=>{const y=E.get(S);if(y&&y instanceof z.Mutable){const w=y.update(b);if(w!==y)return new Map(E).set(y.id,w)}return E})},[]),[f,m]=Object(u.useState)(!1),h=Object(u.useCallback)(S=>{s(S),m(!1)},[]);return n.a.createElement("div",null,n.a.createElement(Ut,{onMenuOpen:()=>m(!0),onHeaderClick:()=>s(null)}),n.a.createElement(Pe.a,{show:f,onHide:()=>m(!1)},n.a.createElement(Pe.a.Header,{closeButton:!0}),n.a.createElement(Pe.a.Body,null,n.a.createElement(he.a,null,n.a.createElement(he.a.Item,{as:"button",onClick:()=>h(null)},"New Sample"),c?"Loading...":null,!c&&n.a.createElement(le.a,{defaultActiveKey:e.size?"user":"factory"},n.a.createElement(le.a.Item,{eventKey:"user"},n.a.createElement(le.a.Header,null,"Your Samples"),n.a.createElement(le.a.Body,{style:{padding:0}},n.a.createElement(gt,{samples:e,selectedSampleId:i,onSampleSelect:h}))),n.a.createElement(le.a.Item,{eventKey:"factory"},n.a.createElement(le.a.Header,null,"Factory Samples"),n.a.createElement(le.a.Body,{style:{padding:0}},n.a.createElement(gt,{samples:a,selectedSampleId:i,onSampleSelect:h}))))))),n.a.createElement("div",{className:Ft.a.mainLayout},n.a.createElement("div",{className:Ft.a.focusedSampleContainer},i&&(()=>{const S=o.get(i)||null;if(!S)return null;const b=E=>{const y=o.get(E);if(y){const w=y.duplicate();t(A=>new Map([[w.id,w],...A])),s(w.id)}};return S instanceof z.Mutable?n.a.createElement(Wa,{sample:S,onSampleUpdate:g,onSampleDuplicate:b,onSampleDelete:E=>{const y=e.get(E);if(y&&y instanceof z.Mutable){y.remove();let w=null,A=!1;for(const[,D]of e){if(A){w=D.id;break}if(D.id===E){if(!w){A=!0;continue}break}w=D.id}s(w),t(D=>{const j=new Map(D);return j.delete(y.id),j})}}}):n.a.createElement(qa,{sample:S,onSampleDuplicate:b})})(),!i&&n.a.createElement(dn,{onRecordFinish:d}))))}var vn=pn,hn=e=>{e&&e instanceof Function&&p.e(3).then(p.bind(null,152)).then(({getCLS:t,getFID:a,getFCP:r,getLCP:o,getTTFB:i})=>{t(e),a(e),r(e),o(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),_t.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(na,null,n.a.createElement(vn,null))),document.getElementById("root")),hn()},19:function(U,te,p){U.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},20:function(U,te,p){U.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},42:function(U,te,p){U.exports={buttonLink:"SampleDetail_buttonLink__1lqYj",waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},46:function(U,te,p){U.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},6:function(U,te,p){U.exports={scaleButtonsContainer:"WaveformEdit_scaleButtonsContainer__248kb",scaleButtons:"WaveformEdit_scaleButtons__3u8fE",waveformContainer:"WaveformEdit_waveformContainer__Qq3MI",playbackOverlay:"WaveformEdit_playbackOverlay__1_jAo",playbackActive:"WaveformEdit_playbackActive__hTwgX",playback:"WaveformEdit_playback__2tuIe",trim:"WaveformEdit_trim__1GV76",bar:"WaveformEdit_bar__1KFgt",handle:"WaveformEdit_handle__23NoG",time:"WaveformEdit_time__YX5rg",left:"WaveformEdit_left__3Jfpn",right:"WaveformEdit_right__35CjW",waveformOverlay:"WaveformEdit_waveformOverlay__3oZfw",playbackButtonContainer:"WaveformEdit_playbackButtonContainer__3tLJJ"}},80:function(U,te,p){U.exports={mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}}},[[134,1,2]]]);

//# sourceMappingURL=main.3010db3c.chunk.js.map