(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{100:function(L,V,g){},131:function(L,V,g){"use strict";g.r(V);var u=g(0),r=g.n(u),je=g(9),gt=g.n(je),Ya=g(99),Ka=g(100),me=g(143),ae=g(146),_=g(145),ne=g(138),St=g(19),U=g.n(St);function Et({onMenuOpen:e,onHeaderClick:t}){return r.a.createElement("div",{className:U.a.titleBar},r.a.createElement("span",{className:U.a.menuIcon,onClick:e},"\u2630"),r.a.createElement(ne.a,{fluid:"sm",className:U.a.titleContainer},r.a.createElement("h1",{className:U.a.title,onClick:t},r.a.createElement("span",{className:U.a.titleText,"data-text":"Volca Sample"},"Volca Sample",r.a.createElement("span",{className:U.a.titleR},"r"),r.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:U.a.titleStarburst},Array(24).fill().map((a,n,{length:l})=>r.a.createElement("polygon",{key:n,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${n*360/l}deg`}})))),r.a.createElement("img",{className:U.a.titleGraphic,src:"volca_sample.png",alt:""}))),r.a.createElement("svg",{width:0,height:0},r.a.createElement("filter",{id:"outline"},r.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),r.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),r.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),r.a.createElement("feMerge",null,r.a.createElement("feMergeNode",{in:"OUTLINE"}),r.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var wt=Et,Be=g(52),Ct=g(53),Me=g.n(Ct),Ot=g(44),re=g.n(Ot),Ie=g(147),xe=g(78);const oe=31250;var Dt=Object.defineProperty,kt=Object.defineProperties,At=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,pe=(e,t,a)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,z=(e,t)=>{for(var a in t||(t={}))Ne.call(t,a)&&pe(e,a,t[a]);if(le)for(var a of le(t))Fe.call(t,a)&&pe(e,a,t[a]);return e},Z=(e,t)=>kt(e,At(t)),Le=(e,t)=>{var a={};for(var n in e)Ne.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&le)for(var n of le(e))t.indexOf(n)<0&&Fe.call(e,n)&&(a[n]=e[n]);return a},ce=(e,t,a)=>(pe(e,typeof t!="symbol"?t+"":t,a),a),T=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const ie=re.a.createInstance({name:"audio_file_data",driver:re.a.INDEXEDDB}),se=re.a.createInstance({name:"sample_metadata",driver:re.a.INDEXEDDB});function Rt(e){return T(this,null,function*(){const t=Object(Ie.a)();return yield ie.setItem(t,e),t})}const he="0.3.0",Pt={"0.1.0":e=>{const t=e,{clip:a}=t,n=Le(t,["clip"]);return Z(z({},n),{trimFrames:a.map(i=>Math.round(i*oe)),metadataVersion:"0.2.0"})},"0.2.0":e=>T(void 0,null,function*(){const t=e,{trimFrames:a}=t,n=Le(t,["trimFrames"]),l=yield Se(n.sourceFileId,!1),i=yield Qe(l,a),c={frames:a,waveformPeaks:i};return Z(z({},n),{trim:c,metadataVersion:"0.3.0"})})};function jt(e){return T(this,null,function*(){let t=e;for(;t.metadataVersion!==he;){const a=Pt[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:he};break}t=yield a(t)}return t})}const G=class{constructor({name:e,sourceFileId:t,trim:a,id:n=Object(Ie.a)(),userFileInfo:l=null,slotNumber:i=0,dateSampled:c=Date.now(),dateModified:s=c,useCompression:o=!0,qualityBitDepth:d=16,scaleCoefficient:E=1}){this.id=n,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:l,slotNumber:i,dateSampled:c,dateModified:s,useCompression:o,qualityBitDepth:d,scaleCoefficient:E,metadataVersion:he}}duplicate(){const e=new G.Mutable(Z(z({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(n=>n!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const n of a)this.sourceFileData.delete(n);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return T(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const n=yield a.arrayBuffer(),l=new Uint8Array(n);return this.cacheSourceFileData(e,l),l}const t=yield ie.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return T(this,null,function*(){const e=new Map,t=[];return yield se.iterate((a,n)=>{a&&t.push(jt(a).then(l=>{e.set(n,l)}).catch(l=>{console.error(l),console.warn(`Failed to upgrade metadata "${n}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return T(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield Te(),a=(yield ie.keys()).concat(t.map(({sourceFileId:l})=>l));return[...e].map(([l,i])=>{const{sourceFileId:c}=i;return a.includes(c)?new G.Mutable(z({id:l},i)):(console.warn(`Found metadata "${i.name||l}" with missing data "${c}; ignoring.`),null)}).filter(Boolean).sort((l,i)=>i.metadata.dateModified-l.metadata.dateModified)})}};let N=G;ce(N,"Mutable",class extends G{constructor(e){super(e);setTimeout(()=>T(this,null,function*(){(yield se.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return T(this,null,function*(){yield se.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,n=typeof e=="function"?e(a):e;if(Object.keys(n).every(c=>n[c]===a[c]))return this;const l=Z(z(z({},a),n),{dateModified:Date.now()}),i=new G.Mutable(z({id:t},l));return i.persist(),i}remove(){return T(this,null,function*(){if(yield se.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield G.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield ie.removeItem(this.metadata.sourceFileId)})}}),ce(N,"sourceFileData",new Map),ce(N,"recentlyCachedSourceFileIds",[]),ce(N,"MAX_CACHED",10);let ve;function Te(){return ve||(ve=fetch("factory-samples.json").then(e=>e.json())),ve}function Bt(){return T(this,null,function*(){const e=yield Te();return new Map(e.map(t=>[t.id,new N(Z(z({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(xe.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(xe.a)(t.trim.waveformPeaks.negative))}}}))]))})}var We=Math.pow,be=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ye(e,t){const a=4,n=t[0]*a,l=e.length-t[0]-t[1];return new Float32Array(e.buffer,n,l)}function ge(e,t){const a=e.length-t[0]-t[1],n=new Float32Array(a),l=Array(e.numberOfChannels).fill().map((i,c)=>ye(e.getChannelData(c),t));for(let i=0;i<a;i++){let c=0;for(let s=0;s<l.length;s++)c+=l[s][i];c/=l.length,n[i]=c}return n}function He(e){let t=0;for(const a of e){const n=Math.abs(a);n>t&&(t=n)}return t}function Mt(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function It(e,t){const a=We(2,t-1);for(let n=0;n<e.length;n++)e[n]=Math.round(e[n]*a)/a}function Ve(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function xt(e){const t=e.length,a=e[0].length,n=new Float32Array(t*a);for(let l=0;l<n.length;l++){const i=t*l;for(let c=0;c<t;c++)n[i+c]=e[c][l]}return n}function Ue(e){const t=new Int16Array(e.length),a=We(2,15);for(let n=0;n<e.length;n++)t[n]=e[n]===1?a-1:a*e[n];return t}function ze(){return window.AudioContext||window.webkitAudioContext}let $e;function _e(){const e=ze();return $e=$e||new e({sampleRate:oe})}function Y(e){return be(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((n,l)=>{_e().decodeAudioData(t.buffer,n,l)})})}function Se(e,t){return be(this,null,function*(){const a=yield N.getSourceFileData(e),n=yield Y(a);if(t)for(let l=0;l<n.numberOfChannels;l++)Ve(n.getChannelData(l));return n})}function Ee(e){return be(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:n,scaleCoefficient:l,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const c=yield Se(a,Boolean(n)),s=c.numberOfChannels===1?ye(c.getChannelData(0),i):ge(c,i);l!==1&&Mt(s,l),t<16&&It(s,t);const o=Ue(s),d=o.length*2,E=Me()({channels:1,sampleRate:c.sampleRate,bitDepth:16,dataLength:d}),m=new Uint8Array(E.length+d);return m.set(E),m.set(new Uint8Array(o.buffer),E.length),{data:m,sampleRate:16}})}const Nt={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},Xe=Object(u.createContext)(Nt);function Ft({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((l,{onTimeUpdate:i=()=>null,onEnded:c=()=>null}={})=>{t.current();const s=_e(),o=s.createBufferSource();o.buffer=l,o.connect(s.destination),o.start();const d=s.currentTime;i(0);let E=requestAnimationFrame(m);function m(){i(s.currentTime-d),E=requestAnimationFrame(m)}let h=!1;o.addEventListener("ended",()=>{h||(i(l.duration),c()),cancelAnimationFrame(E)});function S(){o.stop(),cancelAnimationFrame(E),h=!0}return t.current=S,S},[]),n=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(Xe.Provider,{value:n},e)}function we(){return Object(u.useContext)(Xe)}var Ge=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const K=6,Ye=K*44;function Ke(e,t){const a=Math.floor(K*e.length/t),n=new Float32Array(Math.floor(e.length/a)),l=new Float32Array(Math.floor(e.length/a));for(let i=0;i<n.length;i++){const c=new Float32Array(e.buffer,i*a*4,a);let s=0,o=0;for(const d of c)d>s&&(s=d),d<o&&(o=d);n[i]=Math.min(1,s),l[i]=Math.max(-1,o)}return{positive:n,negative:l}}function Qe(e,t){return Ge(this,null,function*(){const a=ge(e,t);return Ke(a,Ye)})}function Je(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let l=!1;return(()=>Ge(this,null,function*(){if(l)return;const i=yield Se(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));l||a([e.metadata.sourceFileId,i])}))(),()=>{l=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const n=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(n.current=e),{sample:n.current,sourceAudioBuffer:t&&t[1]}}function Ze(e){const t=Object(u.useMemo)(()=>e?ge(e,[0,0]):new Float32Array,[e]),[a,n]=Object(u.useState)(null),l=Object(u.useMemo)(()=>a&&a.offsetWidth,[a]),i=Object(u.useMemo)(()=>!l||!t.length?{positive:new Float32Array,negative:new Float32Array}:Ke(t,l),[l,t]);return{monoSamples:t,waveformRef:n,pixelWidth:l,peaks:i}}var Lt=g(88);const Tt=Be.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function Wt(e,t){function a(l,i){e.width=l,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const n=new Lt.a(([l])=>{const{width:i,height:c}=l.contentRect;a(i,c),t({width:i,height:c})});return n.observe(e),()=>n.disconnect()}function Ht(e,t,a){const n=getComputedStyle(document.documentElement),l=n.getPropertyValue("--bs-primary"),i=n.getPropertyValue("--bs-primary-darkened"),c=e.getContext("2d");c.imageSmoothingEnabled=!1;const{width:s,height:o}=e;c.clearRect(0,0,s,o);const d=Math.floor(o*(2/3))+1;c.fillStyle=l,t.positive.forEach((m,h)=>{const S=d*m,w=Math.max(Math.round(a*S),1);c.fillRect(h*K,d-w,K-1,w)});const E=o-d;c.fillStyle=i,t.negative.forEach((m,h)=>{const S=E*m*-1,w=Math.round(a*S);c.fillRect(h*K,d,K-1,w)})}function Vt({peaks:e,scaleCoefficient:t,waveformRef:a}){const n=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>n.current);const[l,i]=Object(u.useState)(Symbol()),c=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!n.current)throw new Error("Canvas should be defined");return c.current.width=n.current.offsetWidth,c.current.height=n.current.offsetHeight,Wt(n.current,({width:s,height:o})=>{(s!==c.current.width||o!==c.current.height)&&(i(Symbol()),c.current.width=s,c.current.height=o)})},[]),Object(u.useLayoutEffect)(()=>{const s=n.current;if(!s)throw new Error("Canvas should be defined");let o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{Ht(s,e,t)})});return()=>cancelAnimationFrame(o)},[e,t,l]),r.a.createElement(Tt,{ref:n})}var Ce=Vt;const Ut=Be.a.div({width:`${Ye}px`,height:"40px"}),qe=typeof IntersectionObserver!="undefined",zt=r.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const n=Object(u.useRef)(null),[l,i]=Object(u.useState)(!qe);return Object(u.useLayoutEffect)(()=>{if(!qe)return;const c=n.current;if(!c)throw new Error("Waveform container should be defined");const s=c.getBoundingClientRect();if(s.top+s.height>=0&&s.bottom-s.height<=window.innerHeight){i(!0);return}const o=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),o.unobserve(c))});return o.observe(c),()=>o.disconnect()},[]),r.a.createElement(ae.a.Item,{active:t,onClick:()=>a(e.id)},r.a.createElement("div",null,e.metadata.name),r.a.createElement(Ut,{ref:n},l&&r.a.createElement(Ce,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function $t({samples:e,selectedSampleId:t,onSampleSelect:a}){return r.a.createElement(ae.a,{variant:"flush"},[...e].map(([n,l])=>r.a.createElement(zt,{key:n,sample:l,selected:n===t,onSampleSelect:a})))}var et=$t,_t=g(140),ue=g(93),x=g(89),F=g(142);function Xt({sample:e,onSetTrimFrames:t,onSetScaleCoefficient:a}){const{sample:{metadata:{trim:{frames:n},scaleCoefficient:l}},sourceAudioBuffer:i}=Je(e),{monoSamples:c,waveformRef:s,pixelWidth:o,peaks:d}=Ze(i),E=Object(u.useMemo)(()=>{if(!i)return 0;const f=ye(c,n);return He(f)},[i,c,n]),m=1/E;Object(u.useLayoutEffect)(()=>{l>m&&a(m)},[l,m,a]);const[h,S]=Object(u.useState)(n);Object(u.useEffect)(()=>{S(n)},[n]);const w=Object(u.useMemo)(()=>{if(!c.length||!o)return[0,0];const f=o/c.length;return h.map(y=>y*f)},[o,c.length,h]),v=Object(u.useRef)(null),b=Object(u.useRef)(null);{const f=Object(u.useRef)(h);f.current=h,Object(u.useEffect)(()=>{function y(D){if(!o||!c.length)return;const j=Math.max(2e3,Math.ceil(10*c.length/o)),{pageX:k}=D;if(v.current!==null){const O=k-v.current;if(O){const B=O/o,C=Math.round(c.length*B);S(R=>{let p=R[0]+C;return p=Math.min(p,c.length-R[1]-j),p=Math.max(p,0),[p,R[1]]}),v.current=k}}if(b.current!==null){const O=b.current-k;if(O){const B=O/o,C=Math.round(c.length*B);S(R=>{let p=R[1]+C;return p=Math.min(p,c.length-R[0]-j),p=Math.max(p,0),[R[0],p]}),b.current=k}}}function A(){(v.current!==null||b.current!==null)&&t(()=>f.current),v.current=null,b.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",y),window.addEventListener("mouseup",A),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",A)}},[o,c.length,t])}return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},r.a.createElement(x.a,{type:"button",variant:"light",disabled:l===m,onClick:()=>a(m)},"Normalize")," ",r.a.createElement(x.a,{type:"button",variant:"light",disabled:l===1,onClick:()=>a(1)},"Original level"))),r.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:s,peaks:d,scaleCoefficient:l}),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${w[0]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:1,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:25,height:25,background:"#fff",border:"1px solid var(--bs-dark)",borderRadius:"50%",transform:"translateX(calc(50% - 0.5px))"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",v.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",v.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),v.current===null||!o||!c.length)return;const{pageX:y}=f.touches[0],A=y-v.current;if(A){const D=A/o,P=Math.round(c.length*D);t(j=>{let k=j[0]+P;return k=Math.min(k,c.length-j[1]-2e3),k=Math.max(k,0),[k,j[1]]}),v.current=y}},onTouchEnd:()=>{v.current=null},onTouchCancel:()=>{v.current=null}})),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${w[1]}px)`,background:"#f3f3f3"}},r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:1,background:"var(--bs-dark)"}}),r.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:25,height:25,background:"#fff",border:"1px solid var(--bs-dark)",borderRadius:"50%",transform:"translateX(calc(-50% + 0.5px))"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",b.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",b.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),b.current===null||!o||!c.length)return;const{pageX:y}=f.touches[0],A=b.current-y;if(A){const D=A/o,P=Math.round(c.length*D);t(j=>{let k=j[1]+P;return k=Math.min(k,c.length-j[0]-2e3),k=Math.max(k,0),[j[0],k]}),b.current=y}},onTouchEnd:()=>{b.current=null},onTouchCancel:()=>{b.current=null}})),r.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,cursor:"text",background:"red"},ref:f=>{!f||(f.width=f.offsetWidth,f.height=f.offsetHeight)}})))}var Gt=Xt,Yt=g(148),Kt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});let tt;function Qt(){return Kt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return tt=tt||new Promise((t,a)=>{let n;try{n={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(l){return e.addFunction(l,"vi")},unregisterUpdateCallback(l){e.removeFunction(l)},heap8Buffer(){return e.HEAP8.buffer}}}catch(l){a(l);return}t(n)})})}var Jt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function Zt(e,t){let a=!1,n=()=>{};return{cancelWork(){a=!0,n()},sampleBufferPromise:(()=>Jt(this,null,function*(){const{prepareSampleBufferFromWavData:l,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:c,getSampleBufferProgress:s,getSampleBufferTotalSize:o,cancelSampleBufferWork:d,registerUpdateCallback:E,unregisterUpdateCallback:m,heap8Buffer:h}=yield Qt();if(a)return new Uint8Array;const{data:S}=yield Ee(e);if(a)return new Uint8Array;let w,v=0;const b=E(y=>{if(a)return;const A=o(y);w||(w=new Uint8Array(A));const D=i(y),P=c(y),j=s(y);w.set(new Uint8Array(h(),D,P),j-P),v=j/A}),f=l(S,S.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,b);t(v);try{yield new Promise(y=>{let A;n=()=>{cancelAnimationFrame(A),d(f),y()},D();function D(){if(v&&(t(v),v>=1)){y();return}A=requestAnimationFrame(D)}})}finally{n=()=>{},m(b)}if(a)return new Uint8Array;if(!w)throw new Error("Unexpected condition: sampleBuffer should be defined");return w}))()}}var qt=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ea({sample:e}){const[t,a]=Object(u.useState)(0),[n,l]=Object(u.useState)("idle"),[i,c]=Object(u.useState)(null),[s,o]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&s&&(o(null),s.fn())},[i,s]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let m=!1;a(0),l("idle"),c(null),o(null),d.current=()=>{m=!0};try{const{sampleBufferPromise:h,cancelWork:S}=Zt(e,w=>{m||a(w)});d.current=()=>{S(),m=!0},h.then(w=>qt(this,null,function*(){if(m)return;d.current=()=>{m=!0};const v=yield Y(w);m||c(v)}))}catch(h){console.error(h),c(new Error(String(h)))}return()=>d.current()},[e]);const{playAudioBuffer:E}=we();return r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{type:"button",variant:"primary",onClick:m=>{if(!(i instanceof AudioBuffer)){if(!i){const h=m.currentTarget;o({fn:()=>h.click()})}return}try{l("transferring");const h=E(i,{onTimeUpdate:S=>a(S/i.duration),onEnded:()=>l("idle")});d.current=()=>{h(),l("idle")}}catch(h){console.error(h),l("error")}},disabled:i instanceof Error||n==="transferring"},"Transfer to volca sample"),r.a.createElement("br",null),i&&n==="idle"?null:n==="error"?"Error transferring":r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),r.a.createElement(Yt.a,{now:100*t}),r.a.createElement("br",null),r.a.createElement(x.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),r.a.createElement("br",null))}var at=ea,nt=g(73),rt=g.n(nt),ta=g(144),aa=g(139),Oe=g(74),De=g(75),na=g(90),ra=g(18),W=g.n(ra),ot=Math.pow;nt.Digit.defaultProps.offOpacity=0;const lt=(e,t)=>Math.min(199,t+ot(10,e)),ct=(e,t)=>Math.max(0,t-ot(10,e));function oa({slotNumber:e,onSlotNumberUpdate:t}){const[a,n]=Object(u.useState)(e);Object(u.useEffect)(()=>{n(e)},[e]);const[l,i]=Object(u.useState)(null),c=Object(u.useCallback)(E=>{t(m=>lt(E,m))},[t]),s=Object(u.useCallback)(E=>{t(m=>ct(E,m))},[t]),o=Object(u.useRef)(null),d=Object(u.useRef)(null);{const E=Object(u.useRef)(l);E.current=l;const m=Object(u.useRef)(a);m.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function h(O){const B=E.current;if(B!==null)switch(O.stopPropagation(),O.preventDefault(),O.key){case"ArrowDown":n(C=>ct(B,C));break;case"ArrowUp":n(C=>lt(B,C));break;case"ArrowLeft":i(C=>C!==null&&C<2?C+1:C);break;case"ArrowRight":i(C=>C&&C-1);break;case"Enter":case"Escape":i(null);break;default:break}}function S(O){const B=E.current;if(B===null)return;O.stopPropagation(),O.preventDefault();const C=m.current;if(isNaN(Number(O.key)))t(C);else{const R=String(C).padStart(3,"0").split("");R[2-B]=O.key;const p=Math.min(199,Math.max(0,Number(R.join(""))));i(B?B-1:null),t(p)}}function w(O){o.current&&o.current.contains(O.target)||i(null)}document.addEventListener("keydown",h,!0),document.addEventListener("keyup",S,!0),document.addEventListener("click",w);const v=o.current;let b=0,f=!1,y=!1,A=0;function D(O){document.body.style.userSelect="none",b=O instanceof MouseEvent?O.pageY:O.touches[0].pageY,f=!0,y=!1,A=m.current}v.addEventListener("mousedown",D),v.addEventListener("touchstart",O=>{O.preventDefault(),D(O)});function P(O){if(!f)return;const{pageY:B}=O instanceof MouseEvent?O:O.touches[0],C=2,R=Math.round((b-B)/C);R&&(y=!0,n(Math.min(199,Math.max(0,A+R))))}window.addEventListener("mousemove",P),v.addEventListener("touchmove",P);function j(){document.body.style.userSelect="unset",f=!1,y&&t(m.current)}window.addEventListener("mouseup",j),v.addEventListener("touchend",j),v.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function k(O){y||d.current&&d.current.some(B=>B.contains(O.target))||i(2)}return v.addEventListener("click",k),d.current.forEach((O,B)=>{const C=B;O.addEventListener("click",()=>{y||i(C)}),O.addEventListener("touchstart",R=>{R.preventDefault()})}),()=>{document.removeEventListener("keydown",h,!0),document.removeEventListener("keyup",S,!0),document.removeEventListener("click",w),window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",j)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((E,m)=>{m===l?E.classList.add(W.a.active):E.classList.remove(W.a.active)})},[l]),r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a.Label,null,"Destination"),r.a.createElement("br",null),r.a.createElement("div",{className:W.a.slotNumberRow},r.a.createElement("div",{className:W.a.slotNumberContainer},r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>c(2)},r.a.createElement("img",{src:Oe.a,alt:"Increment 100"})),r.a.createElement("span",{onClick:()=>c(1)},r.a.createElement("img",{src:Oe.a,alt:"Increment 10"})),r.a.createElement("span",{onClick:()=>c(0)},r.a.createElement("img",{src:Oe.a,alt:"Increment 1"}))),r.a.createElement("div",{className:W.a.slotNumber,title:`Slot ${a}`,ref:o},r.a.createElement(rt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),r.a.createElement(rt.a,{ref:E=>{const m=Object(je.findDOMNode)(E);if(m){m.querySelectorAll("circle").forEach(S=>{m.removeChild(S)});const h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.classList.add(W.a.point),h.setAttribute("cx","10.7"),h.setAttribute("cy","17"),h.setAttribute("r","1"),m.appendChild(h),d.current=[].slice.call(m.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),r.a.createElement("div",{className:W.a.arrowControls},r.a.createElement("span",{onClick:()=>s(2)},r.a.createElement("img",{src:De.a,alt:"Decrement 100"})),r.a.createElement("span",{onClick:()=>s(1)},r.a.createElement("img",{src:De.a,alt:"Decrement 10"})),r.a.createElement("span",{onClick:()=>s(0)},r.a.createElement("img",{src:De.a,alt:"Decrement 1"})))),e>99&&a>99&&r.a.createElement(ta.a,{placement:"auto-end",overlay:r.a.createElement(aa.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},r.a.createElement("img",{className:W.a.warning,src:na.a,alt:"destination-warning"}))))}var it=oa,la=g(41),ke=g.n(la),ca=Object.defineProperty,ia=Object.defineProperties,sa=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,ua=Object.prototype.hasOwnProperty,da=Object.prototype.propertyIsEnumerable,ut=(e,t,a)=>t in e?ca(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,dt=(e,t)=>{for(var a in t||(t={}))ua.call(t,a)&&ut(e,a,t[a]);if(st)for(var a of st(t))da.call(t,a)&&ut(e,a,t[a]);return e},ft=(e,t)=>ia(e,sa(t)),fa=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ma(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function pa({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:n}){const l=e&&e.id,i=Object(u.useCallback)(b=>l&&t(l,{scaleCoefficient:b}),[l,t]),c=Object(u.useCallback)(b=>l&&t(l,f=>ft(dt({},f),{trim:ft(dt({},f.trim),{frames:b(f.trim.frames)})})),[l,t]),[s,o]=Object(u.useState)(null),[d,E]=Object(u.useState)(null),[m,h]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&m&&(h(null),m.fn())},[d,m]),Object(u.useEffect)(()=>{o(null),h(null);let b=!1;Ee(e).then(({data:f})=>{b||o(f)})},[e]),Object(u.useEffect)(()=>{if(E(null),s){let b=!1;Y(s).then(f=>{b||E(f)})}},[s]);const{playAudioBuffer:S}=we(),w=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>w.current(),[e]);const v=Object(u.useCallback)(b=>{t(e.id,({slotNumber:f})=>({slotNumber:typeof b=="function"?b(f):b}))},[e.id,t]);return r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,e.metadata.name,r.a.createElement(_t.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},r.a.createElement(ue.a.Item,{onClick:()=>{const b=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),f=b&&b.trim();f&&t(e.id,{name:f})}},"Rename"),r.a.createElement(ue.a.Item,{onClick:()=>a(e.id)},"Duplicate"),r.a.createElement(ue.a.Divider,null),r.a.createElement(ue.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&n(e.id)}},"Delete"))),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),r.a.createElement("br",null),r.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:ke.a.waveformContainer},r.a.createElement(Gt,{onSetTrimFrames:c,onSetScaleCoefficient:i,sample:e})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(x.a,{type:"button",variant:"secondary",size:"sm",onClick:b=>{if(d)w.current=S(d);else{const f=b.currentTarget;h({fn:()=>f.click()})}}},"Play audio preview")," ",r.a.createElement(x.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>fa(this,null,function*(){const{sourceFileId:b,userFileInfo:f}=e.metadata,y=yield N.getSourceFileData(b),A=new Blob([y],{type:f?f.type:"audio/x-wav"});ma(A,`${e.metadata.name}${f?f.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:b=>{const f=Number(b.target.value);t(e.id,{qualityBitDepth:f})}})),r.a.createElement(it,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:v}),r.a.createElement("br",null),r.a.createElement(at,{sample:e}))}var ha=pa,de=g(141);function va({sample:e}){const{sample:{metadata:{scaleCoefficient:t}},sourceAudioBuffer:a}=Je(e),{waveformRef:n,peaks:l}=Ze(a);return r.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},r.a.createElement(Ce,{waveformRef:n,peaks:l,scaleCoefficient:t}))}var ba=va,ya=Object.defineProperty,ga=Object.defineProperties,Sa=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,wa=Object.prototype.propertyIsEnumerable,pt=(e,t,a)=>t in e?ya(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ca=(e,t)=>{for(var a in t||(t={}))Ea.call(t,a)&&pt(e,a,t[a]);if(mt)for(var a of mt(t))wa.call(t,a)&&pt(e,a,t[a]);return e},Oa=(e,t)=>ga(e,Sa(t)),Da=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function ka(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(a)}function Aa(e){const t=e.metadata.slotNumber,[a,n]=Object(u.useState)(t);return Object(u.useEffect)(()=>{n(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new N(Oa(Ca({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:n}}function Ra({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:n}=Aa(e),[l,i]=Object(u.useState)(null),[c,s]=Object(u.useState)(null),[o,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{c instanceof AudioBuffer&&o&&(d(null),o.fn())},[c,o]),Object(u.useEffect)(()=>{i(null),d(null);let h=!1;Ee(a).then(({data:S})=>{h||i(S)})},[a]),Object(u.useEffect)(()=>{if(s(null),l){let h=!1;Y(l).then(S=>{h||s(S)})}},[l]);const{playAudioBuffer:E}=we(),m=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>m.current(),[a]),r.a.createElement(ne.a,{fluid:"sm"},r.a.createElement("h2",null,a.metadata.name),r.a.createElement("p",null,r.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),r.a.createElement(de.a,{variant:"secondary"},r.a.createElement(de.a.Heading,null,"This is a factory sample."),r.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",r.a.createElement("span",{className:ke.a.buttonLink},r.a.createElement(x.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),r.a.createElement("div",{className:ke.a.waveformContainer},r.a.createElement(ba,{sample:a})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(x.a,{type:"button",variant:"secondary",size:"sm",onClick:h=>{if(c)m.current=E(c);else{const S=h.currentTarget;d({fn:()=>S.click()})}}},"Play audio preview")," ",r.a.createElement(x.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Da(this,null,function*(){const{sourceFileId:h,userFileInfo:S}=a.metadata,w=yield N.getSourceFileData(h),v=new Blob([w],{type:S?S.type:"audio/x-wav"});ka(v,`${a.metadata.name}${S?S.ext:".wav"}`)})},"Download original file"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),r.a.createElement(F.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),r.a.createElement(it,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:n}),r.a.createElement("br",null),r.a.createElement(at,{sample:a}))}var Pa=Ra,ja=g(94),q=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});let ht;function Ae(){const e=ze();return ht=ht||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:oe}:{})}function Ba(){return q(this,null,function*(){{const n=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const l of n.getTracks())l.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput"),a=[];for(const n of t){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:s})=>n.deviceId===s).label;let c=1;{const s=l.getAudioTracks()[0],o=s.getSettings().channelCount;o?c=o:s.getCapabilities&&(c=(s.getCapabilities().channelCount||{}).max||c)}for(const s of l.getTracks())s.stop();a.push({device:{deviceId:n.deviceId,label:i},channelsAvailable:c})}return a})}let Re;function Ma(e){return q(this,arguments,function*({onData:t,onFinish:a}){const n=Ae();Re=Re||n.audioWorklet.addModule("recorderWorkletProcessor.js"),yield Re;const l=new AudioWorkletNode(n,"recorder-worklet",{parameterData:{bufferSize:1024}});l.port.onmessage=c=>{if(c.data.eventType==="data"){const s=c.data.audioChannels;t(s)}c.data.eventType==="stop"&&a()};const i=l.parameters.get("isRecording");return i.setValueAtTime(1,n.currentTime),{recorderNode:l,stop(){i.setValueAtTime(0,n.currentTime)}}})}function Ia({channelCount:e,onData:t,onFinish:a}){const l=Ae().createScriptProcessor(1024,e,e);let i=!1;return l.onaudioprocess=c=>{const s=Array(e).fill().map((o,d)=>c.inputBuffer.getChannelData(d));t(s),i&&a()},{recorderNode:l,stop(){i=!0}}}function xa(e){return q(this,null,function*(){return typeof AudioWorkletNode=="undefined"?Ia(e):yield Ma(e)})}function Na(e){return q(this,arguments,function*({deviceId:t,channelCount:a,onStart:n,onUpdate:l}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:oe,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),c=Ae(),s=c.createMediaStreamSource(i),{recorderNode:o,stop:d}=yield xa({channelCount:a,onData:w,onFinish:A});s.connect(o),o.connect(c.destination);const E=10;n(c.sampleRate,E);const m=E*c.sampleRate;let h=0;const S=Array(a).fill([]);function w(D){let P=0;const j=[];for(let B=0;B<a;B++){const C=D[B],R=C.length,p=C.slice(0,Math.min(R,m-h));Ve(p),P||(P=p.length),j.push(p)}const k=xt(j),O=Ue(k);S.push(O),h+=P,h>=m&&d(),l(j)}let v,b;const f=new Promise((D,P)=>{v=D,b=P});let y=!1;function A(){return q(this,null,function*(){if(y)return;try{const j=yield new Blob(S).arrayBuffer(),k=new Float32Array(j),O=Me()({channels:a,sampleRate:c.sampleRate,bitDepth:16,dataLength:k.byteLength}),B=new Uint8Array(O.length+k.byteLength);B.set(O),B.set(new Uint8Array(k.buffer),O.length),v(B)}catch(P){b(P)}const D=i.getTracks();for(const P of D)P.stop();o.disconnect(c.destination),s.disconnect(o),y=!0})}return{stop:d,mediaRecording:f}})}var Fa=g(45),fe=g.n(Fa),ee=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});const vt="capture_device_preference";let bt=null;function La(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(vt)||"null")),[n,l]=Object(u.useState)(bt),[i,c]=Object(u.useState)(n?"ok":"pending"),[s,o]=Object(u.useState)("");Object(u.useEffect)(()=>{bt=n,c("ok")},[n]);const d=Object(u.useCallback)(()=>{let C=!1;return Ba().then(R=>{C||R.length&&(l(new Map(R.map(p=>[p.device.deviceId,p]))),o(p=>p?(a.current=null,p):a.current&&R.find(({device:M})=>a.current.deviceId===M.deviceId)?a.current.deviceId:(a.current=null,R[0].device.deviceId)))}).catch(R=>{if(!C){if(R instanceof DOMException){if(R.name==="NotAllowedError"){c("denied");return}if(R.name==="NotFoundError"){c("unavailable");return}}throw R}}),()=>{C=!0}},[]),[E,m]=Object(u.useState)(1);Object(u.useEffect)(()=>{const C=n&&n.get(s);C&&(a.current&&a.current.deviceId===C.device.deviceId&&a.current.channelCount<=C.channelsAvailable?m(a.current.channelCount):m(C.channelsAvailable),a.current=null)},[n,s]),Object(u.useEffect)(()=>{s&&localStorage.setItem(vt,JSON.stringify({deviceId:s,channelCount:E}))},[s,E]);const[h,S]=Object(u.useState)("ready"),[w,v]=Object(u.useState)(null),[b,f]=Object(u.useState)(!1);Object(u.useEffect)(()=>{h!=="ready"&&f(!1)},[h]);const y=Object(u.useCallback)(()=>{f(!1)},[]),[A,D]=Object(u.useState)({fn(C){}});Object(u.useEffect)(()=>A.fn,[A]);const[P,j]=Object(u.useState)(1/0),[k,O]=Object(u.useState)(0),B=Object(u.useCallback)(()=>ee(this,null,function*(){let C=!1;const R=(I,X)=>Na({deviceId:I,channelCount:X,onStart:(J,$)=>{const te=$*J;j(J),O(te),S("capturing")},onUpdate:e}),p=a.current,{mediaRecording:M,stop:Q}=yield p?(()=>ee(this,null,function*(){try{return R(p.deviceId,p.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return R(s,E);throw I}}))():R(s,E);D({fn(I){Q(),I&&(C=!0)}});let H;try{H=yield M}catch(I){v(I),S("error");return}if(C)S("ready");else{S("finalizing");const I=yield t(H);C||(S("ready"),I==="silent"&&f(!0))}}),[s,E,e,t]);return{captureDevices:n,accessState:i,selectedCaptureDeviceId:s,selectedChannelCount:E,captureState:h,recordingError:w,showSilenceWarning:b,sampleRate:P,maxSamples:k,refreshCaptureDevices:d,setSelectedCaptureDeviceId:o,setSelectedChannelCount:m,beginRecording:B,stopRecording:A.fn,dismissSilenceWarning:y}}const Pe=3;function Ta({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:n}){const l="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:c,height:s}=e;i.clearRect(0,0,c,s),i.fillStyle=l;for(let o=0;o<a&&o<t.length;o++){const d=t[o],E=s*d,m=Math.max(Math.round(n*E),2);i.fillRect(o*Pe,s-m,Pe-1,m)}}function Wa({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),n=Object(u.useRef)(new Float32Array),l=Object(u.useRef)(0),i=Object(u.useRef)([]),c=Object(u.useRef)(1/0),s=Object(u.useRef)(0),[o,d]=Object(u.useState)(0),E=Object(u.useCallback)(p=>ee(this,null,function*(){const M=a.current,Q=n.current,H=i.current;if(H.push(p),s.current+=p[0].length,d(Math.floor(s.current/c.current)),H.reduce((X,[{length:J}])=>X+J,0)>=M){const X=yield Promise.all(p.map(($,te)=>H.reduce((Xa,Ga)=>[...Xa,Ga[te]],[])).map($=>ee(this,null,function*(){const te=yield new Blob($).arrayBuffer();return new Float32Array(te)}))),J=X.map($=>He(new Float32Array($.buffer,0,M)));Q[l.current++]=Math.max(...J),Ta({canvas:t.current,peaks:Q,drawUntil:l.current,scaleCoefficient:.3}),i.current=[X.map($=>$.slice(M))]}}),[]),{captureDevices:m,accessState:h,selectedCaptureDeviceId:S,selectedChannelCount:w,captureState:v,recordingError:b,showSilenceWarning:f,maxSamples:y,sampleRate:A,refreshCaptureDevices:D,setSelectedCaptureDeviceId:P,setSelectedChannelCount:j,beginRecording:k,stopRecording:O,dismissSilenceWarning:B}=La(E,e);c.current=A,Object(u.useEffect)(()=>{const p=t.current;p&&(p.width=p.offsetWidth,p.height=p.offsetHeight)},[h]),Object(u.useLayoutEffect)(()=>{const p=t.current;!p||(v!=="finalizing"&&p.getContext("2d").clearRect(0,0,p.width,p.height),v==="capturing"&&y&&(a.current=Math.floor(Pe*y/t.current.width),n.current=new Float32Array(Math.floor(y/a.current)),l.current=0,i.current=[],c.current=1/0,s.current=0,d(0)))},[y,v]);const[C,R]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{C&&D()},[C,D]),r.a.createElement(ne.a,{fluid:"sm"},h==="denied"?r.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",r.a.createElement(x.a,{type:"button",variant:"secondary",onClick:D},"try again")):h==="unavailable"?r.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",r.a.createElement(x.a,{type:"button",variant:"secondary",onClick:D},"try again")):r.a.createElement("div",null,r.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),f&&r.a.createElement("div",{className:fe.a.alertContainer},r.a.createElement(de.a,{dismissible:!0,variant:"warning",onClose:B},r.a.createElement(de.a.Heading,null,"Your recording was totally silent."),r.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),r.a.createElement(x.a,{className:fe.a.recordButton,type:"button",variant:v==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:v==="capturing"?()=>O():k,disabled:v==="finalizing"},r.a.createElement("canvas",{ref:t}),r.a.createElement("span",{className:fe.a.mainText},["capturing","finalizing"].includes(v)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(v)&&r.a.createElement("span",{className:fe.a.timeRecorded},"0:",String(o).padStart(2,"0"))),["capturing","finalizing"].includes(v)?r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(x.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>O(!0)},"Cancel")):r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(x.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>R(p=>!p)},"Audio input settings ",C?"\u25B2":"\u25BC"),r.a.createElement(ja.a,{in:C},r.a.createElement("div",null,r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Capture Device"),r.a.createElement(F.a.Select,{style:{width:250},value:S,onChange:p=>P(p.target.value)},m&&h==="ok"?[...m].map(([p,{device:M}])=>r.a.createElement("option",{key:p,value:p},M.label||p)):r.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),r.a.createElement(F.a.Group,null,r.a.createElement(F.a.Label,null,"Input channels"),r.a.createElement(F.a.Select,{style:{width:250},value:w,onChange:p=>j(Number(p.target.value))},[1,2].map(p=>r.a.createElement("option",{key:p,value:p,disabled:!m||!m.has(S)||m.get(S).channelsAvailable<p},p===1?"Mono":"Stereo (summed to mono)")))),r.a.createElement("br",null))))),v==="error"&&b||null,r.a.createElement("br",null),r.a.createElement(x.a,{style:{width:250},type:"button",variant:"secondary",onClick:p=>{const M=p.currentTarget.querySelector("input");M&&p.target!==M&&M.click()}},"Or import an audio file",r.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:p=>{if(p.target.files&&p.target.files.length){const M=p.target.files[0];M.arrayBuffer().then(Q=>ee(this,null,function*(){const H=new Uint8Array(Q);let I;try{I=yield Y(H)}catch(X){alert("Unsupported audio format detected");return}if(I.length>10*I.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(H,M)}))}}})))}var Ha=Wa,Va=g(79),yt=g.n(Va),Ua=(e,t,a)=>new Promise((n,l)=>{var i=o=>{try{s(a.next(o))}catch(d){l(d)}},c=o=>{try{s(a.throw(o))}catch(d){l(d)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);s((a=a.apply(e,t)).next())});function za(){const[e,t]=Object(u.useState)(new Map),[a,n]=Object(u.useState)(new Map),l=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{Bt().then(n).catch(console.error)},[]);const[i,c]=Object(u.useState)(null),[s,o]=Object(u.useState)(!0);Object(u.useEffect)(()=>{N.getAllFromStorage().then(w=>{t(v=>new Map([...v,...w.map(b=>[b.id,b])]))}).finally(()=>{o(!1)})},[]);const d=Object(u.useCallback)((w,v)=>Ua(this,null,function*(){const b=yield Y(w),f=[0,0],y=yield Qe(b,f);if([...y.positive,...y.negative].every(k=>k===0))return"silent";const A=yield Rt(w);let D="",P="";if(v){const k=v.name.lastIndexOf(".");k>0?(D=v.name.slice(0,k),P=v.name.slice(k)):D=v.name}else D="New sample";const j=new N.Mutable({name:D,sourceFileId:A,trim:{frames:f,waveformPeaks:y},userFileInfo:v&&{type:v.type,ext:P}});return yield j.persist(),t(k=>new Map([[j.id,j],...k])),c(j.id),"saved"}),[]),E=Object(u.useCallback)((w,v)=>{t(b=>{const f=b.get(w);if(f&&f instanceof N.Mutable){const y=f.update(v);if(y!==f)return new Map(b).set(f.id,y)}return b})},[]),[m,h]=Object(u.useState)(!1),S=Object(u.useCallback)(w=>{c(w),h(!1)},[]);return r.a.createElement("div",null,r.a.createElement(wt,{onMenuOpen:()=>h(!0),onHeaderClick:()=>c(null)}),r.a.createElement(me.a,{show:m,onHide:()=>h(!1)},r.a.createElement(me.a.Header,{closeButton:!0}),r.a.createElement(me.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,{as:"button",onClick:()=>S(null)},"New Sample"),s?"Loading...":null,!s&&r.a.createElement(_.a,{defaultActiveKey:e.size?"user":"factory"},r.a.createElement(_.a.Item,{eventKey:"user"},r.a.createElement(_.a.Header,null,"Your Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:e,selectedSampleId:i,onSampleSelect:S}))),r.a.createElement(_.a.Item,{eventKey:"factory"},r.a.createElement(_.a.Header,null,"Factory Samples"),r.a.createElement(_.a.Body,{style:{padding:0}},r.a.createElement(et,{samples:a,selectedSampleId:i,onSampleSelect:S}))))))),r.a.createElement("div",{className:yt.a.mainLayout},r.a.createElement("div",{className:yt.a.focusedSampleContainer},i&&(()=>{const w=l.get(i)||null;if(!w)return null;const v=b=>{const f=l.get(b);if(f){const y=f.duplicate();t(A=>new Map([[y.id,y],...A])),c(y.id)}};return w instanceof N.Mutable?r.a.createElement(ha,{sample:w,onSampleUpdate:E,onSampleDuplicate:v,onSampleDelete:b=>{const f=e.get(b);if(f&&f instanceof N.Mutable){f.remove();let y=null,A=!1;for(const[,D]of e){if(A){y=D.id;break}if(D.id===b){if(!y){A=!0;continue}break}y=D.id}c(y),t(D=>{const P=new Map(D);return P.delete(f.id),P})}}}):r.a.createElement(Pa,{sample:w,onSampleDuplicate:v})})(),!i&&r.a.createElement(Ha,{onRecordFinish:d}))))}var $a=za,_a=e=>{e&&e instanceof Function&&g.e(3).then(g.bind(null,149)).then(({getCLS:t,getFID:a,getFCP:n,getLCP:l,getTTFB:i})=>{t(e),a(e),n(e),l(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),gt.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ft,null,r.a.createElement($a,null))),document.getElementById("root")),_a()},18:function(L,V,g){L.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},19:function(L,V,g){L.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},41:function(L,V,g){L.exports={buttonLink:"SampleDetail_buttonLink__1lqYj",waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},45:function(L,V,g){L.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},79:function(L,V,g){L.exports={mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}},99:function(L,V,g){}},[[131,1,2]]]);

//# sourceMappingURL=main.eeaecc5a.chunk.js.map