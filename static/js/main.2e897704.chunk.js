(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{102:function(z,ae,y){},103:function(z,ae,y){},134:function(z,ae,y){"use strict";y.r(ae);var u=y(0),n=y.n(u),nt=y(10),ea=y.n(nt),Mn=y(102),In=y(103),Le=y(146),he=y(149),ce=y(148),ye=y(141),ta=y(20),oe=y.n(ta);function aa({onMenuOpen:e,onHeaderClick:t}){return n.a.createElement("div",{className:oe.a.titleBar},n.a.createElement("span",{className:oe.a.menuIcon,onClick:e},"\u2630"),n.a.createElement(ye.a,{fluid:"sm",className:oe.a.titleContainer},n.a.createElement("h1",{className:oe.a.title,onClick:t},n.a.createElement("span",{className:oe.a.titleText,"data-text":"Volca Sample"},"Volca Sample",n.a.createElement("span",{className:oe.a.titleR},"r"),n.a.createElement("svg",{viewBox:"0 0 150 150",preserveAspectRatio:"none",className:oe.a.titleStarburst},Array(24).fill().map((a,r,{length:o})=>n.a.createElement("polygon",{key:r,points:"75,70 75,80 150,75","transform-origin":"75 75",style:{"--rotation":`${r*360/o}deg`}})))),n.a.createElement("img",{className:oe.a.titleGraphic,src:"volca_sample.png",alt:""}))),n.a.createElement("svg",{width:0,height:0},n.a.createElement("filter",{id:"outline"},n.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),n.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),n.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),n.a.createElement("feMerge",null,n.a.createElement("feMergeNode",{in:"OUTLINE"}),n.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var na=aa,rt=y(53),ra=y(54),ot=y.n(ra),oa=y(45),be=y.n(oa),lt=y(150),ct=y(79);const ge=31250;var la=Object.defineProperty,ca=Object.defineProperties,ia=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,it=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable,Ne=(e,t,a)=>t in e?la(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,ne=(e,t)=>{for(var a in t||(t={}))it.call(t,a)&&Ne(e,a,t[a]);if(Ee)for(var a of Ee(t))st.call(t,a)&&Ne(e,a,t[a]);return e},ue=(e,t)=>ca(e,ia(t)),xe=(e,t)=>{var a={};for(var r in e)it.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&Ee)for(var r of Ee(e))t.indexOf(r)<0&&st.call(e,r)&&(a[r]=e[r]);return a},Se=(e,t,a)=>(Ne(e,typeof t!="symbol"?t+"":t,a),a),Z=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const we=be.a.createInstance({name:"audio_file_data",driver:be.a.INDEXEDDB}),Oe=be.a.createInstance({name:"sample_metadata",driver:be.a.INDEXEDDB});function sa(e){return Z(this,null,function*(){const t=Object(lt.a)();return yield we.setItem(t,e),t})}const Fe="0.4.0",ua={"0.1.0":e=>{const t=e,{clip:a}=t,r=xe(t,["clip"]);return ue(ne({},r),{trimFrames:a.map(i=>Math.round(i*ge)),metadataVersion:"0.2.0"})},"0.2.0":e=>Z(void 0,null,function*(){const t=e,{trimFrames:a}=t,r=xe(t,["trimFrames"]),o=yield Ve(r.sourceFileId,!1),i=yield wt(o,a),s={frames:a,waveformPeaks:i};return ue(ne({},r),{trim:s,metadataVersion:"0.3.0"})}),"0.3.0":e=>{const t=e,{dateSampled:a,dateModified:r}=t,o=xe(t,["dateSampled","dateModified"]);return ue(ne({},o),{dateSampled:new Date(a).toISOString(),dateModified:new Date(r).toISOString(),metadataVersion:"0.4.0"})}};function da(e){return Z(this,null,function*(){let t=e;for(;t.metadataVersion!==Fe;){const a=ua[e.metadataVersion];if(!a){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:Fe};break}t=yield a(t)}return t})}const de=class{constructor({name:e,sourceFileId:t,trim:a,id:r=Object(lt.a)(),userFileInfo:o=null,slotNumber:i=0,dateSampled:s=new Date().toISOString(),dateModified:c=s,useCompression:l=!0,qualityBitDepth:d=16,scaleCoefficient:E=1}){this.id=r,this.metadata={name:e,sourceFileId:t,trim:a,userFileInfo:o,slotNumber:i,dateSampled:s,dateModified:c,useCompression:l,qualityBitDepth:d,scaleCoefficient:E,metadataVersion:Fe}}duplicate(){const e=new de.Mutable(ue(ne({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:new Date().toISOString()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(r=>r!==e)];const a=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const r of a)this.sourceFileData.delete(r);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return Z(this,null,function*(){{const a=this.sourceFileData.get(e);if(a)return a}if(e.includes(".")){const a=yield fetch(e);if(a.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const r=yield a.arrayBuffer(),o=new Uint8Array(r);return this.cacheSourceFileData(e,o),o}const t=yield we.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return Z(this,null,function*(){const e=new Map,t=[];return yield Oe.iterate((a,r)=>{a&&t.push(da(a).then(o=>{e.set(r,o)}).catch(o=>{console.error(o),console.warn(`Failed to upgrade metadata "${r}" (${a.name}); ignoring.`)}))}),yield Promise.all(t),e})}static getAllFromStorage(){return Z(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield ut(),a=(yield we.keys()).concat(t.map(({sourceFileId:o})=>o));return[...e].map(([o,i])=>{const{sourceFileId:s}=i;return a.includes(s)?new de.Mutable(ne({id:o},i)):(console.warn(`Found metadata "${i.name||o}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort(({metadata:{dateModified:o}},{metadata:{dateModified:i}})=>o>i?-1:i>o?1:0)})}};let $=de;Se($,"Mutable",class extends de{constructor(e){super(e);setTimeout(()=>Z(this,null,function*(){(yield Oe.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return Z(this,null,function*(){yield Oe.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:a}=this,r=typeof e=="function"?e(a):e;if(Object.keys(r).every(s=>r[s]===a[s]))return this;const o=ue(ne(ne({},a),r),{dateModified:new Date().toISOString()}),i=new de.Mutable(ne({id:t},o));return i.persist(),i}remove(){return Z(this,null,function*(){if(yield Oe.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield de.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield we.removeItem(this.metadata.sourceFileId)})}}),Se($,"sourceFileData",new Map),Se($,"recentlyCachedSourceFileIds",[]),Se($,"MAX_CACHED",10);let Te;function ut(){return Te||(Te=fetch("factory-samples.json").then(e=>e.json())),Te}function fa(){return Z(this,null,function*(){const e=yield ut();return new Map(e.map(t=>[t.id,new $(ue(ne({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(ct.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(ct.a)(t.trim.waveformPeaks.negative))}}}))]))})}var dt=Math.pow,We=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function _e(e,t){const a=4,r=t[0]*a,o=e.length-t[0]-t[1];return new Float32Array(e.buffer,r,o)}function He(e,t){const a=e.length-t[0]-t[1],r=new Float32Array(a),o=Array(e.numberOfChannels).fill().map((i,s)=>_e(e.getChannelData(s),t));for(let i=0;i<a;i++){let s=0;for(let c=0;c<o.length;c++)s+=o[c][i];s/=o.length,r[i]=s}return r}function ft(e){let t=0;for(const a of e){const r=Math.abs(a);r>t&&(t=r)}return t}function ma(e,t){if(t!==1)for(let a=0;a<e.length;a++)e[a]*=t}function pa(e,t){const a=dt(2,t-1);for(let r=0;r<e.length;r++)e[r]=Math.round(e[r]*a)/a}function mt(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function va(e){const t=e.length,a=e[0].length,r=new Float32Array(t*a);for(let o=0;o<r.length;o++){const i=t*o;for(let s=0;s<t;s++)r[i+s]=e[s][o]}return r}function pt(e){const t=new Int16Array(e.length),a=dt(2,15);for(let r=0;r<e.length;r++)t[r]=e[r]===1?a-1:a*e[r];return t}function vt(){return window.AudioContext||window.webkitAudioContext}let ht;function yt(){const e=vt();return ht=ht||new e({sampleRate:ge})}function fe(e){return We(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((r,o)=>{yt().decodeAudioData(t.buffer,r,o)})})}function Ve(e,t){return We(this,null,function*(){const a=yield $.getSourceFileData(e),r=yield fe(a);if(t)for(let o=0;o<r.numberOfChannels;o++)mt(r.getChannelData(o));return r})}function Ue(e){return We(this,null,function*(){const{qualityBitDepth:t,sourceFileId:a,userFileInfo:r,scaleCoefficient:o,trim:{frames:i}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const s=yield Ve(a,Boolean(r)),c=s.numberOfChannels===1?_e(s.getChannelData(0),i):He(s,i);o!==1&&ma(c,o),t<16&&pa(c,t);const l=pt(c),d=l.length*2,E=ot()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:d}),m=new Uint8Array(E.length+d);return m.set(E),m.set(new Uint8Array(l.buffer),E.length),{data:m,sampleRate:16}})}const ha={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")}},bt=Object(u.createContext)(ha);function ya({children:e}){const t=Object(u.useRef)(()=>{}),a=Object(u.useCallback)((o,{onTimeUpdate:i=()=>null,onEnded:s=()=>null}={})=>{t.current();const c=yt(),l=c.createBufferSource();l.buffer=o,l.connect(c.destination),l.start();const d=c.currentTime;i(0);let E=requestAnimationFrame(m);function m(){i(c.currentTime-d),E=requestAnimationFrame(m)}let p=!1;l.addEventListener("ended",()=>{p||(i(o.duration),s()),cancelAnimationFrame(E)});function b(){p||(l.stop(),cancelAnimationFrame(E),s(),p=!0)}return t.current=b,b},[]),r=Object(u.useMemo)(()=>({playAudioBuffer:a}),[a]);return Object(u.createElement)(bt.Provider,{value:r},e)}function Ce(){return Object(u.useContext)(bt)}var gt=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const me=6,Et=me*44;function St(e,t){const a=Math.floor(me*e.length/t),r=new Float32Array(Math.floor(e.length/a)),o=new Float32Array(Math.floor(e.length/a));for(let i=0;i<r.length;i++){const s=new Float32Array(e.buffer,i*a*4,a);let c=0,l=0;for(const d of s)d>c&&(c=d),d<l&&(l=d);r[i]=Math.min(1,c),o[i]=Math.max(-1,l)}return{positive:r,negative:o}}function wt(e,t){return gt(this,null,function*(){const a=He(e,t);return St(a,Et)})}function Ot(e){const[t,a]=Object(u.useState)(null);Object(u.useEffect)(()=>{let o=!1;return(()=>gt(this,null,function*(){if(o)return;const i=yield Ve(e.metadata.sourceFileId,Boolean(e.metadata.userFileInfo));o||a([e.metadata.sourceFileId,i])}))(),()=>{o=!0}},[e.metadata.sourceFileId,e.metadata.userFileInfo]);const r=Object(u.useRef)(e);return t&&e.metadata.sourceFileId===t[0]&&(r.current=e),{sample:r.current,sourceAudioBuffer:t&&t[1]}}function Ct(e){const t=Object(u.useMemo)(()=>e?He(e,[0,0]):new Float32Array,[e]),[a,r]=Object(u.useState)(null),[o,i]=Object(u.useState)({width:0,height:0}),s=Object(u.useMemo)(()=>a&&o.width,[a,o]),c=Object(u.useMemo)(()=>!s||!t.length?{positive:new Float32Array,negative:new Float32Array}:St(t,s),[s,t]);return{monoSamples:t,waveformRef:r,pixelWidth:s,peaks:c,onResize:i}}var ba=y(89),ga=Object.defineProperty,Dt=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,Sa=Object.prototype.propertyIsEnumerable,kt=(e,t,a)=>t in e?ga(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,jt=(e,t)=>{for(var a in t||(t={}))Ea.call(t,a)&&kt(e,a,t[a]);if(Dt)for(var a of Dt(t))Sa.call(t,a)&&kt(e,a,t[a]);return e};const wa=rt.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function Oa(e,t){function a(o,i){e.width=o,e.height=i}a(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const r=new ba.a(([o])=>{const{width:i,height:s}=o.contentRect;a(i,s),t({width:i,height:s})});return r.observe(e),()=>r.disconnect()}function Ca(e,t,a){const r=getComputedStyle(document.documentElement),o=r.getPropertyValue("--bs-primary"),i=r.getPropertyValue("--bs-primary-darkened"),s=e.getContext("2d");s.imageSmoothingEnabled=!1;const{width:c,height:l}=e;s.clearRect(0,0,c,l);const d=Math.floor(l*(2/3))+1;s.fillStyle=o,t.positive.forEach((m,p)=>{const b=d*m,h=Math.max(Math.round(a*b),1);s.fillRect(p*me,d-h,me-1,h)});const E=l-d;s.fillStyle=i,t.negative.forEach((m,p)=>{const b=E*m*-1,h=Math.round(a*b);s.fillRect(p*me,d,me-1,h)})}function Da({peaks:e,scaleCoefficient:t,waveformRef:a,onResize:r}){const o=Object(u.useRef)(null);Object(u.useImperativeHandle)(a,()=>o.current);const[i,s]=Object(u.useState)(Symbol()),c=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!o.current)throw new Error("Canvas should be defined");return c.current.width=o.current.offsetWidth,c.current.height=o.current.offsetHeight,r&&r(jt({},c.current)),Oa(o.current,({width:l,height:d})=>{(l!==c.current.width||d!==c.current.height)&&(s(Symbol()),c.current.width=l,c.current.height=d,r&&r(jt({},c.current)))})},[r]),Object(u.useLayoutEffect)(()=>{const l=o.current;if(!l)throw new Error("Canvas should be defined");let d=requestAnimationFrame(()=>{d=requestAnimationFrame(()=>{Ca(l,e,t)})});return()=>cancelAnimationFrame(d)},[e,t,i]),n.a.createElement(wa,{ref:o})}var ze=Da;const ka=rt.a.div({width:`${Et}px`,height:"40px"}),Pt=typeof IntersectionObserver!="undefined",ja=n.a.memo(({sample:e,selected:t,onSampleSelect:a})=>{const r=Object(u.useRef)(null),[o,i]=Object(u.useState)(!Pt);return Object(u.useLayoutEffect)(()=>{if(!Pt)return;const s=r.current;if(!s)throw new Error("Waveform container should be defined");const c=s.getBoundingClientRect();if(c.top+c.height>=0&&c.bottom-c.height<=window.innerHeight){i(!0);return}const l=new IntersectionObserver(([d])=>{d.isIntersecting&&(i(!0),l.unobserve(s))});return l.observe(s),()=>l.disconnect()},[]),n.a.createElement(he.a.Item,{active:t,onClick:()=>a(e.id)},n.a.createElement("div",null,e.metadata.name),n.a.createElement(ka,{ref:r},o&&n.a.createElement(ze,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function Pa({samples:e,selectedSampleId:t,onSampleSelect:a}){return n.a.createElement(he.a,{variant:"flush"},[...e].map(([r,o])=>n.a.createElement(ja,{key:r,sample:o,selected:r===t,onSampleSelect:a})))}var At=Pa,Aa=y(143),De=y(96),V=y(92),Y=y(145),Rt=y(147),Bt=y(142),Ra=y(90),Ba=y(91),Ma=y(6),W=y.n(Ma);function ke(e,t){return`0:${e.toFixed(t).padStart(3+t,"0")}`}function Ia({sample:e,previewWav:t,onSetTrimFrames:a,onSetScaleCoefficient:r}){const{sample:{metadata:{trim:{frames:o},scaleCoefficient:i}},sourceAudioBuffer:s}=Ot(e),{monoSamples:c,waveformRef:l,pixelWidth:d,peaks:E,onResize:m}=Ct(s),p=Object(u.useMemo)(()=>{if(!s)return 0;const L=_e(c,o);return ft(L)},[s,c,o]),b=1/p;Object(u.useLayoutEffect)(()=>{i>b&&r(b)},[i,b,r]);const[h,w]=Object(u.useState)(o);Object(u.useEffect)(()=>{w(o)},[o]);const S=Object(u.useMemo)(()=>{if(!c.length||!d)return[0,0];const L=d/c.length;return h.map(N=>N*L)},[d,c.length,h]),v=Object(u.useRef)(null),O=Object(u.useRef)(null),P=Object(u.useRef)(null),C=Object(u.useRef)(null),A=Object(u.useRef)(null),B=Object(u.useRef)(null);{const L=Object(u.useMemo)(()=>{if(!d||!c.length)return null;const F=Math.max(2e3,Math.ceil(10*c.length/d));return{pixelWidth:d,monoSamplesLength:c.length,minFrameWidth:F}},[d,c.length]),N=Object(u.useRef)(h);N.current=h,Object(u.useEffect)(()=>{if(!L||!v.current||!O.current||!A.current)return;const{pixelWidth:X,monoSamplesLength:F,minFrameWidth:le}=L,{left:Ae}=A.current.getBoundingClientRect();function Re(g){g instanceof TouchEvent&&g.preventDefault(),document.body.style.userSelect="none";const{pageX:R}=g instanceof MouseEvent?g:g.touches[0];P.current=R}function Be(g){g instanceof TouchEvent&&g.preventDefault(),document.body.style.userSelect="none";const{pageX:R}=g instanceof MouseEvent?g:g.touches[0];C.current=R}function Me(g){if(g instanceof TouchEvent&&g.preventDefault(),g.detail===2){a(()=>[0,0]);return}document.body.style.userSelect="none";const{clientX:R}=g instanceof MouseEvent?g:g.touches[0],te=(R-Ae)/X,T=Math.round(F*te),ie=T+le,se=ie<F?ie:T-le;se<0||(w([Math.min(T,se),F-1-Math.max(T,se)]),B.current=T)}function Je(g){const R=g/X,Q=Math.round(F*R);w(te=>{let T=te[0]+Q;return T=Math.min(T,F-te[1]-le),T=Math.max(T,0),[T,te[1]]})}function Ze(g){if(P.current===null)return;g instanceof TouchEvent&&g.preventDefault();const{pageX:R}=g instanceof MouseEvent?g:g.touches[0],Q=R-P.current;Q&&(Je(Q),P.current=R)}function qe(g){const R=g/X,Q=Math.round(F*R);w(te=>{let T=te[1]+Q;return T=Math.min(T,F-te[0]-le),T=Math.max(T,0),[te[0],T]})}function et(g){if(C.current===null)return;g instanceof TouchEvent&&g.preventDefault();const{pageX:R}=g instanceof MouseEvent?g:g.touches[0],Q=C.current-R;Q&&(qe(Q),C.current=R)}let Ie=!1;function Qt(g){if(P.current!==null)return;let R=!0;switch(g.key){case"ArrowLeft":Je(-1);break;case"ArrowRight":Je(1);break;default:R=!1;break}R&&(g.stopPropagation(),g.preventDefault(),Ie=!0)}function Jt(g){if(C.current!==null)return;let R=!0;switch(g.key){case"ArrowLeft":qe(1);break;case"ArrowRight":qe(-1);break;default:R=!1;break}R&&(g.stopPropagation(),g.preventDefault(),Ie=!0)}function tt(g){if(B.current===null)return;g instanceof TouchEvent&&g.preventDefault();const R=B.current,{clientX:Q}=g instanceof MouseEvent?g:g.touches[0],T=(Q-Ae)/X,ie=Math.max(0,Math.min(F-1,Math.round(F*T)));if(ie!==B.current){const se=R+le,at=R-le,qt=ie>R?se<F?Math.max(ie,se):at:at>=0?Math.min(ie,at):se;w([Math.min(R,qt),F-1-Math.max(R,qt)])}}function Zt(g){Ze(g),et(g),tt(g)}function _(g){(P.current!==null||C.current!==null||B.current!==null||Ie)&&((g instanceof TouchEvent||g instanceof KeyboardEvent)&&g.preventDefault(),a(()=>N.current),P.current=null,C.current=null,B.current=null,Ie=!1),document.body.style.userSelect="unset"}const G=v.current,K=O.current,ee=A.current;return G.addEventListener("touchstart",Re),G.addEventListener("mousedown",Re),K.addEventListener("touchstart",Be),K.addEventListener("mousedown",Be),ee.addEventListener("touchstart",Me),ee.addEventListener("mousedown",Me),G.addEventListener("touchmove",Ze),K.addEventListener("touchmove",et),G.addEventListener("keydown",Qt),K.addEventListener("keydown",Jt),ee.addEventListener("touchmove",tt),window.addEventListener("mousemove",Zt),G.addEventListener("touchend",_),G.addEventListener("touchcancel",_),G.addEventListener("keyup",_),K.addEventListener("touchend",_),K.addEventListener("keyup",_),K.addEventListener("touchcancel",_),ee.addEventListener("touchend",_),ee.addEventListener("touchcancel",_),window.addEventListener("mouseup",_),()=>{G.removeEventListener("touchstart",Re),G.removeEventListener("mousedown",Re),K.removeEventListener("touchstart",Be),K.removeEventListener("mousedown",Be),ee.removeEventListener("touchstart",Me),ee.removeEventListener("mousedown",Me),G.removeEventListener("touchmove",Ze),K.removeEventListener("touchmove",et),G.removeEventListener("keydown",Qt),K.removeEventListener("keydown",Jt),ee.removeEventListener("touchmove",tt),window.removeEventListener("mousemove",Zt),G.removeEventListener("touchend",_),G.removeEventListener("touchcancel",_),G.removeEventListener("keyup",_),K.removeEventListener("touchend",_),K.removeEventListener("keyup",_),K.removeEventListener("touchcancel",_),ee.removeEventListener("touchend",_),ee.removeEventListener("touchcancel",_),window.removeEventListener("mouseup",_)}},[L,a])}const{playAudioBuffer:I}=Ce(),U=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>U.current(),[e,h]);const[D,M]=Object(u.useState)(null);Object(u.useEffect)(()=>{t instanceof AudioBuffer&&D&&(M(null),D.fn())},[t,D]);const[k,j]=Object(u.useState)(0),[f,x]=Object(u.useState)(!1),[J,q]=Object(u.useState)("");Object(u.useEffect)(()=>{t&&q(ke(f?k*t.duration:t.duration,1))},[t,f,k]);const H=Object(u.useCallback)(L=>{if(f)U.current();else if(t)U.current=I(t,{onTimeUpdate(N){j(N/t.duration)},onEnded(){x(!1)}}),j(0),x(!0);else{const N=L.target;M({fn:()=>N.dispatchEvent(L)})}},[f,I,t]);return Object(u.useEffect)(()=>{function L(N){N.key===" "&&(N.preventDefault(),H(N))}return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[H]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:W.a.scaleButtonsContainer},n.a.createElement("div",{className:W.a.scaleButtons},n.a.createElement(V.a,{type:"button",variant:"light",disabled:i===b,onClick:()=>r(b)},"Normalize")," ",n.a.createElement(V.a,{type:"button",variant:"light",disabled:i===1,onClick:()=>r(1)},"Original level"))),n.a.createElement("div",{className:[W.a.waveformContainer,f?W.a.playbackActive:""].join(" "),style:{"--trim-pixels-left":`${S[0]}px`,"--trim-pixels-right":`${S[1]}px`,"--playback-progress":`${100*k}%`}},n.a.createElement(ze,{waveformRef:l,peaks:E,scaleCoefficient:i,onResize:m}),n.a.createElement("div",{className:W.a.playbackOverlay},n.a.createElement("div",{className:W.a.playback})),n.a.createElement("div",{className:W.a.playbackButtonContainer},n.a.createElement(Rt.a,{delay:{show:400,hide:0},overlay:n.a.createElement(Bt.a,null,"Preview how your sample will sound on the Volca Sample")},n.a.createElement(V.a,{variant:"dark",onClick:L=>H(L.nativeEvent)},n.a.createElement("img",{src:f?Ba.a:Ra.a,alt:"Play preview"}))),J&&n.a.createElement("span",null,J)),n.a.createElement("div",{className:[W.a.trim,W.a.left].join(" ")},n.a.createElement("div",{className:W.a.bar}),n.a.createElement("div",{ref:v,className:W.a.handle,tabIndex:0}),s&&Boolean(c.length)&&n.a.createElement("span",{className:W.a.time},ke(s.duration*h[0]/c.length,2))),n.a.createElement("div",{className:[W.a.trim,W.a.right].join(" ")},n.a.createElement("div",{className:W.a.bar}),n.a.createElement("div",{ref:O,className:W.a.handle,tabIndex:0}),s&&Boolean(c.length)&&n.a.createElement("span",{className:W.a.time},ke(s.duration*(c.length-1-h[1])/c.length,2))),n.a.createElement("div",{ref:A,className:W.a.waveformOverlay})))}var La=Ia,Na=y(151),xa=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});let Mt;function Fa(){return xa(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return Mt=Mt||new Promise((t,a)=>{let r;try{r={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(o){return e.addFunction(o,"vi")},unregisterUpdateCallback(o){e.removeFunction(o)},heap8Buffer(){return e.HEAP8.buffer}}}catch(o){a(o);return}t(r)})})}var Ta=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Wa(e,t){let a=!1,r=()=>{};return{cancelWork(){a=!0,r()},sampleBufferPromise:(()=>Ta(this,null,function*(){const{prepareSampleBufferFromWavData:o,getSampleBufferChunkPointer:i,getSampleBufferChunkSize:s,getSampleBufferProgress:c,getSampleBufferTotalSize:l,cancelSampleBufferWork:d,registerUpdateCallback:E,unregisterUpdateCallback:m,heap8Buffer:p}=yield Fa();if(a)return new Uint8Array;const{data:b}=yield Ue(e);if(a)return new Uint8Array;let h,w=0;const S=E(O=>{if(a)return;const P=l(O);h||(h=new Uint8Array(P));const C=i(O),A=s(O),B=c(O);h.set(new Uint8Array(p(),C,A),B-A),w=B/P}),v=o(b,b.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,S);t(w);try{yield new Promise(O=>{let P;r=()=>{cancelAnimationFrame(P),d(v),O()},C();function C(){if(w&&(t(w),w>=1)){O();return}P=requestAnimationFrame(C)}})}finally{r=()=>{},m(S)}if(a)return new Uint8Array;if(!h)throw new Error("Unexpected condition: sampleBuffer should be defined");return h}))()}}var _a=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Ha({sample:e}){const[t,a]=Object(u.useState)(0),[r,o]=Object(u.useState)("idle"),[i,s]=Object(u.useState)(null),[c,l]=Object(u.useState)(null);Object(u.useEffect)(()=>{i instanceof AudioBuffer&&c&&(l(null),c.fn())},[i,c]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let m=!1;a(0),o("idle"),s(null),l(null),d.current=()=>{m=!0};try{const{sampleBufferPromise:p,cancelWork:b}=Wa(e,h=>{m||a(h)});d.current=()=>{b(),m=!0},p.then(h=>_a(this,null,function*(){if(m)return;d.current=()=>{m=!0};const w=yield fe(h);m||s(w)}))}catch(p){console.error(p),s(new Error(String(p)))}return()=>d.current()},[e]);const{playAudioBuffer:E}=Ce();return n.a.createElement(n.a.Fragment,null,n.a.createElement(V.a,{type:"button",variant:"primary",onClick:m=>{if(!(i instanceof AudioBuffer)){if(!i){const{target:p,nativeEvent:b}=m;l({fn:()=>p.dispatchEvent(b)})}return}try{o("transferring");const p=E(i,{onTimeUpdate:b=>a(b/i.duration),onEnded:()=>o("idle")});d.current=()=>{p(),o("idle")}}catch(p){console.error(p),o("error")}},disabled:i instanceof Error||r==="transferring"},"Transfer to volca sample"),n.a.createElement("br",null),i&&r==="idle"?null:r==="error"?"Error transferring":n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,i?i instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),n.a.createElement(Na.a,{now:100*t}),n.a.createElement("br",null),n.a.createElement(V.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),n.a.createElement("br",null))}var It=Ha,Lt=y(74),Nt=y.n(Lt),$e=y(75),Xe=y(76),Va=y(93),Ua=y(19),re=y.n(Ua),xt=Math.pow;Lt.Digit.defaultProps.offOpacity=0;const Ft=(e,t)=>Math.min(199,t+xt(10,e)),Tt=(e,t)=>Math.max(0,t-xt(10,e));function za({slotNumber:e,onSlotNumberUpdate:t}){const[a,r]=Object(u.useState)(e);Object(u.useEffect)(()=>{r(e)},[e]);const[o,i]=Object(u.useState)(null),s=Object(u.useCallback)(E=>{t(m=>Ft(E,m))},[t]),c=Object(u.useCallback)(E=>{t(m=>Tt(E,m))},[t]),l=Object(u.useRef)(null),d=Object(u.useRef)(null);{const E=Object(u.useRef)(o);E.current=o;const m=Object(u.useRef)(a);m.current=a,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function p(D){const M=E.current===null?0:E.current;let k=!0;const j=()=>{i(M)};switch(D.key){case"ArrowDown":j(),r(f=>Tt(M,f));break;case"ArrowUp":j(),r(f=>Ft(M,f));break;case"ArrowLeft":j(),i(f=>f!==null&&f<2?f+1:f);break;case"ArrowRight":j(),i(f=>f&&f-1);break;case"Enter":case"Escape":i(null);break;default:k=!1;break}k&&D.preventDefault()}function b(D){const M=E.current===null?2:E.current;D.stopPropagation(),D.preventDefault();const k=m.current;if(isNaN(Number(D.key)))t(k);else{const j=String(k).padStart(3,"0").split("");j[2-M]=D.key;const f=Math.min(199,Math.max(0,Number(j.join(""))));i(M?M-1:null),t(f)}}const h=l.current;h.addEventListener("keydown",p,!0),h.addEventListener("keyup",b,!0);let w=0,S=!1,v=!1,O=0;function P(D){document.body.style.userSelect="none",w=D instanceof MouseEvent?D.pageY:D.touches[0].pageY,S=!0,v=!1,O=m.current}h.addEventListener("mousedown",P),h.addEventListener("touchstart",D=>{D.preventDefault(),P(D)});function C(D){if(!S)return;const{pageY:M}=D instanceof MouseEvent?D:D.touches[0],k=2,j=Math.round((w-M)/k);j&&(v=!0,r(Math.min(199,Math.max(0,O+j))))}window.addEventListener("mousemove",C),h.addEventListener("touchmove",C);function A(){document.body.style.userSelect="unset",S=!1,v&&t(m.current)}window.addEventListener("mouseup",A),h.addEventListener("touchend",A),h.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function B(D){v||d.current&&d.current.some(M=>M.contains(D.target))||i(2)}h.addEventListener("click",B),d.current.forEach((D,M)=>{const k=M;D.addEventListener("click",()=>{v||i(k)}),D.addEventListener("touchstart",j=>{j.preventDefault()})});function I(){S||i(2)}function U(){i(null)}return h.addEventListener("focus",I),h.addEventListener("blur",U),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",A)}},[t])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((E,m)=>{m===o?E.classList.add(re.a.active):E.classList.remove(re.a.active)})},[o]),n.a.createElement(n.a.Fragment,null,n.a.createElement(Y.a.Label,null,"Destination"),n.a.createElement("br",null),n.a.createElement("div",{className:re.a.slotNumberRow},n.a.createElement("div",{className:re.a.slotNumberContainer},n.a.createElement("div",{className:re.a.arrowControls},n.a.createElement("span",{onClick:()=>s(2)},n.a.createElement("img",{src:$e.a,alt:"Increment 100"})),n.a.createElement("span",{onClick:()=>s(1)},n.a.createElement("img",{src:$e.a,alt:"Increment 10"})),n.a.createElement("span",{onClick:()=>s(0)},n.a.createElement("img",{src:$e.a,alt:"Increment 1"}))),n.a.createElement("div",{className:re.a.slotNumber,title:`Slot ${a}`,ref:l,tabIndex:0},n.a.createElement(Nt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),n.a.createElement(Nt.a,{ref:E=>{const m=Object(nt.findDOMNode)(E);if(m){m.querySelectorAll("circle").forEach(b=>{m.removeChild(b)});const p=document.createElementNS("http://www.w3.org/2000/svg","circle");p.classList.add(re.a.point),p.setAttribute("cx","10.7"),p.setAttribute("cy","17"),p.setAttribute("r","1"),m.appendChild(p),d.current=[].slice.call(m.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(a).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),n.a.createElement("div",{className:re.a.arrowControls},n.a.createElement("span",{onClick:()=>c(2)},n.a.createElement("img",{src:Xe.a,alt:"Decrement 100"})),n.a.createElement("span",{onClick:()=>c(1)},n.a.createElement("img",{src:Xe.a,alt:"Decrement 10"})),n.a.createElement("span",{onClick:()=>c(0)},n.a.createElement("img",{src:Xe.a,alt:"Decrement 1"})))),e>99&&a>99&&n.a.createElement(Rt.a,{placement:"auto-end",overlay:n.a.createElement(Bt.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},n.a.createElement("img",{className:re.a.warning,src:Va.a,alt:"destination-warning"}))))}var Wt=za,$a=y(42),Ge=y.n($a),Xa=Object.defineProperty,Ga=Object.defineProperties,Ka=Object.getOwnPropertyDescriptors,_t=Object.getOwnPropertySymbols,Ya=Object.prototype.hasOwnProperty,Qa=Object.prototype.propertyIsEnumerable,Ht=(e,t,a)=>t in e?Xa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Vt=(e,t)=>{for(var a in t||(t={}))Ya.call(t,a)&&Ht(e,a,t[a]);if(_t)for(var a of _t(t))Qa.call(t,a)&&Ht(e,a,t[a]);return e},Ut=(e,t)=>Ga(e,Ka(t)),Ja=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function Za(e,t){const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)}function qa({sample:e,onSampleUpdate:t,onSampleDuplicate:a,onSampleDelete:r}){const o=e&&e.id,i=Object(u.useCallback)(S=>o&&t(o,{scaleCoefficient:S}),[o,t]),s=Object(u.useCallback)(S=>o&&t(o,v=>Ut(Vt({},v),{trim:Ut(Vt({},v.trim),{frames:S(v.trim.frames)})})),[o,t]),[c,l]=Object(u.useState)(null),[d,E]=Object(u.useState)(null),[m,p]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&m&&(p(null),m.fn())},[d,m]),Object(u.useEffect)(()=>{l(null),p(null);let S=!1;Ue(e).then(({data:v})=>{S||l(v)})},[e]),Object(u.useEffect)(()=>{if(E(null),c){let S=!1;fe(c).then(v=>{S||E(v)})}},[c]);const{playAudioBuffer:b}=Ce(),h=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>()=>h.current(),[e]);const w=Object(u.useCallback)(S=>{t(e.id,({slotNumber:v})=>({slotNumber:typeof S=="function"?S(v):S}))},[e.id,t]);return n.a.createElement(ye.a,{fluid:"sm"},n.a.createElement("h2",null,e.metadata.name,n.a.createElement(Aa.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},n.a.createElement(De.a.Item,{onClick:()=>{const S=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),v=S&&S.trim();v&&t(e.id,{name:v})}},"Rename"),n.a.createElement(De.a.Item,{onClick:()=>a(e.id)},"Duplicate"),n.a.createElement(De.a.Divider,null),n.a.createElement(De.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&r(e.id)}},"Delete"))),n.a.createElement("p",null,n.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),n.a.createElement("br",null),n.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",{className:Ge.a.waveformContainer},n.a.createElement(La,{onSetTrimFrames:s,onSetScaleCoefficient:i,sample:e,previewWav:d})),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(V.a,{type:"button",variant:"secondary",size:"sm",onClick:S=>{if(d)h.current=b(d);else{const v=S.currentTarget;p({fn:()=>v.click()})}}},"Play audio preview")," ",n.a.createElement(V.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Ja(this,null,function*(){const{sourceFileId:S,userFileInfo:v}=e.metadata,O=yield $.getSourceFileData(S),P=new Blob([O],{type:v?v.type:"audio/x-wav"});Za(P,`${e.metadata.name}${v?v.ext:".wav"}`)})},"Download original file"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(Y.a.Group,null,n.a.createElement(Y.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),n.a.createElement(Y.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:S=>{const v=Number(S.target.value);t(e.id,{qualityBitDepth:v})}})),n.a.createElement(Wt,{slotNumber:e.metadata.slotNumber,onSlotNumberUpdate:w}),n.a.createElement("br",null),n.a.createElement(It,{sample:e}))}var en=qa,je=y(144);function tn({sample:e}){const{sample:{metadata:{scaleCoefficient:t}},sourceAudioBuffer:a}=Ot(e),{waveformRef:r,peaks:o}=Ct(a);return n.a.createElement("div",{style:{backgroundColor:"#f3f3f3"}},n.a.createElement(ze,{waveformRef:r,peaks:o,scaleCoefficient:t}))}var an=tn,nn=Object.defineProperty,rn=Object.defineProperties,on=Object.getOwnPropertyDescriptors,zt=Object.getOwnPropertySymbols,ln=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable,$t=(e,t,a)=>t in e?nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,sn=(e,t)=>{for(var a in t||(t={}))ln.call(t,a)&&$t(e,a,t[a]);if(zt)for(var a of zt(t))cn.call(t,a)&&$t(e,a,t[a]);return e},un=(e,t)=>rn(e,on(t)),dn=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function fn(e,t){const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)}function mn(e){const t=e.metadata.slotNumber,[a,r]=Object(u.useState)(t);return Object(u.useEffect)(()=>{r(t)},[t]),{sample:Object(u.useMemo)(()=>e&&new $(un(sn({id:e.id},e.metadata),{slotNumber:a})),[e,a]),setSlotNumber:r}}function pn({sample:e,onSampleDuplicate:t}){const{sample:a,setSlotNumber:r}=mn(e),[o,i]=Object(u.useState)(null),[s,c]=Object(u.useState)(null),[l,d]=Object(u.useState)(null);Object(u.useEffect)(()=>{s instanceof AudioBuffer&&l&&(d(null),l.fn())},[s,l]),Object(u.useEffect)(()=>{i(null),d(null);let p=!1;Ue(a).then(({data:b})=>{p||i(b)})},[a]),Object(u.useEffect)(()=>{if(c(null),o){let p=!1;fe(o).then(b=>{p||c(b)})}},[o]);const{playAudioBuffer:E}=Ce(),m=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>m.current(),[a]),n.a.createElement(ye.a,{fluid:"sm"},n.a.createElement("h2",null,a.metadata.name),n.a.createElement("p",null,n.a.createElement("strong",null,"Sampled:")," ",new Date(a.metadata.dateSampled).toLocaleString()),n.a.createElement(je.a,{variant:"secondary"},n.a.createElement(je.a.Heading,null,"This is a factory sample."),n.a.createElement("p",null,"If you want to trim the audio, change volume or adjust quality before transferring to the volca sample,"," ",n.a.createElement("span",{className:Ge.a.buttonLink},n.a.createElement(V.a,{variant:"link",onClick:()=>t(a.id)},"make a duplicate"),"."))),n.a.createElement("div",{className:Ge.a.waveformContainer},n.a.createElement(an,{sample:a})),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(V.a,{type:"button",variant:"secondary",size:"sm",onClick:p=>{if(s)m.current=E(s);else{const b=p.currentTarget;d({fn:()=>b.click()})}}},"Play audio preview")," ",n.a.createElement(V.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>dn(this,null,function*(){const{sourceFileId:p,userFileInfo:b}=a.metadata,h=yield $.getSourceFileData(p),w=new Blob([h],{type:b?b.type:"audio/x-wav"});fn(w,`${a.metadata.name}${b?b.ext:".wav"}`)})},"Download original file"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(Y.a.Group,null,n.a.createElement(Y.a.Label,null,"Quality bit depth (",a.metadata.qualityBitDepth,")"),n.a.createElement(Y.a.Range,{disabled:!0,value:a.metadata.qualityBitDepth,step:1,min:8,max:16})),n.a.createElement(Wt,{slotNumber:a.metadata.slotNumber,onSlotNumberUpdate:r}),n.a.createElement("br",null),n.a.createElement(It,{sample:a}))}var vn=pn,hn=y(97),pe=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});let Xt;function Ke(){const e=vt();return Xt=Xt||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:ge}:{})}function yn(){return pe(this,null,function*(){{const r=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const o of r.getTracks())o.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput"),a=[];for(const r of t){const o=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:r.deviceId,channelCount:2},video:!1}),i=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:c})=>r.deviceId===c).label;let s=1;{const c=o.getAudioTracks()[0],l=c.getSettings().channelCount;l?s=l:c.getCapabilities&&(s=(c.getCapabilities().channelCount||{}).max||s)}for(const c of o.getTracks())c.stop();a.push({device:{deviceId:r.deviceId,label:i},channelsAvailable:s})}return a})}let Ye;function bn(e){return pe(this,arguments,function*({onData:t,onFinish:a}){const r=Ke();Ye=Ye||r.audioWorklet.addModule("recorderWorkletProcessor.js"),yield Ye;const o=new AudioWorkletNode(r,"recorder-worklet",{parameterData:{bufferSize:1024}});o.port.onmessage=s=>{if(s.data.eventType==="data"){const c=s.data.audioChannels;t(c)}s.data.eventType==="stop"&&a()};const i=o.parameters.get("isRecording");return i.setValueAtTime(1,r.currentTime),{recorderNode:o,stop(){i.setValueAtTime(0,r.currentTime)}}})}function gn({channelCount:e,onData:t,onFinish:a}){const o=Ke().createScriptProcessor(1024,e,e);let i=!1;return o.onaudioprocess=s=>{const c=Array(e).fill().map((l,d)=>s.inputBuffer.getChannelData(d));t(c),i&&a()},{recorderNode:o,stop(){i=!0}}}function En(e){return pe(this,null,function*(){return typeof AudioWorkletNode=="undefined"?gn(e):yield bn(e)})}function Sn(e){return pe(this,arguments,function*({deviceId:t,channelCount:a,onStart:r,onUpdate:o}){const i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:a,sampleRate:ge,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),s=Ke(),c=s.createMediaStreamSource(i),{recorderNode:l,stop:d}=yield En({channelCount:a,onData:h,onFinish:P});c.connect(l),l.connect(s.destination);const E=10;r(s.sampleRate,E);const m=E*s.sampleRate;let p=0;const b=Array(a).fill([]);function h(C){let A=0;const B=[];for(let D=0;D<a;D++){const M=C[D],k=M.length,j=M.slice(0,Math.min(k,m-p));mt(j),A||(A=j.length),B.push(j)}const I=va(B),U=pt(I);b.push(U),p+=A,p>=m&&d(),o(B)}let w,S;const v=new Promise((C,A)=>{w=C,S=A});let O=!1;function P(){return pe(this,null,function*(){if(O)return;try{const B=yield new Blob(b).arrayBuffer(),I=new Float32Array(B),U=ot()({channels:a,sampleRate:s.sampleRate,bitDepth:16,dataLength:I.byteLength}),D=new Uint8Array(U.length+I.byteLength);D.set(U),D.set(new Uint8Array(I.buffer),U.length),w(D)}catch(A){S(A)}const C=i.getTracks();for(const A of C)A.stop();l.disconnect(s.destination),c.disconnect(l),O=!0})}return{stop:d,mediaRecording:v}})}var wn=y(46),Pe=y.n(wn),ve=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});const Gt="capture_device_preference";let Kt=null;function On(e,t){const a=Object(u.useRef)(JSON.parse(localStorage.getItem(Gt)||"null")),[r,o]=Object(u.useState)(Kt),[i,s]=Object(u.useState)(r?"ok":"pending"),[c,l]=Object(u.useState)("");Object(u.useEffect)(()=>{Kt=r,s("ok")},[r]);const d=Object(u.useCallback)(()=>{let k=!1;return yn().then(j=>{k||j.length&&(o(new Map(j.map(f=>[f.device.deviceId,f]))),l(f=>f?(a.current=null,f):a.current&&j.find(({device:x})=>a.current.deviceId===x.deviceId)?a.current.deviceId:(a.current=null,j[0].device.deviceId)))}).catch(j=>{if(!k){if(j instanceof DOMException){if(j.name==="NotAllowedError"){s("denied");return}if(j.name==="NotFoundError"){s("unavailable");return}}throw j}}),()=>{k=!0}},[]),[E,m]=Object(u.useState)(1);Object(u.useEffect)(()=>{const k=r&&r.get(c);k&&(a.current&&a.current.deviceId===k.device.deviceId&&a.current.channelCount<=k.channelsAvailable?m(a.current.channelCount):m(k.channelsAvailable),a.current=null)},[r,c]),Object(u.useEffect)(()=>{c&&localStorage.setItem(Gt,JSON.stringify({deviceId:c,channelCount:E}))},[c,E]);const[p,b]=Object(u.useState)("ready"),[h,w]=Object(u.useState)(null),[S,v]=Object(u.useState)(!1);Object(u.useEffect)(()=>{p!=="ready"&&v(!1)},[p]);const O=Object(u.useCallback)(()=>{v(!1)},[]),[P,C]=Object(u.useState)({fn(k){}});Object(u.useEffect)(()=>P.fn,[P]);const[A,B]=Object(u.useState)(1/0),[I,U]=Object(u.useState)(0),D=Object(u.useCallback)(()=>ve(this,null,function*(){let k=!1;const j=(H,L)=>Sn({deviceId:H,channelCount:L,onStart:(N,X)=>{const F=X*N;B(N),U(F),b("capturing")},onUpdate:e}),f=a.current,{mediaRecording:x,stop:J}=yield f?(()=>ve(this,null,function*(){try{return j(f.deviceId,f.channelCount)}catch(H){if(H instanceof DOMException&&H.name==="NotFoundError")return j(c,E);throw H}}))():j(c,E);C({fn(H){J(),H&&(k=!0)}});let q;try{q=yield x}catch(H){w(H),b("error");return}if(k)b("ready");else{b("finalizing");const H=yield t(q);k||(b("ready"),H==="silent"&&v(!0))}}),[c,E,e,t]),M=Object(u.useCallback)(k=>{if(k.target.files&&k.target.files.length){const j=k.target.files[0];j.arrayBuffer().then(f=>ve(this,null,function*(){const x=new Uint8Array(f);let J;try{J=yield fe(x)}catch(H){alert("Unsupported audio format detected");return}if(J.length>10*J.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}b("finalizing");const q=yield t(x,j);b("ready"),q==="silent"&&v(!0)}))}},[t]);return{captureDevices:r,accessState:i,selectedCaptureDeviceId:c,selectedChannelCount:E,captureState:p,recordingError:h,showSilenceWarning:S,sampleRate:A,maxSamples:I,refreshCaptureDevices:d,setSelectedCaptureDeviceId:l,setSelectedChannelCount:m,beginRecording:D,stopRecording:P.fn,importFile:M,dismissSilenceWarning:O}}const Qe=3;function Cn({canvas:e,peaks:t,drawUntil:a,scaleCoefficient:r}){const o="#fff",i=e.getContext("2d");i.imageSmoothingEnabled=!1;const{width:s,height:c}=e;i.clearRect(0,0,s,c),i.fillStyle=o;for(let l=0;l<a&&l<t.length;l++){const d=t[l],E=c*d,m=Math.max(Math.round(r*E),2);i.fillRect(l*Qe,c-m,Qe-1,m)}}function Dn({onRecordFinish:e}){const t=Object(u.useRef)(null),a=Object(u.useRef)(0),r=Object(u.useRef)(new Float32Array),o=Object(u.useRef)(0),i=Object(u.useRef)([]),s=Object(u.useRef)(1/0),c=Object(u.useRef)(0),[l,d]=Object(u.useState)(0),E=Object(u.useCallback)(f=>ve(this,null,function*(){const x=a.current,J=r.current,q=i.current;if(q.push(f),c.current+=f[0].length,d(Math.floor(c.current/s.current)),q.reduce((L,[{length:N}])=>L+N,0)>=x){const L=yield Promise.all(f.map((X,F)=>q.reduce((le,Ae)=>[...le,Ae[F]],[])).map(X=>ve(this,null,function*(){const F=yield new Blob(X).arrayBuffer();return new Float32Array(F)}))),N=L.map(X=>ft(new Float32Array(X.buffer,0,x)));J[o.current++]=Math.max(...N),Cn({canvas:t.current,peaks:J,drawUntil:o.current,scaleCoefficient:.3}),i.current=[L.map(X=>X.slice(x))]}}),[]),{captureDevices:m,accessState:p,selectedCaptureDeviceId:b,selectedChannelCount:h,captureState:w,recordingError:S,showSilenceWarning:v,maxSamples:O,sampleRate:P,refreshCaptureDevices:C,setSelectedCaptureDeviceId:A,setSelectedChannelCount:B,beginRecording:I,stopRecording:U,importFile:D,dismissSilenceWarning:M}=On(E,e);s.current=P,Object(u.useEffect)(()=>{const f=t.current;f&&(f.width=f.offsetWidth,f.height=f.offsetHeight)},[p]),Object(u.useLayoutEffect)(()=>{const f=t.current;!f||(w!=="finalizing"&&f.getContext("2d").clearRect(0,0,f.width,f.height),w==="capturing"&&O&&(a.current=Math.floor(Qe*O/t.current.width),r.current=new Float32Array(Math.floor(O/a.current)),o.current=0,i.current=[],s.current=1/0,c.current=0,d(0)))},[O,w]);const[k,j]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{k&&C()},[k,C]),n.a.createElement(ye.a,{fluid:"sm"},p==="denied"?n.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",n.a.createElement(V.a,{type:"button",variant:"secondary",onClick:C},"try again")):p==="unavailable"?n.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",n.a.createElement(V.a,{type:"button",variant:"secondary",onClick:C},"try again")):n.a.createElement("div",null,n.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),v&&n.a.createElement("div",{className:Pe.a.alertContainer},n.a.createElement(je.a,{dismissible:!0,variant:"warning",onClose:M},n.a.createElement(je.a.Heading,null,"Your recording was totally silent."),n.a.createElement("p",null,"Check the audio input settings and your connections, then try again."))),n.a.createElement(V.a,{className:Pe.a.recordButton,type:"button",variant:w==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:w==="capturing"?()=>U():I,disabled:w==="finalizing"},n.a.createElement("canvas",{ref:t}),n.a.createElement("span",{className:Pe.a.mainText},["capturing","finalizing"].includes(w)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(w)&&n.a.createElement("span",{className:Pe.a.timeRecorded},"0:",String(l).padStart(2,"0"))),["capturing","finalizing"].includes(w)?n.a.createElement(n.a.Fragment,null,n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement(V.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>U(!0)},"Cancel")):n.a.createElement(n.a.Fragment,null,n.a.createElement("br",null),n.a.createElement(V.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>j(f=>!f)},"Audio input settings ",k?"\u25B2":"\u25BC"),n.a.createElement(hn.a,{in:k},n.a.createElement("div",null,n.a.createElement(Y.a.Group,null,n.a.createElement(Y.a.Label,null,"Capture Device"),n.a.createElement(Y.a.Select,{style:{width:250},value:b,onChange:f=>A(f.target.value)},m&&p==="ok"?[...m].map(([f,{device:x}])=>n.a.createElement("option",{key:f,value:f},x.label||f)):n.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),n.a.createElement(Y.a.Group,null,n.a.createElement(Y.a.Label,null,"Input channels"),n.a.createElement(Y.a.Select,{style:{width:250},value:h,onChange:f=>B(Number(f.target.value))},[1,2].map(f=>n.a.createElement("option",{key:f,value:f,disabled:!m||!m.has(b)||m.get(b).channelsAvailable<f},f===1?"Mono":"Stereo (summed to mono)")))),n.a.createElement("br",null))))),w==="error"&&S||null,n.a.createElement("br",null),n.a.createElement(V.a,{style:{width:250},type:"button",variant:"secondary",onClick:f=>{const x=f.currentTarget.querySelector("input");x&&f.target!==x&&x.click()}},"Or import an audio file",n.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:D})))}var kn=Dn,jn=y(80),Yt=y.n(jn),Pn=(e,t,a)=>new Promise((r,o)=>{var i=l=>{try{c(a.next(l))}catch(d){o(d)}},s=l=>{try{c(a.throw(l))}catch(d){o(d)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);c((a=a.apply(e,t)).next())});function An(){const[e,t]=Object(u.useState)(new Map),[a,r]=Object(u.useState)(new Map),o=Object(u.useMemo)(()=>new Map([...e,...a]),[e,a]);Object(u.useEffect)(()=>{fa().then(r).catch(console.error)},[]);const[i,s]=Object(u.useState)(null),[c,l]=Object(u.useState)(!0);Object(u.useEffect)(()=>{$.getAllFromStorage().then(h=>{t(w=>new Map([...w,...h.map(S=>[S.id,S])]))}).finally(()=>{l(!1)})},[]);const d=Object(u.useCallback)((h,w)=>Pn(this,null,function*(){const S=yield fe(h),v=[0,0],O=yield wt(S,v);if([...O.positive,...O.negative].every(I=>I===0))return"silent";const P=yield sa(h);let C="",A="";if(w){const I=w.name.lastIndexOf(".");I>0?(C=w.name.slice(0,I),A=w.name.slice(I)):C=w.name}else C="New sample";const B=new $.Mutable({name:C,sourceFileId:P,trim:{frames:v,waveformPeaks:O},userFileInfo:w&&{type:w.type,ext:A}});return yield B.persist(),t(I=>new Map([[B.id,B],...I])),s(B.id),"saved"}),[]),E=Object(u.useCallback)((h,w)=>{t(S=>{const v=S.get(h);if(v&&v instanceof $.Mutable){const O=v.update(w);if(O!==v)return new Map(S).set(v.id,O)}return S})},[]),[m,p]=Object(u.useState)(!1),b=Object(u.useCallback)(h=>{s(h),p(!1)},[]);return n.a.createElement("div",null,n.a.createElement(na,{onMenuOpen:()=>p(!0),onHeaderClick:()=>s(null)}),n.a.createElement(Le.a,{show:m,onHide:()=>p(!1)},n.a.createElement(Le.a.Header,{closeButton:!0}),n.a.createElement(Le.a.Body,null,n.a.createElement(he.a,null,n.a.createElement(he.a.Item,{as:"button",onClick:()=>b(null)},"New Sample"),c?"Loading...":null,!c&&n.a.createElement(ce.a,{defaultActiveKey:e.size?"user":"factory"},n.a.createElement(ce.a.Item,{eventKey:"user"},n.a.createElement(ce.a.Header,null,"Your Samples"),n.a.createElement(ce.a.Body,{style:{padding:0}},n.a.createElement(At,{samples:e,selectedSampleId:i,onSampleSelect:b}))),n.a.createElement(ce.a.Item,{eventKey:"factory"},n.a.createElement(ce.a.Header,null,"Factory Samples"),n.a.createElement(ce.a.Body,{style:{padding:0}},n.a.createElement(At,{samples:a,selectedSampleId:i,onSampleSelect:b}))))))),n.a.createElement("div",{className:Yt.a.mainLayout},n.a.createElement("div",{className:Yt.a.focusedSampleContainer},i&&(()=>{const h=o.get(i)||null;if(!h)return null;const w=S=>{const v=o.get(S);if(v){const O=v.duplicate();t(P=>new Map([[O.id,O],...P])),s(O.id)}};return h instanceof $.Mutable?n.a.createElement(en,{sample:h,onSampleUpdate:E,onSampleDuplicate:w,onSampleDelete:S=>{const v=e.get(S);if(v&&v instanceof $.Mutable){v.remove();let O=null,P=!1;for(const[,C]of e){if(P){O=C.id;break}if(C.id===S){if(!O){P=!0;continue}break}O=C.id}s(O),t(C=>{const A=new Map(C);return A.delete(v.id),A})}}}):n.a.createElement(vn,{sample:h,onSampleDuplicate:w})})(),!i&&n.a.createElement(kn,{onRecordFinish:d}))))}var Rn=An,Bn=e=>{e&&e instanceof Function&&y.e(3).then(y.bind(null,152)).then(({getCLS:t,getFID:a,getFCP:r,getLCP:o,getTTFB:i})=>{t(e),a(e),r(e),o(e),i(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),ea.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(ya,null,n.a.createElement(Rn,null))),document.getElementById("root")),Bn()},19:function(z,ae,y){z.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},20:function(z,ae,y){z.exports={titleBar:"Header_titleBar__3BLa-",menuIcon:"Header_menuIcon__swn7p",title:"Header_title__R3bRx",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},42:function(z,ae,y){z.exports={buttonLink:"SampleDetail_buttonLink__1lqYj",waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},46:function(z,ae,y){z.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},6:function(z,ae,y){z.exports={scaleButtonsContainer:"WaveformEdit_scaleButtonsContainer__248kb",scaleButtons:"WaveformEdit_scaleButtons__3u8fE",waveformContainer:"WaveformEdit_waveformContainer__Qq3MI",playbackOverlay:"WaveformEdit_playbackOverlay__1_jAo",playbackActive:"WaveformEdit_playbackActive__hTwgX",playback:"WaveformEdit_playback__2tuIe",trim:"WaveformEdit_trim__1GV76",bar:"WaveformEdit_bar__1KFgt",handle:"WaveformEdit_handle__23NoG",time:"WaveformEdit_time__YX5rg",left:"WaveformEdit_left__3Jfpn",right:"WaveformEdit_right__35CjW",waveformOverlay:"WaveformEdit_waveformOverlay__3oZfw",playbackButtonContainer:"WaveformEdit_playbackButtonContainer__3tLJJ"}},80:function(z,ae,y){z.exports={mainLayout:"App_mainLayout__3UKwp",focusedSampleContainer:"App_focusedSampleContainer__1lol8"}}},[[134,1,2]]]);

//# sourceMappingURL=main.2e897704.chunk.js.map