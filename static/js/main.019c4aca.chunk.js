(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{64:function(Ve,le,P){},75:function(Ve,le,P){"use strict";P.r(le);var d=P(0),i=P.n(d),ze=P(14),He=P.n(ze),vn=P(64),M=P(6);const Ue=M.a.h1({display:"flex",alignItems:"center",padding:"2rem 1rem 1rem",marginBottom:"0px",backgroundColor:"#f3f3f3",borderBottom:"1px solid #ccc",position:"sticky",top:0}),Xe=M.a.span({marginRight:"1rem",cursor:"pointer"}),$e=M.a.span({color:"red",whiteSpace:"nowrap"}),Ge=M.a.span({textTransform:"uppercase",textDecoration:"underline"}),Je=M.a.img({height:"1.6em",paddingLeft:"1rem"});function Ke({onMenuOpen:e}){return i.a.createElement(Ue,null,i.a.createElement(Xe,{onClick:e},"\u2630"),i.a.createElement($e,null,"Volca Sample",i.a.createElement(Ge,null,"r")),i.a.createElement(Je,{src:"volca_sample.png",alt:""}))}var Ye=Ke,L=P(87),Qe=P(52),Ze=P.n(Qe),qe=P(36),N=P.n(qe),ie=P(88),ce=P(51);const V=31250;var _e=Object.defineProperty,et=Object.defineProperties,tt=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,Z=(e,t,n)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F=(e,t)=>{for(var n in t||(t={}))se.call(t,n)&&Z(e,n,t[n]);if(z)for(var n of z(t))ue.call(t,n)&&Z(e,n,t[n]);return e},W=(e,t)=>et(e,tt(t)),de=(e,t)=>{var n={};for(var a in e)se.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&z)for(var a of z(e))t.indexOf(a)<0&&ue.call(e,a)&&(n[a]=e[a]);return n},H=(e,t,n)=>(Z(e,typeof t!="symbol"?t+"":t,n),n),I=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const U=N.a.createInstance({name:"audio_file_data",driver:N.a.INDEXEDDB}),X=N.a.createInstance({name:"sample_metadata",driver:N.a.INDEXEDDB});function nt(e){return I(this,null,function*(){const t=Object(ie.a)();return yield U.setItem(t,e),t})}const q="0.3.0",at={"0.1.0":e=>{const t=e,{clip:n}=t,a=de(t,["clip"]);return W(F({},a),{trimFrames:n.map(o=>Math.round(o*V)),metadataVersion:"0.2.0"})},"0.2.0":e=>I(void 0,null,function*(){const t=e,{trimFrames:n}=t,a=de(t,["trimFrames"]),l=yield Ce(a.sourceFileId,n),o={frames:n,waveformPeaks:l};return W(F({},a),{trim:o,metadataVersion:"0.3.0"})})};function rt(e){return I(this,null,function*(){let t=e;for(;t.metadataVersion!==q;){const n=at[e.metadataVersion];if(!n){console.warn(`Failed to properly upgrade metadata for sample "${t.name}"`),t={name:t.name,sourceFileId:t.sourceFileId,id:t.id,metadataVersion:q};break}t=yield n(t)}return t})}const R=class{constructor({name:e,sourceFileId:t,trim:n,id:a=Object(ie.a)(),userFileInfo:l=null,slotNumber:o=0,dateSampled:s=Date.now(),dateModified:c=s,useCompression:r=!0,qualityBitDepth:u=16,scaleCoefficient:C=1}){this.id=a,this.metadata={name:e,sourceFileId:t,trim:n,userFileInfo:l,slotNumber:o,dateSampled:s,dateModified:c,useCompression:r,qualityBitDepth:u,scaleCoefficient:C,metadataVersion:q}}duplicate(){const e=new R.Mutable(W(F({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,t){this.sourceFileData.set(e,t),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(a=>a!==e)];const n=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const a of n)this.sourceFileData.delete(a);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return I(this,null,function*(){{const n=this.sourceFileData.get(e);if(n)return n}if(e.includes(".")){const n=yield fetch(e);if(n.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const a=yield n.arrayBuffer(),l=new Uint8Array(a);return this.cacheSourceFileData(e,l),l}const t=yield U.getItem(e);return t?t instanceof Uint8Array?(this.cacheSourceFileData(e,t),t):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return I(this,null,function*(){const e=[];return yield X.iterate((n,a)=>{n&&e.push(rt(n).then(l=>[a,l]))}),new Map(yield Promise.all(e))})}static getAllFromStorage(){return I(this,null,function*(){const e=yield this.getAllMetadataFromStore(),t=yield fe(),n=(yield U.keys()).concat(t.map(({sourceFileId:l})=>l));return[...e].map(([l,o])=>{const{sourceFileId:s}=o;return n.includes(s)?new R.Mutable(F({id:l},o)):(console.warn(`Found metadata "${o.name||l}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort((l,o)=>o.metadata.dateModified-l.metadata.dateModified)})}};let B=R;H(B,"Mutable",class extends R{constructor(e){super(e);setTimeout(()=>I(this,null,function*(){(yield X.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return I(this,null,function*(){yield X.setItem(this.id,this.metadata)})}update(e){const{id:t,metadata:n}=this;if(Object.keys(e).every(o=>e[o]===n[o]))return this;const a=W(F(F({},n),e),{dateModified:Date.now()}),l=new R.Mutable(F({id:t},a));return l.persist(),l}remove(){return I(this,null,function*(){if(yield X.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield R.getAllMetadataFromStore();for(const[,{sourceFileId:t}]of e)if(t===this.metadata.sourceFileId)return;yield U.removeItem(this.metadata.sourceFileId)})}}),H(B,"sourceFileData",new Map),H(B,"recentlyCachedSourceFileIds",[]),H(B,"MAX_CACHED",10);let _;function fe(){return _||(_=fetch("factory-samples.json").then(e=>e.json())),_}function ot(){return I(this,null,function*(){const e=yield fe();return new Map(e.map(t=>[t.id,new B(W(F({},t),{trim:{frames:[t.trim.frames[0],t.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(ce.a)(t.trim.waveformPeaks.positive)),negative:new Float32Array(Object(ce.a)(t.trim.waveformPeaks.negative))}}}))]))})}var me=Math.pow,ee=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});function te(e,t){const n=4,a=t[0]*n,l=e.length-t[0]-t[1];return new Float32Array(e.buffer,a,l)}function ne(e,t){const n=e.length-t[0]-t[1],a=new Float32Array(n),l=Array(e.numberOfChannels).fill().map((o,s)=>te(e.getChannelData(s),t));for(let o=0;o<n;o++){let s=0;for(let c=0;c<l.length;c++)s+=l[c][o];s/=l.length,a[o]=s}return a}function lt(e){let t=0;for(const n of e){const a=Math.abs(n);a>t&&(t=a)}return t}function it(e,t){if(t!==1)for(let n=0;n<e.length;n++)e[n]*=t}function ct(e,t){const n=me(2,t-1);for(let a=0;a<e.length;a++)e[a]=Math.round(e[a]*n)/n}function pe(e){for(let t=0;t<e.length;t++)e[t]>1?e[t]=1:e[t]<-1&&(e[t]=-1)}function st(e){const t=new Int16Array(e.length),n=me(2,15);for(let a=0;a<e.length;a++)t[a]=e[a]===1?n-1:n*e[a];return t}function he(){return window.AudioContext||window.webkitAudioContext}let ve;function ye(){const e=he();return ve=ve||new e({sampleRate:V})}function $(e){return ee(this,null,function*(){const t=new Uint8Array(e);return yield new Promise((a,l)=>{ye().decodeAudioData(t.buffer,a,l)})})}function G(e,t){return ee(this,null,function*(){const n=yield B.getSourceFileData(e),a=yield $(n);if(t)for(let l=0;l<a.numberOfChannels;l++)pe(a.getChannelData(l));return a})}function ge(e){return ee(this,null,function*(){const{qualityBitDepth:t,sourceFileId:n,userFileInfo:a,scaleCoefficient:l,trim:{frames:o}}=e.metadata;if(t<8||t>16||!Number.isInteger(t))throw new Error(`Expected bit depth between 8 and 16. Received: ${t}`);const s=yield G(n,Boolean(a)),c=s.numberOfChannels===1?te(s.getChannelData(0),o):ne(s,o);l!==1&&it(c,l),t<16&&ct(c,t);const r=st(c),u=r.length*2,C=Ze()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:u}),w=new Uint8Array(C.length+u);return w.set(C),w.set(new Uint8Array(r.buffer),C.length),{data:w,sampleRate:16}})}const ut={playAudioBuffer(e,t){throw new Error("Must render AudioPlaybackContextProvider")},isAudioBusy:!1},be=Object(d.createContext)(ut);function dt({children:e}){const[t,n]=Object(d.useState)(!1),a=Object(d.useCallback)((o,{onTimeUpdate:s=()=>null,onEnded:c=()=>null}={})=>{if(t)throw new Error("Wait until audio playback has finished to start new playback");n(!0);let r,u;try{r=ye(),u=r.createBufferSource(),u.buffer=o,u.connect(r.destination),u.start()}catch(f){throw n(!1),f}const C=r.currentTime;s(0);let w=requestAnimationFrame(E);function E(){s(r.currentTime-C),w=requestAnimationFrame(E)}let O=!1;return u.addEventListener("ended",()=>{O||(s(o.duration),c()),n(!1),cancelAnimationFrame(w)}),function(){u.stop(),O=!0}},[t]),l=Object(d.useMemo)(()=>({playAudioBuffer:a,isAudioBusy:t}),[a,t]);return Object(d.createElement)(be.Provider,{value:l},e)}function Se(){return Object(d.useContext)(be)}var ft=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const T=6,we=T*44;function Ee(e,t){const n=Math.floor(T*e.length/t),a=new Float32Array(Math.floor(e.length/n)),l=new Float32Array(Math.floor(e.length/n));for(let o=0;o<a.length;o++){const s=new Float32Array(e.buffer,o*n*4,n);let c=0,r=0;for(const u of s)u>c&&(c=u),u<r&&(r=u);a[o]=Math.min(1,c),l[o]=Math.max(-1,r)}return{positive:a,negative:l}}function Ce(e,t){return ft(this,null,function*(){const n=yield G(e,!1),a=ne(n,t);return Ee(a,we)})}var mt=P(53);const pt=M.a.canvas({width:"100%",height:"100%",display:"block"});function ht(e,t){function n(l,o){e.width=l,e.height=o}n(e.offsetWidth,e.offsetHeight),t({width:e.offsetWidth,height:e.offsetHeight});const a=new mt.a(([l])=>{const{width:o,height:s}=l.contentRect;n(o,s),t({width:o,height:s})});return a.observe(e),()=>a.disconnect()}function vt(e,t,n){const a=e.getContext("2d"),{width:l,height:o}=e;a.clearRect(0,0,l,o);const s=Math.floor(o*(2/3))+1;a.fillStyle="red",t.positive.forEach((r,u)=>{const C=s*r,w=Math.max(Math.round(n*C),1);a.fillRect(u*T,s-w,T-1,w)});const c=o-s;a.fillStyle="darkred",t.negative.forEach((r,u)=>{const C=c*r*-1,w=Math.round(n*C);a.fillRect(u*T,s,T-1,w)})}function yt({peaks:e,scaleCoefficient:t,waveformRef:n}){const a=Object(d.useRef)(null);Object(d.useImperativeHandle)(n,()=>a.current);const[l,o]=Object(d.useState)(Symbol()),s=Object(d.useRef)({width:0,height:0});return Object(d.useLayoutEffect)(()=>{if(!a.current)throw new Error("Canvas should be defined");return s.current.width=a.current.offsetWidth,s.current.height=a.current.offsetHeight,ht(a.current,({width:c,height:r})=>{(c!==s.current.width||r!==s.current.height)&&(o(Symbol()),s.current.width=c,s.current.height=r)})},[]),Object(d.useLayoutEffect)(()=>{const c=a.current;if(!c)throw new Error("Canvas should be defined");let r=requestAnimationFrame(()=>{r=requestAnimationFrame(()=>{vt(c,e,t)})});return()=>cancelAnimationFrame(r)},[e,t,l]),i.a.createElement(pt,{ref:a})}var Oe=yt;const gt=M.a.div({width:`${we}px`,height:"40px"}),Pe=typeof IntersectionObserver!="undefined",bt=i.a.memo(({sample:e,selected:t,onSampleSelect:n})=>{const a=Object(d.useRef)(null),[l,o]=Object(d.useState)(!Pe);return Object(d.useLayoutEffect)(()=>{if(!Pe)return;const s=a.current;if(!s)throw new Error("Waveform container should be defined");const c=s.getBoundingClientRect();if(c.top+c.height>=0&&c.bottom-c.height<=window.innerHeight){o(!0);return}const r=new IntersectionObserver(([u])=>{u.isIntersecting&&(o(!0),r.unobserve(s))});return r.observe(s),()=>r.disconnect()},[]),i.a.createElement(L.a.Item,{active:t,onClick:()=>n(e.id)},i.a.createElement("div",null,e.metadata.name),i.a.createElement(gt,{ref:a},l&&i.a.createElement(Oe,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function St({samples:e,selectedSampleId:t,onSampleSelect:n}){return i.a.createElement(L.a,{variant:"flush"},[...e].map(([a,l])=>i.a.createElement(bt,{key:a,sample:l,selected:a===t,onSampleSelect:n})))}var De=St,j=P(54),wt=Object.defineProperty,Et=Object.defineProperties,Ct=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,je=(e,t,n)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ot=(e,t)=>{for(var n in t||(t={}))Ae.call(t,n)&&je(e,n,t[n]);if(J)for(var n of J(t))Me.call(t,n)&&je(e,n,t[n]);return e},Pt=(e,t)=>Et(e,Ct(t)),Dt=(e,t)=>{var n={};for(var a in e)Ae.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&J)for(var a of J(e))t.indexOf(a)<0&&Me.call(e,a)&&(n[a]=e[a]);return n},At=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const yn=M.a.input({position:"absolute"});function Mt({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:t},scaleCoefficient:n}},onSetTrimFrames:a,onSetScaleCoefficient:l}){const o=Object(d.useMemo)(()=>e?ne(e,[0,0]):new Float32Array,[e]),[s,c]=Object(d.useState)(null),r=Object(d.useMemo)(()=>s&&s.offsetWidth,[s]),u=Object(d.useMemo)(()=>!r||!o.length?{positive:new Float32Array,negative:new Float32Array}:Ee(o,r),[r,o]),C=Object(d.useMemo)(()=>{if(!e)return 0;const h=te(o,t);return lt(h)},[e,o,t]),w=1/C;Object(d.useLayoutEffect)(()=>{n>w&&l(w)},[n,w,l]);const E=n*C,O=Object(d.useMemo)(()=>{if(!o.length||!r)return[0,0];const h=r/o.length;return t.map(g=>g*h)},[r,o.length,t]),f=Object(d.useRef)(null),m=Object(d.useRef)(null);return Object(d.useEffect)(()=>{function h(y){if(f.current===null||!r||!o.length)return;const{pageX:b}=y,S=b-f.current;if(S){const v=S/r,p=Math.round(o.length*v);a(A=>{let D=A[0]+p;return D=Math.min(D,o.length-A[1]-2e3),D=Math.max(D,0),[D,A[1]]}),f.current=b}}function g(){f.current=null,delete document.body.style.userSelect}return window.addEventListener("mousemove",h),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",g)}},[r,o.length,a]),Object(d.useEffect)(()=>{function h(y){if(m.current===null||!r||!o.length)return;const{pageX:b}=y,S=m.current-b;if(S){const v=S/r,p=Math.round(o.length*v);a(A=>{let D=A[1]+p;return D=Math.min(D,o.length-A[0]-2e3),D=Math.max(D,0),[A[0],D]}),m.current=b}}function g(){m.current=null,delete document.body.style.userSelect}return window.addEventListener("mousemove",h),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",g)}},[r,o.length,a]),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},i.a.createElement(j.a,{type:"button",variant:"light",disabled:n===w,onClick:()=>l(w)},"Normalize")," ",i.a.createElement(j.a,{type:"button",variant:"light",disabled:n===1,onClick:()=>l(1)},"Original level"))),i.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},i.a.createElement(Oe,{waveformRef:c,peaks:u,scaleCoefficient:n}),i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${O[0]}px)`,background:"#f3f3f3"}},i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"black"}}),i.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(50%)"},onTouchStart:h=>{h.preventDefault(),document.body.style.userSelect="none",f.current=h.touches[0].pageX},onMouseDown:h=>{document.body.style.userSelect="none",f.current=h.pageX},onTouchMove:h=>{if(h.preventDefault(),f.current===null||!r||!o.length)return;const{pageX:g}=h.touches[0],y=g-f.current;if(y){const b=y/r,S=Math.round(o.length*b);a(v=>{let p=v[0]+S;return p=Math.min(p,o.length-v[1]-2e3),p=Math.max(p,0),[p,v[1]]}),f.current=g}},onTouchEnd:()=>{f.current=null},onTouchCancel:()=>{f.current=null}})),i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${O[1]}px)`,background:"#f3f3f3"}},i.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"black"}}),i.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"black",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:h=>{h.preventDefault(),document.body.style.userSelect="none",m.current=h.touches[0].pageX},onMouseDown:h=>{document.body.style.userSelect="none",m.current=h.pageX},onTouchMove:h=>{if(h.preventDefault(),m.current===null||!r||!o.length)return;const{pageX:g}=h.touches[0],y=m.current-g;if(y){const b=y/r,S=Math.round(o.length*b);a(v=>{let p=v[1]+S;return p=Math.min(p,o.length-v[0]-2e3),p=Math.max(p,0),[v[0],p]}),m.current=g}},onTouchEnd:()=>{m.current=null},onTouchCancel:()=>{m.current=null}}))))}function jt(e){var t=e,{sample:n}=t,a=Dt(t,["sample"]);const[l,o]=Object(d.useState)(null);Object(d.useEffect)(()=>{let c=!1;return(()=>At(this,null,function*(){if(c)return;const r=yield G(n.metadata.sourceFileId,Boolean(n.metadata.userFileInfo));c||o([n.metadata.sourceFileId,r])}))(),()=>{c=!0}},[n.metadata.sourceFileId,n.metadata.userFileInfo]);const s=Object(d.useRef)(n);return l&&n.metadata.sourceFileId===l[0]&&(s.current=n),i.a.createElement(Mt,Pt(Ot({},a),{sample:s.current,sourceAudioBuffer:l&&l[1]}))}var kt=jt,Bt=P(89),It=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});let ke;function Ft(){return It(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return ke=ke||new Promise((t,n)=>{let a;try{a={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(l){return e.addFunction(l,"vi")},unregisterUpdateCallback(l){e.removeFunction(l)},heap8Buffer(){return e.HEAP8.buffer}}}catch(l){n(l);return}t(a)})})}var xt=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});function Rt(e,t){let n=!1,a=()=>{};return{cancelWork(){n=!0,a()},sampleBufferPromise:(()=>xt(this,null,function*(){const{prepareSampleBufferFromWavData:l,getSampleBufferChunkPointer:o,getSampleBufferChunkSize:s,getSampleBufferProgress:c,getSampleBufferTotalSize:r,cancelSampleBufferWork:u,registerUpdateCallback:C,unregisterUpdateCallback:w,heap8Buffer:E}=yield Ft();if(n)return new Uint8Array;const{data:O}=yield ge(e);if(n)return new Uint8Array;let f,m=0;const h=C(y=>{if(n)return;const b=r(y);f||(f=new Uint8Array(b));const S=o(y),v=s(y),p=c(y);f.set(new Uint8Array(E(),S,v),p-v),m=p/b}),g=l(O,O.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,h);t(m);try{yield new Promise(y=>{let b;a=()=>{cancelAnimationFrame(b),u(g),y()},S();function S(){if(m&&(t(m),m>=1)){y();return}b=requestAnimationFrame(S)}})}finally{a=()=>{},w(h)}if(n)return new Uint8Array;if(!f)throw new Error("Unexpected condition: sampleBuffer should be defined");return f}))()}}var Tt=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});function Wt({sample:e}){const[t,n]=Object(d.useState)(0),[a,l]=Object(d.useState)("idle"),[o,s]=Object(d.useState)(null),[c,r]=Object(d.useState)(null);Object(d.useEffect)(()=>{o instanceof AudioBuffer&&c&&(r(null),c.fn())},[o,c]);const u=Object(d.useRef)(()=>{});Object(d.useEffect)(()=>{let E=!1;n(0),l("idle"),s(null),r(null),u.current=()=>{E=!0};try{const{sampleBufferPromise:O,cancelWork:f}=Rt(e,m=>{E||n(m)});u.current=()=>{f(),E=!0},O.then(m=>Tt(this,null,function*(){if(E)return;u.current=()=>{E=!0};const h=yield $(m);E||s(h)}))}catch(O){console.error(O),s(new Error(String(O)))}return()=>u.current()},[e]);const{playAudioBuffer:C,isAudioBusy:w}=Se();return i.a.createElement(i.a.Fragment,null,i.a.createElement(j.a,{type:"button",variant:"primary",onClick:E=>{if(!(o instanceof AudioBuffer)){if(!o){const O=E.currentTarget;r({fn:()=>O.click()})}return}try{l("transferring");const O=C(o,{onTimeUpdate:f=>n(f/o.duration),onEnded:()=>l("idle")});u.current=()=>{O(),l("idle")}}catch(O){console.error(O),l("error")}},disabled:w||o instanceof Error||a==="transferring"},"Transfer to volca sample"),i.a.createElement("br",null),o&&a==="idle"?null:a==="error"?"Error transferring":i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,o?o instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),i.a.createElement(Bt.a,{now:100*t}),i.a.createElement("br",null),i.a.createElement(j.a,{type:"button",variant:"light",onClick:()=>u.current()},"Cancel")),i.a.createElement("br",null))}var Lt=Wt,Nt=P(82),Vt=P(83),K=P(58),k=P(85),zt=Object.defineProperty,Ht=Object.defineProperties,Ut=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,Xt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable,Ie=(e,t,n)=>t in e?zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fe=(e,t)=>{for(var n in t||(t={}))Xt.call(t,n)&&Ie(e,n,t[n]);if(Be)for(var n of Be(t))$t.call(t,n)&&Ie(e,n,t[n]);return e},xe=(e,t)=>Ht(e,Ut(t)),Gt=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const Jt=M.a.div({height:"200px",maxWidth:"400px"});function Kt(e,t){const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(n)}function Yt({sample:e,onSampleUpdate:t,onSampleDuplicate:n,onSampleDelete:a}){const[l,o]=Object(d.useState)(0),s=e&&e.metadata.sourceFileId;Object(d.useEffect)(()=>{o(0),s&&G(s,!1).then(v=>o(v.length))},[s]);const c=e&&e.id,r=Object(d.useCallback)(v=>c&&t(c,{scaleCoefficient:v}),[c,t]),u=Object(d.useCallback)(v=>c&&t(c,p=>xe(Fe({},p),{trim:xe(Fe({},p.trim),{frames:v(p.trim.frames)})})),[c,t]),[C,w]=Object(d.useState)(null),[E,O]=Object(d.useState)(null),[f,m]=Object(d.useState)(null);Object(d.useEffect)(()=>{E instanceof AudioBuffer&&f&&(m(null),f.fn())},[E,f]),Object(d.useEffect)(()=>{if(w(null),m(null),e){let v=!1;ge(e).then(({data:p})=>{v||w(p)})}},[e]),Object(d.useEffect)(()=>{if(O(null),C){let v=!1;$(C).then(p=>{v||O(p)})}},[C]);const{playAudioBuffer:h,isAudioBusy:g}=Se(),y=Object(d.useRef)(()=>{});if(Object(d.useEffect)(()=>()=>y.current(),[e]),!e)return null;const b=Math.max(0,l-e.metadata.trim.frames[1]),S=Math.max(0,l-e.metadata.trim.frames[0]);return i.a.createElement(Nt.a,{fluid:"sm"},i.a.createElement("h2",null,e.metadata.name,i.a.createElement(Vt.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},i.a.createElement(K.a.Item,{onClick:()=>{const v=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),p=v&&v.trim();p&&t(e.id,{name:p})}},"Rename"),i.a.createElement(K.a.Item,{onClick:()=>n(e.id)},"Duplicate"),i.a.createElement(K.a.Divider,null),i.a.createElement(K.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&a(e.id)}},"Delete"))),i.a.createElement("p",null,i.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),i.a.createElement("br",null),i.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(Jt,null,i.a.createElement(kt,{onSetTrimFrames:u,onSetScaleCoefficient:r,sample:e})),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(j.a,{type:"button",variant:"secondary",size:"sm",onClick:v=>{if(E)y.current=h(E);else{const p=v.currentTarget;m({fn:()=>p.click()})}},disabled:g},"Play audio preview")," ",i.a.createElement(j.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>Gt(this,null,function*(){const{sourceFileId:v,userFileInfo:p}=e.metadata,A=yield B.getSourceFileData(v),D=new Blob([A],{type:p?p.type:"audio/x-wav"});Kt(D,`${e.metadata.name}${p?p.ext:".wav"}`)})},"Download original file"),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(k.a.Group,null,i.a.createElement(k.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),i.a.createElement(k.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:v=>{const p=Number(v.target.value);t(e.id,{qualityBitDepth:p})}})),i.a.createElement(k.a.Group,null,i.a.createElement(k.a.Label,null,"Slot number"),i.a.createElement(k.a.Control,{type:"number",value:e.metadata.slotNumber,step:1,min:0,max:99,onChange:v=>{const p=Number(v.target.value);t(e.id,{slotNumber:p})}})),i.a.createElement("br",null),i.a.createElement(Lt,{sample:e}))}var Qt=Yt,Zt=P(59),qt=P(57),Y=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});let Re;function ae(){const e=he();return Re=Re||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:V}:{})}function _t(){return Y(this,null,function*(){{const a=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const l of a.getTracks())l.stop()}const t=(yield navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="audioinput"),n=[];for(const a of t){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:a.deviceId,channelCount:2},video:!1}),o=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:c})=>a.deviceId===c).label,s=(l.getAudioTracks()[0].getCapabilities().channelCount||{}).max||1;for(const c of l.getTracks())c.stop();n.push({device:{deviceId:a.deviceId,label:o},channelsAvailable:s})}return n})}let re;function en(e){return Y(this,arguments,function*({onData:t,onFinish:n}){const a=ae();re=re||a.audioWorklet.addModule("recorderWorkletProcessor.js"),yield re;const l=new AudioWorkletNode(a,"recorder-worklet",{parameterData:{bufferSize:1024}});l.port.onmessage=s=>{if(s.data.eventType==="data"){const c=s.data.audioChannels;t(c)}s.data.eventType==="stop"&&n()};const o=l.parameters.get("isRecording");return o.setValueAtTime(1,a.currentTime),{recorderNode:l,stop(){o.setValueAtTime(0,a.currentTime)}}})}function tn({channelCount:e,onData:t,onFinish:n}){const l=ae().createScriptProcessor(1024,e,e);let o=!1;return l.onaudioprocess=s=>{const c=Array(e).fill().map((r,u)=>s.inputBuffer.getChannelData(u));t(c),o&&n()},{recorderNode:l,stop(){o=!0}}}function nn(e){return Y(this,null,function*(){return typeof AudioWorkletNode=="undefined"?tn(e):yield en(e)})}function an(e){return Y(this,arguments,function*({deviceId:t,channelCount:n,onStart:a}){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:t,channelCount:n,sampleRate:V,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),o=ae(),s=o.createMediaStreamSource(l),{recorderNode:c,stop:r}=yield nn({channelCount:n,onData:O,onFinish:y});s.connect(c),c.connect(o.destination),a();const C=10*o.sampleRate;let w=0;const E=Array(n).fill([]);function O(b){let S=0;for(let v=0;v<n;v++){const p=b[v],A=p.length,D=p.slice(0,Math.min(A,C-w));pe(D),S||(S=D.length),E[v].push(D)}w+=S,w>=C&&(y(),r())}let f,m;const h=new Promise((b,S)=>{f=b,m=S});let g=!1;function y(){if(g)return;try{const S=E.map(A=>{const D=new Float32Array(A.reduce((Q,hn)=>Q+hn.length,0));let Ne=0;for(const Q of A)D.set(Q,Ne),Ne+=Q.length;return D}),v=new qt.a;v.fromScratch(S.length,o.sampleRate,"32f",S);const p=v.toBuffer();f(p)}catch(S){m(S)}const b=l.getTracks();for(const S of b)S.stop();c.disconnect(o.destination),s.disconnect(c),g=!0}return{stop:r,mediaRecording:h}})}var Te=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const rn=M.a.div({}),We="capture_device_preference";let Le=null;function on(e){const t=Object(d.useRef)(JSON.parse(localStorage.getItem(We)||"null")),[n,a]=Object(d.useState)(Le),[l,o]=Object(d.useState)(n?"ok":"pending"),[s,c]=Object(d.useState)("");Object(d.useEffect)(()=>{Le=n,o("ok")},[n]);const r=Object(d.useCallback)(()=>{let y=!1;return _t().then(b=>{y||b.length&&(a(new Map(b.map(S=>[S.device.deviceId,S]))),c(S=>S?(t.current=null,S):t.current&&b.find(({device:v})=>t.current.deviceId===v.deviceId)?t.current.deviceId:(t.current=null,b[0].device.deviceId)))}).catch(b=>{if(!y){if(b instanceof DOMException){if(b.name==="NotAllowedError"){o("denied");return}if(b.name==="NotFoundError"){o("unavailable");return}}throw b}}),()=>{y=!0}},[]);Object(d.useEffect)(r,[r]);const[u,C]=Object(d.useState)(1);Object(d.useEffect)(()=>{const y=n&&n.get(s);y&&(t.current&&t.current.deviceId===y.device.deviceId&&t.current.channelCount<=y.channelsAvailable?C(t.current.channelCount):C(y.channelsAvailable),t.current=null)},[n,s]),Object(d.useEffect)(()=>{s&&localStorage.setItem(We,JSON.stringify({deviceId:s,channelCount:u}))},[s,u]);const[w,E]=Object(d.useState)("ready"),[O,f]=Object(d.useState)(null),[m,h]=Object(d.useState)({fn(y){}}),g=Object(d.useCallback)(()=>Te(this,null,function*(){let y=!1;const{mediaRecording:b,stop:S}=yield an({deviceId:s,channelCount:u,onStart:()=>E("capturing")});h({fn(p){S(),p&&(y=!0)}});let v;try{v=yield b}catch(p){f(p),E("error");return}y?E("ready"):(E("finalizing"),e(v))}),[s,u,e]);return{captureDevices:n,accessState:l,selectedCaptureDeviceId:s,selectedChannelCount:u,captureState:w,recordingError:O,refreshCaptureDevices:r,setSelectedCaptureDeviceId:c,setSelectedChannelCount:C,beginRecording:g,stopRecording:m.fn}}function ln({onRecordFinish:e}){const{captureDevices:t,accessState:n,selectedCaptureDeviceId:a,selectedChannelCount:l,captureState:o,recordingError:s,refreshCaptureDevices:c,setSelectedCaptureDeviceId:r,setSelectedChannelCount:u,beginRecording:C,stopRecording:w}=on(e),[E,O]=Object(d.useState)(!1);return i.a.createElement(rn,null,n==="denied"?i.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",i.a.createElement(j.a,{type:"button",variant:"secondary",onClick:c},"try again")):n==="unavailable"?i.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",i.a.createElement(j.a,{type:"button",variant:"secondary",onClick:c},"try again")):i.a.createElement("div",null,i.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),i.a.createElement(j.a,{type:"button",variant:o==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:o==="capturing"?()=>w():C,disabled:o==="finalizing"},["capturing","finalizing"].includes(o)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(o)?i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(j.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>w(!0)},"Cancel")):i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement(j.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>O(f=>!f)},"Audio input settings ",E?"\u25B2":"\u25BC"),i.a.createElement(Zt.a,{in:E},i.a.createElement("div",null,i.a.createElement(k.a.Group,null,i.a.createElement(k.a.Label,null,"Capture Device"),i.a.createElement(k.a.Select,{style:{width:250},value:a,onChange:f=>r(f.target.value)},t&&n==="ok"?[...t].map(([f,{device:m}])=>i.a.createElement("option",{key:f,value:f},m.label||f)):i.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),i.a.createElement(k.a.Group,null,i.a.createElement(k.a.Label,null,"Input channels"),i.a.createElement(k.a.Select,{style:{width:250},value:l,onChange:f=>u(Number(f.target.value))},[1,2].map(f=>i.a.createElement("option",{key:f,value:f,disabled:!t||!t.has(a)||t.get(a).channelsAvailable<f},f===1?"Mono":"Stereo (summed to mono)")))),i.a.createElement("br",null))))),o==="error"&&s||null,i.a.createElement("br",null),i.a.createElement(j.a,{style:{width:250},type:"button",variant:"secondary",onClick:f=>{const m=f.currentTarget.querySelector("input");m&&f.target!==m&&m.click()}},"Or import an audio file",i.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:f=>{if(f.target.files&&f.target.files.length){const m=f.target.files[0];m.arrayBuffer().then(h=>Te(this,null,function*(){const g=new Uint8Array(h);let y;try{y=yield $(g)}catch(b){alert("Unsupported audio format detected");return}if(y.length>10*y.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(g,m)}))}}})))}var cn=ln,oe=P(84),x=P(86),sn=(e,t,n)=>new Promise((a,l)=>{var o=r=>{try{c(n.next(r))}catch(u){l(u)}},s=r=>{try{c(n.throw(r))}catch(u){l(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(o,s);c((n=n.apply(e,t)).next())});const un=M.a.div({padding:"2rem",display:"flex",height:"100%"}),dn=M.a.div({flexGrow:1});function fn(){const[e,t]=Object(d.useState)(new Map),[n,a]=Object(d.useState)(new Map),l=Object(d.useMemo)(()=>new Map([...e,...n]),[e,n]);Object(d.useEffect)(()=>{ot().then(a).catch(console.error)},[]);const[o,s]=Object(d.useState)(null),[c,r]=Object(d.useState)(!0);Object(d.useEffect)(()=>{B.getAllFromStorage().then(f=>{t(m=>new Map([...m,...f.map(h=>[h.id,h])]))}).finally(()=>{r(!1)})},[]);const u=Object(d.useCallback)((f,m)=>sn(this,null,function*(){const h=yield nt(f);let g="",y="";if(m){const p=m.name.lastIndexOf(".");p>0?(g=m.name.slice(0,p),y=m.name.slice(p)):g=m.name}else g="New sample";const b=[0,0],S=yield Ce(h,b),v=new B.Mutable({name:g,sourceFileId:h,trim:{frames:b,waveformPeaks:S},userFileInfo:m&&{type:m.type,ext:y}});yield v.persist(),t(p=>new Map([[v.id,v],...p])),s(v.id)}),[]),C=Object(d.useCallback)((f,m)=>{t(h=>{const g=h.get(f);if(g&&g instanceof B.Mutable){const y=g.update(typeof m=="function"?m(g.metadata):m);if(y!==g)return new Map(h).set(g.id,y)}return h})},[]),[w,E]=Object(d.useState)(!1),O=Object(d.useCallback)(f=>{s(f),E(!1)},[]);return i.a.createElement("div",null,i.a.createElement(Ye,{onMenuOpen:()=>E(!0)}),i.a.createElement(oe.a,{show:w,onHide:()=>E(!1)},i.a.createElement(oe.a.Header,{closeButton:!0}),i.a.createElement(oe.a.Body,null,i.a.createElement(L.a,null,i.a.createElement(L.a.Item,{as:"button",onClick:()=>O(null)},"New Sample"),c?"Loading...":null,!c&&i.a.createElement(x.a,{defaultActiveKey:e.size?"user":"factory"},i.a.createElement(x.a.Item,{eventKey:"user"},i.a.createElement(x.a.Header,null,"Your Samples"),i.a.createElement(x.a.Body,{style:{padding:0}},i.a.createElement(De,{samples:e,selectedSampleId:o,onSampleSelect:O}))),i.a.createElement(x.a.Item,{eventKey:"factory"},i.a.createElement(x.a.Header,null,"Factory Samples"),i.a.createElement(x.a.Body,{style:{padding:0}},i.a.createElement(De,{samples:n,selectedSampleId:o,onSampleSelect:O}))))))),i.a.createElement(un,null,i.a.createElement(dn,null,o&&i.a.createElement(Qt,{sample:l.get(o)||null,onSampleUpdate:C,onSampleDuplicate:f=>{const m=l.get(f);if(m){const h=m.duplicate();t(g=>new Map([[h.id,h],...g])),s(h.id)}},onSampleDelete:f=>{const m=l.get(f);m&&m instanceof B.Mutable&&(m.remove(),t(h=>{const g=new Map(h);return g.delete(m.id),g}))}}),!o&&i.a.createElement(cn,{onRecordFinish:u}))))}var mn=fn,pn=e=>{e&&e instanceof Function&&P.e(3).then(P.bind(null,90)).then(({getCLS:t,getFID:n,getFCP:a,getLCP:l,getTTFB:o})=>{t(e),n(e),a(e),l(e),o(e)})};He.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(dt,null,i.a.createElement(mn,null))),document.getElementById("root")),pn()}},[[75,1,2]]]);

//# sourceMappingURL=main.019c4aca.chunk.js.map