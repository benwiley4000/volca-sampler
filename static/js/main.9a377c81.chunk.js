(this["webpackJsonpvolca-sampler"]=this["webpackJsonpvolca-sampler"]||[]).push([[0],{130:function(F,U,y){"use strict";y.r(U);var u=y(0),o=y.n(u),Pe=y(9),pt=y.n(Pe),Un=y(98),Xn=y(99),ne=y(26),vt=y(29),G=y.n(vt);function ht({onMenuOpen:e,onHeaderClick:n}){return o.a.createElement("h1",{className:G.a.title,onClick:n},o.a.createElement("span",{className:G.a.menuIcon,onClick:t=>{t.stopPropagation(),e()}},"\u2630"),o.a.createElement("span",{className:G.a.titleText,"data-text":"Volca Sample"},"Volca Sample",o.a.createElement("span",{className:G.a.titleR},"r"),o.a.createElement("div",{className:G.a.titleStarburst},Array(24).fill().map((t,a,{length:l})=>o.a.createElement("span",{key:a,style:{"--rotation":`${a*360/l}deg`}})))),o.a.createElement("img",{className:G.a.titleGraphic,src:"volca_sample.png",alt:""}),o.a.createElement("svg",{width:0,height:0},o.a.createElement("filter",{id:"outline"},o.a.createElement("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"1"}),o.a.createElement("feFlood",{floodColor:"var(--stroke-color)",floodOpacity:"1",result:"PINK"}),o.a.createElement("feComposite",{in:"PINK",in2:"DILATED",operator:"in",result:"OUTLINE"}),o.a.createElement("feMerge",null,o.a.createElement("feMergeNode",{in:"OUTLINE"}),o.a.createElement("feMergeNode",{in:"SourceGraphic"})))))}var gt=ht,ae=y(145),yt=y(52),Ae=y.n(yt),bt=y(44),re=y.n(bt),ke=y(146),je=y(77);const oe=31250;var Et=Object.defineProperty,St=Object.defineProperties,wt=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,me=(e,n,t)=>n in e?Et(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,V=(e,n)=>{for(var t in n||(n={}))Me.call(n,t)&&me(e,t,n[t]);if(le)for(var t of le(n))Re.call(n,t)&&me(e,t,n[t]);return e},J=(e,n)=>St(e,wt(n)),Ie=(e,n)=>{var t={};for(var a in e)Me.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&le)for(var a of le(e))n.indexOf(a)<0&&Re.call(e,a)&&(t[a]=e[a]);return t},ce=(e,n,t)=>(me(e,typeof n!="symbol"?n+"":n,t),t),L=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});const ie=re.a.createInstance({name:"audio_file_data",driver:re.a.INDEXEDDB}),se=re.a.createInstance({name:"sample_metadata",driver:re.a.INDEXEDDB});function Ct(e){return L(this,null,function*(){const n=Object(ke.a)();return yield ie.setItem(n,e),n})}const pe="0.3.0",Ot={"0.1.0":e=>{const n=e,{clip:t}=n,a=Ie(n,["clip"]);return J(V({},a),{trimFrames:t.map(c=>Math.round(c*oe)),metadataVersion:"0.2.0"})},"0.2.0":e=>L(void 0,null,function*(){const n=e,{trimFrames:t}=n,a=Ie(n,["trimFrames"]),l=yield be(a.sourceFileId,!1),c=yield Ge(l,t),s={frames:t,waveformPeaks:c};return J(V({},a),{trim:s,metadataVersion:"0.3.0"})})};function Dt(e){return L(this,null,function*(){let n=e;for(;n.metadataVersion!==pe;){const t=Ot[e.metadataVersion];if(!t){console.warn(`Failed to properly upgrade metadata for sample "${n.name}"`),n={name:n.name,sourceFileId:n.sourceFileId,id:n.id,metadataVersion:pe};break}n=yield t(n)}return n})}const Y=class{constructor({name:e,sourceFileId:n,trim:t,id:a=Object(ke.a)(),userFileInfo:l=null,slotNumber:c=0,dateSampled:s=Date.now(),dateModified:i=s,useCompression:r=!0,qualityBitDepth:d=16,scaleCoefficient:b=1}){this.id=a,this.metadata={name:e,sourceFileId:n,trim:t,userFileInfo:l,slotNumber:c,dateSampled:s,dateModified:i,useCompression:r,qualityBitDepth:d,scaleCoefficient:b,metadataVersion:pe}}duplicate(){const e=new Y.Mutable(J(V({},this.metadata),{name:`${this.metadata.name} (copy)`,dateModified:Date.now()}));return e.persist(),e}static cacheSourceFileData(e,n){this.sourceFileData.set(e,n),this.recentlyCachedSourceFileIds=[e,...this.recentlyCachedSourceFileIds.filter(a=>a!==e)];const t=this.recentlyCachedSourceFileIds.slice(this.MAX_CACHED);for(const a of t)this.sourceFileData.delete(a);this.recentlyCachedSourceFileIds=this.recentlyCachedSourceFileIds.slice(0,this.MAX_CACHED)}static getSourceFileData(e){return L(this,null,function*(){{const t=this.sourceFileData.get(e);if(t)return t}if(e.includes(".")){const t=yield fetch(e);if(t.status>=400)return Promise.reject(new Error(`Failed to fetch source file "${e}"`));const a=yield t.arrayBuffer(),l=new Uint8Array(a);return this.cacheSourceFileData(e,l),l}const n=yield ie.getItem(e);return n?n instanceof Uint8Array?(this.cacheSourceFileData(e,n),n):Promise.reject("Source data is of unexpected type"):Promise.reject("Missing source data")})}static getAllMetadataFromStore(){return L(this,null,function*(){const e=new Map,n=[];return yield se.iterate((t,a)=>{t&&n.push(Dt(t).then(l=>{e.set(a,l)}).catch(l=>{console.error(l),console.warn(`Failed to upgrade metadata "${a}" (${t.name}); ignoring.`)}))}),yield Promise.all(n),e})}static getAllFromStorage(){return L(this,null,function*(){const e=yield this.getAllMetadataFromStore(),n=yield Be(),t=(yield ie.keys()).concat(n.map(({sourceFileId:l})=>l));return[...e].map(([l,c])=>{const{sourceFileId:s}=c;return t.includes(s)?new Y.Mutable(V({id:l},c)):(console.warn(`Found metadata "${c.name||l}" with missing data "${s}; ignoring.`),null)}).filter(Boolean).sort((l,c)=>c.metadata.dateModified-l.metadata.dateModified)})}};let x=Y;ce(x,"Mutable",class extends Y{constructor(e){super(e);setTimeout(()=>L(this,null,function*(){(yield se.keys()).includes(this.id)||console.warn(`Expected sample metadata container ${this.id} to be persisted`)}))}persist(){return L(this,null,function*(){yield se.setItem(this.id,this.metadata)})}update(e){const{id:n,metadata:t}=this,a=typeof e=="function"?e(t):e;if(Object.keys(a).every(s=>a[s]===t[s]))return this;const l=J(V(V({},t),a),{dateModified:Date.now()}),c=new Y.Mutable(V({id:n},l));return c.persist(),c}remove(){return L(this,null,function*(){if(yield se.removeItem(this.id),this.metadata.sourceFileId.includes("."))return;const e=yield Y.getAllMetadataFromStore();for(const[,{sourceFileId:n}]of e)if(n===this.metadata.sourceFileId)return;yield ie.removeItem(this.metadata.sourceFileId)})}}),ce(x,"sourceFileData",new Map),ce(x,"recentlyCachedSourceFileIds",[]),ce(x,"MAX_CACHED",10);let ve;function Be(){return ve||(ve=fetch("factory-samples.json").then(e=>e.json())),ve}function Pt(){return L(this,null,function*(){const e=yield Be();return new Map(e.map(n=>[n.id,new x(J(V({},n),{trim:{frames:[n.trim.frames[0],n.trim.frames[1]],waveformPeaks:{positive:new Float32Array(Object(je.a)(n.trim.waveformPeaks.positive)),negative:new Float32Array(Object(je.a)(n.trim.waveformPeaks.negative))}}}))]))})}var Ne=Math.pow,he=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});function ge(e,n){const t=4,a=n[0]*t,l=e.length-n[0]-n[1];return new Float32Array(e.buffer,a,l)}function ye(e,n){const t=e.length-n[0]-n[1],a=new Float32Array(t),l=Array(e.numberOfChannels).fill().map((c,s)=>ge(e.getChannelData(s),n));for(let c=0;c<t;c++){let s=0;for(let i=0;i<l.length;i++)s+=l[i][c];s/=l.length,a[c]=s}return a}function xe(e){let n=0;for(const t of e){const a=Math.abs(t);a>n&&(n=a)}return n}function At(e,n){if(n!==1)for(let t=0;t<e.length;t++)e[t]*=n}function kt(e,n){const t=Ne(2,n-1);for(let a=0;a<e.length;a++)e[a]=Math.round(e[a]*t)/t}function Fe(e){for(let n=0;n<e.length;n++)e[n]>1?e[n]=1:e[n]<-1&&(e[n]=-1)}function jt(e){const n=e.length,t=e[0].length,a=new Float32Array(n*t);for(let l=0;l<a.length;l++){const c=n*l;for(let s=0;s<n;s++)a[c+s]=e[s][l]}return a}function Le(e){const n=new Int16Array(e.length),t=Ne(2,15);for(let a=0;a<e.length;a++)n[a]=e[a]===1?t-1:t*e[a];return n}function Te(){return window.AudioContext||window.webkitAudioContext}let We;function He(){const e=Te();return We=We||new e({sampleRate:oe})}function Z(e){return he(this,null,function*(){const n=new Uint8Array(e);return yield new Promise((a,l)=>{He().decodeAudioData(n.buffer,a,l)})})}function be(e,n){return he(this,null,function*(){const t=yield x.getSourceFileData(e),a=yield Z(t);if(n)for(let l=0;l<a.numberOfChannels;l++)Fe(a.getChannelData(l));return a})}function Ve(e){return he(this,null,function*(){const{qualityBitDepth:n,sourceFileId:t,userFileInfo:a,scaleCoefficient:l,trim:{frames:c}}=e.metadata;if(n<8||n>16||!Number.isInteger(n))throw new Error(`Expected bit depth between 8 and 16. Received: ${n}`);const s=yield be(t,Boolean(a)),i=s.numberOfChannels===1?ge(s.getChannelData(0),c):ye(s,c);l!==1&&At(i,l),n<16&&kt(i,n);const r=Le(i),d=r.length*2,b=Ae()({channels:1,sampleRate:s.sampleRate,bitDepth:16,dataLength:d}),m=new Uint8Array(b.length+d);return m.set(b),m.set(new Uint8Array(r.buffer),b.length),{data:m,sampleRate:16}})}const Mt={playAudioBuffer(e,n){throw new Error("Must render AudioPlaybackContextProvider")}},ze=Object(u.createContext)(Mt);function Rt({children:e}){const n=Object(u.useRef)(()=>{}),t=Object(u.useCallback)((l,{onTimeUpdate:c=()=>null,onEnded:s=()=>null}={})=>{n.current();const i=He(),r=i.createBufferSource();r.buffer=l,r.connect(i.destination),r.start();const d=i.currentTime;c(0);let b=requestAnimationFrame(m);function m(){c(i.currentTime-d),b=requestAnimationFrame(m)}let h=!1;r.addEventListener("ended",()=>{h||(c(l.duration),s()),cancelAnimationFrame(b)});function E(){r.stop(),cancelAnimationFrame(b),h=!0}return n.current=E,E},[]),a=Object(u.useMemo)(()=>({playAudioBuffer:t}),[t]);return Object(u.createElement)(ze.Provider,{value:a},e)}function Ue(){return Object(u.useContext)(ze)}var It=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});const K=6,Xe=K*44;function $e(e,n){const t=Math.floor(K*e.length/n),a=new Float32Array(Math.floor(e.length/t)),l=new Float32Array(Math.floor(e.length/t));for(let c=0;c<a.length;c++){const s=new Float32Array(e.buffer,c*t*4,t);let i=0,r=0;for(const d of s)d>i&&(i=d),d<r&&(r=d);a[c]=Math.min(1,i),l[c]=Math.max(-1,r)}return{positive:a,negative:l}}function Ge(e,n){return It(this,null,function*(){const t=ye(e,n);return $e(t,Xe)})}var Bt=y(86);const Nt=ne.a.canvas({width:"100%",height:"100%",display:"block",imageRendering:"pixelated"});function xt(e,n){function t(l,c){e.width=l,e.height=c}t(e.offsetWidth,e.offsetHeight),n({width:e.offsetWidth,height:e.offsetHeight});const a=new Bt.a(([l])=>{const{width:c,height:s}=l.contentRect;t(c,s),n({width:c,height:s})});return a.observe(e),()=>a.disconnect()}function Ft(e,n,t){const a=getComputedStyle(document.documentElement),l=a.getPropertyValue("--bs-primary"),c=a.getPropertyValue("--bs-primary-darkened"),s=e.getContext("2d");s.imageSmoothingEnabled=!1;const{width:i,height:r}=e;s.clearRect(0,0,i,r);const d=Math.floor(r*(2/3))+1;s.fillStyle=l,n.positive.forEach((m,h)=>{const E=d*m,g=Math.max(Math.round(t*E),1);s.fillRect(h*K,d-g,K-1,g)});const b=r-d;s.fillStyle=c,n.negative.forEach((m,h)=>{const E=b*m*-1,g=Math.round(t*E);s.fillRect(h*K,d,K-1,g)})}function Lt({peaks:e,scaleCoefficient:n,waveformRef:t}){const a=Object(u.useRef)(null);Object(u.useImperativeHandle)(t,()=>a.current);const[l,c]=Object(u.useState)(Symbol()),s=Object(u.useRef)({width:0,height:0});return Object(u.useLayoutEffect)(()=>{if(!a.current)throw new Error("Canvas should be defined");return s.current.width=a.current.offsetWidth,s.current.height=a.current.offsetHeight,xt(a.current,({width:i,height:r})=>{(i!==s.current.width||r!==s.current.height)&&(c(Symbol()),s.current.width=i,s.current.height=r)})},[]),Object(u.useLayoutEffect)(()=>{const i=a.current;if(!i)throw new Error("Canvas should be defined");let r=requestAnimationFrame(()=>{r=requestAnimationFrame(()=>{Ft(i,e,n)})});return()=>cancelAnimationFrame(r)},[e,n,l]),o.a.createElement(Nt,{ref:a})}var Ye=Lt;const Tt=ne.a.div({width:`${Xe}px`,height:"40px"}),Ke=typeof IntersectionObserver!="undefined",Wt=o.a.memo(({sample:e,selected:n,onSampleSelect:t})=>{const a=Object(u.useRef)(null),[l,c]=Object(u.useState)(!Ke);return Object(u.useLayoutEffect)(()=>{if(!Ke)return;const s=a.current;if(!s)throw new Error("Waveform container should be defined");const i=s.getBoundingClientRect();if(i.top+i.height>=0&&i.bottom-i.height<=window.innerHeight){c(!0);return}const r=new IntersectionObserver(([d])=>{d.isIntersecting&&(c(!0),r.unobserve(s))});return r.observe(s),()=>r.disconnect()},[]),o.a.createElement(ae.a.Item,{active:n,onClick:()=>t(e.id)},o.a.createElement("div",null,e.metadata.name),o.a.createElement(Tt,{ref:a},l&&o.a.createElement(Ye,{peaks:e.metadata.trim.waveformPeaks,scaleCoefficient:e.metadata.scaleCoefficient})))});function Ht({samples:e,selectedSampleId:n,onSampleSelect:t}){return o.a.createElement(ae.a,{variant:"flush"},[...e].map(([a,l])=>o.a.createElement(Wt,{key:a,sample:l,selected:a===n,onSampleSelect:t})))}var _e=Ht,Qe=y(138),Vt=y(139),ue=y(92),B=y(87),T=y(141),zt=Object.defineProperty,Ut=Object.defineProperties,Xt=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,Je=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,qe=(e,n,t)=>n in e?zt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,$t=(e,n)=>{for(var t in n||(n={}))Je.call(n,t)&&qe(e,t,n[t]);if(de)for(var t of de(n))Ze.call(n,t)&&qe(e,t,n[t]);return e},Gt=(e,n)=>Ut(e,Xt(n)),Yt=(e,n)=>{var t={};for(var a in e)Je.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&de)for(var a of de(e))n.indexOf(a)<0&&Ze.call(e,a)&&(t[a]=e[a]);return t},Kt=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});function _t({sourceAudioBuffer:e,sample:{metadata:{trim:{frames:n},scaleCoefficient:t}},onSetTrimFrames:a,onSetScaleCoefficient:l}){const c=Object(u.useMemo)(()=>e?ye(e,[0,0]):new Float32Array,[e]),[s,i]=Object(u.useState)(null),r=Object(u.useMemo)(()=>s&&s.offsetWidth,[s]),d=Object(u.useMemo)(()=>!r||!c.length?{positive:new Float32Array,negative:new Float32Array}:$e(c,r),[r,c]),b=Object(u.useMemo)(()=>{if(!e)return 0;const f=ge(c,n);return xe(f)},[e,c,n]),m=1/b;Object(u.useLayoutEffect)(()=>{t>m&&l(m)},[t,m,l]);const h=Object(u.useMemo)(()=>{if(!c.length||!r)return[0,0];const f=r/c.length;return n.map(p=>p*f)},[r,c.length,n]),E=Object(u.useRef)(null),g=Object(u.useRef)(null);return Object(u.useEffect)(()=>{function f(C){if(E.current===null||!r||!c.length)return;const{pageX:S}=C,j=S-E.current;if(j){const D=j/r,w=Math.round(c.length*D);a(M=>{let k=M[0]+w;return k=Math.min(k,c.length-M[1]-2e3),k=Math.max(k,0),[k,M[1]]}),E.current=S}}function p(){E.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",p)}},[r,c.length,a]),Object(u.useEffect)(()=>{function f(C){if(g.current===null||!r||!c.length)return;const{pageX:S}=C,j=g.current-S;if(j){const D=j/r,w=Math.round(c.length*D);a(M=>{let k=M[1]+w;return k=Math.min(k,c.length-M[0]-2e3),k=Math.max(k,0),[M[0],k]}),g.current=S}}function p(){g.current=null,document.body.style.userSelect="unset"}return window.addEventListener("mousemove",f),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",p)}},[r,c.length,a]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{position:"relative"}},o.a.createElement("div",{style:{position:"absolute",right:0,bottom:4}},o.a.createElement(B.a,{type:"button",variant:"light",disabled:t===m,onClick:()=>l(m)},"Normalize")," ",o.a.createElement(B.a,{type:"button",variant:"light",disabled:t===1,onClick:()=>l(1)},"Original level"))),o.a.createElement("div",{style:{position:"relative",backgroundColor:"#f3f3f3"}},o.a.createElement(Ye,{waveformRef:i,peaks:d,scaleCoefficient:t}),o.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:`calc(100% - ${h[0]}px)`,background:"#f3f3f3"}},o.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,width:2,background:"var(--bs-dark)"}}),o.a.createElement("div",{style:{position:"absolute",top:"100%",right:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",E.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",E.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),E.current===null||!r||!c.length)return;const{pageX:p}=f.touches[0],C=p-E.current;if(C){const S=C/r,j=Math.round(c.length*S);a(D=>{let w=D[0]+j;return w=Math.min(w,c.length-D[1]-2e3),w=Math.max(w,0),[w,D[1]]}),E.current=p}},onTouchEnd:()=>{E.current=null},onTouchCancel:()=>{E.current=null}})),o.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,right:0,left:`calc(100% - ${h[1]}px)`,background:"#f3f3f3"}},o.a.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,width:2,background:"var(--bs-dark)"}}),o.a.createElement("div",{style:{position:"absolute",top:"100%",left:0,width:20,height:20,background:"var(--bs-dark)",borderRadius:10,transform:"translateX(-50%)"},onTouchStart:f=>{f.preventDefault(),document.body.style.userSelect="none",g.current=f.touches[0].pageX},onMouseDown:f=>{document.body.style.userSelect="none",g.current=f.pageX},onTouchMove:f=>{if(f.preventDefault(),g.current===null||!r||!c.length)return;const{pageX:p}=f.touches[0],C=g.current-p;if(C){const S=C/r,j=Math.round(c.length*S);a(D=>{let w=D[1]+j;return w=Math.min(w,c.length-D[0]-2e3),w=Math.max(w,0),[D[0],w]}),g.current=p}},onTouchEnd:()=>{g.current=null},onTouchCancel:()=>{g.current=null}}))))}function Qt(e){var n=e,{sample:t}=n,a=Yt(n,["sample"]);const[l,c]=Object(u.useState)(null);Object(u.useEffect)(()=>{let i=!1;return(()=>Kt(this,null,function*(){if(i)return;const r=yield be(t.metadata.sourceFileId,Boolean(t.metadata.userFileInfo));i||c([t.metadata.sourceFileId,r])}))(),()=>{i=!0}},[t.metadata.sourceFileId,t.metadata.userFileInfo]);const s=Object(u.useRef)(t);return l&&t.metadata.sourceFileId===l[0]&&(s.current=t),o.a.createElement(_t,Gt($t({},a),{sample:s.current,sourceAudioBuffer:l&&l[1]}))}var Jt=Qt,Zt=y(147),qt=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});let et;function en(){return qt(this,null,function*(){if(typeof window.CREATE_SYRO_BINDINGS!="function")return Promise.reject("Expected CREATE_SYRO_BINDINGS global function to exist");const e=yield window.CREATE_SYRO_BINDINGS();return et=et||new Promise((n,t)=>{let a;try{a={prepareSampleBufferFromWavData:e.cwrap("prepareSampleBufferFromWavData","number",["array","number","number","number","number"]),prepareSampleBufferFrom16BitPcmData(){throw new Error("This function does not work. Use prepareSampleBufferFromWavData.")},getSampleBufferChunkPointer:e.cwrap("getSampleBufferChunkPointer","number",["number"]),getSampleBufferChunkSize:e.cwrap("getSampleBufferChunkSize","number",["number"]),getSampleBufferProgress:e.cwrap("getSampleBufferProgress","number",["number"]),getSampleBufferTotalSize:e.cwrap("getSampleBufferTotalSize","number",["number"]),cancelSampleBufferWork:e.cwrap("cancelSampleBufferWork",null,["number"]),registerUpdateCallback(l){return e.addFunction(l,"vi")},unregisterUpdateCallback(l){e.removeFunction(l)},heap8Buffer(){return e.HEAP8.buffer}}}catch(l){t(l);return}n(a)})})}var tn=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});function nn(e,n){let t=!1,a=()=>{};return{cancelWork(){t=!0,a()},sampleBufferPromise:(()=>tn(this,null,function*(){const{prepareSampleBufferFromWavData:l,getSampleBufferChunkPointer:c,getSampleBufferChunkSize:s,getSampleBufferProgress:i,getSampleBufferTotalSize:r,cancelSampleBufferWork:d,registerUpdateCallback:b,unregisterUpdateCallback:m,heap8Buffer:h}=yield en();if(t)return new Uint8Array;const{data:E}=yield Ve(e);if(t)return new Uint8Array;let g,f=0;const p=b(S=>{if(t)return;const j=r(S);g||(g=new Uint8Array(j));const D=c(S),w=s(S),M=i(S);g.set(new Uint8Array(h(),D,w),M-w),f=M/j}),C=l(E,E.length,e.metadata.slotNumber,e.metadata.qualityBitDepth,e.metadata.useCompression?1:0,p);n(f);try{yield new Promise(S=>{let j;a=()=>{cancelAnimationFrame(j),d(C),S()},D();function D(){if(f&&(n(f),f>=1)){S();return}j=requestAnimationFrame(D)}})}finally{a=()=>{},m(p)}if(t)return new Uint8Array;if(!g)throw new Error("Unexpected condition: sampleBuffer should be defined");return g}))()}}var an=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});function rn({sample:e}){const[n,t]=Object(u.useState)(0),[a,l]=Object(u.useState)("idle"),[c,s]=Object(u.useState)(null),[i,r]=Object(u.useState)(null);Object(u.useEffect)(()=>{c instanceof AudioBuffer&&i&&(r(null),i.fn())},[c,i]);const d=Object(u.useRef)(()=>{});Object(u.useEffect)(()=>{let m=!1;t(0),l("idle"),s(null),r(null),d.current=()=>{m=!0};try{const{sampleBufferPromise:h,cancelWork:E}=nn(e,g=>{m||t(g)});d.current=()=>{E(),m=!0},h.then(g=>an(this,null,function*(){if(m)return;d.current=()=>{m=!0};const f=yield Z(g);m||s(f)}))}catch(h){console.error(h),s(new Error(String(h)))}return()=>d.current()},[e]);const{playAudioBuffer:b}=Ue();return o.a.createElement(o.a.Fragment,null,o.a.createElement(B.a,{type:"button",variant:"primary",onClick:m=>{if(!(c instanceof AudioBuffer)){if(!c){const h=m.currentTarget;r({fn:()=>h.click()})}return}try{l("transferring");const h=b(c,{onTimeUpdate:E=>t(E/c.duration),onEnded:()=>l("idle")});d.current=()=>{h(),l("idle")}}catch(h){console.error(h),l("error")}},disabled:c instanceof Error||a==="transferring"},"Transfer to volca sample"),o.a.createElement("br",null),c&&a==="idle"?null:a==="error"?"Error transferring":o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,c?c instanceof AudioBuffer?"Transferring to Volca Sample...":"Error preparing sample for transfer":"Preparing sample for transfer..."),o.a.createElement(Zt.a,{now:100*n}),o.a.createElement("br",null),o.a.createElement(B.a,{type:"button",variant:"light",onClick:()=>d.current()},"Cancel")),o.a.createElement("br",null))}var on=rn,tt=y(72),nt=y.n(tt),ln=y(143),cn=y(137),Ee=y(73),Se=y(74),sn=y(88),un=y(18),W=y.n(un),at=Math.pow;tt.Digit.defaultProps.offOpacity=0;const rt=(e,n)=>Math.min(199,n+at(10,e)),ot=(e,n)=>Math.max(0,n-at(10,e));function dn({sample:e,onSampleUpdate:n}){const[t,a]=Object(u.useState)(e.metadata.slotNumber);Object(u.useEffect)(()=>{a(e.metadata.slotNumber)},[e.metadata.slotNumber]);const[l,c]=Object(u.useState)(null),s=Object(u.useCallback)(b=>{n(e.id,({slotNumber:m})=>({slotNumber:rt(b,m)}))},[e.id,n]),i=Object(u.useCallback)(b=>{n(e.id,({slotNumber:m})=>({slotNumber:ot(b,m)}))},[e.id,n]),r=Object(u.useRef)(null),d=Object(u.useRef)(null);{const b=Object(u.useRef)(l);b.current=l;const m=Object(u.useRef)(e.id);m.current=e.id;const h=Object(u.useRef)(t);h.current=t,Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");function E(O){const A=b.current;if(A!==null)switch(O.stopPropagation(),O.preventDefault(),O.key){case"ArrowDown":a(P=>ot(A,P));break;case"ArrowUp":a(P=>rt(A,P));break;case"ArrowLeft":c(P=>P!==null&&P<2?P+1:P);break;case"ArrowRight":c(P=>P&&P-1);break;case"Enter":case"Escape":c(null);break;default:break}}function g(O){const A=b.current;if(A===null)return;O.stopPropagation(),O.preventDefault();const P=h.current;if(isNaN(Number(O.key)))n(m.current,{slotNumber:P});else{const v=String(P).padStart(3,"0").split("");v[2-A]=O.key;const R=Math.min(199,Math.max(0,Number(v.join(""))));c(A?A-1:null),n(m.current,{slotNumber:R})}}function f(O){r.current&&r.current.contains(O.target)||c(null)}document.addEventListener("keydown",E,!0),document.addEventListener("keyup",g,!0),document.addEventListener("click",f);const p=r.current;let C=0,S=!1,j=!1,D=0;function w(O){document.body.style.userSelect="none",C=O instanceof MouseEvent?O.pageY:O.touches[0].pageY,S=!0,j=!1,D=h.current}p.addEventListener("mousedown",w),p.addEventListener("touchstart",O=>{O.preventDefault(),w(O)});function M(O){if(!S)return;const{pageY:A}=O instanceof MouseEvent?O:O.touches[0],P=2,v=Math.round((C-A)/P);v&&(j=!0,a(Math.min(199,Math.max(0,D+v))))}window.addEventListener("mousemove",M),p.addEventListener("touchmove",M);function k(){document.body.style.userSelect="unset",S=!1,j&&n(m.current,{slotNumber:h.current})}window.addEventListener("mouseup",k),p.addEventListener("touchend",k),p.addEventListener("touchcancel",()=>{document.body.style.userSelect="unset"});function N(O){j||d.current&&d.current.some(A=>A.contains(O.target))||c(2)}return p.addEventListener("click",N),d.current.forEach((O,A)=>{const P=A;O.addEventListener("click",()=>{j||c(P)}),O.addEventListener("touchstart",v=>{v.preventDefault()})}),()=>{document.removeEventListener("keydown",E,!0),document.removeEventListener("keyup",g,!0),document.removeEventListener("click",f),window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",k)}},[n])}return Object(u.useEffect)(()=>{if(!d.current)throw new Error("Expected elements to exist");d.current.forEach((b,m)=>{m===l?b.classList.add(W.a.active):b.classList.remove(W.a.active)})},[l]),o.a.createElement(o.a.Fragment,null,o.a.createElement(T.a.Label,null,"Destination"),o.a.createElement("br",null),o.a.createElement("div",{className:W.a.slotNumberRow},o.a.createElement("div",{className:W.a.slotNumberContainer},o.a.createElement("div",{className:W.a.arrowControls},o.a.createElement("span",{onClick:()=>s(2)},o.a.createElement("img",{src:Ee.a,alt:"Increment 100"})),o.a.createElement("span",{onClick:()=>s(1)},o.a.createElement("img",{src:Ee.a,alt:"Increment 10"})),o.a.createElement("span",{onClick:()=>s(0)},o.a.createElement("img",{src:Ee.a,alt:"Increment 1"}))),o.a.createElement("div",{className:W.a.slotNumber,title:`Slot ${t}`,ref:r},o.a.createElement(nt.a,{value:"8888",color:"var(--bs-gray-dark)",strokeColor:"transparent",digitCount:4}),o.a.createElement(nt.a,{ref:b=>{const m=Object(Pe.findDOMNode)(b);if(m){m.querySelectorAll("circle").forEach(E=>{m.removeChild(E)});const h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.classList.add(W.a.point),h.setAttribute("cx","10.7"),h.setAttribute("cy","17"),h.setAttribute("r","1"),m.appendChild(h),d.current=[].slice.call(m.querySelectorAll("g")).reverse().slice(0,3)}},value:`5${String(t).padStart(3,"0")}`,digitProps:{color:"var(--bs-primary)"},digitCount:4})),o.a.createElement("div",{className:W.a.arrowControls},o.a.createElement("span",{onClick:()=>i(2)},o.a.createElement("img",{src:Se.a,alt:"Decrement 100"})),o.a.createElement("span",{onClick:()=>i(1)},o.a.createElement("img",{src:Se.a,alt:"Decrement 10"})),o.a.createElement("span",{onClick:()=>i(0)},o.a.createElement("img",{src:Se.a,alt:"Decrement 1"})))),e.metadata.slotNumber>99&&t>99&&o.a.createElement(ln.a,{placement:"auto-end",overlay:o.a.createElement(cn.a,null,"To transfer to this destination, be sure you have a volca sample2. The original volca sample only supports slots 0-99.")},o.a.createElement("img",{className:W.a.warning,src:sn.a,alt:"destination-warning"}))))}var fn=dn,mn=y(89),pn=y.n(mn),vn=Object.defineProperty,hn=Object.defineProperties,gn=Object.getOwnPropertyDescriptors,lt=Object.getOwnPropertySymbols,yn=Object.prototype.hasOwnProperty,bn=Object.prototype.propertyIsEnumerable,ct=(e,n,t)=>n in e?vn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,it=(e,n)=>{for(var t in n||(n={}))yn.call(n,t)&&ct(e,t,n[t]);if(lt)for(var t of lt(n))bn.call(n,t)&&ct(e,t,n[t]);return e},st=(e,n)=>hn(e,gn(n)),En=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});function Sn(e,n){const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=n,a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(t)}function wn({sample:e,onSampleUpdate:n,onSampleDuplicate:t,onSampleDelete:a}){const l=e&&e.id,c=Object(u.useCallback)(f=>l&&n(l,{scaleCoefficient:f}),[l,n]),s=Object(u.useCallback)(f=>l&&n(l,p=>st(it({},p),{trim:st(it({},p.trim),{frames:f(p.trim.frames)})})),[l,n]),[i,r]=Object(u.useState)(null),[d,b]=Object(u.useState)(null),[m,h]=Object(u.useState)(null);Object(u.useEffect)(()=>{d instanceof AudioBuffer&&m&&(h(null),m.fn())},[d,m]),Object(u.useEffect)(()=>{if(r(null),h(null),e){let f=!1;Ve(e).then(({data:p})=>{f||r(p)})}},[e]),Object(u.useEffect)(()=>{if(b(null),i){let f=!1;Z(i).then(p=>{f||b(p)})}},[i]);const{playAudioBuffer:E}=Ue(),g=Object(u.useRef)(()=>{});return Object(u.useEffect)(()=>()=>g.current(),[e]),e?o.a.createElement(Qe.a,{fluid:"sm"},o.a.createElement("h2",null,e.metadata.name,o.a.createElement(Vt.a,{style:{display:"inline-block",float:"right"},variant:"light",align:"end",title:"options"},o.a.createElement(ue.a.Item,{onClick:()=>{const f=prompt(`Choose a new name for the sample "${e.metadata.name}":`,e.metadata.name),p=f&&f.trim();p&&n(e.id,{name:p})}},"Rename"),o.a.createElement(ue.a.Item,{onClick:()=>t(e.id)},"Duplicate"),o.a.createElement(ue.a.Divider,null),o.a.createElement(ue.a.Item,{onClick:()=>{window.confirm(`Are you sure you want to delete ${e.metadata.name}?`)&&a(e.id)}},"Delete"))),o.a.createElement("p",null,o.a.createElement("strong",null,"Sampled:")," ",new Date(e.metadata.dateSampled).toLocaleString(),o.a.createElement("br",null),o.a.createElement("strong",null,"Updated:")," ",new Date(e.metadata.dateModified).toLocaleString()),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("div",{className:pn.a.waveformContainer},o.a.createElement(Jt,{onSetTrimFrames:s,onSetScaleCoefficient:c,sample:e})),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(B.a,{type:"button",variant:"secondary",size:"sm",onClick:f=>{if(d)g.current=E(d);else{const p=f.currentTarget;h({fn:()=>p.click()})}}},"Play audio preview")," ",o.a.createElement(B.a,{type:"button",variant:"secondary",size:"sm",onClick:()=>En(this,null,function*(){const{sourceFileId:f,userFileInfo:p}=e.metadata,C=yield x.getSourceFileData(f),S=new Blob([C],{type:p?p.type:"audio/x-wav"});Sn(S,`${e.metadata.name}${p?p.ext:".wav"}`)})},"Download original file"),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(T.a.Group,null,o.a.createElement(T.a.Label,null,"Quality bit depth (",e.metadata.qualityBitDepth,")"),o.a.createElement(T.a.Range,{value:e.metadata.qualityBitDepth,step:1,min:8,max:16,onChange:f=>{const p=Number(f.target.value);n(e.id,{qualityBitDepth:p})}})),o.a.createElement(fn,{sample:e,onSampleUpdate:n}),o.a.createElement("br",null),o.a.createElement(on,{sample:e})):null}var Cn=wn,ut=y(140),On=y(93),q=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});let dt;function we(){const e=Te();return dt=dt||new e(navigator.mediaDevices.getSupportedConstraints().sampleRate?{sampleRate:oe}:{})}function Dn(){return q(this,null,function*(){{const a=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1});for(const l of a.getTracks())l.stop()}const n=(yield navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="audioinput"),t=[];for(const a of n){const l=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:a.deviceId,channelCount:2},video:!1}),c=(yield navigator.mediaDevices.enumerateDevices()).find(({deviceId:i})=>a.deviceId===i).label;let s=1;{const i=l.getAudioTracks()[0],r=i.getSettings().channelCount;r?s=r:i.getCapabilities&&(s=(i.getCapabilities().channelCount||{}).max||s)}for(const i of l.getTracks())i.stop();t.push({device:{deviceId:a.deviceId,label:c},channelsAvailable:s})}return t})}let Ce;function Pn(e){return q(this,arguments,function*({onData:n,onFinish:t}){const a=we();Ce=Ce||a.audioWorklet.addModule("recorderWorkletProcessor.js"),yield Ce;const l=new AudioWorkletNode(a,"recorder-worklet",{parameterData:{bufferSize:1024}});l.port.onmessage=s=>{if(s.data.eventType==="data"){const i=s.data.audioChannels;n(i)}s.data.eventType==="stop"&&t()};const c=l.parameters.get("isRecording");return c.setValueAtTime(1,a.currentTime),{recorderNode:l,stop(){c.setValueAtTime(0,a.currentTime)}}})}function An({channelCount:e,onData:n,onFinish:t}){const l=we().createScriptProcessor(1024,e,e);let c=!1;return l.onaudioprocess=s=>{const i=Array(e).fill().map((r,d)=>s.inputBuffer.getChannelData(d));n(i),c&&t()},{recorderNode:l,stop(){c=!0}}}function kn(e){return q(this,null,function*(){return typeof AudioWorkletNode=="undefined"?An(e):yield Pn(e)})}function jn(e){return q(this,arguments,function*({deviceId:n,channelCount:t,onStart:a,onUpdate:l}){const c=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n,channelCount:t,sampleRate:oe,echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},video:!1}),s=we(),i=s.createMediaStreamSource(c),{recorderNode:r,stop:d}=yield kn({channelCount:t,onData:g,onFinish:j});i.connect(r),r.connect(s.destination);const b=10;a(s.sampleRate,b);const m=b*s.sampleRate;let h=0;const E=Array(t).fill([]);function g(D){let w=0;const M=[];for(let O=0;O<t;O++){const A=D[O],P=A.length,v=A.slice(0,Math.min(P,m-h));Fe(v),w||(w=v.length),M.push(v)}const k=jt(M),N=Le(k);E.push(N),h+=w,h>=m&&d(),l(M)}let f,p;const C=new Promise((D,w)=>{f=D,p=w});let S=!1;function j(){return q(this,null,function*(){if(S)return;try{const M=yield new Blob(E).arrayBuffer(),k=new Float32Array(M),N=Ae()({channels:t,sampleRate:s.sampleRate,bitDepth:16,dataLength:k.byteLength}),O=new Uint8Array(N.length+k.byteLength);O.set(N),O.set(new Uint8Array(k.buffer),N.length),f(O)}catch(w){p(w)}const D=c.getTracks();for(const w of D)w.stop();r.disconnect(s.destination),i.disconnect(r),S=!0})}return{stop:d,mediaRecording:C}})}var Mn=y(45),fe=y.n(Mn),ee=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});const ft="capture_device_preference";let mt=null;function Rn(e,n){const t=Object(u.useRef)(JSON.parse(localStorage.getItem(ft)||"null")),[a,l]=Object(u.useState)(mt),[c,s]=Object(u.useState)(a?"ok":"pending"),[i,r]=Object(u.useState)("");Object(u.useEffect)(()=>{mt=a,s("ok")},[a]);const d=Object(u.useCallback)(()=>{let A=!1;return Dn().then(P=>{A||P.length&&(l(new Map(P.map(v=>[v.device.deviceId,v]))),r(v=>v?(t.current=null,v):t.current&&P.find(({device:R})=>t.current.deviceId===R.deviceId)?t.current.deviceId:(t.current=null,P[0].device.deviceId)))}).catch(P=>{if(!A){if(P instanceof DOMException){if(P.name==="NotAllowedError"){s("denied");return}if(P.name==="NotFoundError"){s("unavailable");return}}throw P}}),()=>{A=!0}},[]),[b,m]=Object(u.useState)(1);Object(u.useEffect)(()=>{const A=a&&a.get(i);A&&(t.current&&t.current.deviceId===A.device.deviceId&&t.current.channelCount<=A.channelsAvailable?m(t.current.channelCount):m(A.channelsAvailable),t.current=null)},[a,i]),Object(u.useEffect)(()=>{i&&localStorage.setItem(ft,JSON.stringify({deviceId:i,channelCount:b}))},[i,b]);const[h,E]=Object(u.useState)("ready"),[g,f]=Object(u.useState)(null),[p,C]=Object(u.useState)(!1);Object(u.useEffect)(()=>{h!=="ready"&&C(!1)},[h]);const S=Object(u.useCallback)(()=>{C(!1)},[]),[j,D]=Object(u.useState)({fn(A){}});Object(u.useEffect)(()=>j.fn,[j]);const[w,M]=Object(u.useState)(1/0),[k,N]=Object(u.useState)(0),O=Object(u.useCallback)(()=>ee(this,null,function*(){let A=!1;const P=(I,$)=>jn({deviceId:I,channelCount:$,onStart:(Q,z)=>{const te=z*Q;M(Q),N(te),E("capturing")},onUpdate:e}),v=t.current,{mediaRecording:R,stop:_}=yield v?(()=>ee(this,null,function*(){try{return P(v.deviceId,v.channelCount)}catch(I){if(I instanceof DOMException&&I.name==="NotFoundError")return P(i,b);throw I}}))():P(i,b);D({fn(I){_(),I&&(A=!0)}});let H;try{H=yield R}catch(I){f(I),E("error");return}if(A)E("ready");else{E("finalizing");const I=yield n(H);A||(E("ready"),I==="silent"&&C(!0))}}),[i,b,e,n]);return{captureDevices:a,accessState:c,selectedCaptureDeviceId:i,selectedChannelCount:b,captureState:h,recordingError:g,showSilenceWarning:p,sampleRate:w,maxSamples:k,refreshCaptureDevices:d,setSelectedCaptureDeviceId:r,setSelectedChannelCount:m,beginRecording:O,stopRecording:j.fn,dismissSilenceWarning:S}}const Oe=3;function In({canvas:e,peaks:n,drawUntil:t,scaleCoefficient:a}){const l="#fff",c=e.getContext("2d");c.imageSmoothingEnabled=!1;const{width:s,height:i}=e;c.clearRect(0,0,s,i),c.fillStyle=l;for(let r=0;r<t&&r<n.length;r++){const d=n[r],b=i*d,m=Math.max(Math.round(a*b),2);c.fillRect(r*Oe,i-m,Oe-1,m)}}function Bn({onRecordFinish:e}){const n=Object(u.useRef)(null),t=Object(u.useRef)(0),a=Object(u.useRef)(new Float32Array),l=Object(u.useRef)(0),c=Object(u.useRef)([]),s=Object(u.useRef)(1/0),i=Object(u.useRef)(0),[r,d]=Object(u.useState)(0),b=Object(u.useCallback)(v=>ee(this,null,function*(){const R=t.current,_=a.current,H=c.current;if(H.push(v),i.current+=v[0].length,d(Math.floor(i.current/s.current)),H.reduce(($,[{length:Q}])=>$+Q,0)>=R){const $=yield Promise.all(v.map((z,te)=>H.reduce((Vn,zn)=>[...Vn,zn[te]],[])).map(z=>ee(this,null,function*(){const te=yield new Blob(z).arrayBuffer();return new Float32Array(te)}))),Q=$.map(z=>xe(new Float32Array(z.buffer,0,R)));_[l.current++]=Math.max(...Q),In({canvas:n.current,peaks:_,drawUntil:l.current,scaleCoefficient:.3}),c.current=[$.map(z=>z.slice(R))]}}),[]),{captureDevices:m,accessState:h,selectedCaptureDeviceId:E,selectedChannelCount:g,captureState:f,recordingError:p,showSilenceWarning:C,maxSamples:S,sampleRate:j,refreshCaptureDevices:D,setSelectedCaptureDeviceId:w,setSelectedChannelCount:M,beginRecording:k,stopRecording:N,dismissSilenceWarning:O}=Rn(b,e);s.current=j,Object(u.useEffect)(()=>{const v=n.current;v&&(v.width=v.offsetWidth,v.height=v.offsetHeight)},[h]),Object(u.useLayoutEffect)(()=>{const v=n.current;!v||(f!=="finalizing"&&v.getContext("2d").clearRect(0,0,v.width,v.height),f==="capturing"&&S&&(t.current=Math.floor(Oe*S/n.current.width),a.current=new Float32Array(Math.floor(S/t.current)),l.current=0,c.current=[],s.current=1/0,i.current=0,d(0)))},[S,f]);const[A,P]=Object(u.useState)(!1);return Object(u.useEffect)(()=>{A&&D()},[A,D]),o.a.createElement(Qe.a,{fluid:"sm"},h==="denied"?o.a.createElement("p",null,"Looks like you didn't grant access to your audio input device. Please give Volca Sampler access, then"," ",o.a.createElement(B.a,{type:"button",variant:"secondary",onClick:D},"try again")):h==="unavailable"?o.a.createElement("p",null,"Volca Sampler couldn't find any audio input devices. Please connect one, then"," ",o.a.createElement(B.a,{type:"button",variant:"secondary",onClick:D},"try again")):o.a.createElement("div",null,o.a.createElement("h2",null,"Send a new sound to your Volca Sample!"),C&&o.a.createElement("div",{className:fe.a.alertContainer},o.a.createElement(ut.a,{dismissible:!0,variant:"warning",onClose:O},o.a.createElement(ut.a.Heading,null,"Your recording was totally silent"),o.a.createElement("p",null,"Check the audio input settings and your connections, then try again"))),o.a.createElement(B.a,{className:fe.a.recordButton,type:"button",variant:f==="capturing"?"danger":"primary",size:"lg",style:{width:250},onClick:f==="capturing"?()=>N():k,disabled:f==="finalizing"},o.a.createElement("canvas",{ref:n}),o.a.createElement("span",{className:fe.a.mainText},["capturing","finalizing"].includes(f)?"Finished recording":"Start recording"),["capturing","finalizing"].includes(f)&&o.a.createElement("span",{className:fe.a.timeRecorded},"0:",String(r).padStart(2,"0"))),["capturing","finalizing"].includes(f)?o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(B.a,{style:{width:250},size:"sm",type:"button",variant:"secondary",onClick:()=>N(!0)},"Cancel")):o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),o.a.createElement(B.a,{style:{width:250},type:"button",variant:"light",size:"sm",onClick:()=>P(v=>!v)},"Audio input settings ",A?"\u25B2":"\u25BC"),o.a.createElement(On.a,{in:A},o.a.createElement("div",null,o.a.createElement(T.a.Group,null,o.a.createElement(T.a.Label,null,"Capture Device"),o.a.createElement(T.a.Select,{style:{width:250},value:E,onChange:v=>w(v.target.value)},m&&h==="ok"?[...m].map(([v,{device:R}])=>o.a.createElement("option",{key:v,value:v},R.label||v)):o.a.createElement("option",{value:"",disabled:!0},"Loading devices..."))),o.a.createElement(T.a.Group,null,o.a.createElement(T.a.Label,null,"Input channels"),o.a.createElement(T.a.Select,{style:{width:250},value:g,onChange:v=>M(Number(v.target.value))},[1,2].map(v=>o.a.createElement("option",{key:v,value:v,disabled:!m||!m.has(E)||m.get(E).channelsAvailable<v},v===1?"Mono":"Stereo (summed to mono)")))),o.a.createElement("br",null))))),f==="error"&&p||null,o.a.createElement("br",null),o.a.createElement(B.a,{style:{width:250},type:"button",variant:"secondary",onClick:v=>{const R=v.currentTarget.querySelector("input");R&&v.target!==R&&R.click()}},"Or import an audio file",o.a.createElement("input",{hidden:!0,type:"file",accept:"audio/*,.wav,.mp3,.ogg",onChange:v=>{if(v.target.files&&v.target.files.length){const R=v.target.files[0];R.arrayBuffer().then(_=>ee(this,null,function*(){const H=new Uint8Array(_);let I;try{I=yield Z(H)}catch($){alert("Unsupported audio format detected");return}if(I.length>10*I.sampleRate){alert("Please select an audio file no more than 10 seconds long");return}e(H,R)}))}}})))}var Nn=Bn,De=y(142),X=y(144),xn=(e,n,t)=>new Promise((a,l)=>{var c=r=>{try{i(t.next(r))}catch(d){l(d)}},s=r=>{try{i(t.throw(r))}catch(d){l(d)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(c,s);i((t=t.apply(e,n)).next())});const Fn=ne.a.div({padding:"2rem",display:"flex",height:"100%"}),Ln=ne.a.div({flexGrow:1});function Tn(){const[e,n]=Object(u.useState)(new Map),[t,a]=Object(u.useState)(new Map),l=Object(u.useMemo)(()=>new Map([...e,...t]),[e,t]);Object(u.useEffect)(()=>{Pt().then(a).catch(console.error)},[]);const[c,s]=Object(u.useState)(null),[i,r]=Object(u.useState)(!0);Object(u.useEffect)(()=>{x.getAllFromStorage().then(g=>{n(f=>new Map([...f,...g.map(p=>[p.id,p])]))}).finally(()=>{r(!1)})},[]);const d=Object(u.useCallback)((g,f)=>xn(this,null,function*(){const p=yield Z(g),C=[0,0],S=yield Ge(p,C);if([...S.positive,...S.negative].every(k=>k===0))return"silent";const j=yield Ct(g);let D="",w="";if(f){const k=f.name.lastIndexOf(".");k>0?(D=f.name.slice(0,k),w=f.name.slice(k)):D=f.name}else D="New sample";const M=new x.Mutable({name:D,sourceFileId:j,trim:{frames:C,waveformPeaks:S},userFileInfo:f&&{type:f.type,ext:w}});return yield M.persist(),n(k=>new Map([[M.id,M],...k])),s(M.id),"saved"}),[]),b=Object(u.useCallback)((g,f)=>{n(p=>{const C=p.get(g);if(C&&C instanceof x.Mutable){const S=C.update(f);if(S!==C)return new Map(p).set(C.id,S)}return p})},[]),[m,h]=Object(u.useState)(!1),E=Object(u.useCallback)(g=>{s(g),h(!1)},[]);return o.a.createElement("div",null,o.a.createElement(gt,{onMenuOpen:()=>h(!0),onHeaderClick:()=>s(null)}),o.a.createElement(De.a,{show:m,onHide:()=>h(!1)},o.a.createElement(De.a.Header,{closeButton:!0}),o.a.createElement(De.a.Body,null,o.a.createElement(ae.a,null,o.a.createElement(ae.a.Item,{as:"button",onClick:()=>E(null)},"New Sample"),i?"Loading...":null,!i&&o.a.createElement(X.a,{defaultActiveKey:e.size?"user":"factory"},o.a.createElement(X.a.Item,{eventKey:"user"},o.a.createElement(X.a.Header,null,"Your Samples"),o.a.createElement(X.a.Body,{style:{padding:0}},o.a.createElement(_e,{samples:e,selectedSampleId:c,onSampleSelect:E}))),o.a.createElement(X.a.Item,{eventKey:"factory"},o.a.createElement(X.a.Header,null,"Factory Samples"),o.a.createElement(X.a.Body,{style:{padding:0}},o.a.createElement(_e,{samples:t,selectedSampleId:c,onSampleSelect:E}))))))),o.a.createElement(Fn,null,o.a.createElement(Ln,null,c&&o.a.createElement(Cn,{sample:l.get(c)||null,onSampleUpdate:b,onSampleDuplicate:g=>{const f=l.get(g);if(f){const p=f.duplicate();n(C=>new Map([[p.id,p],...C])),s(p.id)}},onSampleDelete:g=>{const f=l.get(g);f&&f instanceof x.Mutable&&(f.remove(),n(p=>{const C=new Map(p);return C.delete(f.id),C}))}}),!c&&o.a.createElement(Nn,{onRecordFinish:d}))))}var Wn=Tn,Hn=e=>{e&&e instanceof Function&&y.e(3).then(y.bind(null,148)).then(({getCLS:n,getFID:t,getFCP:a,getLCP:l,getTTFB:c})=>{n(e),t(e),a(e),l(e),c(e)})};Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Response(this).arrayBuffer()}),pt.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Rt,null,o.a.createElement(Wn,null))),document.getElementById("root")),Hn()},18:function(F,U,y){F.exports={slotNumberRow:"SlotNumberInput_slotNumberRow__kQwOw",slotNumberContainer:"SlotNumberInput_slotNumberContainer__1q7P1",arrowControls:"SlotNumberInput_arrowControls__1LPAC",slotNumber:"SlotNumberInput_slotNumber__GC-i7",active:"SlotNumberInput_active__2zN4D",digitBlinkEffect:"SlotNumberInput_digitBlinkEffect__1_u8n",point:"SlotNumberInput_point__3pJD3",warning:"SlotNumberInput_warning__3NAeN"}},29:function(F,U,y){F.exports={title:"Header_title__R3bRx",menuIcon:"Header_menuIcon__swn7p",titleText:"Header_titleText__3e5ME",titleR:"Header_titleR__3QRgv",titleStarburst:"Header_titleStarburst__1oLYP",titleGraphic:"Header_titleGraphic__3S89F"}},45:function(F,U,y){F.exports={alertContainer:"SampleRecord_alertContainer__vjGNP",recordButton:"SampleRecord_recordButton__3R-KX",mainText:"SampleRecord_mainText__2dca6",timeRecorded:"SampleRecord_timeRecorded__3FGTe"}},89:function(F,U,y){F.exports={waveformContainer:"SampleDetail_waveformContainer__3VrPQ",slotNumber:"SampleDetail_slotNumber__3sgS6",point:"SampleDetail_point__3d7qL"}},98:function(F,U,y){},99:function(F,U,y){}},[[130,1,2]]]);

//# sourceMappingURL=main.9a377c81.chunk.js.map